define("domReady",[],function(){function runCallbacks(callbacks){var i;for(i=0;i<callbacks.length;i+=1)callbacks[i](doc)}function callReady(){var callbacks=readyCalls;isPageLoaded&&callbacks.length&&(readyCalls=[],runCallbacks(callbacks))}function pageLoaded(){isPageLoaded||(isPageLoaded=!0,scrollIntervalId&&clearInterval(scrollIntervalId),callReady())}function domReady(callback){return isPageLoaded?callback(doc):readyCalls.push(callback),domReady}var isTop,testDiv,scrollIntervalId,isBrowser="undefined"!=typeof window&&window.document,isPageLoaded=!isBrowser,doc=isBrowser?document:null,readyCalls=[];if(isBrowser){if(document.addEventListener)document.addEventListener("DOMContentLoaded",pageLoaded,!1),window.addEventListener("load",pageLoaded,!1);else if(window.attachEvent){window.attachEvent("onload",pageLoaded),testDiv=document.createElement("div");try{isTop=null===window.frameElement}catch(e){}testDiv.doScroll&&isTop&&window.external&&(scrollIntervalId=setInterval(function(){try{testDiv.doScroll(),pageLoaded()}catch(e){}},30))}"complete"===document.readyState&&pageLoaded()}return domReady.version="2.0.1",domReady.load=function(name,req,onLoad,config){config.isBuild?onLoad(null):domReady(onLoad)},domReady}),function(){var progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,hasLocation="undefined"!=typeof location&&location.href,defaultProtocol=hasLocation&&location.protocol&&location.protocol.replace(/\:/,""),defaultHostName=hasLocation&&location.hostname,defaultPort=hasLocation&&(location.port||void 0),buildMap=[];define("text",[],function(){var text,fs;return text={version:"1.0.8",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);matches&&(content=matches[1])}else content="";return content},jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var xhr,i,progId;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(i=0;3>i;i++){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}return xhr},parseName:function(name){var strip=!1,index=name.indexOf("."),modName=name.substring(0,index),ext=name.substring(index+1,name.length);return index=ext.indexOf("!"),-1!==index&&(strip=ext.substring(index+1,ext.length),strip="strip"===strip,ext=ext.substring(0,index)),{moduleName:modName,ext:ext,strip:strip}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(url,protocol,hostname,port){var uProtocol,uHostName,uPort,match=text.xdRegExp.exec(url);return match?(uProtocol=match[2],uHostName=match[3],uHostName=uHostName.split(":"),uPort=uHostName[1],uHostName=uHostName[0],!(uProtocol&&uProtocol!==protocol||uHostName&&uHostName!==hostname||(uPort||uHostName)&&uPort!==port)):!0},finishLoad:function(name,strip,content,onLoad,config){content=strip?text.strip(content):content,config.isBuild&&(buildMap[name]=content),onLoad(content)},load:function(name,req,onLoad,config){if(config.isBuild&&!config.inlineText)return void onLoad();var parsed=text.parseName(name),nonStripName=parsed.moduleName+"."+parsed.ext,url=req.toUrl(nonStripName),useXhr=config&&config.text&&config.text.useXhr||text.useXhr;!hasLocation||useXhr(url,defaultProtocol,defaultHostName,defaultPort)?text.get(url,function(content){text.finishLoad(name,parsed.strip,content,onLoad,config)}):req([nonStripName],function(content){text.finishLoad(parsed.moduleName+"."+parsed.ext,parsed.strip,content,onLoad,config)})},write:function(pluginName,moduleName,write){if(buildMap.hasOwnProperty(moduleName)){var content=text.jsEscape(buildMap[moduleName]);write.asModule(pluginName+"!"+moduleName,"define(function () { return '"+content+"';});\n")}},writeFile:function(pluginName,moduleName,req,write,config){var parsed=text.parseName(moduleName),nonStripName=parsed.moduleName+"."+parsed.ext,fileName=req.toUrl(parsed.moduleName+"."+parsed.ext)+".js";text.load(nonStripName,req,function(){var textWrite=function(contents){return write(fileName,contents)};textWrite.asModule=function(moduleName,contents){return write.asModule(moduleName,fileName,contents)},text.write(pluginName,nonStripName,textWrite,config)},config)}},text.createXhr()?text.get=function(url,callback){var xhr=text.createXhr();xhr.open("GET",url,!0),xhr.onreadystatechange=function(){4===xhr.readyState&&callback(xhr.responseText)},xhr.send(null)}:"undefined"!=typeof process&&process.versions&&process.versions.node?(fs=require.nodeRequire("fs"),text.get=function(url,callback){var file=fs.readFileSync(url,"utf8");0===file.indexOf("ï»¿")&&(file=file.substring(1)),callback(file)}):"undefined"!=typeof Packages&&(text.get=function(url,callback){var stringBuffer,line,encoding="utf-8",file=new java.io.File(url),lineSeparator=java.lang.System.getProperty("line.separator"),input=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),encoding)),content="";try{for(stringBuffer=new java.lang.StringBuffer,line=input.readLine(),line&&line.length()&&65279===line.charAt(0)&&(line=line.substring(1)),stringBuffer.append(line);null!==(line=input.readLine());)stringBuffer.append(lineSeparator),stringBuffer.append(line);content=String(stringBuffer.toString())}finally{input.close()}callback(content)}),text})}(),function(window,undefined){function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);return jQuery.isWindow(obj)?!1:1===obj.nodeType&&length?!0:"array"===type||"function"!==type&&(0===length||"number"==typeof length&&length>0&&length-1 in obj)}function createOptions(options){var object=optionsCache[options]={};return jQuery.each(options.match(core_rnotwhite)||[],function(_,flag){object[flag]=!0}),object}function internalData(elem,name,data,pvt){if(jQuery.acceptData(elem)){var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if(id&&cache[id]&&(pvt||cache[id].data)||data!==undefined||"string"!=typeof name)return id||(id=isNode?elem[internalKey]=core_deletedIds.pop()||jQuery.guid++:internalKey),cache[id]||(cache[id]=isNode?{}:{toJSON:jQuery.noop}),("object"==typeof name||"function"==typeof name)&&(pvt?cache[id]=jQuery.extend(cache[id],name):cache[id].data=jQuery.extend(cache[id].data,name)),thisCache=cache[id],pvt||(thisCache.data||(thisCache.data={}),thisCache=thisCache.data),data!==undefined&&(thisCache[jQuery.camelCase(name)]=data),"string"==typeof name?(ret=thisCache[name],null==ret&&(ret=thisCache[jQuery.camelCase(name)])):ret=thisCache,ret}}function internalRemoveData(elem,name,pvt){if(jQuery.acceptData(elem)){var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(cache[id]){if(name&&(thisCache=pvt?cache[id]:cache[id].data)){jQuery.isArray(name)?name=name.concat(jQuery.map(name,jQuery.camelCase)):name in thisCache?name=[name]:(name=jQuery.camelCase(name),name=name in thisCache?[name]:name.split(" ")),i=name.length;for(;i--;)delete thisCache[name[i]];if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache))return}(pvt||(delete cache[id].data,isEmptyDataObject(cache[id])))&&(isNode?jQuery.cleanData([elem],!0):jQuery.support.deleteExpando||cache!=cache.window?delete cache[id]:cache[id]=null)}}}function dataAttr(elem,key,data){if(data===undefined&&1===elem.nodeType){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();if(data=elem.getAttribute(name),"string"==typeof data){try{data="true"===data?!0:"false"===data?!1:"null"===data?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else data=undefined}return data}function isEmptyDataObject(obj){var name;for(name in obj)if(("data"!==name||!jQuery.isEmptyObject(obj[name]))&&"toJSON"!==name)return!1;return!0}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}function sibling(cur,dir){do cur=cur[dir];while(cur&&1!==cur.nodeType);return cur}function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not});if(qualifier.nodeType)return jQuery.grep(elements,function(elem){return elem===qualifier!==not});if("string"==typeof qualifier){if(isSimple.test(qualifier))return jQuery.filter(qualifier,elements,not);qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return jQuery.inArray(elem,qualifier)>=0!==not})}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement)for(;list.length;)safeFrag.createElement(list.pop());return safeFrag}function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(1===content.nodeType?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){return elem.type=(null!==jQuery.find.attr(elem,"type"))+"/"+elem.type,elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);return match?elem.type=match[1]:elem.removeAttribute("type"),elem}function setGlobalEval(elems,refElements){for(var elem,i=0;null!=(elem=elems[i]);i++)jQuery._data(elem,"globalEval",!refElements||jQuery._data(refElements[i],"globalEval"))}function cloneCopyEvent(src,dest){if(1===dest.nodeType&&jQuery.hasData(src)){var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle,curData.events={};for(type in events)for(i=0,l=events[type].length;l>i;i++)jQuery.event.add(dest,type,events[type][i])}curData.data&&(curData.data=jQuery.extend({},curData.data))}}function fixCloneNodeIssues(src,dest){var nodeName,e,data;if(1===dest.nodeType){if(nodeName=dest.nodeName.toLowerCase(),!jQuery.support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);for(e in data.events)jQuery.removeEvent(dest,e,data.handle);dest.removeAttribute(jQuery.expando)}"script"===nodeName&&dest.text!==src.text?(disableScript(dest).text=src.text,restoreScript(dest)):"object"===nodeName?(dest.parentNode&&(dest.outerHTML=src.outerHTML),jQuery.support.html5Clone&&src.innerHTML&&!jQuery.trim(dest.innerHTML)&&(dest.innerHTML=src.innerHTML)):"input"===nodeName&&manipulation_rcheckableType.test(src.type)?(dest.defaultChecked=dest.checked=src.checked,dest.value!==src.value&&(dest.value=src.value)):"option"===nodeName?dest.defaultSelected=dest.selected=src.defaultSelected:("input"===nodeName||"textarea"===nodeName)&&(dest.defaultValue=src.defaultValue)}}function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!==core_strundefined?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!==core_strundefined?context.querySelectorAll(tag||"*"):undefined;if(!found)for(found=[],elems=context.childNodes||context;null!=(elem=elems[i]);i++)!tag||jQuery.nodeName(elem,tag)?found.push(elem):jQuery.merge(found,getAll(elem,tag));return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found}function fixDefaultChecked(elem){manipulation_rcheckableType.test(elem.type)&&(elem.defaultChecked=elem.checked)}function vendorPropName(style,name){if(name in style)return name;for(var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;i--;)if(name=cssPrefixes[i]+capName,name in style)return name;return origName}function isHidden(elem,el){return elem=el||elem,"none"===jQuery.css(elem,"display")||!jQuery.contains(elem.ownerDocument,elem)}function showHide(elements,show){for(var display,elem,hidden,values=[],index=0,length=elements.length;length>index;index++)elem=elements[index],elem.style&&(values[index]=jQuery._data(elem,"olddisplay"),display=elem.style.display,show?(values[index]||"none"!==display||(elem.style.display=""),""===elem.style.display&&isHidden(elem)&&(values[index]=jQuery._data(elem,"olddisplay",css_defaultDisplay(elem.nodeName)))):values[index]||(hidden=isHidden(elem),(display&&"none"!==display||!hidden)&&jQuery._data(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))));for(index=0;length>index;index++)elem=elements[index],elem.style&&(show&&"none"!==elem.style.display&&""!==elem.style.display||(elem.style.display=show?values[index]||"":"none"));return elements}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){for(var i=extra===(isBorderBox?"border":"content")?4:"width"===name?1:0,val=0;4>i;i+=2)"margin"===extra&&(val+=jQuery.css(elem,extra+cssExpand[i],!0,styles)),isBorderBox?("content"===extra&&(val-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==extra&&(val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(val+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==extra&&(val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles)));return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=!0,val="width"===name?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles);if(0>=val||null==val){if(val=curCSS(elem,name,styles),(0>val||null==val)&&(val=elem.style[name]),rnumnonpx.test(val))return val;valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]),val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function css_defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];return display||(display=actualDisplay(nodeName,doc),"none"!==display&&display||(iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(doc.documentElement),doc=(iframe[0].contentWindow||iframe[0].contentDocument).document,doc.write("<!doctype html><html><body>"),doc.close(),display=actualDisplay(nodeName,doc),iframe.detach()),elemdisplay[nodeName]=display),display}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");return elem.remove(),display}function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v?i:"")+"]",v,traditional,add)});else if(traditional||"object"!==jQuery.type(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType[0]?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)}),selected}var inspected={},seekingTransport=structure===transports;return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)src[key]!==undefined&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}function ajaxHandleResponses(s,jqXHR,responses){for(var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),ct===undefined&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}return finalDataType?(finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]):void 0}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(conv=converters[prev+" "+current]||converters["* "+current],!conv)for(conv2 in converters)if(tmp=conv2.split(" "),tmp[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){conv===!0?conv=converters[conv2]:converters[conv2]!==!0&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(conv!==!0)if(conv&&s["throws"])response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function createTween(value,prop,animation){for(var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;length>index;index++)if(tween=collection[index].call(animation,prop,value))return tween}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;length>index;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),1>percent&&length?remaining:(deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;length>index;index++)animation.tweens[index].run(1);return gotoEnd?deferred.resolveWith(elem,[animation,gotoEnd]):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(propFilter(props,animation.opts.specialEasing);length>index;index++)if(result=animationPrefilters[index].call(animation,elem,props,animation.opts))return result;return jQuery.map(props,createTween,animation),jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(name=jQuery.camelCase(index),easing=specialEasing[name],value=props[index],jQuery.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),hooks=jQuery.cssHooks[name],hooks&&"expand"in hooks){value=hooks.expand(value),delete props[name];for(index in value)index in props||(props[index]=value[index],specialEasing[index]=easing)}else specialEasing[name]=easing}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,"fxshow");opts.queue||(hooks=jQuery._queueHooks(elem,"fx"),null==hooks.unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),1===elem.nodeType&&("height"in props||"width"in props)&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],"inline"===jQuery.css(elem,"display")&&"none"===jQuery.css(elem,"float")&&(jQuery.support.inlineBlockNeedsLayout&&"inline"!==css_defaultDisplay(elem.nodeName)?style.zoom=1:style.display="inline-block")),opts.overflow&&(style.overflow="hidden",jQuery.support.shrinkWrapBlocks||anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]}));for(prop in props)if(value=props[prop],rfxtypes.exec(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show"))continue;orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}if(!jQuery.isEmptyObject(orig)){dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=jQuery._data(elem,"fxshow",{}),toggle&&(dataShow.hidden=!hidden),hidden?jQuery(elem).show():anim.done(function(){jQuery(elem).hide()}),anim.done(function(){var prop;jQuery._removeData(elem,"fxshow");for(prop in orig)jQuery.style(elem,prop,orig[prop])});for(prop in orig)tween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=tween.start,hidden&&(tween.end=tween.start,tween.start="width"===prop||"height"===prop?1:0))}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}function genFx(type,includeWidth){var which,attrs={height:type},i=0;for(includeWidth=includeWidth?1:0;4>i;i+=2-includeWidth)which=cssExpand[i],attrs["margin"+which]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function getWindow(elem){return jQuery.isWindow(elem)?elem:9===elem.nodeType?elem.defaultView||elem.parentWindow:!1}var readyList,rootjQuery,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="1.10.2",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},completed=function(event){(document.addEventListener||"load"===event.type||"complete"===document.readyState)&&(detach(),jQuery.ready())},detach=function(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1)):(document.detachEvent("onreadystatechange",completed),window.detachEvent("onload",completed))};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem;if(!selector)return this;if("string"==typeof selector){if(match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector),!match||!match[1]&&context)return!context||context.jquery?(context||rootjQuery).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)jQuery.isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}if(elem=document.getElementById(match[2]),elem&&elem.parentNode){if(elem.id!==match[2])return rootjQuery.find(selector);this.length=1,this[0]=elem}return this.context=document,this.selector=selector,this}return selector.nodeType?(this.context=this[0]=selector,this.length=1,this):jQuery.isFunction(selector)?rootjQuery.ready(selector):(selector.selector!==undefined&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this))},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return null==num?this.toArray():0>num?this[this.length+num]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret.context=this.context,ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){return jQuery.ready.promise().done(fn),this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(0>i?len:0);return this.pushStack(j>=0&&len>j?[this[j]]:[])},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),"object"==typeof target||jQuery.isFunction(target)||(target={}),length===i&&(target=this,--i);length>i;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],copy=options[name],target!==copy&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):copy!==undefined&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){if(wait===!0?!--jQuery.readyWait:!jQuery.isReady){if(!document.body)return setTimeout(jQuery.ready);jQuery.isReady=!0,wait!==!0&&--jQuery.readyWait>0||(readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready"))}},isFunction:function(obj){return"function"===jQuery.type(obj)},isArray:Array.isArray||function(obj){return"array"===jQuery.type(obj)},isWindow:function(obj){return null!=obj&&obj==obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){return null==obj?String(obj):"object"==typeof obj||"function"==typeof obj?class2type[core_toString.call(obj)]||"object":typeof obj},isPlainObject:function(obj){var key;if(!obj||"object"!==jQuery.type(obj)||obj.nodeType||jQuery.isWindow(obj))return!1;try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(jQuery.support.ownLast)for(key in obj)return core_hasOwn.call(obj,key);for(key in obj);return key===undefined||core_hasOwn.call(obj,key)},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,keepScripts){if(!data||"string"!=typeof data)return null;"boolean"==typeof context&&(keepScripts=context,context=!1),context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];return parsed?[context.createElement(parsed[1])]:(parsed=jQuery.buildFragment([data],context,scripts),scripts&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes))},parseJSON:function(data){return window.JSON&&window.JSON.parse?window.JSON.parse(data):null===data?data:"string"==typeof data&&(data=jQuery.trim(data),data&&rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,"")))?new Function("return "+data)():void jQuery.error("Invalid JSON: "+data)},parseXML:function(data){var xml,tmp;if(!data||"string"!=typeof data)return null;try{window.DOMParser?(tmp=new DOMParser,xml=tmp.parseFromString(data,"text/xml")):(xml=new ActiveXObject("Microsoft.XMLDOM"),xml.async="false",xml.loadXML(data))}catch(e){xml=undefined}return xml&&xml.documentElement&&!xml.getElementsByTagName("parsererror").length||jQuery.error("Invalid XML: "+data),xml},noop:function(){},globalEval:function(data){data&&jQuery.trim(data)&&(window.execScript||function(data){window.eval.call(window,data)})(data)},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray)for(;length>i&&(value=callback.apply(obj[i],args),value!==!1);i++);else for(i in obj)if(value=callback.apply(obj[i],args),value===!1)break}else if(isArray)for(;length>i&&(value=callback.call(obj[i],i,obj[i]),value!==!1);i++);else for(i in obj)if(value=callback.call(obj[i],i,obj[i]),value===!1)break;return obj},trim:core_trim&&!core_trim.call("ï»¿Â ")?function(text){return null==text?"":core_trim.call(text)}:function(text){return null==text?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArraylike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):core_push.call(ret,arr)),ret},inArray:function(elem,arr,i){var len;if(arr){if(core_indexOf)return core_indexOf.call(arr,elem,i);for(len=arr.length,i=i?0>i?Math.max(0,len+i):i:0;len>i;i++)if(i in arr&&arr[i]===elem)return i}return-1},merge:function(first,second){var l=second.length,i=first.length,j=0;if("number"==typeof l)for(;l>j;j++)first[i++]=second[j];else for(;second[j]!==undefined;)first[i++]=second[j++];return first.length=i,first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;for(inv=!!inv;length>i;i++)retVal=!!callback(elems[i],i),inv!==retVal&&ret.push(elems[i]);
return ret},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray)for(;length>i;i++)value=callback(elems[i],i,arg),null!=value&&(ret[ret.length]=value);else for(i in elems)value=callback(elems[i],i,arg),null!=value&&(ret[ret.length]=value);return core_concat.apply([],ret)},guid:1,proxy:function(fn,context){var args,proxy,tmp;return"string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),jQuery.isFunction(fn)?(args=core_slice.call(arguments,2),proxy=function(){return fn.apply(context||this,args.concat(core_slice.call(arguments)))},proxy.guid=fn.guid=fn.guid||jQuery.guid++,proxy):undefined},access:function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=null==key;if("object"===jQuery.type(key)){chainable=!0;for(i in key)jQuery.access(elems,fn,i,key[i],!0,emptyGet,raw)}else if(value!==undefined&&(chainable=!0,jQuery.isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,key,value){return bulk.call(jQuery(elem),value)})),fn))for(;length>i;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:function(){return(new Date).getTime()},swap:function(elem,options,callback,args){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];ret=callback.apply(elem,args||[]);for(name in options)elem.style[name]=old[name];return ret}}),jQuery.ready.promise=function(obj){if(!readyList)if(readyList=jQuery.Deferred(),"complete"===document.readyState)setTimeout(jQuery.ready);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1);else{document.attachEvent("onreadystatechange",completed),window.attachEvent("onload",completed);var top=!1;try{top=null==window.frameElement&&document.documentElement}catch(e){}top&&top.doScroll&&!function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}detach(),jQuery.ready()}}()}return readyList.promise(obj)},jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()}),rootjQuery=jQuery(document),function(window,undefined){function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=context.nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector))if(m=match[1]){if(9===nodeType){if(elem=context.getElementById(m),!elem||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&context.parentNode||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){function cache(key,value){return keys.push(key+=" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key]=value}var keys=[];return cache}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=attrs.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function setFilters(){}function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){(!matched||(match=rcomma.exec(soFar)))&&(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length));for(type in Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";len>i;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var data,cache,outerCache,dirkey=dirruns+" "+doneName;if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)if(outerCache=elem[expando]||(elem[expando]={}),(cache=outerCache[dir])&&cache[0]===dirkey){if((data=cache[1])===!0||data===cachedruns)return data===!0}else if(cache=outerCache[dir]=[dirkey],cache[1]=matcher(elem,context,xml)||cachedruns,cache[1]===!0)return!0}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;len>i;i++)(elem=unmatched[i])&&(!filter||filter(elem,context,xml))&&(newUnmatched.push(elem),mapped&&map.push(i));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];len>i;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if(matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches),matcher[expando]){for(j=++i;len>j&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,j>i&&matcherFromTokens(tokens.slice(i,j)),len>j&&matcherFromTokens(tokens=tokens.slice(j)),len>j&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var matcherCachedRuns=0,bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=null!=expandContext,contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",expandContext&&context.parentNode||context),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1;for(outermost&&(outermostContext=context!==document&&context,cachedruns=matcherCachedRuns);null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique,cachedruns=++matcherCachedRuns)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;len>i;i++)Sizzle(selector,contexts[i],results);return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed&&1===match.length){if(tokens=match[0]=match[0].slice(0),tokens.length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0],!context)return results;selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&context.parentNode||context))){if(tokens.splice(i,1),selector=seed.length&&toSelector(tokens),!selector)return push.apply(results,seed),results;break}}return compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector)),results}var i,support,cachedruns,Expr,getText,isXML,compile,outermostContext,sortInput,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),hasDuplicate=!1,sortOrder=function(a,b){return a===b?(hasDuplicate=!0,0):0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;len>i;i++)if(this[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rsibling=new RegExp(whitespace+"*[+~]"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:0>high?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?"HTML"!==documentElement.nodeName:!1},support=Sizzle.support={},setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;return doc!==document&&9===doc.nodeType&&doc.documentElement?(document=doc,docElem=doc.documentElement,documentIsHTML=!isXML(doc),parent&&parent.attachEvent&&parent!==parent.top&&parent.attachEvent("onbeforeunload",function(){setDocument()}),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(doc.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=assert(function(div){return div.innerHTML="<div class='a'></div><div class='a i'></div>",div.firstChild.className="i",2===div.getElementsByClassName("i").length}),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!doc.getElementsByName||!doc.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return typeof context.getElementsByTagName!==strundefined?context.getElementsByTagName(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){return typeof context.getElementsByClassName!==strundefined&&documentIsHTML?context.getElementsByClassName(className):void 0},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(doc.querySelectorAll))&&(assert(function(div){div.innerHTML="<select><option selected=''></option></select>",div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked")}),assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("t",""),div.querySelectorAll("[t^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),contains=rnative.test(docElem.contains)||docElem.compareDocumentPosition?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);return compare?1&compare||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||contains(preferredDoc,a)?-1:b===doc||contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1:a.compareDocumentPosition?-1:1}:function(a,b){var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(a===b)return hasDuplicate=!0,0;if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),!(!support.matchesSelector||!documentIsHTML||rbuggyMatches&&rbuggyMatches.test(expr)||rbuggyQSA&&rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val===undefined?support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null:val},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i];i++)ret+=getText(node);return ret},Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]&&match[4]!==undefined?match[2]=match[4]:unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:operator?(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator?result===check||result.slice(0,check.length+1)===check+"-":!1):!0}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(outerCache=parent[expando]||(parent[expando]={}),cache=outerCache[type]||[],nodeIndex=cache[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return diff-=last,diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)idx=indexOf.call(seed,matched[i]),seed[idx]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return elemLang=elemLang.toLowerCase(),elemLang===lang||0===elemLang.indexOf(lang+"-");while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===!1},disabled:function(elem){return elem.disabled===!0},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,elem.selected===!0},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeName>"@"||3===elem.nodeType||4===elem.nodeType)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||attr.toLowerCase()===elem.type)},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[0>argument?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}},Expr.pseudos.nth=Expr.pseudos.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(group||(group=tokenize(selector)),i=group.length;i--;)cached=matcherFromTokens(group[i]),cached[expando]?setMatchers.push(cached):elementMatchers.push(cached);cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))}),assert(function(div){return div.innerHTML="<a href='#'></a>","#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){return isXML?void 0:elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){return isXML||"input"!==elem.nodeName.toLowerCase()?void 0:elem.defaultValue}),assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;return isXML?void 0:(val=elem.getAttributeNode(name))&&val.specified?val.value:elem[name]===!0?name.toLowerCase():null}),jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains}(window);var optionsCache={};jQuery.Callbacks=function(options){options="string"==typeof options?optionsCache[options]||createOptions(options):jQuery.extend({},options);var firing,memory,fired,firingLength,firingIndex,firingStart,list=[],stack=!options.once&&[],fire=function(data){for(memory=options.memory&&data,fired=!0,firingIndex=firingStart||0,firingStart=0,firingLength=list.length,firing=!0;list&&firingLength>firingIndex;firingIndex++)if(list[firingIndex].apply(data[0],data[1])===!1&&options.stopOnFalse){memory=!1;break}firing=!1,list&&(stack?stack.length&&fire(stack.shift()):memory?list=[]:self.disable())},self={add:function(){if(list){var start=list.length;!function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);"function"===type?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==type&&add(arg)
})}(arguments),firing?firingLength=list.length:memory&&(firingStart=start,fire(memory))}return this},remove:function(){return list&&jQuery.each(arguments,function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;)list.splice(index,1),firing&&(firingLength>=index&&firingLength--,firingIndex>=index&&firingIndex--)}),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!(!list||!list.length)},empty:function(){return list=[],firingLength=0,this},disable:function(){return list=stack=memory=undefined,this},disabled:function(){return!list},lock:function(){return stack=undefined,memory||self.disable(),this},locked:function(){return!stack},fireWith:function(context,args){return!list||fired&&!stack||(args=args||[],args=[context,args.slice?args.slice():args],firing?stack.push(args):fire(args)),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify):newDefer[action+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)})}),fns=null}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};return promise.pipe=promise.then,jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[1^i][2].disable,tuples[2][2].lock),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?promise:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(subordinate){var progressValues,progressContexts,resolveContexts,i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=1!==length||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=1===remaining?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this,values[i]=arguments.length>1?core_slice.call(arguments):value,values===progressValues?deferred.notifyWith(contexts,values):--remaining||deferred.resolveWith(contexts,values)}};if(length>1)for(progressValues=new Array(length),progressContexts=new Array(length),resolveContexts=new Array(length);length>i;i++)resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)?resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues)):--remaining;return remaining||deferred.resolveWith(resolveContexts,resolveValues),deferred.promise()}}),jQuery.support=function(support){var all,a,input,select,fragment,opt,eventName,isSupported,i,div=document.createElement("div");if(div.setAttribute("className","t"),div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",all=div.getElementsByTagName("*")||[],a=div.getElementsByTagName("a")[0],!a||!a.style||!all.length)return support;select=document.createElement("select"),opt=select.appendChild(document.createElement("option")),input=div.getElementsByTagName("input")[0],a.style.cssText="top:1px;float:left;opacity:.5",support.getSetAttribute="t"!==div.className,support.leadingWhitespace=3===div.firstChild.nodeType,support.tbody=!div.getElementsByTagName("tbody").length,support.htmlSerialize=!!div.getElementsByTagName("link").length,support.style=/top/.test(a.getAttribute("style")),support.hrefNormalized="/a"===a.getAttribute("href"),support.opacity=/^0.5/.test(a.style.opacity),support.cssFloat=!!a.style.cssFloat,support.checkOn=!!input.value,support.optSelected=opt.selected,support.enctype=!!document.createElement("form").enctype,support.html5Clone="<:nav></:nav>"!==document.createElement("nav").cloneNode(!0).outerHTML,support.inlineBlockNeedsLayout=!1,support.shrinkWrapBlocks=!1,support.pixelPosition=!1,support.deleteExpando=!0,support.noCloneEvent=!0,support.reliableMarginRight=!0,support.boxSizingReliable=!0,input.checked=!0,support.noCloneChecked=input.cloneNode(!0).checked,select.disabled=!0,support.optDisabled=!opt.disabled;try{delete div.test}catch(e){support.deleteExpando=!1}input=document.createElement("input"),input.setAttribute("value",""),support.input=""===input.getAttribute("value"),input.value="t",input.setAttribute("type","radio"),support.radioValue="t"===input.value,input.setAttribute("checked","t"),input.setAttribute("name","t"),fragment=document.createDocumentFragment(),fragment.appendChild(input),support.appendChecked=input.checked,support.checkClone=fragment.cloneNode(!0).cloneNode(!0).lastChild.checked,div.attachEvent&&(div.attachEvent("onclick",function(){support.noCloneEvent=!1}),div.cloneNode(!0).click());for(i in{submit:!0,change:!0,focusin:!0})div.setAttribute(eventName="on"+i,"t"),support[i+"Bubbles"]=eventName in window||div.attributes[eventName].expando===!1;div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip;for(i in jQuery(support))break;return support.ownLast="0"!==i,jQuery(function(){var container,marginDiv,tds,divReset="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",body=document.getElementsByTagName("body")[0];body&&(container=document.createElement("div"),container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",body.appendChild(container).appendChild(div),div.innerHTML="<table><tr><td></td><td>t</td></tr></table>",tds=div.getElementsByTagName("td"),tds[0].style.cssText="padding:0;margin:0;border:0;display:none",isSupported=0===tds[0].offsetHeight,tds[0].style.display="",tds[1].style.display="none",support.reliableHiddenOffsets=isSupported&&0===tds[0].offsetHeight,div.innerHTML="",div.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",jQuery.swap(body,null!=body.style.zoom?{zoom:1}:{},function(){support.boxSizing=4===div.offsetWidth}),window.getComputedStyle&&(support.pixelPosition="1%"!==(window.getComputedStyle(div,null)||{}).top,support.boxSizingReliable="4px"===(window.getComputedStyle(div,null)||{width:"4px"}).width,marginDiv=div.appendChild(document.createElement("div")),marginDiv.style.cssText=div.style.cssText=divReset,marginDiv.style.marginRight=marginDiv.style.width="0",div.style.width="1px",support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)),typeof div.style.zoom!==core_strundefined&&(div.innerHTML="",div.style.cssText=divReset+"width:1px;padding:1px;display:inline;zoom:1",support.inlineBlockNeedsLayout=3===div.offsetWidth,div.style.display="block",div.innerHTML="<div></div>",div.firstChild.style.width="5px",support.shrinkWrapBlocks=3!==div.offsetWidth,support.inlineBlockNeedsLayout&&(body.style.zoom=1)),body.removeChild(container),container=div=tds=marginDiv=null)}),all=select=fragment=opt=a=input=null,support}({});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(elem){return elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando],!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data){return internalData(elem,name,data)},removeData:function(elem,name){return internalRemoveData(elem,name)},_data:function(elem,name,data){return internalData(elem,name,data,!0)},_removeData:function(elem,name){return internalRemoveData(elem,name,!0)},acceptData:function(elem){if(elem.nodeType&&1!==elem.nodeType&&9!==elem.nodeType)return!1;var noData=elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()];return!noData||noData!==!0&&elem.getAttribute("classid")===noData}}),jQuery.fn.extend({data:function(key,value){var attrs,name,data=null,i=0,elem=this[0];if(key===undefined){if(this.length&&(data=jQuery.data(elem),1===elem.nodeType&&!jQuery._data(elem,"parsedAttrs"))){for(attrs=elem.attributes;i<attrs.length;i++)name=attrs[i].name,0===name.indexOf("data-")&&(name=jQuery.camelCase(name.slice(5)),dataAttr(elem,name,data[name]));jQuery._data(elem,"parsedAttrs",!0)}return data}return"object"==typeof key?this.each(function(){jQuery.data(this,key)}):arguments.length>1?this.each(function(){jQuery.data(this,key,value)}):elem?dataAttr(elem,key,jQuery.data(elem,key)):null},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}}),jQuery.extend({queue:function(elem,type,data){var queue;return elem?(type=(type||"fx")+"queue",queue=jQuery._data(elem,type),data&&(!queue||jQuery.isArray(data)?queue=jQuery._data(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]):void 0},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,next,hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery._removeData(elem,type+"queue"),jQuery._removeData(elem,key)})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){return time=jQuery.fx?jQuery.fx.speeds[time]||time:time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for("string"!=typeof type&&(obj=type,type=undefined),type=type||"fx";i--;)tmp=jQuery._data(elements[i],type+"queueHooks"),tmp&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute,getSetInput=jQuery.support.input;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return name=jQuery.propFix[name]||name,this.each(function(){try{this[name]=undefined,delete this[name]}catch(e){}})},addClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed="string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))});if(proceed)for(classes=(value||"").match(core_rnotwhite)||[];len>i;i++)if(elem=this[i],cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ")){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");elem.className=jQuery.trim(cur)}return this},removeClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=0===arguments.length||"string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))});if(proceed)for(classes=(value||"").match(core_rnotwhite)||[];len>i;i++)if(elem=this[i],cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"")){for(j=0;clazz=classes[j++];)for(;cur.indexOf(" "+clazz+" ")>=0;)cur=cur.replace(" "+clazz+" "," ");elem.className=value?jQuery.trim(cur):""}return this},toggleClass:function(value,stateVal){var type=typeof value;return"boolean"==typeof stateVal&&"string"===type?stateVal?this.addClass(value):this.removeClass(value):this.each(jQuery.isFunction(value)?function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)}:function(){if("string"===type)for(var className,i=0,self=jQuery(this),classNames=value.match(core_rnotwhite)||[];className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else(type===core_strundefined||"boolean"===type)&&(this.className&&jQuery._data(this,"__className__",this.className),this.className=this.className||value===!1?"":jQuery._data(this,"__className__")||"")})},hasClass:function(selector){for(var className=" "+selector+" ",i=0,l=this.length;l>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0)return!0;return!1},val:function(value){var ret,hooks,isFunction,elem=this[0];{if(arguments.length)return isFunction=jQuery.isFunction(value),this.each(function(i){var val;1===this.nodeType&&(val=isFunction?value.call(this,i,jQuery(this).val()):value,null==val?val="":"number"==typeof val?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""})),hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()],hooks&&"set"in hooks&&hooks.set(this,val,"value")!==undefined||(this.value=val))});if(elem)return hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()],hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined?ret:(ret=elem.value,"string"==typeof ret?ret.replace(rreturn,""):null==ret?"":ret)}}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return null!=val?val:elem.text}},select:{get:function(elem){for(var value,option,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type||0>index,values=one?null:[],max=one?index+1:options.length,i=0>index?max:one?index:0;max>i;i++)if(option=options[i],!(!option.selected&&i!==index||(jQuery.support.optDisabled?option.disabled:null!==option.getAttribute("disabled"))||option.parentNode.disabled&&jQuery.nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)option=options[i],(option.selected=jQuery.inArray(jQuery(option).val(),values)>=0)&&(optionSet=!0);return optionSet||(elem.selectedIndex=-1),values}}},attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType)return typeof elem.getAttribute===core_strundefined?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(name=name.toLowerCase(),hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)),value===undefined?hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:(ret=jQuery.find.attr(elem,name),null==ret?undefined:ret):null!==value?hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:(elem.setAttribute(name,value+""),value):void jQuery.removeAttr(elem,name))},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(core_rnotwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)propName=jQuery.propFix[name]||name,jQuery.expr.match.bool.test(name)?getSetInput&&getSetAttribute||!ruseDefault.test(name)?elem[propName]=!1:elem[jQuery.camelCase("default-"+name)]=elem[propName]=!1:jQuery.attr(elem,name,""),elem.removeAttribute(getSetAttribute?name:propName)},attrHooks:{type:{set:function(elem,value){if(!jQuery.support.radioValue&&"radio"===value&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType)return notxml=1!==nType||!jQuery.isXMLDoc(elem),notxml&&(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),value!==undefined?hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}}}),boolHook={set:function(elem,value,name){return value===!1?jQuery.removeAttr(elem,name):getSetInput&&getSetAttribute||!ruseDefault.test(name)?elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name):elem[jQuery.camelCase("default-"+name)]=elem[name]=!0,name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=jQuery.expr.attrHandle[name]||jQuery.find.attr;jQuery.expr.attrHandle[name]=getSetInput&&getSetAttribute||!ruseDefault.test(name)?function(elem,name,isXML){var fn=jQuery.expr.attrHandle[name],ret=isXML?undefined:(jQuery.expr.attrHandle[name]=undefined)!=getter(elem,name,isXML)?name.toLowerCase():null;return jQuery.expr.attrHandle[name]=fn,ret}:function(elem,name,isXML){return isXML?undefined:elem[jQuery.camelCase("default-"+name)]?name.toLowerCase():null}}),getSetInput&&getSetAttribute||(jQuery.attrHooks.value={set:function(elem,value,name){return jQuery.nodeName(elem,"input")?void(elem.defaultValue=value):nodeHook&&nodeHook.set(elem,value,name)}}),getSetAttribute||(nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);return ret||elem.setAttributeNode(ret=elem.ownerDocument.createAttribute(name)),ret.value=value+="","value"===name||value===elem.getAttribute(name)?value:undefined}},jQuery.expr.attrHandle.id=jQuery.expr.attrHandle.name=jQuery.expr.attrHandle.coords=function(elem,name,isXML){var ret;return isXML?undefined:(ret=elem.getAttributeNode(name))&&""!==ret.value?ret.value:null},jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);return ret&&ret.specified?ret.value:undefined},set:nodeHook.set},jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,""===value?!1:value,name)}},jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){return""===value?(elem.setAttribute(name,"auto"),value):void 0}}})),jQuery.support.hrefNormalized||jQuery.each(["href","src"],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4)}}}),jQuery.support.style||(jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||undefined},set:function(elem,value){return elem.style.cssText=value+""}}),jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex),null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.support.enctype||(jQuery.propFix.enctype="encoding"),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){return jQuery.isArray(value)?elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0:void 0}},jQuery.support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})});var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);if(elemData){for(handler.handler&&(handleObjIn=handler,handler=handleObjIn.handler,selector=handleObjIn.selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events={}),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return typeof jQuery===core_strundefined||e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(eventHandle.elem,arguments)},eventHandle.elem=elem),types=(types||"").match(core_rnotwhite)||[""],t=types.length;t--;)tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||(handlers=events[type]=[],handlers.delegateCount=0,special.setup&&special.setup.call(elem,data,namespaces,eventHandle)!==!1||(elem.addEventListener?elem.addEventListener(type,eventHandle,!1):elem.attachEvent&&elem.attachEvent("on"+type,eventHandle))),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0);elem=null}},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(elemData&&(events=elemData.events)){for(types=(types||"").match(core_rnotwhite)||[""],t=types.length;t--;)if(tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,handlers=events[type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&special.teardown.call(elem,namespaces,elemData.handle)!==!1||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&(delete elemData.handle,jQuery._removeData(elem,"events"))}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=core_hasOwn.call(event,"type")?event.type:event,namespaces=core_hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(type.indexOf(".")>=0&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event),event.isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=undefined,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||special.trigger.apply(elem,data)!==!1)){if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)event.type=i>1?bubbleType:special.bindType||type,handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle"),handle&&handle.apply(cur,data),handle=ontype&&cur[ontype],handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===!1&&event.preventDefault();if(event.type=type,!onlyHandlers&&!event.isDefaultPrevented()&&(!special._default||special._default.apply(eventPath.pop(),data)===!1)&&jQuery.acceptData(elem)&&ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype],tmp&&(elem[ontype]=null),jQuery.event.triggered=type;try{elem[type]()}catch(e){}jQuery.event.triggered=undefined,tmp&&(elem[ontype]=tmp)}return event.result}},dispatch:function(event){event=jQuery.event.fix(event);var i,ret,handleObj,matched,j,handlerQueue=[],args=core_slice.call(arguments),handlers=(jQuery._data(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};if(args[0]=event,event.delegateTarget=this,!special.preDispatch||special.preDispatch.call(this,event)!==!1){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)(!event.namespace_re||event.namespace_re.test(handleObj.namespace))&&(event.handleObj=handleObj,event.data=handleObj.data,ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args),ret!==undefined&&(event.result=ret)===!1&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,handlers){var sel,handleObj,matches,i,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||"click"!==event.type))for(;cur!=this;cur=cur.parentNode||this)if(1===cur.nodeType&&(cur.disabled!==!0||"click"!==event.type)){for(matches=[],i=0;delegateCount>i;i++)handleObj=handlers[i],sel=handleObj.selector+" ",matches[sel]===undefined&&(matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length),matches[sel]&&matches.push(handleObj);matches.length&&handlerQueue.push({elem:cur,handlers:matches})}return delegateCount<handlers.length&&handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)}),handlerQueue},fix:function(event){if(event[jQuery.expando])return event;var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];for(fixHook||(this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}),copy=fixHook.props?this.props.concat(fixHook.props):this.props,event=new jQuery.Event(originalEvent),i=copy.length;i--;)prop=copy[i],event[prop]=originalEvent[prop];return event.target||(event.target=originalEvent.srcElement||document),3===event.target.nodeType&&(event.target=event.target.parentNode),event.metaKey=!!event.metaKey,fixHook.filter?fixHook.filter(event,originalEvent):event},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){return null==event.which&&(event.which=null!=original.charCode?original.charCode:original.keyCode),event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;return null==event.pageX&&null!=original.clientX&&(eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)),!event.relatedTarget&&fromElement&&(event.relatedTarget=fromElement===event.target?original.toElement:fromElement),event.which||button===undefined||(event.which=1&button?1:2&button?3:4&button?2:0),event}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===safeActiveElement()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return jQuery.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){event.result!==undefined&&(event.originalEvent.returnValue=event.result)}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0,originalEvent:{}});bubble?jQuery.event.trigger(e,null,elem):jQuery.event.dispatch.call(elem,e),e.isDefaultPrevented()&&event.preventDefault()}},jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle,!1)}:function(elem,type,handle){var name="on"+type;elem.detachEvent&&(typeof elem[name]===core_strundefined&&(elem[name]=null),elem.detachEvent(name,handle))},jQuery.Event=function(src,props){return this instanceof jQuery.Event?(src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||src.returnValue===!1||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),void(this[jQuery.expando]=!0)):new jQuery.Event(src,props)},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;return(!related||related!==target&&!jQuery.contains(target,related))&&(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}}),jQuery.support.submitBubbles||(jQuery.event.special.submit={setup:function(){return jQuery.nodeName(this,"form")?!1:void jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;
form&&!jQuery._data(form,"submitBubbles")&&(jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=!0}),jQuery._data(form,"submitBubbles",!0))})},postDispatch:function(event){event._submit_bubble&&(delete event._submit_bubble,this.parentNode&&!event.isTrigger&&jQuery.event.simulate("submit",this.parentNode,event,!0))},teardown:function(){return jQuery.nodeName(this,"form")?!1:void jQuery.event.remove(this,"._submit")}}),jQuery.support.changeBubbles||(jQuery.event.special.change={setup:function(){return rformElems.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(jQuery.event.add(this,"propertychange._change",function(event){"checked"===event.originalEvent.propertyName&&(this._just_changed=!0)}),jQuery.event.add(this,"click._change",function(event){this._just_changed&&!event.isTrigger&&(this._just_changed=!1),jQuery.event.simulate("change",this,event,!0)})),!1):void jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;rformElems.test(elem.nodeName)&&!jQuery._data(elem,"changeBubbles")&&(jQuery.event.add(elem,"change._change",function(event){!this.parentNode||event.isSimulated||event.isTrigger||jQuery.event.simulate("change",this.parentNode,event,!0)}),jQuery._data(elem,"changeBubbles",!0))})},handle:function(event){var elem=event.target;return this!==elem||event.isSimulated||event.isTrigger||"radio"!==elem.type&&"checkbox"!==elem.type?event.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return jQuery.event.remove(this,"._change"),!rformElems.test(this.nodeName)}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),!0)};jQuery.event.special[fix]={setup:function(){0===attaches++&&document.addEventListener(orig,handler,!0)},teardown:function(){0===--attaches&&document.removeEventListener(orig,handler,!0)}}}),jQuery.fn.extend({on:function(types,selector,data,fn,one){var type,origFn;if("object"==typeof types){"string"!=typeof selector&&(data=data||selector,selector=undefined);for(type in types)this.on(type,selector,data,types[type],one);return this}if(null==data&&null==fn?(fn=selector,data=selector=undefined):null==fn&&("string"==typeof selector?(fn=data,data=undefined):(fn=data,data=selector,selector=undefined)),fn===!1)fn=returnFalse;else if(!fn)return this;return 1===one&&(origFn=fn,fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)},fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"==typeof types){for(type in types)this.off(type,selector,types[type]);return this}return(selector===!1||"function"==typeof selector)&&(fn=selector,selector=undefined),fn===!1&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];return elem?jQuery.event.trigger(type,data,elem,!0):void 0}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;len>i;i++)if(jQuery.contains(self[i],this))return!0}));for(i=0;len>i;i++)jQuery.find(selector,self[i],ret);return ret=this.pushStack(len>1?jQuery.unique(ret):ret),ret.selector=this.selector?this.selector+" "+selector:selector,ret},has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;len>i;i++)if(jQuery.contains(this,targets[i]))return!0})},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length},closest:function(selectors,context){for(var cur,i=0,l=this.length,ret=[],pos=rneedsContext.test(selectors)||"string"!=typeof selectors?jQuery(selectors,context||this.context):0;l>i;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(pos?pos.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){cur=ret.push(cur);break}return this.pushStack(ret.length>1?jQuery.unique(ret):ret)},index:function(elem){return elem?"string"==typeof elem?jQuery.inArray(this[0],jQuery(elem)):jQuery.inArray(elem.jquery?elem[0]:elem,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){var set="string"==typeof selector?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(jQuery.unique(all))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(ret=jQuery.filter(selector,ret)),this.length>1&&(guaranteedUnique[name]||(ret=jQuery.unique(ret)),rparentsprev.test(name)&&(ret=ret.reverse())),this.pushStack(ret)}}),jQuery.extend({filter:function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},dir:function(elem,dir,until){for(var matched=[],cur=elem[dir];cur&&9!==cur.nodeType&&(until===undefined||1!==cur.nodeType||!jQuery(cur).is(until));)1===cur.nodeType&&matched.push(cur),cur=cur[dir];return matched},sibling:function(n,elem){for(var r=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&r.push(n);return r}});var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},remove:function(selector,keepData){for(var elem,elems=selector?jQuery.filter(selector,this):this,i=0;null!=(elem=elems[i]);i++)keepData||1!==elem.nodeType||jQuery.cleanData(getAll(elem)),elem.parentNode&&(keepData&&jQuery.contains(elem.ownerDocument,elem)&&setGlobalEval(getAll(elem,"script")),elem.parentNode.removeChild(elem));return this},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++){for(1===elem.nodeType&&jQuery.cleanData(getAll(elem,!1));elem.firstChild;)elem.removeChild(elem.firstChild);elem.options&&jQuery.nodeName(elem,"select")&&(elem.options.length=0)}return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null==dataAndEvents?!1:dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined)return 1===elem.nodeType?elem.innerHTML.replace(rinlinejQuery,""):undefined;if(!("string"!=typeof value||rnoInnerhtml.test(value)||!jQuery.support.htmlSerialize&&rnoshimcache.test(value)||!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(value)||wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()])){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;l>i;i++)elem=this[i]||{},1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var args=jQuery.map(this,function(elem){return[elem.nextSibling,elem.parentNode]}),i=0;return this.domManip(arguments,function(elem){var next=args[i++],parent=args[i++];parent&&(next&&next.parentNode!==parent&&(next=this.nextSibling),jQuery(this).remove(),parent.insertBefore(elem,next))},!0),i?this:this.remove()},detach:function(selector){return this.remove(selector,!0)},domManip:function(args,callback,allowIntersection){args=core_concat.apply([],args);var first,node,hasScripts,scripts,doc,fragment,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||!(1>=l||"string"!=typeof value||jQuery.support.checkClone)&&rchecked.test(value))return this.each(function(index){var self=set.eq(index);isFunction&&(args[0]=value.call(this,index,self.html())),self.domManip(args,callback,allowIntersection)});if(l&&(fragment=jQuery.buildFragment(args,this[0].ownerDocument,!1,!allowIntersection&&this),first=fragment.firstChild,1===fragment.childNodes.length&&(fragment=first),first)){for(scripts=jQuery.map(getAll(fragment,"script"),disableScript),hasScripts=scripts.length;l>i;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(this[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;hasScripts>i;i++)node=scripts[i],rscriptType.test(node.type||"")&&!jQuery._data(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src?jQuery._evalUrl(node.src):jQuery.globalEval((node.text||node.textContent||node.innerHTML||"").replace(rcleanScript,"")));fragment=first=null}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;last>=i;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),core_push.apply(ret,elems.get());return this.pushStack(ret)}}),jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);if(jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")?clone=elem.cloneNode(!0):(fragmentDiv.innerHTML=elem.outerHTML,fragmentDiv.removeChild(clone=fragmentDiv.firstChild)),!(jQuery.support.noCloneEvent&&jQuery.support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),srcElements=getAll(elem),i=0;null!=(node=srcElements[i]);++i)destElements[i]&&fixCloneNodeIssues(node,destElements[i]);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0;null!=(node=srcElements[i]);i++)cloneCopyEvent(node,destElements[i]);else cloneCopyEvent(elem,clone);return destElements=getAll(clone,"script"),destElements.length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),destElements=srcElements=node=null,clone},buildFragment:function(elems,context,scripts,selection){for(var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;l>i;i++)if(elem=elems[i],elem||0===elem)if("object"===jQuery.type(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||safe.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)&&nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0])),!jQuery.support.tbody)for(elem="table"!==tag||rtbody.test(elem)?"<table>"!==wrap[1]||rtbody.test(elem)?0:tmp:tmp.firstChild,j=elem&&elem.childNodes.length;j--;)jQuery.nodeName(tbody=elem.childNodes[j],"tbody")&&!tbody.childNodes.length&&elem.removeChild(tbody);for(jQuery.merge(nodes,tmp.childNodes),tmp.textContent="";tmp.firstChild;)tmp.removeChild(tmp.firstChild);tmp=safe.lastChild}else nodes.push(context.createTextNode(elem));for(tmp&&safe.removeChild(tmp),jQuery.support.appendChecked||jQuery.grep(getAll(nodes,"input"),fixDefaultChecked),i=0;elem=nodes[i++];)if((!selection||-1===jQuery.inArray(elem,selection))&&(contains=jQuery.contains(elem.ownerDocument,elem),tmp=getAll(safe.appendChild(elem),"script"),contains&&setGlobalEval(tmp),scripts))for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return tmp=null,safe},cleanData:function(elems,acceptData){for(var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=jQuery.support.deleteExpando,special=jQuery.event.special;null!=(elem=elems[i]);i++)if((acceptData||jQuery.acceptData(elem))&&(id=elem[internalKey],data=id&&cache[id])){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);cache[id]&&(delete cache[id],deleteExpando?delete elem[internalKey]:typeof elem.removeAttribute!==core_strundefined?elem.removeAttribute(internalKey):elem[internalKey]=null,core_deletedIds.push(id))}},_evalUrl:function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html))return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))});if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstChild&&1===elem.firstChild.nodeType;)elem=elem.firstChild;return elem}).append(this)}return this},wrapInner:function(html){return this.each(jQuery.isFunction(html)?function(i){jQuery(this).wrapInner(html.call(this,i))}:function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var iframe,getStyles,curCSS,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/,rposition=/^(top|right|bottom|left)$/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){var len,styles,map={},i=0;if(jQuery.isArray(name)){for(styles=getStyles(elem),len=name.length;len>i;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;if(name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],value===undefined)return hooks&&"get"in hooks&&(ret=hooks.get(elem,!1,extra))!==undefined?ret:style[name];if(type=typeof value,"string"===type&&(ret=rrelNum.exec(value))&&(value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name)),type="number"),!(null==value||"number"===type&&isNaN(value)||("number"!==type||jQuery.cssNumber[origName]||(value+="px"),jQuery.support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),hooks&&"set"in hooks&&(value=hooks.set(elem,value,extra))===undefined)))try{style[name]=value}catch(e){}}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],hooks&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),val===undefined&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),extra===!0||jQuery.isNumeric(num)?num||0:val):val}}),window.getComputedStyle?(getStyles=function(elem){return window.getComputedStyle(elem,null)},curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;return computed&&(""!==ret||jQuery.contains(elem.ownerDocument,elem)||(ret=jQuery.style(elem,name)),rnumnonpx.test(ret)&&rmargin.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),ret}):document.documentElement.currentStyle&&(getStyles=function(elem){return elem.currentStyle},curCSS=function(elem,name,_computed){var left,rs,rsLeft,computed=_computed||getStyles(elem),ret=computed?computed[name]:undefined,style=elem.style;return null==ret&&style&&style[name]&&(ret=style[name]),rnumnonpx.test(ret)&&!rposition.test(name)&&(left=style.left,rs=elem.runtimeStyle,rsLeft=rs&&rs.left,rsLeft&&(rs.left=elem.currentStyle.left),style.left="fontSize"===name?"1em":ret,ret=style.pixelLeft+"px",style.left=left,rsLeft&&(rs.left=rsLeft)),""===ret?"auto":ret}),jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){return computed?0===elem.offsetWidth&&rdisplayswap.test(jQuery.css(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra):void 0},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),styles):0)}}}),jQuery.support.opacity||(jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+100*value+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1,(value>=1||""===value)&&""===jQuery.trim(filter.replace(ralpha,""))&&style.removeAttribute&&(style.removeAttribute("filter"),""===value||currentStyle&&!currentStyle.filter)||(style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity)}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(elem,computed){return computed?jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"]):void 0}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){return computed?(computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed):void 0}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0||!jQuery.support.reliableHiddenOffsets&&"none"===(elem.style&&elem.style.display||jQuery.css(elem,"display"))},jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];4>i;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!manipulation_rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():null==value?"":value,s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined&&(traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional),jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")},jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}),jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.fn.load=function(url,params,callback){if("string"!=typeof url&&_load)return _load.apply(this,arguments);var selector,response,type,self=this,off=url.indexOf(" ");return off>=0&&(selector=url.slice(off,url.length),url=url.slice(0,off)),jQuery.isFunction(params)?(callback=params,params=undefined):params&&"object"==typeof params&&(type="POST"),self.length>0&&jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;2!==state&&(state=2,timeoutTimer&&clearTimeout(timeoutTimer),transport=undefined,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&300>status||304===status,responses&&(response=ajaxHandleResponses(s,jqXHR,responses)),response=ajaxConvert(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&(modified=jqXHR.getResponseHeader("Last-Modified"),modified&&(jQuery.lastModified[cacheURL]=modified),modified=jqXHR.getResponseHeader("etag"),modified&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,error=response.error,isSuccess=!error)):(error=statusText,(status||!statusText)&&(statusText="error",0>status&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=undefined,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}"object"==typeof url&&(options=url,url=undefined),options=options||{};var parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(2===state){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2];match=responseHeaders[key.toLowerCase()]}return null==match?null:match},getAllResponseHeaders:function(){return 2===state?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();return state||(name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return state||(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(2>state)for(code in map)statusCode[code]=[statusCode[code],map[code]];else jqXHR.always(map[jqXHR.status]);return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR).complete=completeDeferred.add,jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(core_rnotwhite)||[""],null==s.crossDomain&&(parts=rurl.exec(s.url.toLowerCase()),s.crossDomain=!(!parts||parts[1]===ajaxLocParts[1]&&parts[2]===ajaxLocParts[2]&&(parts[3]||("http:"===parts[1]?"80":"443"))===(ajaxLocParts[3]||("http:"===ajaxLocParts[1]?"80":"443")))),s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),2===state)return jqXHR;
fireGlobals=s.global,fireGlobals&&0===jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url,s.hasContent||(s.data&&(cacheURL=s.url+=(ajax_rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),s.cache===!1&&(s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+ajax_nonce++):cacheURL+(ajax_rquery.test(cacheURL)?"&":"?")+"_="+ajax_nonce++)),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&s.contentType!==!1||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===!1||2===state))return jqXHR.abort();strAbort="abort";for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);if(transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),s.async&&s.timeout>0&&(timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){if(!(2>state))throw e;done(-1,e)}}else done(-1,"No Transport");return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=undefined),jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){s.cache===undefined&&(s.cache=!1),s.crossDomain&&(s.type="GET",s.global=!1)}),jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||jQuery("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script"),script.async=!0,s.scriptCharset&&(script.charset=s.scriptCharset),script.src=s.url,script.onload=script.onreadystatechange=function(_,isAbort){(isAbort||!script.readyState||/loaded|complete/.test(script.readyState))&&(script.onload=script.onreadystatechange=null,script.parentNode&&script.parentNode.removeChild(script),script=null,isAbort||callback(200,"success"))},head.insertBefore(script,head.firstChild)},abort:function(){script&&script.onload(undefined,!0)}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==!1&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");return jsonProp||"jsonp"===s.dataTypes[0]?(callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):s.jsonp!==!1&&(s.url+=(ajax_rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=undefined}),"script"):void 0});var xhrCallbacks,xhrSupported,xhrId=0,xhrOnUnloadAbort=window.ActiveXObject&&function(){var key;for(key in xhrCallbacks)xhrCallbacks[key](undefined,!0)};jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR()}:createStandardXHR,xhrSupported=jQuery.ajaxSettings.xhr(),jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,xhrSupported=jQuery.support.ajax=!!xhrSupported,xhrSupported&&jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var handle,i,xhr=s.xhr();if(s.username?xhr.open(s.type,s.url,s.async,s.username,s.password):xhr.open(s.type,s.url,s.async),s.xhrFields)for(i in s.xhrFields)xhr[i]=s.xhrFields[i];s.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(s.mimeType),s.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest");try{for(i in headers)xhr.setRequestHeader(i,headers[i])}catch(err){}xhr.send(s.hasContent&&s.data||null),callback=function(_,isAbort){var status,responseHeaders,statusText,responses;try{if(callback&&(isAbort||4===xhr.readyState))if(callback=undefined,handle&&(xhr.onreadystatechange=jQuery.noop,xhrOnUnloadAbort&&delete xhrCallbacks[handle]),isAbort)4!==xhr.readyState&&xhr.abort();else{responses={},status=xhr.status,responseHeaders=xhr.getAllResponseHeaders(),"string"==typeof xhr.responseText&&(responses.text=xhr.responseText);try{statusText=xhr.statusText}catch(e){statusText=""}status||!s.isLocal||s.crossDomain?1223===status&&(status=204):status=responses.text?200:404}}catch(firefoxAccessException){isAbort||complete(-1,firefoxAccessException)}responses&&complete(status,statusText,responses,responseHeaders)},s.async?4===xhr.readyState?setTimeout(callback):(handle=++xhrId,xhrOnUnloadAbort&&(xhrCallbacks||(xhrCallbacks={},jQuery(window).unload(xhrOnUnloadAbort)),xhrCallbacks[handle]=callback),xhr.onreadystatechange=callback):callback()},abort:function(){callback&&callback(undefined,!0)}}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||"px"!==unit&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3],parts=parts||[],start=+target||1;do scale=scale||".5",start/=scale,jQuery.style(tween.elem,prop,start+unit);while(scale!==(scale=tween.cur()/target)&&1!==scale&&--maxIterations)}return parts&&(start=tween.start=+start||+target||0,tween.unit=unit,tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]),tween}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){jQuery.isFunction(props)?(callback=props,props=["*"]):props=props.split(" ");for(var prop,index=0,length=props.length;length>index;index++)prop=props[index],tweeners[prop]=tweeners[prop]||[],tweeners[prop].unshift(callback)},prefilter:function(callback,prepend){prepend?animationPrefilters.unshift(callback):animationPrefilters.push(callback)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||"swing",this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.pos=eased=this.options.duration?jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return null==tween.elem[tween.prop]||tween.elem.style&&null!=tween.elem.style[tween.prop]?(result=jQuery.css(tween.elem,tween.prop,""),result&&"auto"!==result?result:0):tween.elem[tween.prop]},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):tween.elem.style&&(null!=tween.elem.style[jQuery.cssProps[tween.prop]]||jQuery.cssHooks[tween.prop])?jQuery.style(tween.elem,tween.prop,tween.now+tween.unit):tween.elem[tween.prop]=tween.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||jQuery._data(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||optall.queue===!1?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=undefined),clearQueue&&type!==!1&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));(dequeue||!gotoEnd)&&jQuery.dequeue(this,type)})},finish:function(type){return type!==!1&&(type=type||"fx"),this.each(function(){var index,data=jQuery._data(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;length>index;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};return opt.duration=jQuery.fx.off?0:"number"==typeof opt.duration?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default,(null==opt.queue||opt.queue===!0)&&(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}},jQuery.timers=[],jQuery.fx=Tween.prototype.init,jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;for(fxNow=jQuery.now();i<timers.length;i++)timer=timers[i],timer()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(timer){timer()&&jQuery.timers.push(timer)&&jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}),jQuery.fn.offset=function(options){if(arguments.length)return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(doc)return docElem=doc.documentElement,jQuery.contains(docElem,elem)?(typeof elem.getBoundingClientRect!==core_strundefined&&(box=elem.getBoundingClientRect()),win=getWindow(doc),{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}):box},jQuery.offset={setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");"static"===position&&(elem.style.position="relative");var curTop,curLeft,curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=("absolute"===position||"fixed"===position)&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={};calculatePosition?(curPosition=curElem.position(),curTop=curPosition.top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,curOffset)),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({position:function(){if(this[0]){var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];return"fixed"===jQuery.css(elem,"position")?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),jQuery.nodeName(offsetParent[0],"html")||(parentOffset=offsetParent.offset()),parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",!0)),{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent||docElem;offsetParent&&!jQuery.nodeName(offsetParent,"html")&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);return val===undefined?win?prop in win?win[prop]:win.document.documentElement[method]:elem[method]:void(win?win.scrollTo(top?jQuery(win).scrollLeft():val,top?val:jQuery(win).scrollTop()):elem[method]=val)},method,val,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(margin===!0||value===!0?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;return jQuery.isWindow(elem)?elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jQuery:"function"==typeof define&&define.amd&&define("jquery",[],function(){return jQuery.noConflict(!0)})}(window),!function(a){"function"==typeof define&&define.amd?define("jquery.cookie",["jquery"],a):a("object"==typeof exports?require("jquery"):jQuery)}(function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}}),"function"==typeof define&&define.amd&&define("foundation",["jquery"],function(jQuery){return function($,window,document,undefined){function removeQuotes(string){return("string"==typeof string||string instanceof String)&&(string=string.replace(/^['\\/"]+|(;\s?})+|['\\/"]+$/g,"")),string}var header_helpers=function(class_array){for(var i=class_array.length,head=$("head");i--;)0===head.has("."+class_array[i]).length&&head.append('<meta class="'+class_array[i]+'" />')};header_helpers(["foundation-mq-small","foundation-mq-medium","foundation-mq-large","foundation-mq-xlarge","foundation-mq-xxlarge","foundation-data-attribute-namespace"]),$(function(){"undefined"!=typeof FastClick&&"undefined"!=typeof document.body&&FastClick.attach(document.body)});var S=function(selector,context){if("string"==typeof selector){if(context){var cont;if(context.jquery){if(cont=context[0],!cont)return context}else cont=context;return $(cont.querySelectorAll(selector))}return $(document.querySelectorAll(selector))}return $(selector,context)},attr_name=function(init){var arr=[];return init||arr.push("data"),this.namespace.length>0&&arr.push(this.namespace),arr.push(this.name),arr.join("-")},add_namespace=function(str){for(var parts=str.split("-"),i=parts.length,arr=[];i--;)0!==i?arr.push(parts[i]):this.namespace.length>0?arr.push(this.namespace,parts[i]):arr.push(parts[i]);return arr.reverse().join("-")},bindings=function(method,options){var self=this,should_bind_events=!S(this).data(this.attr_name(!0));return S(this.scope).is("["+this.attr_name()+"]")?(S(this.scope).data(this.attr_name(!0)+"-init",$.extend({},this.settings,options||method,this.data_options(S(this.scope)))),should_bind_events&&this.events(this.scope)):S("["+this.attr_name()+"]",this.scope).each(function(){var should_bind_events=!S(this).data(self.attr_name(!0)+"-init");S(this).data(self.attr_name(!0)+"-init",$.extend({},self.settings,options||method,self.data_options(S(this)))),should_bind_events&&self.events(this)}),"string"==typeof method?this[method].call(this,options):void 0},single_image_loaded=function(image,callback){function loaded(){callback(image[0])}function bindLoad(){if(this.one("load",loaded),/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var src=this.attr("src"),param=src.match(/\?/)?"&":"?";param+="random="+(new Date).getTime(),this.attr("src",src+param)}}return image.attr("src")?void(image[0].complete||4===image[0].readyState?loaded():bindLoad.call(image)):void loaded()};window.matchMedia=window.matchMedia||function(doc){var bool,docElem=doc.documentElement,refNode=docElem.firstElementChild||docElem.firstChild,fakeBody=doc.createElement("body"),div=doc.createElement("div");return div.id="mq-test-1",div.style.cssText="position:absolute;top:-100em",fakeBody.style.background="none",fakeBody.appendChild(div),function(q){return div.innerHTML='&shy;<style media="'+q+'"> #mq-test-1 { width: 42px; }</style>',docElem.insertBefore(fakeBody,refNode),bool=42===div.offsetWidth,docElem.removeChild(fakeBody),{matches:bool,media:q}}}(document),function(){function raf(){animating&&(requestAnimationFrame(raf),jqueryFxAvailable&&jQuery.fx.tick())}for(var animating,lastTime=0,vendors=["webkit","moz"],requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame,jqueryFxAvailable="undefined"!=typeof jQuery.fx;lastTime<vendors.length&&!requestAnimationFrame;lastTime++)requestAnimationFrame=window[vendors[lastTime]+"RequestAnimationFrame"],cancelAnimationFrame=cancelAnimationFrame||window[vendors[lastTime]+"CancelAnimationFrame"]||window[vendors[lastTime]+"CancelRequestAnimationFrame"];requestAnimationFrame?(window.requestAnimationFrame=requestAnimationFrame,window.cancelAnimationFrame=cancelAnimationFrame,jqueryFxAvailable&&(jQuery.fx.timer=function(timer){timer()&&jQuery.timers.push(timer)&&!animating&&(animating=!0,raf())},jQuery.fx.stop=function(){animating=!1})):(window.requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id},window.cancelAnimationFrame=function(id){clearTimeout(id)})}(jQuery);var Foundation={name:"Foundation",version:"5.3.0",media_queries:{small:S(".foundation-mq-small").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),medium:S(".foundation-mq-medium").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),large:S(".foundation-mq-large").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),xlarge:S(".foundation-mq-xlarge").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,""),xxlarge:S(".foundation-mq-xxlarge").css("font-family").replace(/^[\/\\'"]+|(;\s?})+|[\/\\'"]+$/g,"")},stylesheet:$("<style></style>").appendTo("head")[0].sheet,global:{namespace:undefined},init:function(scope,libraries,method,options,response){var args=[scope,method,options,response],responses=[];if(this.rtl=/rtl/i.test(S("html").attr("dir")),this.scope=scope||this.scope,this.set_namespace(),libraries&&"string"==typeof libraries&&!/reflow/i.test(libraries))this.libs.hasOwnProperty(libraries)&&responses.push(this.init_lib(libraries,args));else for(var lib in this.libs)responses.push(this.init_lib(lib,libraries));return scope},init_lib:function(lib,args){return this.libs.hasOwnProperty(lib)?(this.patch(this.libs[lib]),args&&args.hasOwnProperty(lib)?("undefined"!=typeof this.libs[lib].settings?$.extend(!0,this.libs[lib].settings,args[lib]):"undefined"!=typeof this.libs[lib].defaults&&$.extend(!0,this.libs[lib].defaults,args[lib]),this.libs[lib].init.apply(this.libs[lib],[this.scope,args[lib]])):(args=args instanceof Array?args:new Array(args),this.libs[lib].init.apply(this.libs[lib],args))):function(){}},patch:function(lib){lib.scope=this.scope,lib.namespace=this.global.namespace,lib.rtl=this.rtl,lib.data_options=this.utils.data_options,lib.attr_name=attr_name,lib.add_namespace=add_namespace,lib.bindings=bindings,lib.S=this.utils.S},inherit:function(scope,methods){for(var methods_arr=methods.split(" "),i=methods_arr.length;i--;)this.utils.hasOwnProperty(methods_arr[i])&&(scope[methods_arr[i]]=this.utils[methods_arr[i]])},set_namespace:function(){var namespace=this.global.namespace===undefined?$(".foundation-data-attribute-namespace").css("font-family"):this.global.namespace;this.global.namespace=namespace===undefined||/false/i.test(namespace)?"":namespace},libs:{},utils:{S:S,throttle:function(func,delay){var timer=null;return function(){var context=this,args=arguments;null==timer&&(timer=setTimeout(function(){func.apply(context,args),timer=null},delay))}},debounce:function(func,delay,immediate){var timeout,result;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||(result=func.apply(context,args))},callNow=immediate&&!timeout;return clearTimeout(timeout),timeout=setTimeout(later,delay),callNow&&(result=func.apply(context,args)),result}},data_options:function(el,data_attr_name){function isNumber(o){return!isNaN(o-0)&&null!==o&&""!==o&&o!==!1&&o!==!0}function trim(str){return"string"==typeof str?$.trim(str):str}data_attr_name=data_attr_name||"options";var ii,p,opts_arr,opts={},data_options=function(el){var namespace=Foundation.global.namespace;return el.data(namespace.length>0?namespace+"-"+data_attr_name:data_attr_name)},cached_options=data_options(el);if("object"==typeof cached_options)return cached_options;for(opts_arr=(cached_options||":").split(";"),ii=opts_arr.length;ii--;)p=opts_arr[ii].split(":"),p=[p[0],p.slice(1).join(":")],/true/i.test(p[1])&&(p[1]=!0),/false/i.test(p[1])&&(p[1]=!1),isNumber(p[1])&&(p[1]=-1===p[1].indexOf(".")?parseInt(p[1],10):parseFloat(p[1])),2===p.length&&p[0].length>0&&(opts[trim(p[0])]=trim(p[1]));return opts},register_media:function(media,media_class){Foundation.media_queries[media]===undefined&&($("head").append('<meta class="'+media_class+'"/>'),Foundation.media_queries[media]=removeQuotes($("."+media_class).css("font-family")))},add_custom_rule:function(rule,media){if(media===undefined&&Foundation.stylesheet)Foundation.stylesheet.insertRule(rule,Foundation.stylesheet.cssRules.length);else{var query=Foundation.media_queries[media];query!==undefined&&Foundation.stylesheet.insertRule("@media "+Foundation.media_queries[media]+"{ "+rule+" }")}},image_loaded:function(images,callback){var self=this,unloaded=images.length;0===unloaded&&callback(images),images.each(function(){single_image_loaded(self.S(this),function(){unloaded-=1,0===unloaded&&callback(images)})})},random_str:function(){return this.fidx||(this.fidx=0),this.prefix=this.prefix||[this.name||"F",(+new Date).toString(36)].join("-"),this.prefix+(this.fidx++).toString(36)}}};return $.fn.foundation=function(){var args=Array.prototype.slice.call(arguments,0);return this.each(function(){return Foundation.init.apply(Foundation,[this].concat(args)),this})},Foundation}(jQuery,window,window.document)}),"function"==typeof define&&define.amd&&define("foundation.joyride",["jquery","foundation"],function(jQuery,Foundation){!function($,Foundation,window,document,undefined){Foundation.libs.joyride={name:"joyride",version:"5.3.0",defaults:{expose:!1,modal:!0,tip_location:"bottom",nub_position:"auto",scroll_speed:1500,scroll_animation:"linear",timer:0,start_timer_on_click:!0,start_offset:0,next_button:!0,tip_animation:"fade",pause_after:[],exposed:[],tip_animation_fade_speed:300,cookie_monster:!1,cookie_name:"joyride",cookie_domain:!1,cookie_expires:365,tip_container:"body",abort_on_close:!0,tip_location_patterns:{top:["bottom"],bottom:[],left:["right","top","bottom"],right:["left","top","bottom"]},post_ride_callback:function(){},post_step_callback:function(){},pre_step_callback:function(){},pre_ride_callback:function(){},post_expose_callback:function(){},template:{link:'<a href="#close" class="joyride-close-tip">&times;</a>',timer:'<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>',tip:'<div class="joyride-tip-guide"><span class="joyride-nub"></span></div>',wrapper:'<div class="joyride-content-wrapper"></div>',button:'<a href="#" class="small button joyride-next-tip"></a>',modal:'<div class="joyride-modal-bg"></div>',expose:'<div class="joyride-expose-wrapper"></div>',expose_cover:'<div class="joyride-expose-cover"></div>'},expose_add_class:""},init:function(scope,method,options){Foundation.inherit(this,"throttle random_str"),this.settings=this.settings||$.extend({},this.defaults,options||method),this.bindings(method,options)},events:function(){var self=this;$(this.scope).off(".joyride").on("click.fndtn.joyride",".joyride-next-tip, .joyride-modal-bg",function(e){e.preventDefault(),this.settings.$li.next().length<1?this.end():this.settings.timer>0?(clearTimeout(this.settings.automate),this.hide(),this.show(),this.startTimer()):(this.hide(),this.show())}.bind(this)).on("click.fndtn.joyride",".joyride-close-tip",function(e){e.preventDefault(),this.end(this.settings.abort_on_close)}.bind(this)),$(window).off(".joyride").on("resize.fndtn.joyride",self.throttle(function(){if($("["+self.attr_name()+"]").length>0&&self.settings.$next_tip){if(self.settings.exposed.length>0){var $els=$(self.settings.exposed);$els.each(function(){var $this=$(this);self.un_expose($this),self.expose($this)})}self.is_phone()?self.pos_phone():self.pos_default(!1)}},100))},start:function(){var self=this,$this=$("["+this.attr_name()+"]",this.scope),integer_settings=["timer","scrollSpeed","startOffset","tipAnimationFadeSpeed","cookieExpires"],int_settings_count=integer_settings.length;!$this.length>0||(this.settings.init||this.events(),this.settings=$this.data(this.attr_name(!0)+"-init"),this.settings.$content_el=$this,this.settings.$body=$(this.settings.tip_container),this.settings.body_offset=$(this.settings.tip_container).position(),this.settings.$tip_content=this.settings.$content_el.find("> li"),this.settings.paused=!1,this.settings.attempts=0,"function"!=typeof $.cookie&&(this.settings.cookie_monster=!1),(!this.settings.cookie_monster||this.settings.cookie_monster&&!$.cookie(this.settings.cookie_name))&&(this.settings.$tip_content.each(function(index){var $this=$(this);this.settings=$.extend({},self.defaults,self.data_options($this));for(var i=int_settings_count;i--;)self.settings[integer_settings[i]]=parseInt(self.settings[integer_settings[i]],10);self.create({$li:$this,index:index})}),!this.settings.start_timer_on_click&&this.settings.timer>0?(this.show("init"),this.startTimer()):this.show("init")))},resume:function(){this.set_li(),this.show()},tip_template:function(opts){var $blank,content;return opts.tip_class=opts.tip_class||"",$blank=$(this.settings.template.tip).addClass(opts.tip_class),content=$.trim($(opts.li).html())+this.button_text(opts.button_text)+this.settings.template.link+this.timer_instance(opts.index),$blank.append($(this.settings.template.wrapper)),$blank.first().attr(this.add_namespace("data-index"),opts.index),$(".joyride-content-wrapper",$blank).append(content),$blank[0]},timer_instance:function(index){var txt;return txt=0===index&&this.settings.start_timer_on_click&&this.settings.timer>0||0===this.settings.timer?"":$(this.settings.template.timer)[0].outerHTML},button_text:function(txt){return this.settings.next_button?(txt=$.trim(txt)||"Next",txt=$(this.settings.template.button).append(txt)[0].outerHTML):txt="",txt},create:function(opts){var buttonText=opts.$li.attr(this.add_namespace("data-button"))||opts.$li.attr(this.add_namespace("data-text")),tipClass=opts.$li.attr("class"),$tip_content=$(this.tip_template({tip_class:tipClass,index:opts.index,button_text:buttonText,li:opts.$li}));$(this.settings.tip_container).append($tip_content)},show:function(init){var $timer=null;this.settings.$li===undefined||-1===$.inArray(this.settings.$li.index(),this.settings.pause_after)?(this.settings.paused?this.settings.paused=!1:this.set_li(init),this.settings.attempts=0,this.settings.$li.length&&this.settings.$target.length>0?(init&&(this.settings.pre_ride_callback(this.settings.$li.index(),this.settings.$next_tip),this.settings.modal&&this.show_modal()),this.settings.pre_step_callback(this.settings.$li.index(),this.settings.$next_tip),this.settings.modal&&this.settings.expose&&this.expose(),this.settings.tip_settings=$.extend({},this.settings,this.data_options(this.settings.$li)),this.settings.timer=parseInt(this.settings.timer,10),this.settings.tip_settings.tip_location_pattern=this.settings.tip_location_patterns[this.settings.tip_settings.tip_location],/body/i.test(this.settings.$target.selector)||this.scroll_to(),this.is_phone()?this.pos_phone(!0):this.pos_default(!0),$timer=this.settings.$next_tip.find(".joyride-timer-indicator"),/pop/i.test(this.settings.tip_animation)?($timer.width(0),this.settings.timer>0?(this.settings.$next_tip.show(),setTimeout(function(){$timer.animate({width:$timer.parent().width()},this.settings.timer,"linear")
}.bind(this),this.settings.tip_animation_fade_speed)):this.settings.$next_tip.show()):/fade/i.test(this.settings.tip_animation)&&($timer.width(0),this.settings.timer>0?(this.settings.$next_tip.fadeIn(this.settings.tip_animation_fade_speed).show(),setTimeout(function(){$timer.animate({width:$timer.parent().width()},this.settings.timer,"linear")}.bind(this),this.settings.tip_animation_fade_speed)):this.settings.$next_tip.fadeIn(this.settings.tip_animation_fade_speed)),this.settings.$current_tip=this.settings.$next_tip):this.settings.$li&&this.settings.$target.length<1?this.show():this.end()):this.settings.paused=!0},is_phone:function(){return matchMedia(Foundation.media_queries.small).matches&&!matchMedia(Foundation.media_queries.medium).matches},hide:function(){this.settings.modal&&this.settings.expose&&this.un_expose(),this.settings.modal||$(".joyride-modal-bg").hide(),this.settings.$current_tip.css("visibility","hidden"),setTimeout($.proxy(function(){this.hide(),this.css("visibility","visible")},this.settings.$current_tip),0),this.settings.post_step_callback(this.settings.$li.index(),this.settings.$current_tip)},set_li:function(init){init?(this.settings.$li=this.settings.$tip_content.eq(this.settings.start_offset),this.set_next_tip(),this.settings.$current_tip=this.settings.$next_tip):(this.settings.$li=this.settings.$li.next(),this.set_next_tip()),this.set_target()},set_next_tip:function(){this.settings.$next_tip=$(".joyride-tip-guide").eq(this.settings.$li.index()),this.settings.$next_tip.data("closed","")},set_target:function(){var cl=this.settings.$li.attr(this.add_namespace("data-class")),id=this.settings.$li.attr(this.add_namespace("data-id")),$sel=function(){return id?$(document.getElementById(id)):cl?$("."+cl).first():$("body")};this.settings.$target=$sel()},scroll_to:function(){var window_half,tipOffset;window_half=$(window).height()/2,tipOffset=Math.ceil(this.settings.$target.offset().top-window_half+this.settings.$next_tip.outerHeight()),0!=tipOffset&&$("html, body").stop().animate({scrollTop:tipOffset},this.settings.scroll_speed,"swing")},paused:function(){return-1===$.inArray(this.settings.$li.index()+1,this.settings.pause_after)},restart:function(){this.hide(),this.settings.$li=undefined,this.show("init")},pos_default:function(init){var $nub=this.settings.$next_tip.find(".joyride-nub"),nub_width=Math.ceil($nub.outerWidth()/2),nub_height=Math.ceil($nub.outerHeight()/2),toggle=init||!1;if(toggle&&(this.settings.$next_tip.css("visibility","hidden"),this.settings.$next_tip.show()),/body/i.test(this.settings.$target.selector))this.settings.$li.length&&this.pos_modal($nub);else{var topAdjustment=this.settings.tip_settings.tipAdjustmentY?parseInt(this.settings.tip_settings.tipAdjustmentY):0,leftAdjustment=this.settings.tip_settings.tipAdjustmentX?parseInt(this.settings.tip_settings.tipAdjustmentX):0;this.bottom()?(this.settings.$next_tip.css(this.rtl?{top:this.settings.$target.offset().top+nub_height+this.settings.$target.outerHeight()+topAdjustment,left:this.settings.$target.offset().left+this.settings.$target.outerWidth()-this.settings.$next_tip.outerWidth()+leftAdjustment}:{top:this.settings.$target.offset().top+nub_height+this.settings.$target.outerHeight()+topAdjustment,left:this.settings.$target.offset().left+leftAdjustment}),this.nub_position($nub,this.settings.tip_settings.nub_position,"top")):this.top()?(this.settings.$next_tip.css(this.rtl?{top:this.settings.$target.offset().top-this.settings.$next_tip.outerHeight()-nub_height+topAdjustment,left:this.settings.$target.offset().left+this.settings.$target.outerWidth()-this.settings.$next_tip.outerWidth()}:{top:this.settings.$target.offset().top-this.settings.$next_tip.outerHeight()-nub_height+topAdjustment,left:this.settings.$target.offset().left+leftAdjustment}),this.nub_position($nub,this.settings.tip_settings.nub_position,"bottom")):this.right()?(this.settings.$next_tip.css({top:this.settings.$target.offset().top+topAdjustment,left:this.settings.$target.outerWidth()+this.settings.$target.offset().left+nub_width+leftAdjustment}),this.nub_position($nub,this.settings.tip_settings.nub_position,"left")):this.left()&&(this.settings.$next_tip.css({top:this.settings.$target.offset().top+topAdjustment,left:this.settings.$target.offset().left-this.settings.$next_tip.outerWidth()-nub_width+leftAdjustment}),this.nub_position($nub,this.settings.tip_settings.nub_position,"right")),!this.visible(this.corners(this.settings.$next_tip))&&this.settings.attempts<this.settings.tip_settings.tip_location_pattern.length&&($nub.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"),this.settings.tip_settings.tip_location=this.settings.tip_settings.tip_location_pattern[this.settings.attempts],this.settings.attempts++,this.pos_default())}toggle&&(this.settings.$next_tip.hide(),this.settings.$next_tip.css("visibility","visible"))},pos_phone:function(init){var tip_height=this.settings.$next_tip.outerHeight(),target_height=(this.settings.$next_tip.offset(),this.settings.$target.outerHeight()),$nub=$(".joyride-nub",this.settings.$next_tip),nub_height=Math.ceil($nub.outerHeight()/2),toggle=init||!1;$nub.removeClass("bottom").removeClass("top").removeClass("right").removeClass("left"),toggle&&(this.settings.$next_tip.css("visibility","hidden"),this.settings.$next_tip.show()),/body/i.test(this.settings.$target.selector)?this.settings.$li.length&&this.pos_modal($nub):this.top()?(this.settings.$next_tip.offset({top:this.settings.$target.offset().top-tip_height-nub_height}),$nub.addClass("bottom")):(this.settings.$next_tip.offset({top:this.settings.$target.offset().top+target_height+nub_height}),$nub.addClass("top")),toggle&&(this.settings.$next_tip.hide(),this.settings.$next_tip.css("visibility","visible"))},pos_modal:function($nub){this.center(),$nub.hide(),this.show_modal()},show_modal:function(){if(!this.settings.$next_tip.data("closed")){var joyridemodalbg=$(".joyride-modal-bg");joyridemodalbg.length<1&&$("body").append(this.settings.template.modal).show(),/pop/i.test(this.settings.tip_animation)?joyridemodalbg.show():joyridemodalbg.fadeIn(this.settings.tip_animation_fade_speed)}},expose:function(){var expose,exposeCover,el,origCSS,origClasses,randId="expose-"+this.random_str(6);if(arguments.length>0&&arguments[0]instanceof $)el=arguments[0];else{if(!this.settings.$target||/body/i.test(this.settings.$target.selector))return!1;el=this.settings.$target}return el.length<1?(window.console&&console.error("element not valid",el),!1):(expose=$(this.settings.template.expose),this.settings.$body.append(expose),expose.css({top:el.offset().top,left:el.offset().left,width:el.outerWidth(!0),height:el.outerHeight(!0)}),exposeCover=$(this.settings.template.expose_cover),origCSS={zIndex:el.css("z-index"),position:el.css("position")},origClasses=null==el.attr("class")?"":el.attr("class"),el.css("z-index",parseInt(expose.css("z-index"))+1),"static"==origCSS.position&&el.css("position","relative"),el.data("expose-css",origCSS),el.data("orig-class",origClasses),el.attr("class",origClasses+" "+this.settings.expose_add_class),exposeCover.css({top:el.offset().top,left:el.offset().left,width:el.outerWidth(!0),height:el.outerHeight(!0)}),this.settings.modal&&this.show_modal(),this.settings.$body.append(exposeCover),expose.addClass(randId),exposeCover.addClass(randId),el.data("expose",randId),this.settings.post_expose_callback(this.settings.$li.index(),this.settings.$next_tip,el),void this.add_exposed(el))},un_expose:function(){var exposeId,el,expose,origCSS,origClasses,clearAll=!1;if(arguments.length>0&&arguments[0]instanceof $)el=arguments[0];else{if(!this.settings.$target||/body/i.test(this.settings.$target.selector))return!1;el=this.settings.$target}return el.length<1?(window.console&&console.error("element not valid",el),!1):(exposeId=el.data("expose"),expose=$("."+exposeId),arguments.length>1&&(clearAll=arguments[1]),clearAll===!0?$(".joyride-expose-wrapper,.joyride-expose-cover").remove():expose.remove(),origCSS=el.data("expose-css"),"auto"==origCSS.zIndex?el.css("z-index",""):el.css("z-index",origCSS.zIndex),origCSS.position!=el.css("position")&&("static"==origCSS.position?el.css("position",""):el.css("position",origCSS.position)),origClasses=el.data("orig-class"),el.attr("class",origClasses),el.removeData("orig-classes"),el.removeData("expose"),el.removeData("expose-z-index"),void this.remove_exposed(el))},add_exposed:function(el){this.settings.exposed=this.settings.exposed||[],el instanceof $||"object"==typeof el?this.settings.exposed.push(el[0]):"string"==typeof el&&this.settings.exposed.push(el)},remove_exposed:function(el){var search,i;for(el instanceof $?search=el[0]:"string"==typeof el&&(search=el),this.settings.exposed=this.settings.exposed||[],i=this.settings.exposed.length;i--;)if(this.settings.exposed[i]==search)return void this.settings.exposed.splice(i,1)},center:function(){var $w=$(window);return this.settings.$next_tip.css({top:($w.height()-this.settings.$next_tip.outerHeight())/2+$w.scrollTop(),left:($w.width()-this.settings.$next_tip.outerWidth())/2+$w.scrollLeft()}),!0},bottom:function(){return/bottom/i.test(this.settings.tip_settings.tip_location)},top:function(){return/top/i.test(this.settings.tip_settings.tip_location)},right:function(){return/right/i.test(this.settings.tip_settings.tip_location)},left:function(){return/left/i.test(this.settings.tip_settings.tip_location)},corners:function(el){var w=$(window),window_half=w.height()/2,tipOffset=Math.ceil(this.settings.$target.offset().top-window_half+this.settings.$next_tip.outerHeight()),right=w.width()+w.scrollLeft(),offsetBottom=w.height()+tipOffset,bottom=w.height()+w.scrollTop(),top=w.scrollTop();return top>tipOffset&&(top=0>tipOffset?0:tipOffset),offsetBottom>bottom&&(bottom=offsetBottom),[el.offset().top<top,right<el.offset().left+el.outerWidth(),bottom<el.offset().top+el.outerHeight(),w.scrollLeft()>el.offset().left]},visible:function(hidden_corners){for(var i=hidden_corners.length;i--;)if(hidden_corners[i])return!1;return!0},nub_position:function(nub,pos,def){nub.addClass("auto"===pos?def:pos)},startTimer:function(){this.settings.$li.length?this.settings.automate=setTimeout(function(){this.hide(),this.show(),this.startTimer()}.bind(this),this.settings.timer):clearTimeout(this.settings.automate)},end:function(abort){this.settings.cookie_monster&&$.cookie(this.settings.cookie_name,"ridden",{expires:this.settings.cookie_expires,domain:this.settings.cookie_domain}),this.settings.timer>0&&clearTimeout(this.settings.automate),this.settings.modal&&this.settings.expose&&this.un_expose(),this.settings.$next_tip.data("closed",!0),$(".joyride-modal-bg").hide(),this.settings.$current_tip.hide(),("undefined"==typeof abort||abort===!1)&&(this.settings.post_step_callback(this.settings.$li.index(),this.settings.$current_tip),this.settings.post_ride_callback(this.settings.$li.index(),this.settings.$current_tip)),$(".joyride-tip-guide").remove()},off:function(){$(this.scope).off(".joyride"),$(window).off(".joyride"),$(".joyride-close-tip, .joyride-next-tip, .joyride-modal-bg").off(".joyride"),$(".joyride-tip-guide, .joyride-modal-bg").remove(),clearTimeout(this.settings.automate),this.settings={}},reflow:function(){}}}(jQuery,Foundation,window,window.document)}),function(){function baseIndexOf(array,value,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0;++index<length;)if(array[index]===value)return index;return-1}function compareAscending(a,b){for(var ac=a.criteria,bc=b.criteria,index=-1,length=ac.length;++index<length;){var value=ac[index],other=bc[index];if(value!==other){if(value>other||"undefined"==typeof value)return 1;if(other>value||"undefined"==typeof other)return-1}}return a.index-b.index}function escapeStringChar(match){return"\\"+stringEscapes[match]}function slice(array,start,end){start||(start=0),"undefined"==typeof end&&(end=array?array.length:0);for(var index=-1,length=end-start||0,result=Array(0>length?0:length);++index<length;)result[index]=array[start+index];return result}function lodash(value){return value instanceof lodash?value:new lodashWrapper(value)}function lodashWrapper(value,chainAll){this.__chain__=!!chainAll,this.__wrapped__=value}function baseBind(bindData){function bound(){if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if(this instanceof bound){var thisBinding=baseCreate(func.prototype),result=func.apply(thisBinding,args||arguments);return isObject(result)?result:thisBinding}return func.apply(thisArg,args||arguments)}var func=bindData[0],partialArgs=bindData[2],thisArg=bindData[4];return bound}function baseCreate(prototype){return isObject(prototype)?nativeCreate(prototype):{}}function baseCreateCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if("undefined"==typeof thisArg||!("prototype"in func))return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 2:return function(a,b){return func.call(thisArg,a,b)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)}}return bind(func,thisArg)}function baseCreateWrapper(bindData){function bound(){var thisBinding=isBind?thisArg:this;if(partialArgs){var args=slice(partialArgs);push.apply(args,arguments)}if((partialRightArgs||isCurry)&&(args||(args=slice(arguments)),partialRightArgs&&push.apply(args,partialRightArgs),isCurry&&args.length<arity))return bitmask|=16,baseCreateWrapper([func,isCurryBound?bitmask:-4&bitmask,args,null,thisArg,arity]);if(args||(args=arguments),isBindKey&&(func=thisBinding[key]),this instanceof bound){thisBinding=baseCreate(func.prototype);var result=func.apply(thisBinding,args);return isObject(result)?result:thisBinding}return func.apply(thisBinding,args)}var func=bindData[0],bitmask=bindData[1],partialArgs=bindData[2],partialRightArgs=bindData[3],thisArg=bindData[4],arity=bindData[5],isBind=1&bitmask,isBindKey=2&bitmask,isCurry=4&bitmask,isCurryBound=8&bitmask,key=func;return bound}function baseDifference(array,values){for(var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];++index<length;){var value=array[index];indexOf(values,value)<0&&result.push(value)}return result}function baseFlatten(array,isShallow,isStrict,fromIndex){for(var index=(fromIndex||0)-1,length=array?array.length:0,result=[];++index<length;){var value=array[index];if(value&&"object"==typeof value&&"number"==typeof value.length&&(isArray(value)||isArguments(value))){isShallow||(value=baseFlatten(value,isShallow,isStrict));var valIndex=-1,valLength=value.length,resIndex=result.length;for(result.length+=valLength;++valIndex<valLength;)result[resIndex++]=value[valIndex]}else isStrict||result.push(value)}return result}function baseIsEqual(a,b,stackA,stackB){if(a===b)return 0!==a||1/a==1/b;var type=typeof a,otherType=typeof b;if(!(a!==a||a&&objectTypes[type]||b&&objectTypes[otherType]))return!1;if(null==a||null==b)return a===b;var className=toString.call(a),otherClass=toString.call(b);if(className!=otherClass)return!1;switch(className){case boolClass:case dateClass:return+a==+b;case numberClass:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case regexpClass:case stringClass:return a==String(b)}var isArr=className==arrayClass;if(!isArr){var aWrapped=a instanceof lodash,bWrapped=b instanceof lodash;if(aWrapped||bWrapped)return baseIsEqual(aWrapped?a.__wrapped__:a,bWrapped?b.__wrapped__:b,stackA,stackB);if(className!=objectClass)return!1;var ctorA=a.constructor,ctorB=b.constructor;if(ctorA!=ctorB&&!(isFunction(ctorA)&&ctorA instanceof ctorA&&isFunction(ctorB)&&ctorB instanceof ctorB)&&"constructor"in a&&"constructor"in b)return!1}stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==a)return stackB[length]==b;var result=!0,size=0;if(stackA.push(a),stackB.push(b),isArr){if(size=b.length,result=size==a.length)for(;size--&&(result=baseIsEqual(a[size],b[size],stackA,stackB)););}else forIn(b,function(value,key,b){return hasOwnProperty.call(b,key)?(size++,!(result=hasOwnProperty.call(a,key)&&baseIsEqual(a[key],value,stackA,stackB))&&indicatorObject):void 0}),result&&forIn(a,function(value,key,a){return hasOwnProperty.call(a,key)?!(result=--size>-1)&&indicatorObject:void 0});return stackA.pop(),stackB.pop(),result}function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1))}function baseUniq(array,isSorted,callback){for(var index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[],seen=callback?[]:result;++index<length;){var value=array[index],computed=callback?callback(value,index,array):value;(isSorted?!index||seen[seen.length-1]!==computed:indexOf(seen,computed)<0)&&(callback&&seen.push(computed),result.push(value))}return result}function createAggregator(setter){return function(collection,callback,thisArg){var result={};callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length;){var value=collection[index];setter(result,value,callback(value,index,collection),collection)}else forOwn(collection,function(value,key,collection){setter(result,value,callback(value,key,collection),collection)});return result}}function createWrapper(func,bitmask,partialArgs,partialRightArgs,thisArg,arity){var isBindKey=2&bitmask,isPartial=16&bitmask,isPartialRight=32&bitmask;if(!isBindKey&&!isFunction(func))throw new TypeError;isPartial&&!partialArgs.length&&(bitmask&=-17,isPartial=partialArgs=!1),isPartialRight&&!partialRightArgs.length&&(bitmask&=-33,isPartialRight=partialRightArgs=!1);var creater=1==bitmask||17===bitmask?baseBind:baseCreateWrapper;return creater([func,bitmask,partialArgs,partialRightArgs,thisArg,arity])}function escapeHtmlChar(match){return htmlEscapes[match]}function getIndexOf(){var result=(result=lodash.indexOf)===indexOf?baseIndexOf:result;return result}function isNative(value){return"function"==typeof value&&reNative.test(value)}function unescapeHtmlChar(match){return htmlUnescapes[match]}function isArguments(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==argsClass||!1}function assign(object){if(!object)return object;for(var argsIndex=1,argsLength=arguments.length;argsLength>argsIndex;argsIndex++){var iterable=arguments[argsIndex];if(iterable)for(var key in iterable)object[key]=iterable[key]}return object}function clone(value){return isObject(value)?isArray(value)?slice(value):assign({},value):value}function defaults(object){if(!object)return object;for(var argsIndex=1,argsLength=arguments.length;argsLength>argsIndex;argsIndex++){var iterable=arguments[argsIndex];if(iterable)for(var key in iterable)"undefined"==typeof object[key]&&(object[key]=iterable[key])}return object}function functions(object){var result=[];return forIn(object,function(value,key){isFunction(value)&&result.push(key)}),result.sort()}function has(object,key){return object?hasOwnProperty.call(object,key):!1}function invert(object){for(var index=-1,props=keys(object),length=props.length,result={};++index<length;){var key=props[index];result[object[key]]=key}return result}function isBoolean(value){return value===!0||value===!1||value&&"object"==typeof value&&toString.call(value)==boolClass||!1}function isDate(value){return value&&"object"==typeof value&&toString.call(value)==dateClass||!1}function isElement(value){return value&&1===value.nodeType||!1}function isEmpty(value){if(!value)return!0;if(isArray(value)||isString(value))return!value.length;for(var key in value)if(hasOwnProperty.call(value,key))return!1;return!0}function isEqual(a,b){return baseIsEqual(a,b)}function isFinite(value){return nativeIsFinite(value)&&!nativeIsNaN(parseFloat(value))}function isFunction(value){return"function"==typeof value}function isObject(value){return!(!value||!objectTypes[typeof value])}function isNaN(value){return isNumber(value)&&value!=+value}function isNull(value){return null===value}function isNumber(value){return"number"==typeof value||value&&"object"==typeof value&&toString.call(value)==numberClass||!1}function isRegExp(value){return value&&objectTypes[typeof value]&&toString.call(value)==regexpClass||!1}function isString(value){return"string"==typeof value||value&&"object"==typeof value&&toString.call(value)==stringClass||!1}function isUndefined(value){return"undefined"==typeof value}function omit(object){var props=[];forIn(object,function(value,key){props.push(key)}),props=baseDifference(props,baseFlatten(arguments,!0,!1,1));for(var index=-1,length=props.length,result={};++index<length;){var key=props[index];result[key]=object[key]}return result}function pairs(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;){var key=props[index];result[index]=[key,object[key]]}return result}function pick(object){for(var index=-1,props=baseFlatten(arguments,!0,!1,1),length=props.length,result={};++index<length;){var key=props[index];key in object&&(result[key]=object[key])}return result}function values(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}function contains(collection,target){var indexOf=getIndexOf(),length=collection?collection.length:0,result=!1;return length&&"number"==typeof length?result=indexOf(collection,target)>-1:forOwn(collection,function(value){return(result=value===target)&&indicatorObject}),result}function every(collection,callback,thisArg){var result=!0;callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length&&(result=!!callback(collection[index],index,collection)););else forOwn(collection,function(value,index,collection){return!(result=!!callback(value,index,collection))&&indicatorObject});return result}function filter(collection,callback,thisArg){var result=[];callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length;){var value=collection[index];callback(value,index,collection)&&result.push(value)}else forOwn(collection,function(value,index,collection){callback(value,index,collection)&&result.push(value)});return result}function find(collection,callback,thisArg){callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"!=typeof length){var result;return forOwn(collection,function(value,index,collection){return callback(value,index,collection)?(result=value,indicatorObject):void 0}),result}for(;++index<length;){var value=collection[index];if(callback(value,index,collection))return value}}function findWhere(object,properties){return where(object,properties,!0)}function forEach(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;if(callback=callback&&"undefined"==typeof thisArg?callback:baseCreateCallback(callback,thisArg,3),"number"==typeof length)for(;++index<length&&callback(collection[index],index,collection)!==indicatorObject;);else forOwn(collection,callback)}function forEachRight(collection,callback){var length=collection?collection.length:0;if("number"==typeof length)for(;length--&&callback(collection[length],length,collection)!==!1;);else{var props=keys(collection);length=props.length,forOwn(collection,function(value,key,collection){return key=props?props[--length]:--length,callback(collection[key],key,collection)===!1&&indicatorObject})}}function invoke(collection,methodName){var args=slice(arguments,2),index=-1,isFunc="function"==typeof methodName,length=collection?collection.length:0,result=Array("number"==typeof length?length:0);return forEach(collection,function(value){result[++index]=(isFunc?methodName:value[methodName]).apply(value,args)}),result}function map(collection,callback,thisArg){var index=-1,length=collection?collection.length:0;if(callback=createCallback(callback,thisArg,3),"number"==typeof length)for(var result=Array(length);++index<length;)result[index]=callback(collection[index],index,collection);else result=[],forOwn(collection,function(value,key,collection){result[++index]=callback(value,key,collection)});return result}function max(collection,callback,thisArg){var computed=-1/0,result=computed;"function"!=typeof callback&&thisArg&&thisArg[callback]===collection&&(callback=null);var index=-1,length=collection?collection.length:0;if(null==callback&&"number"==typeof length)for(;++index<length;){var value=collection[index];value>result&&(result=value)}else callback=createCallback(callback,thisArg,3),forEach(collection,function(value,index,collection){var current=callback(value,index,collection);current>computed&&(computed=current,result=value)});return result}function min(collection,callback,thisArg){var computed=1/0,result=computed;"function"!=typeof callback&&thisArg&&thisArg[callback]===collection&&(callback=null);var index=-1,length=collection?collection.length:0;if(null==callback&&"number"==typeof length)for(;++index<length;){var value=collection[index];result>value&&(result=value)}else callback=createCallback(callback,thisArg,3),forEach(collection,function(value,index,collection){var current=callback(value,index,collection);computed>current&&(computed=current,result=value)});return result}function reduce(collection,callback,accumulator,thisArg){if(!collection)return accumulator;var noaccum=arguments.length<3;callback=createCallback(callback,thisArg,4);var index=-1,length=collection.length;if("number"==typeof length)for(noaccum&&(accumulator=collection[++index]);++index<length;)accumulator=callback(accumulator,collection[index],index,collection);else forOwn(collection,function(value,index,collection){accumulator=noaccum?(noaccum=!1,value):callback(accumulator,value,index,collection)});return accumulator}function reduceRight(collection,callback,accumulator,thisArg){var noaccum=arguments.length<3;return callback=createCallback(callback,thisArg,4),forEachRight(collection,function(value,index,collection){accumulator=noaccum?(noaccum=!1,value):callback(accumulator,value,index,collection)}),accumulator}function reject(collection,callback,thisArg){return callback=createCallback(callback,thisArg,3),filter(collection,function(value,index,collection){return!callback(value,index,collection)})}function sample(collection,n,guard){if(collection&&"number"!=typeof collection.length&&(collection=values(collection)),null==n||guard)return collection?collection[baseRandom(0,collection.length-1)]:undefined;var result=shuffle(collection);return result.length=nativeMin(nativeMax(0,n),result.length),result}function shuffle(collection){var index=-1,length=collection?collection.length:0,result=Array("number"==typeof length?length:0);return forEach(collection,function(value){var rand=baseRandom(0,++index);result[index]=result[rand],result[rand]=value}),result}function size(collection){var length=collection?collection.length:0;return"number"==typeof length?length:keys(collection).length}function some(collection,callback,thisArg){var result;callback=createCallback(callback,thisArg,3);var index=-1,length=collection?collection.length:0;if("number"==typeof length)for(;++index<length&&!(result=callback(collection[index],index,collection)););else forOwn(collection,function(value,index,collection){return(result=callback(value,index,collection))&&indicatorObject});return!!result}function sortBy(collection,callback,thisArg){var index=-1,length=collection?collection.length:0,result=Array("number"==typeof length?length:0);for(callback=createCallback(callback,thisArg,3),forEach(collection,function(value,key,collection){result[++index]={criteria:[callback(value,key,collection)],index:index,value:value}}),length=result.length,result.sort(compareAscending);length--;)result[length]=result[length].value;return result}function toArray(collection){return isArray(collection)?slice(collection):collection&&"number"==typeof collection.length?map(collection):values(collection)}function where(collection,properties,first){return first&&isEmpty(properties)?undefined:(first?find:filter)(collection,properties)}function compact(array){for(var index=-1,length=array?array.length:0,result=[];++index<length;){var value=array[index];value&&result.push(value)}return result}function difference(array){return baseDifference(array,baseFlatten(arguments,!0,!0,1))}function first(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=-1;for(callback=createCallback(callback,thisArg,3);++index<length&&callback(array[index],index,array);)n++}else if(n=callback,null==n||thisArg)return array?array[0]:undefined;return slice(array,0,nativeMin(nativeMax(0,n),length))}function flatten(array,isShallow){return baseFlatten(array,isShallow)}function indexOf(array,value,fromIndex){if("number"==typeof fromIndex){var length=array?array.length:0;fromIndex=0>fromIndex?nativeMax(0,length+fromIndex):fromIndex||0}else if(fromIndex){var index=sortedIndex(array,value);return array[index]===value?index:-1}return baseIndexOf(array,value,fromIndex)}function initial(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=length;for(callback=createCallback(callback,thisArg,3);index--&&callback(array[index],index,array);)n++}else n=null==callback||thisArg?1:callback||n;return slice(array,0,nativeMin(nativeMax(0,length-n),length))}function intersection(){for(var args=[],argsIndex=-1,argsLength=arguments.length;++argsIndex<argsLength;){var value=arguments[argsIndex];(isArray(value)||isArguments(value))&&args.push(value)}var array=args[0],index=-1,indexOf=getIndexOf(),length=array?array.length:0,result=[];outer:for(;++index<length;)if(value=array[index],indexOf(result,value)<0){for(var argsIndex=argsLength;--argsIndex;)if(indexOf(args[argsIndex],value)<0)continue outer;result.push(value)}return result}function last(array,callback,thisArg){var n=0,length=array?array.length:0;if("number"!=typeof callback&&null!=callback){var index=length;for(callback=createCallback(callback,thisArg,3);index--&&callback(array[index],index,array);)n++}else if(n=callback,null==n||thisArg)return array?array[length-1]:undefined;return slice(array,nativeMax(0,length-n))}function lastIndexOf(array,value,fromIndex){var index=array?array.length:0;for("number"==typeof fromIndex&&(index=(0>fromIndex?nativeMax(0,index+fromIndex):nativeMin(fromIndex,index-1))+1);index--;)if(array[index]===value)return index;return-1}function range(start,end,step){start=+start||0,step=+step||1,null==end&&(end=start,start=0);for(var index=-1,length=nativeMax(0,ceil((end-start)/step)),result=Array(length);++index<length;)result[index]=start,start+=step;return result}function rest(array,callback,thisArg){if("number"!=typeof callback&&null!=callback){var n=0,index=-1,length=array?array.length:0;for(callback=createCallback(callback,thisArg,3);++index<length&&callback(array[index],index,array);)n++}else n=null==callback||thisArg?1:nativeMax(0,callback);return slice(array,n)}function sortedIndex(array,value,callback,thisArg){var low=0,high=array?array.length:low;for(callback=callback?createCallback(callback,thisArg,1):identity,value=callback(value);high>low;){var mid=low+high>>>1;callback(array[mid])<value?low=mid+1:high=mid}return low}function union(){return baseUniq(baseFlatten(arguments,!0,!0))}function uniq(array,isSorted,callback,thisArg){return"boolean"!=typeof isSorted&&null!=isSorted&&(thisArg=callback,callback="function"!=typeof isSorted&&thisArg&&thisArg[isSorted]===array?null:isSorted,isSorted=!1),null!=callback&&(callback=createCallback(callback,thisArg,3)),baseUniq(array,isSorted,callback)}function without(array){return baseDifference(array,slice(arguments,1))}function zip(){for(var index=-1,length=max(pluck(arguments,"length")),result=Array(0>length?0:length);++index<length;)result[index]=pluck(arguments,index);
return result}function zipObject(keys,values){var index=-1,length=keys?keys.length:0,result={};for(values||!length||isArray(keys[0])||(values=[]);++index<length;){var key=keys[index];values?result[key]=values[index]:key&&(result[key[0]]=key[1])}return result}function after(n,func){if(!isFunction(func))throw new TypeError;return function(){return--n<1?func.apply(this,arguments):void 0}}function bind(func,thisArg){return arguments.length>2?createWrapper(func,17,slice(arguments,2),null,thisArg):createWrapper(func,1,null,null,thisArg)}function bindAll(object){for(var funcs=arguments.length>1?baseFlatten(arguments,!0,!1,1):functions(object),index=-1,length=funcs.length;++index<length;){var key=funcs[index];object[key]=createWrapper(object[key],1,null,null,object)}return object}function compose(){for(var funcs=arguments,length=funcs.length;length--;)if(!isFunction(funcs[length]))throw new TypeError;return function(){for(var args=arguments,length=funcs.length;length--;)args=[funcs[length].apply(this,args)];return args[0]}}function debounce(func,wait,options){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if(!isFunction(func))throw new TypeError;if(wait=nativeMax(0,wait)||0,options===!0){var leading=!0;trailing=!1}else isObject(options)&&(leading=options.leading,maxWait="maxWait"in options&&(nativeMax(wait,options.maxWait)||0),trailing="trailing"in options?options.trailing:trailing);var delayed=function(){var remaining=wait-(now()-stamp);if(0>=remaining){maxTimeoutId&&clearTimeout(maxTimeoutId);var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined,isCalled&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))}else timeoutId=setTimeout(delayed,remaining)},maxDelayed=function(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId=timeoutId=trailingCall=undefined,(trailing||maxWait!==wait)&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))};return function(){if(args=arguments,stamp=now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),maxWait===!1)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=0>=remaining;isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=null),result}}function defer(func){if(!isFunction(func))throw new TypeError;var args=slice(arguments,1);return setTimeout(function(){func.apply(undefined,args)},1)}function delay(func,wait){if(!isFunction(func))throw new TypeError;var args=slice(arguments,2);return setTimeout(function(){func.apply(undefined,args)},wait)}function memoize(func,resolver){var cache={};return function(){var key=resolver?resolver.apply(this,arguments):keyPrefix+arguments[0];return hasOwnProperty.call(cache,key)?cache[key]:cache[key]=func.apply(this,arguments)}}function once(func){var ran,result;if(!isFunction(func))throw new TypeError;return function(){return ran?result:(ran=!0,result=func.apply(this,arguments),func=null,result)}}function partial(func){return createWrapper(func,16,slice(arguments,1))}function throttle(func,wait,options){var leading=!0,trailing=!0;if(!isFunction(func))throw new TypeError;return options===!1?leading=!1:isObject(options)&&(leading="leading"in options?options.leading:leading,trailing="trailing"in options?options.trailing:trailing),options={},options.leading=leading,options.maxWait=wait,options.trailing=trailing,debounce(func,wait,options)}function wrap(value,wrapper){return createWrapper(wrapper,16,[value])}function createCallback(func,thisArg,argCount){var type=typeof func;if(null==func||"function"==type)return baseCreateCallback(func,thisArg,argCount);if("object"!=type)return property(func);var props=keys(func);return function(object){for(var length=props.length,result=!1;length--&&(result=object[props[length]]===func[props[length]]););return result}}function escape(string){return null==string?"":String(string).replace(reUnescapedHtml,escapeHtmlChar)}function identity(value){return value}function mixin(object){forEach(functions(object),function(methodName){var func=lodash[methodName]=object[methodName];lodash.prototype[methodName]=function(){var args=[this.__wrapped__];push.apply(args,arguments);var result=func.apply(lodash,args);return this.__chain__?new lodashWrapper(result,!0):result}})}function noConflict(){return root._=oldDash,this}function property(key){return function(object){return object[key]}}function random(min,max){return null==min&&null==max&&(max=1),min=+min||0,null==max?(max=min,min=0):max=+max||0,min+floor(nativeRandom()*(max-min+1))}function result(object,key){if(object){var value=object[key];return isFunction(value)?object[key]():value}}function template(text,data,options){var _=lodash,settings=_.templateSettings;text=String(text||""),options=defaults({},options,settings);var index=0,source="__p += '",variable=options.variable,reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+(options.interpolate||reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g");text.replace(reDelimiters,function(match,escapeValue,interpolateValue,evaluateValue,offset){return source+=text.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(source+="' +\n_.escape("+escapeValue+") +\n'"),evaluateValue&&(source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n",variable||(variable="obj",source="with ("+variable+" || {}) {\n"+source+"\n}\n"),source="function("+variable+") {\nvar __t, __p = '', __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n"+source+"return __p\n}";try{var result=Function("_","return "+source)(_)}catch(e){throw e.source=source,e}return data?result(data):(result.source=source,result)}function times(n,callback,thisArg){n=(n=+n)>-1?n:0;var index=-1,result=Array(n);for(callback=baseCreateCallback(callback,thisArg,1);++index<n;)result[index]=callback(index);return result}function unescape(string){return null==string?"":String(string).replace(reEscapedHtml,unescapeHtmlChar)}function uniqueId(prefix){var id=++idCounter+"";return prefix?prefix+id:id}function chain(value){return value=new lodashWrapper(value),value.__chain__=!0,value}function tap(value,interceptor){return interceptor(value),value}function wrapperChain(){return this.__chain__=!0,this}function wrapperValueOf(){return this.__wrapped__}var undefined,idCounter=0,indicatorObject={},keyPrefix=+new Date+"",reInterpolate=/<%=([\s\S]+?)%>/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\t\u2028\u2029\\]/g,argsClass="[object Arguments]",arrayClass="[object Array]",boolClass="[object Boolean]",dateClass="[object Date]",funcClass="[object Function]",numberClass="[object Number]",objectClass="[object Object]",regexpClass="[object RegExp]",stringClass="[object String]",objectTypes={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},root=objectTypes[typeof window]&&window||this,freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,freeGlobal=objectTypes[typeof global]&&global;!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal||(root=freeGlobal);var arrayRef=[],objectProto=Object.prototype,oldDash=root._,toString=objectProto.toString,reNative=RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),ceil=Math.ceil,floor=Math.floor,hasOwnProperty=objectProto.hasOwnProperty,push=arrayRef.push,propertyIsEnumerable=objectProto.propertyIsEnumerable,nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeIsFinite=root.isFinite,nativeIsNaN=root.isNaN,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeRandom=Math.random;lodashWrapper.prototype=lodash.prototype;var support={};!function(){var object={0:1,length:1};support.spliceObjects=(arrayRef.splice.call(object,0,1),!object[0])}(1),lodash.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:reInterpolate,variable:""},nativeCreate||(baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||root.Object()}}()),isArguments(arguments)||(isArguments=function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")||!1});var isArray=nativeIsArray||function(value){return value&&"object"==typeof value&&"number"==typeof value.length&&toString.call(value)==arrayClass||!1},shimKeys=function(object){var index,iterable=object,result=[];if(!iterable)return result;if(!objectTypes[typeof object])return result;for(index in iterable)hasOwnProperty.call(iterable,index)&&result.push(index);return result},keys=nativeKeys?function(object){return isObject(object)?nativeKeys(object):[]}:shimKeys,htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},htmlUnescapes=invert(htmlEscapes),reEscapedHtml=RegExp("("+keys(htmlUnescapes).join("|")+")","g"),reUnescapedHtml=RegExp("["+keys(htmlEscapes).join("")+"]","g"),forIn=function(collection,callback){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;for(index in iterable)if(callback(iterable[index],index,collection)===indicatorObject)return result;return result},forOwn=function(collection,callback){var index,iterable=collection,result=iterable;if(!iterable)return result;if(!objectTypes[typeof iterable])return result;for(index in iterable)if(hasOwnProperty.call(iterable,index)&&callback(iterable[index],index,collection)===indicatorObject)return result;return result};isFunction(/x/)&&(isFunction=function(value){return"function"==typeof value&&toString.call(value)==funcClass});var countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key]++:result[key]=1}),groupBy=createAggregator(function(result,value,key){(hasOwnProperty.call(result,key)?result[key]:result[key]=[]).push(value)}),indexBy=createAggregator(function(result,value,key){result[key]=value}),pluck=map,now=isNative(now=Date.now)&&now||function(){return(new Date).getTime()};lodash.after=after,lodash.bind=bind,lodash.bindAll=bindAll,lodash.chain=chain,lodash.compact=compact,lodash.compose=compose,lodash.countBy=countBy,lodash.debounce=debounce,lodash.defaults=defaults,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.filter=filter,lodash.flatten=flatten,lodash.forEach=forEach,lodash.functions=functions,lodash.groupBy=groupBy,lodash.indexBy=indexBy,lodash.initial=initial,lodash.intersection=intersection,lodash.invert=invert,lodash.invoke=invoke,lodash.keys=keys,lodash.map=map,lodash.max=max,lodash.memoize=memoize,lodash.min=min,lodash.omit=omit,lodash.once=once,lodash.pairs=pairs,lodash.partial=partial,lodash.pick=pick,lodash.pluck=pluck,lodash.range=range,lodash.reject=reject,lodash.rest=rest,lodash.shuffle=shuffle,lodash.sortBy=sortBy,lodash.tap=tap,lodash.throttle=throttle,lodash.times=times,lodash.toArray=toArray,lodash.union=union,lodash.uniq=uniq,lodash.values=values,lodash.where=where,lodash.without=without,lodash.wrap=wrap,lodash.zip=zip,lodash.collect=map,lodash.drop=rest,lodash.each=forEach,lodash.extend=assign,lodash.methods=functions,lodash.object=zipObject,lodash.select=filter,lodash.tail=rest,lodash.unique=uniq,lodash.clone=clone,lodash.contains=contains,lodash.escape=escape,lodash.every=every,lodash.find=find,lodash.has=has,lodash.identity=identity,lodash.indexOf=indexOf,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isBoolean=isBoolean,lodash.isDate=isDate,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isNaN=isNaN,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isRegExp=isRegExp,lodash.isString=isString,lodash.isUndefined=isUndefined,lodash.lastIndexOf=lastIndexOf,lodash.mixin=mixin,lodash.noConflict=noConflict,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.result=result,lodash.size=size,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.template=template,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.all=every,lodash.any=some,lodash.detect=find,lodash.findWhere=findWhere,lodash.foldl=reduce,lodash.foldr=reduceRight,lodash.include=contains,lodash.inject=reduce,lodash.first=first,lodash.last=last,lodash.sample=sample,lodash.take=first,lodash.head=first,mixin(lodash),lodash.VERSION="2.4.1",lodash.prototype.chain=wrapperChain,lodash.prototype.value=wrapperValueOf,forEach(["pop","push","reverse","shift","sort","splice","unshift"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__;return func.apply(value,arguments),support.spliceObjects||0!==value.length||delete value[0],this}}),forEach(["concat","join","slice"],function(methodName){var func=arrayRef[methodName];lodash.prototype[methodName]=function(){var value=this.__wrapped__,result=func.apply(value,arguments);return this.__chain__&&(result=new lodashWrapper(result),result.__chain__=!0),result}}),"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("underscore",[],function(){return lodash}):freeExports&&freeModule?moduleExports?(freeModule.exports=lodash)._=lodash:freeExports._=lodash:root._=lodash}.call(this),function(root,factory){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(_,$,exports){return factory(root,exports,_,$)});else if("undefined"!=typeof exports){var _=require("underscore");factory(root,exports,_)}else root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}(this,function(root,Backbone,_,$){{var previousBackbone=root.Backbone,array=[],slice=(array.push,array.slice);array.splice}Backbone.VERSION="1.1.2-cit",Backbone.$=$,Backbone.noConflict=function(){return root.Backbone=previousBackbone,this},Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);return events.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_.once(function(){self.off(name,once),callback.apply(this,arguments)});return once._callback=callback,this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events=void 0,this;for(names=name?[name]:_.keys(this._events),i=0,l=names.length;l>i;i++)if(name=names[i],events=this._events[name]){if(this._events[name]=retain=[],callback||context)for(j=0,k=events.length;k>j;j++)ev=events[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev);retain.length||delete this._events[name]}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;return events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;callback||"object"!=typeof name||(callback=this),obj&&((listeningTo={})[obj._listenId]=obj);for(var id in listeningTo)obj=listeningTo[id],obj.off(name,callback,this),(remove||_.isEmpty(obj._events))&&delete this._listeningTo[id];return this}},eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name){for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args);return}},listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={}),id=obj._listenId||(obj._listenId=_.uniqueId("l"));return listeningTo[id]=obj,callback||"object"!=typeof name||(callback=this),obj[implementation](name,callback,this),this}}),Events.bind=Events.on,Events.unbind=Events.off,_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={}),this.cid=_.uniqueId("c"),this.attributes={},options.collection&&(this.collection=options.collection),options.parse&&(attrs=this.parse(attrs,options)||{}),attrs=_.defaults({},attrs,_.result(this,"defaults")),this.set(attrs,options),this.changed={},this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return null!=this.get(attr)},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(null==key)return this;if("object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options||(options={}),!this._validate(attrs,options))return!1;unset=options.unset,silent=options.silent,changes=[],changing=this._changing,this._changing=!0,changing||(this._previousAttributes=_.clone(this.attributes),this.changed={}),current=this.attributes,prev=this._previousAttributes,this.idAttribute in attrs&&(this.id=attrs[this.idAttribute]);for(attr in attrs)val=attrs[attr],_.isEqual(current[attr],val)||changes.push(attr),_.isEqual(prev[attr],val)?delete this.changed[attr]:this.changed[attr]=val,unset?delete current[attr]:current[attr]=val;if(!silent){changes.length&&(this._pending=options);for(var i=0,l=changes.length;l>i;i++)this.trigger("change:"+changes[i],this,current[changes[i]],options)}if(changing)return this;if(!silent)for(;this._pending;)options=this._pending,this._pending=!1,this.trigger("change",this,options);return this._pending=!1,this._changing=!1,this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:!0}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:!0}))},hasChanged:function(attr){return null==attr?!_.isEmpty(this.changed):_.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):!1;var val,changed=!1,old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff)_.isEqual(old[attr],val=diff[attr])||((changed||(changed={}))[attr]=val);return changed},previous:function(attr){return null!=attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){return model.set(model.parse(resp,options),options)?(success&&success(model,resp,options),void model.trigger("sync",model,resp,options)):!1},wrapError(this,options),this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(null==key||"object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options=_.extend({validate:!0},options),attrs&&!options.wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;attrs&&options.wait&&(this.attributes=_.extend({},attributes,attrs)),void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);return options.wait&&(serverAttrs=_.extend(attrs||{},serverAttrs)),_.isObject(serverAttrs)&&!model.set(serverAttrs,options)?!1:(success&&success(model,resp,options),void model.trigger("sync",model,resp,options))},wrapError(this,options),method=this.isNew()?"create":options.patch?"patch":"update","patch"===method&&(options.attrs=attrs),xhr=this.sync(method,this,options),attrs&&options.wait&&(this.attributes=attributes),xhr},destroy:function(options){options=options?_.clone(options):{};var model=this,success=options.success,destroy=function(){model.trigger("destroy",model,model.collection,options)};if(options.success=function(resp){(options.wait||model.isNew())&&destroy(),success&&success(model,resp,options),model.isNew()||model.trigger("sync",model,resp,options)},this.isNew())return options.success(),!1;wrapError(this,options);var xhr=this.sync("delete",this,options);return options.wait||destroy(),xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();return this.isNew()?base:base.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(resp){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend(options||{},{validate:!0}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;return error?(this.trigger("invalid",this,error,_.extend(options,{validationError:error})),!1):!0}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.attributes),_[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={}),options.model&&(this.model=options.model),void 0!==options.comparator&&(this.comparator=options.comparator),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,_.extend({silent:!0},options))},setOptions={add:!0,remove:!0,merge:!0},addOptions={add:!0,remove:!1};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:!1},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models),options||(options={});var i,l,index,model;for(i=0,l=models.length;l>i;i++)model=models[i]=this.get(models[i]),model&&(delete this._byId[model.id],delete this._byId[model.cid],index=this.indexOf(model),this.models.splice(index,1),this.length--,options.silent||(options.index=index,model.trigger("remove",model,this,options)),this._removeReference(model,options));return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions),options.parse&&(models=this.parse(models,options));var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort,at=options.at,targetModel=this.model,sortable=this.comparator&&null==at&&options.sort!==!1,sortAttr=_.isString(this.comparator)?this.comparator:null,toAdd=[],toRemove=[],modelMap={},add=options.add,merge=options.merge,remove=options.remove,order=!sortable&&add&&remove?[]:!1;for(i=0,l=models.length;l>i;i++){if(attrs=models[i]||{},id=attrs instanceof Model?model=attrs:attrs[targetModel.prototype.idAttribute||"id"],existing=this.get(id))remove&&(modelMap[existing.cid]=!0),merge&&(attrs=attrs===model?model.attributes:attrs,options.parse&&(attrs=existing.parse(attrs,options)),existing.set(attrs,options),sortable&&!sort&&existing.hasChanged(sortAttr)&&(sort=!0)),models[i]=existing;else if(add){if(model=models[i]=this._prepareModel(attrs,options),!model)continue;toAdd.push(model),this._addReference(model,options)}model=existing||model,!order||!model.isNew()&&modelMap[model.id]||order.push(model),modelMap[model.id]=!0}if(remove){for(i=0,l=this.length;l>i;++i)modelMap[(model=this.models[i]).cid]||toRemove.push(model);toRemove.length&&this.remove(toRemove,options)}if(toAdd.length||order&&order.length)if(sortable&&(sort=!0),this.length+=toAdd.length,null!=at)for(i=0,l=toAdd.length;l>i;i++)this.models.splice(at+i,0,toAdd[i]);else{order&&(this.models.length=0);var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;l>i;i++)this.models.push(orderedModels[i])}if(sort&&this.sort({silent:!0}),!options.silent){for(i=0,l=toAdd.length;l>i;i++)(model=toAdd[i]).trigger("add",model,this,options);(sort||order&&order.length)&&this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;l>i;i++)this._removeReference(this.models[i],options);return options.previousModels=this.models,this._reset(),models=this.add(models,_.extend({silent:!0},options)),options.silent||this.trigger("reset",this,options),models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options),model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options),model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){return null==obj?void 0:this._byId[obj]||this._byId[obj.id]||this._byId[obj.cid]},at:function(index){return this.models[index]},where:function(attrs,first){return _.isEmpty(attrs)?first?void 0:[]:this[first?"find":"filter"](function(model){for(var key in attrs)if(attrs[key]!==model.get(key))return!1;return!0})},findWhere:function(attrs){return this.where(attrs,!0)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return options||(options={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this)),options.silent||this.trigger("sort",this,options),this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var success=options.success,collection=this;return options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options),success&&success(collection,resp,options),collection.trigger("sync",collection,resp,options)},wrapError(this,options),this.sync("read",this,options)},create:function(model,options){if(options=options?_.clone(options):{},!(model=this._prepareModel(model,options)))return!1;options.wait||this.add(model,options);var collection=this,success=options.success;return options.success=function(model,resp){options.wait&&collection.add(model,options),success&&success(model,resp,options)},model.save(null,options),model},parse:function(resp){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model)return attrs;options=options?_.clone(options):{},options.collection=this;var model=new this.model(attrs,options);return model.validationError?(this.trigger("invalid",this,model.validationError,options),!1):model},_addReference:function(model){this._byId[model.cid]=model,null!=model.id&&(this._byId[model.id]=model),model.collection||(model.collection=this),model.on("all",this._onModelEvent,this)},_removeReference:function(model){this===model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){("add"!==event&&"remove"!==event||collection===this)&&("destroy"===event&&this.remove(model,options),model&&event==="change:"+model.idAttribute&&(delete this._byId[model.previous(model.idAttribute)],null!=model.id&&(this._byId[model.id]=model)),this.trigger.apply(this,arguments))}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.models),_[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy","indexBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view"),options||(options={}),_.extend(this,_.pick(options,viewOptions)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(element,delegate){return this.$el&&this.undelegateEvents(),this.$el=element instanceof Backbone.$?element:Backbone.$(element),this.el=this.$el[0],delegate!==!1&&this.delegateEvents(),this},delegateEvents:function(events){if(!events&&!(events=_.result(this,"events")))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(_.isFunction(method)||(method=this[events[key]]),method){var match=key.match(delegateEventSplitter),eventName=match[1],selector=match[2];method=_.bind(method,this),eventName+=".delegateEvents"+this.cid,""===selector?this.$el.on(eventName,method):this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"),!1);
else{var attrs=_.extend({},_.result(this,"attributes"));this.id&&(attrs.id=_.result(this,"id")),this.className&&(attrs["class"]=_.result(this,"className"));var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,!1)}}}),Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(options.url||(params.url=_.result(model,"url")||urlError()),null!=options.data||!model||"create"!==method&&"update"!==method&&"patch"!==method||(params.contentType="application/json",params.data=JSON.stringify(options.attrs||model.toJSON(options))),options.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.data=params.data?{model:params.data}:{}),options.emulateHTTP&&("PUT"===type||"DELETE"===type||"PATCH"===type)){params.type="POST",options.emulateJSON&&(params.data._method=type);var beforeSend=options.beforeSend;options.beforeSend=function(xhr){return xhr.setRequestHeader("X-HTTP-Method-Override",type),beforeSend?beforeSend.apply(this,arguments):void 0}}"GET"===params.type||options.emulateJSON||(params.processData=!1),"PATCH"===params.type&&noXhrPatch&&(params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var xhr=options.xhr=Backbone.ajax(_.extend(params,options));return model.trigger("request",model,xhr,options),xhr};var noXhrPatch=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={}),options.routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){_.isRegExp(route)||(route=this._routeToRegExp(route)),_.isFunction(name)&&(callback=name,name=""),callback||(callback=this[name]);var router=this;return Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);router.execute(callback,args),router.trigger.apply(router,["route:"+name].concat(args)),router.trigger("route",name,args),Backbone.history.trigger("route",router,name,args)}),this},execute:function(callback,args){callback&&callback.apply(this,args)},navigate:function(fragment,options){return Backbone.history.navigate(fragment,options),this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var route,routes=_.keys(this.routes);null!=(route=routes.pop());)this.route(route,this.routes[route])}},_routeToRegExp:function(route){return route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)"),new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){return i===params.length-1?param||null:param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[],_.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,pathStripper=/#.*$/;History.started=!1,_.extend(History.prototype,Events,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(null==fragment)if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=decodeURI(this.location.pathname+this.location.search);var root=this.root.replace(trailingSlash,"");fragment.indexOf(root)||(fragment=fragment.slice(root.length))}else fragment=this.getHash();return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=!0,this.options=_.extend({root:"/"},this.options,options),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment(),docMode=document.documentMode,oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||7>=docMode);if(this.root=("/"+this.root+"/").replace(rootStripper,"/"),oldIE&&this._wantsHashChange){var frame=Backbone.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=frame.hide().appendTo("body")[0].contentWindow,this.navigate(fragment)}this._hasPushState?Backbone.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!oldIE?Backbone.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=fragment;var loc=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&loc.hash&&(this.fragment=this.getHash().replace(routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(){var current=this.getFragment();return current===this.fragment&&this.iframe&&(current=this.getFragment(this.getHash(this.iframe))),current===this.fragment?!1:(this.iframe&&this.navigate(current),void this.loadUrl())},loadUrl:function(fragment){return fragment=this.fragment=this.getFragment(fragment),_.any(this.handlers,function(handler){return handler.route.test(fragment)?(handler.callback(fragment),!0):void 0})},navigate:function(fragment,options){if(!History.started)return!1;options&&options!==!0||(options={trigger:!!options});var url=this.root+(fragment=this.getFragment(fragment||""));if(fragment=fragment.replace(pathStripper,""),this.fragment!==fragment){if(this.fragment=fragment,""===fragment&&"/"!==url&&(url=url.slice(0,-1)),this._hasPushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))&&(options.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,fragment,options.replace))}return options.trigger?this.loadUrl(fragment):void 0}},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else location.hash="#"+fragment}}),Backbone.history=new History;var extend=function(protoProps,staticProps){var child,parent=this;child=protoProps&&_.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&_.extend(child.prototype,protoProps),child.__super__=parent.prototype,child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')},wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error(model,resp,options),model.trigger("error",model,resp,options)}};return Backbone}),function(undefined){function defaultParsingFlags(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count)}}function ordinalizeToken(func,period){return function(a){return this.lang().ordinal(func.call(this,a),period)}}function Language(){}function Moment(config){checkOverflow(config),extend(this,config)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._milliseconds=+milliseconds+1e3*seconds+6e4*minutes+36e5*hours,this._days=+days+7*weeks,this._months=+months+12*years,this._data={},this._bubble()}function extend(a,b){for(var i in b)b.hasOwnProperty(i)&&(a[i]=b[i]);return b.hasOwnProperty("toString")&&(a.toString=b.toString),b.hasOwnProperty("valueOf")&&(a.valueOf=b.valueOf),a}function cloneMoment(m){var i,result={};for(i in m)m.hasOwnProperty(i)&&momentProperties.hasOwnProperty(i)&&(result[i]=m[i]);return result}function absRound(number){return 0>number?Math.ceil(number):Math.floor(number)}function leftZeroFill(number,targetLength,forceSign){for(var output=""+Math.abs(number),sign=number>=0;output.length<targetLength;)output="0"+output;return(sign?forceSign?"+":"":"-")+output}function addOrSubtractDurationFromMoment(mom,duration,isAdding,ignoreUpdateOffset){var minutes,hours,milliseconds=duration._milliseconds,days=duration._days,months=duration._months;milliseconds&&mom._d.setTime(+mom._d+milliseconds*isAdding),(days||months)&&(minutes=mom.minute(),hours=mom.hour()),days&&mom.date(mom.date()+days*isAdding),months&&mom.month(mom.month()+months*isAdding),milliseconds&&!ignoreUpdateOffset&&moment.updateOffset(mom),(days||months)&&(mom.minute(minutes),mom.hour(hours))}function isArray(input){return"[object Array]"===Object.prototype.toString.call(input)}function isDate(input){return"[object Date]"===Object.prototype.toString.call(input)||input instanceof Date}function compareArrays(array1,array2,dontConvert){var i,len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0;for(i=0;len>i;i++)(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i]))&&diffs++;return diffs+lengthDiff}function normalizeUnits(units){if(units){var lowered=units.toLowerCase().replace(/(.)s$/,"$1");units=unitAliases[units]||camelFunctions[lowered]||lowered}return units}function normalizeObjectUnits(inputObject){var normalizedProp,prop,normalizedInput={};for(prop in inputObject)inputObject.hasOwnProperty(prop)&&(normalizedProp=normalizeUnits(prop),normalizedProp&&(normalizedInput[normalizedProp]=inputObject[prop]));return normalizedInput}function makeList(field){var count,setter;if(0===field.indexOf("week"))count=7,setter="day";else{if(0!==field.indexOf("month"))return;count=12,setter="month"}moment[field]=function(format,index){var i,getter,method=moment.fn._lang[field],results=[];if("number"==typeof format&&(index=format,format=undefined),getter=function(i){var m=moment().utc().set(setter,i);return method.call(moment.fn._lang,m,format||"")},null!=index)return getter(index);for(i=0;count>i;i++)results.push(getter(i));return results}}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;return 0!==coercedNumber&&isFinite(coercedNumber)&&(value=coercedNumber>=0?Math.floor(coercedNumber):Math.ceil(coercedNumber)),value}function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}function checkOverflow(m){var overflow;m._a&&-2===m._pf.overflow&&(overflow=m._a[MONTH]<0||m._a[MONTH]>11?MONTH:m._a[DATE]<1||m._a[DATE]>daysInMonth(m._a[YEAR],m._a[MONTH])?DATE:m._a[HOUR]<0||m._a[HOUR]>23?HOUR:m._a[MINUTE]<0||m._a[MINUTE]>59?MINUTE:m._a[SECOND]<0||m._a[SECOND]>59?SECOND:m._a[MILLISECOND]<0||m._a[MILLISECOND]>999?MILLISECOND:-1,m._pf._overflowDayOfYear&&(YEAR>overflow||overflow>DATE)&&(overflow=DATE),m._pf.overflow=overflow)}function isValid(m){return null==m._isValid&&(m._isValid=!isNaN(m._d.getTime())&&m._pf.overflow<0&&!m._pf.empty&&!m._pf.invalidMonth&&!m._pf.nullInput&&!m._pf.invalidFormat&&!m._pf.userInvalidated,m._strict&&(m._isValid=m._isValid&&0===m._pf.charsLeftOver&&0===m._pf.unusedTokens.length)),m._isValid}function normalizeLanguage(key){return key?key.toLowerCase().replace("_","-"):key}function makeAs(input,model){return model._isUTC?moment(input).zone(model._offset||0):moment(input).local()}function loadLang(key,values){return values.abbr=key,languages[key]||(languages[key]=new Language),languages[key].set(values),languages[key]}function unloadLang(key){delete languages[key]}function getLangDefinition(key){var j,lang,next,split,i=0,get=function(k){if(!languages[k]&&hasModule)try{require("./lang/"+k)}catch(e){}return languages[k]};if(!key)return moment.fn._lang;if(!isArray(key)){if(lang=get(key))return lang;key=[key]}for(;i<key.length;){for(split=normalizeLanguage(key[i]).split("-"),j=split.length,next=normalizeLanguage(key[i+1]),next=next?next.split("-"):null;j>0;){if(lang=get(split.slice(0,j).join("-")))return lang;if(next&&next.length>=j&&compareArrays(split,next,!0)>=j-1)break;j--}i++}return moment.fn._lang}function removeFormattingTokens(input){return input.match(/\[[\s\S]/)?input.replace(/^\[|\]$/g,""):input.replace(/\\/g,"")}function makeFormatFunction(format){var i,length,array=format.match(formattingTokens);for(i=0,length=array.length;length>i;i++)array[i]=formatTokenFunctions[array[i]]?formatTokenFunctions[array[i]]:removeFormattingTokens(array[i]);return function(mom){var output="";for(i=0;length>i;i++)output+=array[i]instanceof Function?array[i].call(mom,format):array[i];return output}}function formatMoment(m,format){return m.isValid()?(format=expandFormat(format,m.lang()),formatFunctions[format]||(formatFunctions[format]=makeFormatFunction(format)),formatFunctions[format](m)):m.lang().invalidDate()}function expandFormat(format,lang){function replaceLongDateFormatTokens(input){return lang.longDateFormat(input)||input}var i=5;for(localFormattingTokens.lastIndex=0;i>=0&&localFormattingTokens.test(format);)format=format.replace(localFormattingTokens,replaceLongDateFormatTokens),localFormattingTokens.lastIndex=0,i-=1;return format}function getParseRegexForToken(token,config){var a,strict=config._strict;switch(token){case"DDDD":return parseTokenThreeDigits;case"YYYY":case"GGGG":case"gggg":return strict?parseTokenFourDigits:parseTokenOneToFourDigits;case"Y":case"G":case"g":return parseTokenSignedNumber;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return strict?parseTokenSixDigits:parseTokenOneToSixDigits;case"S":if(strict)return parseTokenOneDigit;case"SS":if(strict)return parseTokenTwoDigits;case"SSS":if(strict)return parseTokenThreeDigits;case"DDD":return parseTokenOneToThreeDigits;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return parseTokenWord;case"a":case"A":return getLangDefinition(config._l)._meridiemParse;case"X":return parseTokenTimestampMs;case"Z":case"ZZ":return parseTokenTimezone;case"T":return parseTokenT;case"SSSS":return parseTokenDigits;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return strict?parseTokenTwoDigits:parseTokenOneOrTwoDigits;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return parseTokenOneOrTwoDigits;default:return a=new RegExp(regexpEscape(unescapeFormat(token.replace("\\","")),"i"))}}function timezoneMinutesFromString(string){string=string||"";var possibleTzMatches=string.match(parseTokenTimezone)||[],tzChunk=possibleTzMatches[possibleTzMatches.length-1]||[],parts=(tzChunk+"").match(parseTimezoneChunker)||["-",0,0],minutes=+(60*parts[1])+toInt(parts[2]);return"+"===parts[0]?-minutes:minutes}function addTimeToArrayFromToken(token,input,config){var a,datePartArray=config._a;switch(token){case"M":case"MM":null!=input&&(datePartArray[MONTH]=toInt(input)-1);break;case"MMM":case"MMMM":a=getLangDefinition(config._l).monthsParse(input),null!=a?datePartArray[MONTH]=a:config._pf.invalidMonth=input;break;case"D":case"DD":null!=input&&(datePartArray[DATE]=toInt(input));break;case"DDD":case"DDDD":null!=input&&(config._dayOfYear=toInt(input));break;case"YY":datePartArray[YEAR]=toInt(input)+(toInt(input)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":datePartArray[YEAR]=toInt(input);break;case"a":case"A":config._isPm=getLangDefinition(config._l).isPM(input);break;case"H":case"HH":case"h":case"hh":datePartArray[HOUR]=toInt(input);break;case"m":case"mm":datePartArray[MINUTE]=toInt(input);break;case"s":case"ss":datePartArray[SECOND]=toInt(input);break;case"S":case"SS":case"SSS":case"SSSS":datePartArray[MILLISECOND]=toInt(1e3*("0."+input));break;case"X":config._d=new Date(1e3*parseFloat(input));break;case"Z":case"ZZ":config._useUTC=!0,config._tzm=timezoneMinutesFromString(input);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":token=token.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":token=token.substr(0,2),input&&(config._w=config._w||{},config._w[token]=input)}}function dateFromConfig(config){var i,date,currentDate,yearToUse,fixYear,w,temp,lang,weekday,week,input=[];if(!config._d){for(currentDate=currentDateArray(config),config._w&&null==config._a[DATE]&&null==config._a[MONTH]&&(fixYear=function(val){var int_val=parseInt(val,10);return val?val.length<3?int_val>68?1900+int_val:2e3+int_val:int_val:null==config._a[YEAR]?moment().weekYear():config._a[YEAR]},w=config._w,null!=w.GG||null!=w.W||null!=w.E?temp=dayOfYearFromWeeks(fixYear(w.GG),w.W||1,w.E,4,1):(lang=getLangDefinition(config._l),weekday=null!=w.d?parseWeekday(w.d,lang):null!=w.e?parseInt(w.e,10)+lang._week.dow:0,week=parseInt(w.w,10)||1,null!=w.d&&weekday<lang._week.dow&&week++,temp=dayOfYearFromWeeks(fixYear(w.gg),week,weekday,lang._week.doy,lang._week.dow)),config._a[YEAR]=temp.year,config._dayOfYear=temp.dayOfYear),config._dayOfYear&&(yearToUse=null==config._a[YEAR]?currentDate[YEAR]:config._a[YEAR],config._dayOfYear>daysInYear(yearToUse)&&(config._pf._overflowDayOfYear=!0),date=makeUTCDate(yearToUse,0,config._dayOfYear),config._a[MONTH]=date.getUTCMonth(),config._a[DATE]=date.getUTCDate()),i=0;3>i&&null==config._a[i];++i)config._a[i]=input[i]=currentDate[i];for(;7>i;i++)config._a[i]=input[i]=null==config._a[i]?2===i?1:0:config._a[i];input[HOUR]+=toInt((config._tzm||0)/60),input[MINUTE]+=toInt((config._tzm||0)%60),config._d=(config._useUTC?makeUTCDate:makeDate).apply(null,input)}}function dateFromObject(config){var normalizedInput;config._d||(normalizedInput=normalizeObjectUnits(config._i),config._a=[normalizedInput.year,normalizedInput.month,normalizedInput.day,normalizedInput.hour,normalizedInput.minute,normalizedInput.second,normalizedInput.millisecond],dateFromConfig(config))}function currentDateArray(config){var now=new Date;return config._useUTC?[now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()]:[now.getFullYear(),now.getMonth(),now.getDate()]}function makeDateFromStringAndFormat(config){config._a=[],config._pf.empty=!0;var i,parsedInput,tokens,token,skipped,lang=getLangDefinition(config._l),string=""+config._i,stringLength=string.length,totalParsedInputLength=0;for(tokens=expandFormat(config._f,lang).match(formattingTokens)||[],i=0;i<tokens.length;i++)token=tokens[i],parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0],parsedInput&&(skipped=string.substr(0,string.indexOf(parsedInput)),skipped.length>0&&config._pf.unusedInput.push(skipped),string=string.slice(string.indexOf(parsedInput)+parsedInput.length),totalParsedInputLength+=parsedInput.length),formatTokenFunctions[token]?(parsedInput?config._pf.empty=!1:config._pf.unusedTokens.push(token),addTimeToArrayFromToken(token,parsedInput,config)):config._strict&&!parsedInput&&config._pf.unusedTokens.push(token);config._pf.charsLeftOver=stringLength-totalParsedInputLength,string.length>0&&config._pf.unusedInput.push(string),config._isPm&&config._a[HOUR]<12&&(config._a[HOUR]+=12),config._isPm===!1&&12===config._a[HOUR]&&(config._a[HOUR]=0),dateFromConfig(config),checkOverflow(config)}function unescapeFormat(s){return s.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4})}function regexpEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function makeDateFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(0===config._f.length)return config._pf.invalidFormat=!0,void(config._d=new Date(0/0));for(i=0;i<config._f.length;i++)currentScore=0,tempConfig=extend({},config),tempConfig._pf=defaultParsingFlags(),tempConfig._f=config._f[i],makeDateFromStringAndFormat(tempConfig),isValid(tempConfig)&&(currentScore+=tempConfig._pf.charsLeftOver,currentScore+=10*tempConfig._pf.unusedTokens.length,tempConfig._pf.score=currentScore,(null==scoreToBeat||scoreToBeat>currentScore)&&(scoreToBeat=currentScore,bestMoment=tempConfig));extend(config,bestMoment||tempConfig)}function makeDateFromString(config){var i,l,string=config._i,match=isoRegex.exec(string);if(match){for(config._pf.iso=!0,i=0,l=isoDates.length;l>i;i++)if(isoDates[i][1].exec(string)){config._f=isoDates[i][0]+(match[6]||" ");break}for(i=0,l=isoTimes.length;l>i;i++)if(isoTimes[i][1].exec(string)){config._f+=isoTimes[i][0];break}string.match(parseTokenTimezone)&&(config._f+="Z"),makeDateFromStringAndFormat(config)}else config._d=new Date(string)}function makeDateFromInput(config){var input=config._i,matched=aspNetJsonRegex.exec(input);input===undefined?config._d=new Date:matched?config._d=new Date(+matched[1]):"string"==typeof input?makeDateFromString(config):isArray(input)?(config._a=input.slice(0),dateFromConfig(config)):isDate(input)?config._d=new Date(+input):"object"==typeof input?dateFromObject(config):config._d=new Date(input)}function makeDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);return 1970>y&&date.setFullYear(y),date}function makeUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));return 1970>y&&date.setUTCFullYear(y),date}function parseWeekday(input,language){if("string"==typeof input)if(isNaN(input)){if(input=language.weekdaysParse(input),"number"!=typeof input)return null}else input=parseInt(input,10);return input}function substituteTimeAgo(string,number,withoutSuffix,isFuture,lang){return lang.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime(milliseconds,withoutSuffix,lang){var seconds=round(Math.abs(milliseconds)/1e3),minutes=round(seconds/60),hours=round(minutes/60),days=round(hours/24),years=round(days/365),args=45>seconds&&["s",seconds]||1===minutes&&["m"]||45>minutes&&["mm",minutes]||1===hours&&["h"]||22>hours&&["hh",hours]||1===days&&["d"]||25>=days&&["dd",days]||45>=days&&["M"]||345>days&&["MM",round(days/30)]||1===years&&["y"]||["yy",years];return args[2]=withoutSuffix,args[3]=milliseconds>0,args[4]=lang,substituteTimeAgo.apply({},args)}function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var adjustedMoment,end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day();return daysToDayOfWeek>end&&(daysToDayOfWeek-=7),end-7>daysToDayOfWeek&&(daysToDayOfWeek+=7),adjustedMoment=moment(mom).add("d",daysToDayOfWeek),{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()}}function dayOfYearFromWeeks(year,week,weekday,firstDayOfWeekOfYear,firstDayOfWeek){var daysToAdd,dayOfYear,d=makeUTCDate(year,0,1).getUTCDay();return weekday=null!=weekday?weekday:firstDayOfWeek,daysToAdd=firstDayOfWeek-d+(d>firstDayOfWeekOfYear?7:0)-(firstDayOfWeek>d?7:0),dayOfYear=7*(week-1)+(weekday-firstDayOfWeek)+daysToAdd+1,{year:dayOfYear>0?year:year-1,dayOfYear:dayOfYear>0?dayOfYear:daysInYear(year-1)+dayOfYear}}function makeMoment(config){var input=config._i,format=config._f;return null===input?moment.invalid({nullInput:!0}):("string"==typeof input&&(config._i=input=getLangDefinition().preparse(input)),moment.isMoment(input)?(config=cloneMoment(input),config._d=new Date(+input._d)):format?isArray(format)?makeDateFromStringAndArray(config):makeDateFromStringAndFormat(config):makeDateFromInput(config),new Moment(config))}function makeGetterAndSetter(name,key){moment.fn[name]=moment.fn[name+"s"]=function(input){var utc=this._isUTC?"UTC":"";return null!=input?(this._d["set"+utc+key](input),moment.updateOffset(this),this):this._d["get"+utc+key]()}}function makeDurationGetter(name){moment.duration.fn[name]=function(){return this._data[name]}}function makeDurationAsGetter(name,factor){moment.duration.fn["as"+name]=function(){return+this/factor}}function makeGlobal(deprecate){var warned=!1,local_moment=moment;"undefined"==typeof ender&&(deprecate?(global.moment=function(){return!warned&&console&&console.warn&&(warned=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),local_moment.apply(null,arguments)},extend(global.moment,local_moment)):global.moment=moment)}for(var moment,i,VERSION="2.5.0",global=this,round=Math.round,YEAR=0,MONTH=1,DATE=2,HOUR=3,MINUTE=4,SECOND=5,MILLISECOND=6,languages={},momentProperties={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},hasModule="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,aspNetTimeSpanJsonRegex=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,isoDurationRegex=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenOneToFourDigits=/\d{1,4}/,parseTokenOneToSixDigits=/[+\-]?\d{1,6}/,parseTokenDigits=/\d+/,parseTokenWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/gi,parseTokenT=/T/i,parseTokenTimestampMs=/[\+\-]?\d+(\.\d{1,3})?/,parseTokenOneDigit=/\d/,parseTokenTwoDigits=/\d\d/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{4}/,parseTokenSixDigits=/[+-]?\d{6}/,parseTokenSignedNumber=/[+-]?\d+/,isoRegex=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,isoFormat="YYYY-MM-DDTHH:mm:ssZ",isoDates=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],isoTimes=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,proxyGettersAndSetters="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),unitMillisecondFactors={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},unitAliases={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},camelFunctions={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},formatFunctions={},ordinalizeTokens="DDD w W M D d".split(" "),paddedTokens="M D H h m s w W".split(" "),formatTokenFunctions={M:function(){return this.month()+1},MMM:function(format){return this.lang().monthsShort(this,format)},MMMM:function(format){return this.lang().months(this,format)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(format){return this.lang().weekdaysMin(this,format)},ddd:function(format){return this.lang().weekdaysShort(this,format)},dddd:function(format){return this.lang().weekdays(this,format)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return leftZeroFill(this.year()%100,2)},YYYY:function(){return leftZeroFill(this.year(),4)},YYYYY:function(){return leftZeroFill(this.year(),5)},YYYYYY:function(){var y=this.year(),sign=y>=0?"+":"-";return sign+leftZeroFill(Math.abs(y),6)},gg:function(){return leftZeroFill(this.weekYear()%100,2)},gggg:function(){return leftZeroFill(this.weekYear(),4)},ggggg:function(){return leftZeroFill(this.weekYear(),5)},GG:function(){return leftZeroFill(this.isoWeekYear()%100,2)},GGGG:function(){return leftZeroFill(this.isoWeekYear(),4)},GGGGG:function(){return leftZeroFill(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return toInt(this.milliseconds()/100)},SS:function(){return leftZeroFill(toInt(this.milliseconds()/10),2)},SSS:function(){return leftZeroFill(this.milliseconds(),3)},SSSS:function(){return leftZeroFill(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+leftZeroFill(toInt(a/60),2)+":"+leftZeroFill(toInt(a)%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+leftZeroFill(toInt(a/60),2)+leftZeroFill(toInt(a)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},lists=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ordinalizeTokens.length;)i=ordinalizeTokens.pop(),formatTokenFunctions[i+"o"]=ordinalizeToken(formatTokenFunctions[i],i);for(;paddedTokens.length;)i=paddedTokens.pop(),formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2);for(formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3),extend(Language.prototype,{set:function(config){var prop,i;for(i in config)prop=config[i],"function"==typeof prop?this[i]=prop:this["_"+i]=prop},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(m){return this._months[m.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(m){return this._monthsShort[m.month()]},monthsParse:function(monthName){var i,mom,regex;for(this._monthsParse||(this._monthsParse=[]),i=0;12>i;i++)if(this._monthsParse[i]||(mom=moment.utc([2e3,i]),regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,""),this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")),this._monthsParse[i].test(monthName))return i},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(m){return this._weekdays[m.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(m){return this._weekdaysShort[m.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(m){return this._weekdaysMin[m.day()]},weekdaysParse:function(weekdayName){var i,mom,regex;for(this._weekdaysParse||(this._weekdaysParse=[]),i=0;7>i;i++)if(this._weekdaysParse[i]||(mom=moment([2e3,1]).day(i),regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,""),this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")),this._weekdaysParse[i].test(weekdayName))return i
},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(key){var output=this._longDateFormat[key];return!output&&this._longDateFormat[key.toUpperCase()]&&(output=this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)}),this._longDateFormat[key]=output),output},isPM:function(input){return"p"===(input+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(hours,minutes,isLower){return hours>11?isLower?"pm":"PM":isLower?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(key,mom){var output=this._calendar[key];return"function"==typeof output?output.apply(mom):output},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return"function"==typeof output?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)},pastFuture:function(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return"function"==typeof format?format(output):format.replace(/%s/i,output)},ordinal:function(number){return this._ordinal.replace("%d",number)},_ordinal:"%d",preparse:function(string){return string},postformat:function(string){return string},week:function(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),moment=function(input,format,lang,strict){return"boolean"==typeof lang&&(strict=lang,lang=undefined),makeMoment({_isAMomentObject:!0,_i:input,_f:format,_l:lang,_strict:strict,_isUTC:!1,_pf:defaultParsingFlags()})},moment.utc=function(input,format,lang,strict){var m;return"boolean"==typeof lang&&(strict=lang,lang=undefined),m=makeMoment({_isAMomentObject:!0,_useUTC:!0,_isUTC:!0,_l:lang,_i:input,_f:format,_strict:strict,_pf:defaultParsingFlags()}).utc()},moment.unix=function(input){return moment(1e3*input)},moment.duration=function(input,key){var sign,ret,parseIso,duration=input,match=null;return moment.isDuration(input)?duration={ms:input._milliseconds,d:input._days,M:input._months}:"number"==typeof input?(duration={},key?duration[key]=input:duration.milliseconds=input):(match=aspNetTimeSpanJsonRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign}):(match=isoDurationRegex.exec(input))&&(sign="-"===match[1]?-1:1,parseIso=function(inp){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign},duration={y:parseIso(match[2]),M:parseIso(match[3]),d:parseIso(match[4]),h:parseIso(match[5]),m:parseIso(match[6]),s:parseIso(match[7]),w:parseIso(match[8])}),ret=new Duration(duration),moment.isDuration(input)&&input.hasOwnProperty("_lang")&&(ret._lang=input._lang),ret},moment.version=VERSION,moment.defaultFormat=isoFormat,moment.updateOffset=function(){},moment.lang=function(key,values){var r;return key?(values?loadLang(normalizeLanguage(key),values):null===values?(unloadLang(key),key="en"):languages[key]||getLangDefinition(key),r=moment.duration.fn._lang=moment.fn._lang=getLangDefinition(key),r._abbr):moment.fn._lang._abbr},moment.langData=function(key){return key&&key._lang&&key._lang._abbr&&(key=key._lang._abbr),getLangDefinition(key)},moment.isMoment=function(obj){return obj instanceof Moment||null!=obj&&obj.hasOwnProperty("_isAMomentObject")},moment.isDuration=function(obj){return obj instanceof Duration},i=lists.length-1;i>=0;--i)makeList(lists[i]);for(moment.normalizeUnits=function(units){return normalizeUnits(units)},moment.invalid=function(flags){var m=moment.utc(0/0);return null!=flags?extend(m._pf,flags):m._pf.userInvalidated=!0,m},moment.parseZone=function(input){return moment(input).parseZone()},extend(moment.fn=Moment.prototype,{clone:function(){return moment(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var m=moment(this).utc();return 0<m.year()&&m.year()<=9999?formatMoment(m,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):formatMoment(m,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var m=this;return[m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds()]},isValid:function(){return isValid(this)},isDSTShifted:function(){return this._a?this.isValid()&&compareArrays(this._a,(this._isUTC?moment.utc(this._a):moment(this._a)).toArray())>0:!1},parsingFlags:function(){return extend({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(inputString){var output=formatMoment(this,inputString||moment.defaultFormat);return this.lang().postformat(output)},add:function(input,val){var dur;return dur="string"==typeof input?moment.duration(+val,input):moment.duration(input,val),addOrSubtractDurationFromMoment(this,dur,1),this},subtract:function(input,val){var dur;return dur="string"==typeof input?moment.duration(+val,input):moment.duration(input,val),addOrSubtractDurationFromMoment(this,dur,-1),this},diff:function(input,units,asFloat){var diff,output,that=makeAs(input,this),zoneDiff=6e4*(this.zone()-that.zone());return units=normalizeUnits(units),"year"===units||"month"===units?(diff=432e5*(this.daysInMonth()+that.daysInMonth()),output=12*(this.year()-that.year())+(this.month()-that.month()),output+=(this-moment(this).startOf("month")-(that-moment(that).startOf("month")))/diff,output-=6e4*(this.zone()-moment(this).startOf("month").zone()-(that.zone()-moment(that).startOf("month").zone()))/diff,"year"===units&&(output/=12)):(diff=this-that,output="second"===units?diff/1e3:"minute"===units?diff/6e4:"hour"===units?diff/36e5:"day"===units?(diff-zoneDiff)/864e5:"week"===units?(diff-zoneDiff)/6048e5:diff),asFloat?output:absRound(output)},from:function(time,withoutSuffix){return moment.duration(this.diff(time)).lang(this.lang()._abbr).humanize(!withoutSuffix)},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix)},calendar:function(){var sod=makeAs(moment(),this).startOf("day"),diff=this.diff(sod,"days",!0),format=-6>diff?"sameElse":-1>diff?"lastWeek":0>diff?"lastDay":1>diff?"sameDay":2>diff?"nextDay":7>diff?"nextWeek":"sameElse";return this.format(this.lang().calendar(format,this))},isLeapYear:function(){return isLeapYear(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=input?(input=parseWeekday(input,this.lang()),this.add({d:input-day})):day},month:function(input){var dayOfMonth,utc=this._isUTC?"UTC":"";return null!=input?"string"==typeof input&&(input=this.lang().monthsParse(input),"number"!=typeof input)?this:(dayOfMonth=this.date(),this.date(1),this._d["set"+utc+"Month"](input),this.date(Math.min(dayOfMonth,this.daysInMonth())),moment.updateOffset(this),this):this._d["get"+utc+"Month"]()},startOf:function(units){switch(units=normalizeUnits(units)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===units?this.weekday(0):"isoWeek"===units&&this.isoWeekday(1),this},endOf:function(units){return units=normalizeUnits(units),this.startOf(units).add("isoWeek"===units?"week":units,1).subtract("ms",1)},isAfter:function(input,units){return units="undefined"!=typeof units?units:"millisecond",+this.clone().startOf(units)>+moment(input).startOf(units)},isBefore:function(input,units){return units="undefined"!=typeof units?units:"millisecond",+this.clone().startOf(units)<+moment(input).startOf(units)},isSame:function(input,units){return units=units||"ms",+this.clone().startOf(units)===+makeAs(input,this).startOf(units)},min:function(other){return other=moment.apply(null,arguments),this>other?this:other},max:function(other){return other=moment.apply(null,arguments),other>this?this:other},zone:function(input){var offset=this._offset||0;return null==input?this._isUTC?offset:this._d.getTimezoneOffset():("string"==typeof input&&(input=timezoneMinutesFromString(input)),Math.abs(input)<16&&(input=60*input),this._offset=input,this._isUTC=!0,offset!==input&&addOrSubtractDurationFromMoment(this,moment.duration(offset-input,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(input){return input=input?moment(input).zone():0,(this.zone()-input)%60===0},daysInMonth:function(){return daysInMonth(this.year(),this.month())},dayOfYear:function(input){var dayOfYear=round((moment(this).startOf("day")-moment(this).startOf("year"))/864e5)+1;return null==input?dayOfYear:this.add("d",input-dayOfYear)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(input){var year=weekOfYear(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==input?year:this.add("y",input-year)},isoWeekYear:function(input){var year=weekOfYear(this,1,4).year;return null==input?year:this.add("y",input-year)},week:function(input){var week=this.lang().week(this);return null==input?week:this.add("d",7*(input-week))},isoWeek:function(input){var week=weekOfYear(this,1,4).week;return null==input?week:this.add("d",7*(input-week))},weekday:function(input){var weekday=(this.day()+7-this.lang()._week.dow)%7;return null==input?weekday:this.add("d",input-weekday)},isoWeekday:function(input){return null==input?this.day()||7:this.day(this.day()%7?input:input-7)},get:function(units){return units=normalizeUnits(units),this[units]()},set:function(units,value){return units=normalizeUnits(units),"function"==typeof this[units]&&this[units](value),this},lang:function(key){return key===undefined?this._lang:(this._lang=getLangDefinition(key),this)}}),i=0;i<proxyGettersAndSetters.length;i++)makeGetterAndSetter(proxyGettersAndSetters[i].toLowerCase().replace(/s$/,""),proxyGettersAndSetters[i]);makeGetterAndSetter("year","FullYear"),moment.fn.days=moment.fn.day,moment.fn.months=moment.fn.month,moment.fn.weeks=moment.fn.week,moment.fn.isoWeeks=moment.fn.isoWeek,moment.fn.toJSON=moment.fn.toISOString,extend(moment.duration.fn=Duration.prototype,{_bubble:function(){var seconds,minutes,hours,years,milliseconds=this._milliseconds,days=this._days,months=this._months,data=this._data;data.milliseconds=milliseconds%1e3,seconds=absRound(milliseconds/1e3),data.seconds=seconds%60,minutes=absRound(seconds/60),data.minutes=minutes%60,hours=absRound(minutes/60),data.hours=hours%24,days+=absRound(hours/24),data.days=days%30,months+=absRound(days/30),data.months=months%12,years=absRound(months/12),data.years=years},weeks:function(){return absRound(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12)},humanize:function(withSuffix){var difference=+this,output=relativeTime(difference,!withSuffix,this.lang());return withSuffix&&(output=this.lang().pastFuture(difference,output)),this.lang().postformat(output)},add:function(input,val){var dur=moment.duration(input,val);return this._milliseconds+=dur._milliseconds,this._days+=dur._days,this._months+=dur._months,this._bubble(),this},subtract:function(input,val){var dur=moment.duration(input,val);return this._milliseconds-=dur._milliseconds,this._days-=dur._days,this._months-=dur._months,this._bubble(),this},get:function(units){return units=normalizeUnits(units),this[units.toLowerCase()+"s"]()},as:function(units){return units=normalizeUnits(units),this["as"+units.charAt(0).toUpperCase()+units.slice(1)+"s"]()},lang:moment.fn.lang,toIsoString:function(){var years=Math.abs(this.years()),months=Math.abs(this.months()),days=Math.abs(this.days()),hours=Math.abs(this.hours()),minutes=Math.abs(this.minutes()),seconds=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(years?years+"Y":"")+(months?months+"M":"")+(days?days+"D":"")+(hours||minutes||seconds?"T":"")+(hours?hours+"H":"")+(minutes?minutes+"M":"")+(seconds?seconds+"S":""):"P0D"}});for(i in unitMillisecondFactors)unitMillisecondFactors.hasOwnProperty(i)&&(makeDurationAsGetter(i,unitMillisecondFactors[i]),makeDurationGetter(i.toLowerCase()));makeDurationAsGetter("Weeks",6048e5),moment.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},moment.lang("en",{ordinal:function(number){var b=number%10,output=1===toInt(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return number+output}}),hasModule?(module.exports=moment,makeGlobal(!0)):"function"==typeof define&&define.amd?define("moment",["require","exports","module"],function(require,exports,module){return module.config&&module.config()&&module.config().noGlobal!==!0&&makeGlobal(module.config().noGlobal===undefined),moment}):makeGlobal()}.call(this),function(global,factory){"object"==typeof exports&&exports?factory(exports):"function"==typeof define&&define.amd?define("mustache",["exports"],factory):factory(global.Mustache={})}(this,function(mustache){function isFunction(object){return"function"==typeof object}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function testRegExp(re,string){return RegExp_test.call(re,string)}function isWhitespace(string){return!testRegExp(nonSpaceRe,string)}function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function parseTemplate(template,tags){function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)delete tokens[spaces.pop()];else spaces=[];hasTag=!1,nonSpace=!1}function compileTags(tags){if("string"==typeof tags&&(tags=tags.split(spaceRe,2)),!isArray(tags)||2!==tags.length)throw new Error("Invalid tags: "+tags);openingTagRe=new RegExp(escapeRegExp(tags[0])+"\\s*"),closingTagRe=new RegExp("\\s*"+escapeRegExp(tags[1])),closingCurlyRe=new RegExp("\\s*"+escapeRegExp("}"+tags[1]))}if(!template)return[];var openingTagRe,closingTagRe,closingCurlyRe,sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1;compileTags(tags||mustache.tags);for(var start,type,value,chr,token,openSection,scanner=new Scanner(template);!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(openingTagRe))for(var i=0,valueLength=value.length;valueLength>i;++i)chr=value.charAt(i),isWhitespace(chr)?spaces.push(tokens.length):nonSpace=!0,tokens.push(["text",chr,start,start+1]),start+=1,"\n"===chr&&stripSpace();if(!scanner.scan(openingTagRe))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type?(value=scanner.scanUntil(equalsRe),scanner.scan(equalsRe),scanner.scanUntil(closingTagRe)):"{"===type?(value=scanner.scanUntil(closingCurlyRe),scanner.scan(curlyRe),scanner.scanUntil(closingTagRe),type="&"):value=scanner.scanUntil(closingTagRe),!scanner.scan(closingTagRe))throw new Error("Unclosed tag at "+scanner.pos);if(token=[type,value,start,scanner.pos],tokens.push(token),"#"===type||"^"===type)sections.push(token);else if("/"===type){if(openSection=sections.pop(),!openSection)throw new Error('Unopened section "'+value+'" at '+start);if(openSection[1]!==value)throw new Error('Unclosed section "'+openSection[1]+'" at '+start)}else"name"===type||"{"===type||"&"===type?nonSpace=!0:"="===type&&compileTags(value)}if(openSection=sections.pop())throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);return nestTokens(squashTokens(tokens))}function squashTokens(tokens){for(var token,lastToken,squashedTokens=[],i=0,numTokens=tokens.length;numTokens>i;++i)token=tokens[i],token&&("text"===token[0]&&lastToken&&"text"===lastToken[0]?(lastToken[1]+=token[1],lastToken[3]=token[3]):(squashedTokens.push(token),lastToken=token));return squashedTokens}function nestTokens(tokens){for(var token,section,nestedTokens=[],collector=nestedTokens,sections=[],i=0,numTokens=tokens.length;numTokens>i;++i)switch(token=tokens[i],token[0]){case"#":case"^":collector.push(token),sections.push(token),collector=token[4]=[];break;case"/":section=sections.pop(),section[5]=token[2],collector=sections.length>0?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token)}return nestedTokens}function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parentContext){this.view=null==view?{}:view,this.cache={".":this.view},this.parent=parentContext}function Writer(){this.cache={}}var Object_toString=Object.prototype.toString,isArray=Array.isArray||function(object){return"[object Array]"===Object_toString.call(object)},RegExp_test=RegExp.prototype.test,nonSpaceRe=/\S/,entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},whiteRe=/\s*/,spaceRe=/\s+/,equalsRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!/;Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(!match||0!==match.index)return"";var string=match[0];return this.tail=this.tail.substring(string.length),this.pos+=string.length,string},Scanner.prototype.scanUntil=function(re){var match,index=this.tail.search(re);switch(index){case-1:match=this.tail,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index),this.tail=this.tail.substring(index)}return this.pos+=match.length,match},Context.prototype.push=function(view){return new Context(view,this)},Context.prototype.lookup=function(name){var value,cache=this.cache;if(name in cache)value=cache[name];else{for(var names,index,context=this;context;){if(name.indexOf(".")>0)for(value=context.view,names=name.split("."),index=0;null!=value&&index<names.length;)value=value[names[index++]];else value=context.view[name];if(null!=value)break;context=context.parent}cache[name]=value}return isFunction(value)&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function(){this.cache={}},Writer.prototype.parse=function(template,tags){var cache=this.cache,tokens=cache[template];return null==tokens&&(tokens=cache[template]=parseTemplate(template,tags)),tokens},Writer.prototype.render=function(template,view,partials){var tokens=this.parse(template),context=view instanceof Context?view:new Context(view);return this.renderTokens(tokens,context,partials,template)},Writer.prototype.renderTokens=function(tokens,context,partials,originalTemplate){function subRender(template){return self.render(template,context,partials)}for(var token,value,buffer="",self=this,i=0,numTokens=tokens.length;numTokens>i;++i)switch(token=tokens[i],token[0]){case"#":if(value=context.lookup(token[1]),!value)continue;if(isArray(value))for(var j=0,valueLength=value.length;valueLength>j;++j)buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate);else if("object"==typeof value||"string"==typeof value)buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate);else if(isFunction(value)){if("string"!=typeof originalTemplate)throw new Error("Cannot use higher-order sections without the original template");value=value.call(context.view,originalTemplate.slice(token[3],token[5]),subRender),null!=value&&(buffer+=value)}else buffer+=this.renderTokens(token[4],context,partials,originalTemplate);break;case"^":value=context.lookup(token[1]),(!value||isArray(value)&&0===value.length)&&(buffer+=this.renderTokens(token[4],context,partials,originalTemplate));break;case">":if(!partials)continue;value=isFunction(partials)?partials(token[1]):partials[token[1]],null!=value&&(buffer+=this.renderTokens(this.parse(value),context,partials,value));break;case"&":value=context.lookup(token[1]),null!=value&&(buffer+=value);break;case"name":value=context.lookup(token[1]),null!=value&&(buffer+=mustache.escape(value));break;case"text":buffer+=token[1]}return buffer},mustache.name="mustache.js",mustache.version="0.8.1",mustache.tags=["{{","}}"];var defaultWriter=new Writer;mustache.clearCache=function(){return defaultWriter.clearCache()},mustache.parse=function(template,tags){return defaultWriter.parse(template,tags)},mustache.render=function(template,view,partials){return defaultWriter.render(template,view,partials)},mustache.to_html=function(template,view,partials,send){var result=mustache.render(template,view,partials);return isFunction(send)?void send(result):result},mustache.escape=escapeHtml,mustache.Scanner=Scanner,mustache.Context=Context,mustache.Writer=Writer}),function(root,factory){var moment;if("object"==typeof exports){try{moment=require("moment")}catch(e){}module.exports=factory(moment)}else"function"==typeof define&&define.amd?define("pikaday",["require"],function(req){var id="moment";return moment=req.defined&&req.defined(id)?req(id):void 0,factory(moment)}):root.Pikaday=factory(root.moment)}(this,function(moment){var hasMoment="function"==typeof moment,hasEventListeners=!!window.addEventListener,document=window.document,sto=window.setTimeout,addEvent=function(el,e,callback,capture){hasEventListeners?el.addEventListener(e,callback,!!capture):el.attachEvent("on"+e,callback)},removeEvent=function(el,e,callback,capture){hasEventListeners?el.removeEventListener(e,callback,!!capture):el.detachEvent("on"+e,callback)},fireEvent=function(el,eventName,data){var ev;document.createEvent?(ev=document.createEvent("HTMLEvents"),ev.initEvent(eventName,!0,!1),ev=extend(ev,data),el.dispatchEvent(ev)):document.createEventObject&&(ev=document.createEventObject(),ev=extend(ev,data),el.fireEvent("on"+eventName,ev))},trim=function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")},hasClass=function(el,cn){return-1!==(" "+el.className+" ").indexOf(" "+cn+" ")},addClass=function(el,cn){hasClass(el,cn)||(el.className=""===el.className?cn:el.className+" "+cn)},removeClass=function(el,cn){el.className=trim((" "+el.className+" ").replace(" "+cn+" "," "))},isArray=function(obj){return/Array/.test(Object.prototype.toString.call(obj))},isDate=function(obj){return/Date/.test(Object.prototype.toString.call(obj))&&!isNaN(obj.getTime())},isLeapYear=function(year){return year%4===0&&year%100!==0||year%400===0},getDaysInMonth=function(year,month){return[31,isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},setToStartOfDay=function(date){isDate(date)&&date.setHours(0,0,0,0)},compareDates=function(a,b){return a.getTime()===b.getTime()},extend=function(to,from,overwrite){var prop,hasProp;for(prop in from)hasProp=void 0!==to[prop],hasProp&&"object"==typeof from[prop]&&void 0===from[prop].nodeName?isDate(from[prop])?overwrite&&(to[prop]=new Date(from[prop].getTime())):isArray(from[prop])?overwrite&&(to[prop]=from[prop].slice(0)):to[prop]=extend({},from[prop],overwrite):(overwrite||!hasProp)&&(to[prop]=from[prop]);return to},defaults={field:null,bound:void 0,format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,numberOfMonths:1,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},onSelect:null,onOpen:null,onClose:null,onDraw:null},renderDayName=function(opts,day,abbr){for(day+=opts.firstDay;day>=7;)day-=7;return abbr?opts.i18n.weekdaysShort[day]:opts.i18n.weekdays[day]},renderDay=function(i,isSelected,isToday,isDisabled,isEmpty){if(isEmpty)return'<td class="is-empty"></td>';var arr=[];return isDisabled&&arr.push("is-disabled"),isToday&&arr.push("is-today"),isSelected&&arr.push("is-selected"),'<td data-day="'+i+'" class="'+arr.join(" ")+'"><button class="pika-button" type="button">'+i+"</button></td>"},renderRow=function(days,isRTL){return"<tr>"+(isRTL?days.reverse():days).join("")+"</tr>"},renderBody=function(rows){return"<tbody>"+rows.join("")+"</tbody>"},renderHead=function(opts){var i,arr=[];for(i=0;7>i;i++)arr.push('<th scope="col"><abbr title="'+renderDayName(opts,i)+'">'+renderDayName(opts,i,!0)+"</abbr></th>");return"<thead>"+(opts.isRTL?arr.reverse():arr).join("")+"</thead>"},renderTitle=function(instance){var i,j,arr,monthHtml,yearHtml,opts=instance._o,month=instance._m,year=instance._y,isMinYear=year===opts.minYear,isMaxYear=year===opts.maxYear,html='<div class="pika-title">',prev=!0,next=!0;for(arr=[],i=0;12>i;i++)arr.push('<option value="'+i+'"'+(i===month?" selected":"")+(isMinYear&&i<opts.minMonth||isMaxYear&&i>opts.maxMonth?"disabled":"")+">"+opts.i18n.months[i]+"</option>");for(monthHtml='<div class="pika-label">'+opts.i18n.months[month]+'<select class="pika-select pika-select-month">'+arr.join("")+"</select></div>",isArray(opts.yearRange)?(i=opts.yearRange[0],j=opts.yearRange[1]+1):(i=year-opts.yearRange,j=1+year+opts.yearRange),arr=[];j>i&&i<=opts.maxYear;i++)i>=opts.minYear&&arr.push('<option value="'+i+'"'+(i===year?" selected":"")+">"+i+"</option>");return yearHtml='<div class="pika-label">'+year+opts.yearSuffix+'<select class="pika-select pika-select-year">'+arr.join("")+"</select></div>",html+=opts.showMonthAfterYear?yearHtml+monthHtml:monthHtml+yearHtml,isMinYear&&(0===month||opts.minMonth>=month)&&(prev=!1),isMaxYear&&(11===month||opts.maxMonth<=month)&&(next=!1),html+='<button class="pika-prev'+(prev?"":" is-disabled")+'" type="button">'+opts.i18n.previousMonth+"</button>",html+='<button class="pika-next'+(next?"":" is-disabled")+'" type="button">'+opts.i18n.nextMonth+"</button>",html+="</div>"},renderTable=function(opts,data){return'<table cellpadding="0" cellspacing="0" class="pika-table">'+renderHead(opts)+renderBody(data)+"</table>"},Pikaday=function(options){var self=this,opts=self.config(options);self._onMouseDown=function(e){if(self._v){e=e||window.event;var target=e.target||e.srcElement;if(target){if(!hasClass(target,"is-disabled")){if(hasClass(target,"pika-button")&&!hasClass(target,"is-empty"))return self.setDate(new Date(self._y,self._m,parseInt(target.innerHTML,10))),void(opts.bound&&sto(function(){self.hide()},100));hasClass(target,"pika-prev")?self.prevMonth():hasClass(target,"pika-next")&&self.nextMonth()}if(hasClass(target,"pika-select"))self._c=!0;else{if(!e.preventDefault)return e.returnValue=!1,!1;e.preventDefault()}}}},self._onChange=function(e){e=e||window.event;var target=e.target||e.srcElement;target&&(hasClass(target,"pika-select-month")?self.gotoMonth(target.value):hasClass(target,"pika-select-year")&&self.gotoYear(target.value))},self._onInputChange=function(e){var date;e.firedBy!==self&&(hasMoment?(date=moment(opts.field.value,opts.format),date=date&&date.isValid()?date.toDate():null):date=new Date(Date.parse(opts.field.value)),self.setDate(isDate(date)?date:null),self._v||self.show())},self._onInputFocus=function(){self.show()},self._onInputClick=function(){self.show()},self._onInputBlur=function(){self._c||(self._b=sto(function(){self.hide()},50)),self._c=!1},self._onClick=function(e){e=e||window.event;var target=e.target||e.srcElement,pEl=target;if(target){!hasEventListeners&&hasClass(target,"pika-select")&&(target.onchange||(target.setAttribute("onchange","return;"),addEvent(target,"change",self._onChange)));do if(hasClass(pEl,"pika-single"))return;while(pEl=pEl.parentNode);self._v&&target!==opts.trigger&&self.hide()}},self.el=document.createElement("div"),self.el.className="pika-single"+(opts.isRTL?" is-rtl":""),addEvent(self.el,"mousedown",self._onMouseDown,!0),addEvent(self.el,"change",self._onChange),opts.field&&(opts.bound?document.body.appendChild(self.el):opts.field.parentNode.insertBefore(self.el,opts.field.nextSibling),addEvent(opts.field,"change",self._onInputChange),opts.defaultDate||(opts.defaultDate=hasMoment&&opts.field.value?moment(opts.field.value,opts.format).toDate():new Date(Date.parse(opts.field.value)),opts.setDefaultDate=!0));var defDate=opts.defaultDate;isDate(defDate)?opts.setDefaultDate?self.setDate(defDate,!0):self.gotoDate(defDate):self.gotoDate(new Date),opts.bound?(this.hide(),self.el.className+=" is-bound",addEvent(opts.trigger,"click",self._onInputClick),addEvent(opts.trigger,"focus",self._onInputFocus),addEvent(opts.trigger,"blur",self._onInputBlur)):this.show()};return Pikaday.prototype={config:function(options){this._o||(this._o=extend({},defaults,!0));var opts=extend(this._o,options,!0);opts.isRTL=!!opts.isRTL,opts.field=opts.field&&opts.field.nodeName?opts.field:null,opts.bound=!!(void 0!==opts.bound?opts.field&&opts.bound:opts.field),opts.trigger=opts.trigger&&opts.trigger.nodeName?opts.trigger:opts.field;var nom=parseInt(opts.numberOfMonths,10)||1;if(opts.numberOfMonths=nom>4?4:nom,isDate(opts.minDate)||(opts.minDate=!1),isDate(opts.maxDate)||(opts.maxDate=!1),opts.minDate&&opts.maxDate&&opts.maxDate<opts.minDate&&(opts.maxDate=opts.minDate=!1),opts.minDate&&(setToStartOfDay(opts.minDate),opts.minYear=opts.minDate.getFullYear(),opts.minMonth=opts.minDate.getMonth()),opts.maxDate&&(setToStartOfDay(opts.maxDate),opts.maxYear=opts.maxDate.getFullYear(),opts.maxMonth=opts.maxDate.getMonth()),isArray(opts.yearRange)){var fallback=(new Date).getFullYear()-10;opts.yearRange[0]=parseInt(opts.yearRange[0],10)||fallback,opts.yearRange[1]=parseInt(opts.yearRange[1],10)||fallback}else opts.yearRange=Math.abs(parseInt(opts.yearRange,10))||defaults.yearRange,opts.yearRange>100&&(opts.yearRange=100);return opts},toString:function(format){return isDate(this._d)?hasMoment?moment(this._d).format(format||this._o.format):this._d.toDateString():""},getMoment:function(){return hasMoment?moment(this._d):null},setMoment:function(date){hasMoment&&moment.isMoment(date)&&this.setDate(date.toDate())},getDate:function(){return isDate(this._d)?new Date(this._d.getTime()):null},setDate:function(date,preventOnSelect){if(!date)return this._d=null,this.draw();if("string"==typeof date&&(date=new Date(Date.parse(date))),isDate(date)){var min=this._o.minDate,max=this._o.maxDate;isDate(min)&&min>date?date=min:isDate(max)&&date>max&&(date=max),this._d=new Date(date.getTime()),setToStartOfDay(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),fireEvent(this._o.field,"change",{firedBy:this})),preventOnSelect||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(date){isDate(date)&&(this._y=date.getFullYear(),this._m=date.getMonth(),this.draw())},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(month){isNaN(month=parseInt(month,10))||(this._m=0>month?0:month>11?11:month,this.draw())},nextMonth:function(){++this._m>11&&(this._m=0,this._y++),this.draw()},prevMonth:function(){--this._m<0&&(this._m=11,this._y--),this.draw()},gotoYear:function(year){isNaN(year)||(this._y=parseInt(year,10),this.draw())},setMinDate:function(value){this._o.minDate=value},setMaxDate:function(value){this._o.maxDate=value},draw:function(force){if(this._v||force){var opts=this._o,minYear=opts.minYear,maxYear=opts.maxYear,minMonth=opts.minMonth,maxMonth=opts.maxMonth;if(this._y<=minYear&&(this._y=minYear,!isNaN(minMonth)&&this._m<minMonth&&(this._m=minMonth)),this._y>=maxYear&&(this._y=maxYear,!isNaN(maxMonth)&&this._m>maxMonth&&(this._m=maxMonth)),this.el.innerHTML=renderTitle(this)+this.render(this._y,this._m),opts.bound&&(this.adjustPosition(),"hidden"!==opts.field.type&&sto(function(){opts.trigger.focus()
},1)),"function"==typeof this._o.onDraw){var self=this;sto(function(){self._o.onDraw.call(self)},0)}}},adjustPosition:function(){var left,top,clientRect,field=this._o.trigger,pEl=field,width=this.el.offsetWidth,height=this.el.offsetHeight,viewportWidth=window.innerWidth||document.documentElement.clientWidth,viewportHeight=window.innerHeight||document.documentElement.clientHeight,scrollTop=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;if("function"==typeof field.getBoundingClientRect)clientRect=field.getBoundingClientRect(),left=clientRect.left+window.pageXOffset,top=clientRect.bottom+window.pageYOffset;else for(left=pEl.offsetLeft,top=pEl.offsetTop+pEl.offsetHeight;pEl=pEl.offsetParent;)left+=pEl.offsetLeft,top+=pEl.offsetTop;left+width>viewportWidth&&(left=left-width+field.offsetWidth),top+height>viewportHeight+scrollTop&&(top=top-height-field.offsetHeight),this.el.style.cssText="position:absolute;left:"+left+"px;top:"+top+"px;"},render:function(year,month){var opts=this._o,now=new Date,days=getDaysInMonth(year,month),before=new Date(year,month,1).getDay(),data=[],row=[];setToStartOfDay(now),opts.firstDay>0&&(before-=opts.firstDay,0>before&&(before+=7));for(var cells=days+before,after=cells;after>7;)after-=7;cells+=7-after;for(var i=0,r=0;cells>i;i++){var day=new Date(year,month,1+(i-before)),isDisabled=opts.minDate&&day<opts.minDate||opts.maxDate&&day>opts.maxDate,isSelected=isDate(this._d)?compareDates(day,this._d):!1,isToday=compareDates(day,now),isEmpty=before>i||i>=days+before;row.push(renderDay(1+(i-before),isSelected,isToday,isDisabled,isEmpty)),7===++r&&(data.push(renderRow(row,opts.isRTL)),row=[],r=0)}return renderTable(opts,data)},isVisible:function(){return this._v},show:function(){this._v||(this._o.bound&&addEvent(document,"click",this._onClick),removeClass(this.el,"is-hidden"),this._v=!0,this.draw(),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var v=this._v;v!==!1&&(this._o.bound&&removeEvent(document,"click",this._onClick),this.el.style.cssText="",addClass(this.el,"is-hidden"),this._v=!1,void 0!==v&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){this.hide(),removeEvent(this.el,"mousedown",this._onMouseDown,!0),removeEvent(this.el,"change",this._onChange),this._o.field&&(removeEvent(this._o.field,"change",this._onInputChange),this._o.bound&&(removeEvent(this._o.trigger,"click",this._onInputClick),removeEvent(this._o.trigger,"focus",this._onInputFocus),removeEvent(this._o.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},Pikaday}),function(){var window=this,document=this.document,_defaults={speed:500,easing:"easeInOutCubic",offset:0,updateURL:!1,callbackBefore:function(){},callbackAfter:function(){}},_mergeObjects=function(original,updates){for(var key in updates)original[key]=updates[key];return original},_easingPattern=function(type,time){return"easeInQuad"==type?time*time:"easeOutQuad"==type?time*(2-time):"easeInOutQuad"==type?.5>time?2*time*time:-1+(4-2*time)*time:"easeInCubic"==type?time*time*time:"easeOutCubic"==type?--time*time*time+1:"easeInOutCubic"==type?.5>time?4*time*time*time:(time-1)*(2*time-2)*(2*time-2)+1:"easeInQuart"==type?time*time*time*time:"easeOutQuart"==type?1- --time*time*time*time:"easeInOutQuart"==type?.5>time?8*time*time*time*time:1-8*--time*time*time*time:"easeInQuint"==type?time*time*time*time*time:"easeOutQuint"==type?1+--time*time*time*time*time:"easeInOutQuint"==type?.5>time?16*time*time*time*time*time:1+16*--time*time*time*time*time:time},_getEndLocation=function(anchor,headerHeight,offset){var location=0;if(anchor.offsetParent)do location+=anchor.offsetTop,anchor=anchor.offsetParent;while(anchor);return location=location-headerHeight-offset,location>=0?location:0},_getDocumentHeight=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},_getDataOptions=function(options){if(null===options||void 0===options)return{};var settings={};return options=options.split(";"),options.forEach(function(option){option=option.trim(),""!==option&&(option=option.split(":"),settings[option[0]]=option[1].trim())}),settings},_updateURL=function(anchor,url){url!==!0&&"true"!==url||!history.pushState||history.pushState({pos:anchor.id},"",anchor)},animateScroll=function(toggle,anchor,options,event){options=_mergeObjects(_defaults,options||{});var animationInterval,percentage,position,overrides=_getDataOptions(toggle?toggle.getAttribute("data-options"):null),speed=parseInt(overrides.speed||options.speed,10),easing=overrides.easing||options.easing,offset=parseInt(overrides.offset||options.offset,10),updateURL=overrides.updateURL||options.updateURL,fixedHeader=document.querySelector("[data-scroll-header]"),headerHeight=null===fixedHeader?0:fixedHeader.offsetHeight+fixedHeader.offsetTop,startLocation=window.pageYOffset,endLocation=_getEndLocation(document.querySelector(anchor),headerHeight,offset),distance=endLocation-startLocation,documentHeight=_getDocumentHeight(),timeLapsed=0;toggle&&"A"===toggle.tagName&&event&&event.preventDefault(),_updateURL(anchor,updateURL);var _stopAnimateScroll=function(position,endLocation,animationInterval){var currentLocation=window.pageYOffset;(position==endLocation||currentLocation==endLocation||window.innerHeight+currentLocation>=documentHeight)&&(clearInterval(animationInterval),options.callbackAfter(toggle,anchor))},_loopAnimateScroll=function(){timeLapsed+=16,percentage=timeLapsed/speed,percentage=percentage>1?1:percentage,position=startLocation+distance*_easingPattern(easing,percentage),window.scrollTo(0,Math.floor(position)),_stopAnimateScroll(position,endLocation,animationInterval)},_startAnimateScroll=function(){options.callbackBefore(toggle,anchor),animationInterval=setInterval(_loopAnimateScroll,16)};0===window.pageYOffset&&window.scrollTo(0,0),_startAnimateScroll()},init=function(options){if("querySelector"in document&&"addEventListener"in window&&Array.prototype.forEach){options=_mergeObjects(_defaults,options||{});var toggles=document.querySelectorAll("[data-scroll]");Array.prototype.forEach.call(toggles,function(toggle){toggle.addEventListener("click",animateScroll.bind(null,toggle,toggle.getAttribute("href"),options),!1)})}};return define("smoothScroll",[],function(){return{init:init,animateScroll:animateScroll}}),{init:init,animateScroll:animateScroll}}.call(this),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("socket-io",[],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.io=e()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){function lookup(uri,opts){"object"==typeof uri&&(opts=uri,uri=void 0),opts=opts||{};var io,parsed=url(uri),source=parsed.source,id=parsed.id;return opts.forceNew||opts["force new connection"]||!1===opts.multiplex?(debug("ignoring socket cache for %s",source),io=Manager(source,opts)):(cache[id]||(debug("new io instance for %s",source),cache[id]=Manager(source,opts)),io=cache[id]),io.socket(parsed.path)}var url=_dereq_("./url"),parser=_dereq_("socket.io-parser"),Manager=_dereq_("./manager"),debug=_dereq_("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};exports.protocol=parser.protocol,exports.connect=lookup,exports.Manager=_dereq_("./manager"),exports.Socket=_dereq_("./socket")},{"./manager":2,"./socket":4,"./url":5,debug:8,"socket.io-parser":38}],2:[function(_dereq_,module){function Manager(uri,opts){return this instanceof Manager?(uri&&"object"==typeof uri&&(opts=uri,uri=void 0),opts=opts||{},opts.path=opts.path||"/socket.io",this.nsps={},this.subs=[],this.opts=opts,this.reconnection(opts.reconnection!==!1),this.reconnectionAttempts(opts.reconnectionAttempts||1/0),this.reconnectionDelay(opts.reconnectionDelay||1e3),this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3),this.timeout(null==opts.timeout?2e4:opts.timeout),this.readyState="closed",this.uri=uri,this.connected=0,this.attempts=0,this.encoding=!1,this.packetBuffer=[],this.encoder=new parser.Encoder,this.decoder=new parser.Decoder,void(opts.autoConnect!==!1&&this.open())):new Manager(uri,opts)}var eio=(_dereq_("./url"),_dereq_("engine.io-client")),Socket=_dereq_("./socket"),Emitter=_dereq_("component-emitter"),parser=_dereq_("socket.io-parser"),on=_dereq_("./on"),bind=_dereq_("component-bind"),debug=(_dereq_("object-component"),_dereq_("debug")("socket.io-client:manager"));module.exports=Manager,Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps)this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)},Emitter(Manager.prototype),Manager.prototype.reconnection=function(v){return arguments.length?(this._reconnection=!!v,this):this._reconnection},Manager.prototype.reconnectionAttempts=function(v){return arguments.length?(this._reconnectionAttempts=v,this):this._reconnectionAttempts},Manager.prototype.reconnectionDelay=function(v){return arguments.length?(this._reconnectionDelay=v,this):this._reconnectionDelay},Manager.prototype.reconnectionDelayMax=function(v){return arguments.length?(this._reconnectionDelayMax=v,this):this._reconnectionDelayMax},Manager.prototype.timeout=function(v){return arguments.length?(this._timeout=v,this):this._timeout},Manager.prototype.maybeReconnectOnOpen=function(){this.openReconnect||this.reconnecting||!this._reconnection||0!==this.attempts||(this.openReconnect=!0,this.reconnect())},Manager.prototype.open=Manager.prototype.connect=function(fn){if(debug("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri),this.engine=eio(this.uri,this.opts);var socket=this.engine,self=this;this.readyState="opening";var openSub=on(socket,"open",function(){self.onopen(),fn&&fn()}),errorSub=on(socket,"error",function(data){if(debug("connect_error"),self.cleanup(),self.readyState="closed",self.emitAll("connect_error",data),fn){var err=new Error("Connection error");err.data=data,fn(err)}self.maybeReconnectOnOpen()});if(!1!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout),openSub.destroy(),socket.close(),socket.emit("error","timeout"),self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}return this.subs.push(openSub),this.subs.push(errorSub),this},Manager.prototype.onopen=function(){debug("open"),this.cleanup(),this.readyState="open",this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata"))),this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded"))),this.subs.push(on(socket,"error",bind(this,"onerror"))),this.subs.push(on(socket,"close",bind(this,"onclose")))},Manager.prototype.ondata=function(data){this.decoder.add(data)},Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)},Manager.prototype.onerror=function(err){debug("error",err),this.emitAll("error",err)},Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp),this.nsps[nsp]=socket;var self=this;socket.on("connect",function(){self.connected++})}return socket},Manager.prototype.destroy=function(){--this.connected||this.close()},Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;self.encoding?self.packetBuffer.push(packet):(self.encoding=!0,this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++)self.engine.write(encodedPackets[i]);self.encoding=!1,self.processPacketQueue()}))},Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}},Manager.prototype.cleanup=function(){for(var sub;sub=this.subs.shift();)sub.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},Manager.prototype.close=Manager.prototype.disconnect=function(){this.skipReconnect=!0,this.engine.close()},Manager.prototype.onclose=function(reason){debug("close"),this.cleanup(),this.readyState="closed",this.emit("close",reason),this._reconnection&&!this.skipReconnect&&this.reconnect()},Manager.prototype.reconnect=function(){if(this.reconnecting)return this;var self=this;if(this.attempts++,this.attempts>this._reconnectionAttempts)debug("reconnect failed"),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var delay=this.attempts*this.reconnectionDelay();delay=Math.min(delay,this.reconnectionDelayMax()),debug("will wait %dms before reconnect attempt",delay),this.reconnecting=!0;var timer=setTimeout(function(){debug("attempting reconnect"),self.emitAll("reconnect_attempt",self.attempts),self.emitAll("reconnecting",self.attempts),self.open(function(err){err?(debug("reconnect attempt error"),self.reconnecting=!1,self.reconnect(),self.emitAll("reconnect_error",err.data)):(debug("reconnect success"),self.onreconnect())})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}},Manager.prototype.onreconnect=function(){var attempt=this.attempts;this.attempts=0,this.reconnecting=!1,this.emitAll("reconnect",attempt)}},{"./on":3,"./socket":4,"./url":5,"component-bind":6,"component-emitter":7,debug:8,"engine.io-client":9,"object-component":35,"socket.io-parser":38}],3:[function(_dereq_,module){function on(obj,ev,fn){return obj.on(ev,fn),{destroy:function(){obj.removeListener(ev,fn)}}}module.exports=on},{}],4:[function(_dereq_,module,exports){function Socket(io,nsp){this.io=io,this.nsp=nsp,this.json=this,this.ids=0,this.acks={},this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.subEvents()}{var parser=_dereq_("socket.io-parser"),Emitter=_dereq_("component-emitter"),toArray=_dereq_("to-array"),on=_dereq_("./on"),bind=_dereq_("component-bind"),debug=_dereq_("debug")("socket.io-client:socket"),hasBin=_dereq_("has-binary-data");_dereq_("indexof")}module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},emit=Emitter.prototype.emit;Emitter(Socket.prototype),Socket.prototype.subEvents=function(){var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]},Socket.prototype.open=Socket.prototype.connect=function(){return this.connected?this:(this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},Socket.prototype.send=function(){var args=toArray(arguments);return args.unshift("message"),this.emit.apply(this,args),this},Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev))return emit.apply(this,arguments),this;var args=toArray(arguments),parserType=parser.EVENT;hasBin(args)&&(parserType=parser.BINARY_EVENT);var packet={type:parserType,data:args};return"function"==typeof args[args.length-1]&&(debug("emitting packet with ack id %d",this.ids),this.acks[this.ids]=args.pop(),packet.id=this.ids++),this.connected?this.packet(packet):this.sendBuffer.push(packet),this},Socket.prototype.packet=function(packet){packet.nsp=this.nsp,this.io.packet(packet)},Socket.prototype.onopen=function(){debug("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:parser.CONNECT})},Socket.prototype.onclose=function(reason){debug("close (%s)",reason),this.connected=!1,this.disconnected=!0,this.emit("disconnect",reason)},Socket.prototype.onpacket=function(packet){if(packet.nsp==this.nsp)switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data)}},Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args),null!=packet.id&&(debug("attaching ack callback to event"),args.push(this.ack(packet.id))),this.connected?emit.apply(this,args):this.receiveBuffer.push(args)},Socket.prototype.ack=function(id){var self=this,sent=!1;return function(){if(!sent){sent=!0;var args=toArray(arguments);debug("sending ack %j",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}}},Socket.prototype.onack=function(packet){debug("calling ack %s with %j",packet.id,packet.data);var fn=this.acks[packet.id];fn.apply(this,packet.data),delete this.acks[packet.id]},Socket.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++)emit.apply(this,this.receiveBuffer[i]);for(this.receiveBuffer=[],i=0;i<this.sendBuffer.length;i++)this.packet(this.sendBuffer[i]);this.sendBuffer=[]},Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},Socket.prototype.destroy=function(){for(var i=0;i<this.subs.length;i++)this.subs[i].destroy();this.io.destroy(this)},Socket.prototype.close=Socket.prototype.disconnect=function(){return this.connected?(debug("performing disconnect (%s)",this.nsp),this.packet({type:parser.DISCONNECT}),this.destroy(),this.onclose("io client disconnect"),this):this}},{"./on":3,"component-bind":6,"component-emitter":7,debug:8,"has-binary-data":30,indexof:34,"socket.io-parser":38,"to-array":41}],5:[function(_dereq_,module){(function(global){function url(uri,loc){var obj=uri,loc=loc||global.location;return null==uri&&(uri=loc.protocol+"//"+loc.hostname),"string"==typeof uri&&("/"==uri.charAt(0)&&"undefined"!=typeof loc&&(uri=loc.hostname+uri),/^(https?|wss?):\/\//.test(uri)||(debug("protocol-less url %s",uri),uri="undefined"!=typeof loc?loc.protocol+"//"+uri:"https://"+uri),debug("parse %s",uri),obj=parseuri(uri)),obj.port||(/^(http|ws)$/.test(obj.protocol)?obj.port="80":/^(http|ws)s$/.test(obj.protocol)&&(obj.port="443")),obj.path=obj.path||"/",obj.id=obj.protocol+"://"+obj.host+":"+obj.port,obj.href=obj.protocol+"://"+obj.host+(loc&&loc.port==obj.port?"":":"+obj.port),obj}var parseuri=_dereq_("parseuri"),debug=_dereq_("debug")("socket.io-client:url");module.exports=url}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:8,parseuri:36}],6:[function(_dereq_,module){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn&&(fn=obj[fn]),"function"!=typeof fn)throw new Error("bind() requires a function");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],7:[function(_dereq_,module){function Emitter(obj){return obj?mixin(obj):void 0}function mixin(obj){for(var key in Emitter.prototype)obj[key]=Emitter.prototype[key];return obj}module.exports=Emitter,Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){return this._callbacks=this._callbacks||{},(this._callbacks[event]=this._callbacks[event]||[]).push(fn),this},Emitter.prototype.once=function(event,fn){function on(){self.off(event,on),fn.apply(this,arguments)}var self=this;return this._callbacks=this._callbacks||{},on.fn=fn,this.on(event,on),this},Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length)return delete this._callbacks[event],this;for(var cb,i=0;i<callbacks.length;i++)if(cb=callbacks[i],cb===fn||cb.fn===fn){callbacks.splice(i,1);break}return this},Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;len>i;++i)callbacks[i].apply(this,args)}return this},Emitter.prototype.listeners=function(event){return this._callbacks=this._callbacks||{},this._callbacks[event]||[]},Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],8:[function(_dereq_,module){function debug(name){return debug.enabled(name)?function(fmt){fmt=coerce(fmt);var curr=new Date,ms=curr-(debug[name]||curr);debug[name]=curr,fmt=name+" "+fmt+" +"+debug.humanize(ms),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function coerce(val){return val instanceof Error?val.stack||val.message:val}module.exports=debug,debug.names=[],debug.skips=[],debug.enable=function(name){try{localStorage.debug=name}catch(e){}for(var split=(name||"").split(/[\s,]+/),len=split.length,i=0;len>i;i++)name=split[i].replace("*",".*?"),"-"===name[0]?debug.skips.push(new RegExp("^"+name.substr(1)+"$")):debug.names.push(new RegExp("^"+name+"$"))},debug.disable=function(){debug.enable("")},debug.humanize=function(ms){var sec=1e3,min=6e4,hour=60*min;return ms>=hour?(ms/hour).toFixed(1)+"h":ms>=min?(ms/min).toFixed(1)+"m":ms>=sec?(ms/sec|0)+"s":ms+"ms"},debug.enabled=function(name){for(var i=0,len=debug.skips.length;len>i;i++)if(debug.skips[i].test(name))return!1;for(var i=0,len=debug.names.length;len>i;i++)if(debug.names[i].test(name))return!0;return!1};try{window.localStorage&&debug.enable(localStorage.debug)}catch(e){}},{}],9:[function(_dereq_,module){module.exports=_dereq_("./lib/")},{"./lib/":10}],10:[function(_dereq_,module){module.exports=_dereq_("./socket"),module.exports.parser=_dereq_("engine.io-parser")},{"./socket":11,"engine.io-parser":21}],11:[function(_dereq_,module){(function(global){function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);if(opts=opts||{},uri&&"object"==typeof uri&&(opts=uri,uri=null),uri&&(uri=parseuri(uri),opts.host=uri.host,opts.secure="https"==uri.protocol||"wss"==uri.protocol,opts.port=uri.port,uri.query&&(opts.query=uri.query)),this.secure=null!=opts.secure?opts.secure:global.location&&"https:"==location.protocol,opts.host){var pieces=opts.host.split(":");opts.hostname=pieces.shift(),pieces.length&&(opts.port=pieces.pop())}this.agent=opts.agent||!1,this.hostname=opts.hostname||(global.location?location.hostname:"localhost"),this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80),this.query=opts.query||{},"string"==typeof this.query&&(this.query=parseqs.decode(this.query)),this.upgrade=!1!==opts.upgrade,this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!opts.forceJSONP,this.forceBase64=!!opts.forceBase64,this.timestampParam=opts.timestampParam||"t",this.timestampRequests=opts.timestampRequests,this.transports=opts.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=opts.policyPort||843,this.rememberUpgrade=opts.rememberUpgrade||!1,this.open(),this.binaryType=null,this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades}function clone(obj){var o={};for(var i in obj)obj.hasOwnProperty(i)&&(o[i]=obj[i]);return o}var transports=_dereq_("./transports"),Emitter=_dereq_("component-emitter"),debug=_dereq_("debug")("engine.io-client:socket"),index=_dereq_("indexof"),parser=_dereq_("engine.io-parser"),parseuri=_dereq_("parseuri"),parsejson=_dereq_("parsejson"),parseqs=_dereq_("parseqs");module.exports=Socket,Socket.priorWebsocketSuccess=!1,Emitter(Socket.prototype),Socket.protocol=parser.protocol,Socket.Socket=Socket,Socket.Transport=_dereq_("./transport"),Socket.transports=_dereq_("./transports"),Socket.parser=_dereq_("engine.io-parser"),Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=clone(this.query);query.EIO=parser.protocol,query.transport=name,this.id&&(query.sid=this.id);var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,forceBase64:this.forceBase64,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this});return transport},Socket.prototype.open=function(){var transport;transport=this.rememberUpgrade&&Socket.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket")?"websocket":this.transports[0],this.readyState="opening";var transport=this.createTransport(transport);transport.open(),this.setTransport(transport)},Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;this.transport&&(debug("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=transport,transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})},Socket.prototype.probe=function(name){function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}failed||(debug('probe transport "%s" opened',name),transport.send([{type:"ping",data:"probe"}]),transport.once("packet",function(msg){if(!failed)if("pong"==msg.type&&"probe"==msg.data)debug('probe transport "%s" pong',name),self.upgrading=!0,self.emit("upgrading",transport),Socket.priorWebsocketSuccess="websocket"==transport.name,debug('pausing current transport "%s"',self.transport.name),self.transport.pause(function(){failed||"closed"!=self.readyState&&"closing"!=self.readyState&&(debug("changing transport and sending upgrade packet"),cleanup(),self.setTransport(transport),transport.send([{type:"upgrade"}]),self.emit("upgrade",transport),transport=null,self.upgrading=!1,self.flush())});else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name,self.emit("upgradeError",err)}}))}function freezeTransport(){failed||(failed=!0,cleanup(),transport.close(),transport=null)}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name,freezeTransport(),debug('probe transport "%s" failed because of error: %s',name,err),self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){transport&&to.name!=transport.name&&(debug('"%s" works - aborting "%s"',to.name,transport.name),freezeTransport())}function cleanup(){transport.removeListener("open",onTransportOpen),transport.removeListener("error",onerror),transport.removeListener("close",onTransportClose),self.removeListener("close",onclose),self.removeListener("upgrading",onupgrade)}debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1}),failed=!1,self=this;Socket.priorWebsocketSuccess=!1,transport.once("open",onTransportOpen),transport.once("error",onerror),transport.once("close",onTransportClose),this.once("close",onclose),this.once("upgrading",onupgrade),transport.open()},Socket.prototype.onOpen=function(){if(debug("socket open"),this.readyState="open",Socket.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;l>i;i++)this.probe(this.upgrades[i])}},Socket.prototype.onPacket=function(packet){if("opening"==this.readyState||"open"==this.readyState)switch(debug('socket receive: type "%s", data "%s"',packet.type,packet.data),this.emit("packet",packet),this.emit("heartbeat"),packet.type){case"open":this.onHandshake(parsejson(packet.data));break;case"pong":this.setPing();break;case"error":var err=new Error("server error");err.code=packet.data,this.emit("error",err);break;case"message":this.emit("data",packet.data),this.emit("message",packet.data)}else debug('packet received with socket readyState "%s"',this.readyState)},Socket.prototype.onHandshake=function(data){this.emit("handshake",data),this.id=data.sid,this.transport.query.sid=data.sid,this.upgrades=this.filterUpgrades(data.upgrades),this.pingInterval=data.pingInterval,this.pingTimeout=data.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){"closed"!=self.readyState&&self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)},Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer),self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout),self.ping(),self.onHeartbeat(self.pingTimeout)},self.pingInterval)},Socket.prototype.ping=function(){this.sendPacket("ping")},Socket.prototype.onDrain=function(){for(var i=0;i<this.prevBufferLen;i++)this.callbackBuffer[i]&&this.callbackBuffer[i]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},Socket.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(debug("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Socket.prototype.write=Socket.prototype.send=function(msg,fn){return this.sendPacket("message",msg,fn),this},Socket.prototype.sendPacket=function(type,data,fn){var packet={type:type,data:data};this.emit("packetCreate",packet),this.writeBuffer.push(packet),this.callbackBuffer.push(fn),this.flush()},Socket.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.onClose("forced close"),debug("socket closing - telling transport to close"),this.transport.close()),this},Socket.prototype.onError=function(err){debug("socket error %j",err),Socket.priorWebsocketSuccess=!1,this.emit("error",err),this.onClose("transport error",err)},Socket.prototype.onClose=function(reason,desc){if("opening"==this.readyState||"open"==this.readyState){debug('socket close with reason: "%s"',reason);var self=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){self.writeBuffer=[],self.callbackBuffer=[],self.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",reason,desc)}},Socket.prototype.filterUpgrades=function(upgrades){for(var filteredUpgrades=[],i=0,j=upgrades.length;j>i;i++)~index(this.transports,upgrades[i])&&filteredUpgrades.push(upgrades[i]);return filteredUpgrades}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":12,"./transports":13,"component-emitter":7,debug:8,"engine.io-parser":21,indexof:34,parsejson:27,parseqs:28,parseuri:36}],12:[function(_dereq_,module){function Transport(opts){this.path=opts.path,this.hostname=opts.hostname,this.port=opts.port,this.secure=opts.secure,this.query=opts.query,this.timestampParam=opts.timestampParam,this.timestampRequests=opts.timestampRequests,this.readyState="",this.agent=opts.agent||!1,this.socket=opts.socket
}var parser=_dereq_("engine.io-parser"),Emitter=_dereq_("component-emitter");module.exports=Transport,Emitter(Transport.prototype),Transport.timestamps=0,Transport.prototype.onError=function(msg,desc){var err=new Error(msg);return err.type="TransportError",err.description=desc,this.emit("error",err),this},Transport.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},Transport.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},Transport.prototype.send=function(packets){if("open"!=this.readyState)throw new Error("Transport not open");this.write(packets)},Transport.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Transport.prototype.onData=function(data){try{var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)}catch(e){e.data=data,this.onError("parser decode error",e)}},Transport.prototype.onPacket=function(packet){this.emit("packet",packet)},Transport.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":7,"engine.io-parser":21}],13:[function(_dereq_,module,exports){(function(global){function polling(opts){var xhr,xd=!1;if(global.location){var isSSL="https:"==location.protocol,port=location.port;port||(port=isSSL?443:80),xd=opts.hostname!=location.hostname||port!=opts.port}return opts.xdomain=xd,xhr=new XMLHttpRequest(opts),"open"in xhr&&!opts.forceJSONP?new XHR(opts):new JSONP(opts)}var XMLHttpRequest=_dereq_("xmlhttprequest"),XHR=_dereq_("./polling-xhr"),JSONP=_dereq_("./polling-jsonp"),websocket=_dereq_("./websocket");exports.polling=polling,exports.websocket=websocket}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":14,"./polling-xhr":15,"./websocket":17,xmlhttprequest:18}],14:[function(_dereq_,module){(function(global){function empty(){}function JSONPPolling(opts){Polling.call(this,opts),this.query=this.query||{},callbacks||(global.___eio||(global.___eio=[]),callbacks=global.___eio),this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)}),this.query.j=this.index,global.document&&global.addEventListener&&global.addEventListener("beforeunload",function(){self.script&&(self.script.onerror=empty)})}var Polling=_dereq_("./polling"),inherit=_dereq_("component-inherit");module.exports=JSONPPolling;var callbacks,rNewline=/\n/g,rEscapedNewline=/\\n/g;inherit(JSONPPolling,Polling),JSONPPolling.prototype.supportsBinary=!1,JSONPPolling.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),Polling.prototype.doClose.call(this)},JSONPPolling.prototype.doPoll=function(){var self=this,script=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),script.async=!0,script.src=this.uri(),script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt),this.script=script;var isUAgecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);isUAgecko&&setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe),document.body.removeChild(iframe)},100)},JSONPPolling.prototype.doWrite=function(data,fn){function complete(){initIframe(),fn()}function initIframe(){if(self.iframe)try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){iframe=document.createElement("iframe"),iframe.name=self.iframeId,iframe.src="javascript:0"}iframe.id=self.iframeId,self.form.appendChild(iframe),self.iframe=iframe}var self=this;if(!this.form){var iframe,form=document.createElement("form"),area=document.createElement("textarea"),id=this.iframeId="eio_iframe_"+this.index;form.className="socketio",form.style.position="absolute",form.style.top="-1000px",form.style.left="-1000px",form.target=id,form.method="POST",form.setAttribute("accept-charset","utf-8"),area.name="d",form.appendChild(area),document.body.appendChild(form),this.form=form,this.area=area}this.form.action=this.uri(),initIframe(),data=data.replace(rEscapedNewline,"\\\n"),this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==self.iframe.readyState&&complete()}:this.iframe.onload=complete}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":16,"component-inherit":20}],15:[function(_dereq_,module){(function(global){function empty(){}function XHR(opts){if(Polling.call(this,opts),global.location){var isSSL="https:"==location.protocol,port=location.port;port||(port=isSSL?443:80),this.xd=opts.hostname!=global.location.hostname||port!=opts.port}}function Request(opts){this.method=opts.method||"GET",this.uri=opts.uri,this.xd=!!opts.xd,this.async=!1!==opts.async,this.data=void 0!=opts.data?opts.data:null,this.agent=opts.agent,this.create(opts.isBinary,opts.supportsBinary)}function unloadHandler(){for(var i in Request.requests)Request.requests.hasOwnProperty(i)&&Request.requests[i].abort()}var XMLHttpRequest=_dereq_("xmlhttprequest"),Polling=_dereq_("./polling"),Emitter=_dereq_("component-emitter"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:polling-xhr");module.exports=XHR,module.exports.Request=Request,inherit(XHR,Polling),XHR.prototype.supportsBinary=!0,XHR.prototype.request=function(opts){return opts=opts||{},opts.uri=this.uri(),opts.xd=this.xd,opts.agent=this.agent||!1,opts.supportsBinary=this.supportsBinary,new Request(opts)},XHR.prototype.doWrite=function(data,fn){var isBinary="string"!=typeof data&&void 0!==data,req=this.request({method:"POST",data:data,isBinary:isBinary}),self=this;req.on("success",fn),req.on("error",function(err){self.onError("xhr post error",err)}),this.sendXhr=req},XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request(),self=this;req.on("data",function(data){self.onData(data)}),req.on("error",function(err){self.onError("xhr poll error",err)}),this.pollXhr=req},Emitter(Request.prototype),Request.prototype.create=function(isBinary,supportsBinary){var xhr=this.xhr=new XMLHttpRequest({agent:this.agent,xdomain:this.xd}),self=this;try{if(debug("xhr open %s: %s",this.method,this.uri),xhr.open(this.method,this.uri,this.async),supportsBinary&&(xhr.responseType="arraybuffer"),"POST"==this.method)try{isBinary?xhr.setRequestHeader("Content-type","application/octet-stream"):xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}"withCredentials"in xhr&&(xhr.withCredentials=!0),xhr.onreadystatechange=function(){var data;try{if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){var contentType=xhr.getResponseHeader("Content-Type");data="application/octet-stream"===contentType?xhr.response:supportsBinary?"ok":xhr.responseText}else setTimeout(function(){self.onError(xhr.status)},0)}catch(e){self.onError(e)}null!=data&&self.onData(data)},debug("xhr data %s",this.data),xhr.send(this.data)}catch(e){return void setTimeout(function(){self.onError(e)},0)}global.document&&(this.index=Request.requestsCount++,Request.requests[this.index]=this)},Request.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},Request.prototype.onData=function(data){this.emit("data",data),this.onSuccess()},Request.prototype.onError=function(err){this.emit("error",err),this.cleanup()},Request.prototype.cleanup=function(){if("undefined"!=typeof this.xhr&&null!==this.xhr){this.xhr.onreadystatechange=empty;try{this.xhr.abort()}catch(e){}global.document&&delete Request.requests[this.index],this.xhr=null}},Request.prototype.abort=function(){this.cleanup()},global.document&&(Request.requestsCount=0,Request.requests={},global.attachEvent?global.attachEvent("onunload",unloadHandler):global.addEventListener&&global.addEventListener("beforeunload",unloadHandler))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":16,"component-emitter":7,"component-inherit":20,debug:8,xmlhttprequest:18}],16:[function(_dereq_,module){function Polling(opts){var forceBase64=opts&&opts.forceBase64;(!hasXHR2||forceBase64)&&(this.supportsBinary=!1),Transport.call(this,opts)}var Transport=_dereq_("../transport"),parseqs=_dereq_("parseqs"),parser=_dereq_("engine.io-parser"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_("xmlhttprequest"),xhr=new XMLHttpRequest({agent:this.agent,xdomain:!1});return null!=xhr.responseType}();inherit(Polling,Transport),Polling.prototype.name="polling",Polling.prototype.doOpen=function(){this.poll()},Polling.prototype.pause=function(onPause){function pause(){debug("paused"),self.readyState="paused",onPause()}var self=this;if(this.readyState="pausing",this.polling||!this.writable){var total=0;this.polling&&(debug("we are currently polling - waiting to pause"),total++,this.once("pollComplete",function(){debug("pre-pause polling complete"),--total||pause()})),this.writable||(debug("we are currently writing - waiting to pause"),total++,this.once("drain",function(){debug("pre-pause writing complete"),--total||pause()}))}else pause()},Polling.prototype.poll=function(){debug("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);var callback=function(packet){return"opening"==self.readyState&&self.onOpen(),"close"==packet.type?(self.onClose(),!1):void self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():debug('ignoring poll - transport state "%s"',this.readyState))},Polling.prototype.doClose=function(){function close(){debug("writing close packet"),self.write([{type:"close"}])}var self=this;"open"==this.readyState?(debug("transport open - closing"),close()):(debug("transport not open - deferring close"),this.once("open",close))},Polling.prototype.write=function(packets){var self=this;this.writable=!1;var callbackfn=function(){self.writable=!0,self.emit("drain")},self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})},Polling.prototype.uri=function(){var query=this.query||{},schema=this.secure?"https":"http",port="";return!1!==this.timestampRequests&&(query[this.timestampParam]=+new Date+"-"+Transport.timestamps++),this.supportsBinary||query.sid||(query.b64=1),query=parseqs.encode(query),this.port&&("https"==schema&&443!=this.port||"http"==schema&&80!=this.port)&&(port=":"+this.port),query.length&&(query="?"+query),schema+"://"+this.hostname+port+this.path+query}},{"../transport":12,"component-inherit":20,debug:8,"engine.io-parser":21,parseqs:28,xmlhttprequest:18}],17:[function(_dereq_,module){function WS(opts){var forceBase64=opts&&opts.forceBase64;forceBase64&&(this.supportsBinary=!1),Transport.call(this,opts)}var Transport=_dereq_("../transport"),parser=_dereq_("engine.io-parser"),parseqs=_dereq_("parseqs"),inherit=_dereq_("component-inherit"),debug=_dereq_("debug")("engine.io-client:websocket"),WebSocket=_dereq_("ws");module.exports=WS,inherit(WS,Transport),WS.prototype.name="websocket",WS.prototype.supportsBinary=!0,WS.prototype.doOpen=function(){if(this.check()){var uri=this.uri(),protocols=void 0,opts={agent:this.agent};this.ws=new WebSocket(uri,protocols,opts),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()},this.ws.onclose=function(){self.onClose()},this.ws.onmessage=function(ev){self.onData(ev.data)},this.ws.onerror=function(e){self.onError("websocket error",e)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}),WS.prototype.write=function(packets){function ondrain(){self.writable=!0,self.emit("drain")}var self=this;this.writable=!1;for(var i=0,l=packets.length;l>i;i++)parser.encodePacket(packets[i],this.supportsBinary,function(data){try{self.ws.send(data)}catch(e){debug("websocket closed before onclose event")}});setTimeout(ondrain,0)},WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)},WS.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},WS.prototype.uri=function(){var query=this.query||{},schema=this.secure?"wss":"ws",port="";return this.port&&("wss"==schema&&443!=this.port||"ws"==schema&&80!=this.port)&&(port=":"+this.port),this.timestampRequests&&(query[this.timestampParam]=+new Date),this.supportsBinary||(query.b64=1),query=parseqs.encode(query),query.length&&(query="?"+query),schema+"://"+this.hostname+port+this.path+query},WS.prototype.check=function(){return!(!WebSocket||"__initialize"in WebSocket&&this.name===WS.prototype.name)}},{"../transport":12,"component-inherit":20,debug:8,"engine.io-parser":21,parseqs:28,ws:29}],18:[function(_dereq_,module){var hasCORS=_dereq_("has-cors");module.exports=function(opts){var xdomain=opts.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS))return new XMLHttpRequest}catch(e){}if(!xdomain)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},{"has-cors":32}],19:[function(_dereq_,module){(function(global){function BlobBuilderConstructor(ary,options){options=options||{};for(var bb=new BlobBuilder,i=0;i<ary.length;i++)bb.append(ary[i]);return options.type?bb.getBlob(options.type):bb.getBlob()}var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder,blobSupported=function(){try{var b=new Blob(["hi"]);return 2==b.size}catch(e){return!1}}(),blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;module.exports=function(){return blobSupported?global.Blob:blobBuilderSupported?BlobBuilderConstructor:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(_dereq_,module){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype,a.prototype=new fn,a.prototype.constructor=a}},{}],21:[function(_dereq_,module,exports){(function(global){function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var data=packet.data,contentArray=new Uint8Array(data),resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++)resultBuffer[i+1]=contentArray[i];return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);var fr=new FileReader;return fr.onload=function(){packet.data=fr.result,exports.encodePacket(packet,supportsBinary,callback)},fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary)return exports.encodeBase64Packet(packet,callback);if(isAndroid)return encodeBlobAsArrayBuffer(packet,supportsBinary,callback);var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}function map(ary,each,done){for(var result=new Array(ary.length),next=after(ary.length,done),eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg,cb(error,result)})},i=0;i<ary.length;i++)eachWithIndex(i,ary[i],next)}var keys=_dereq_("./keys"),sliceBuffer=_dereq_("arraybuffer.slice"),base64encoder=_dereq_("base64-arraybuffer"),after=_dereq_("after"),utf8=_dereq_("utf8"),isAndroid=navigator.userAgent.match(/Android/i);exports.protocol=2;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},packetslist=keys(packets),err={type:"error",data:"parser error"},Blob=_dereq_("blob");exports.encodePacket=function(packet,supportsBinary,callback){"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=!1);var data=void 0===packet.data?void 0:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer)return encodeArrayBuffer(packet,supportsBinary,callback);if(Blob&&data instanceof global.Blob)return encodeBlob(packet,supportsBinary,callback);var encoded=packets[packet.type];return void 0!==packet.data&&(encoded+=utf8.encode(String(packet.data))),callback(""+encoded)},exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof Blob){var fr=new FileReader;return fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)},fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){for(var typed=new Uint8Array(packet.data),basic=new Array(typed.length),i=0;i<typed.length;i++)basic[i]=typed[i];b64data=String.fromCharCode.apply(null,basic)}return message+=global.btoa(b64data),callback(message)},exports.decodePacket=function(data,binaryType){if("string"==typeof data||void 0===data){if("b"==data.charAt(0))return exports.decodeBase64Packet(data.substr(1),binaryType);data=utf8.decode(data);var type=data.charAt(0);return Number(type)==type&&packetslist[type]?data.length>1?{type:packetslist[type],data:data.substring(1)}:{type:packetslist[type]}:err}var asArray=new Uint8Array(data),type=asArray[0],rest=sliceBuffer(data,1);return Blob&&"blob"===binaryType&&(rest=new Blob([rest])),{type:packetslist[type],data:rest}},exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer)return{type:type,data:{base64:!0,data:msg.substr(1)}};var data=base64encoder.decode(msg.substr(1));return"blob"===binaryType&&Blob&&(data=new Blob([data])),{type:type,data:data}},exports.encodePayload=function(packets,supportsBinary,callback){function setLengthHeader(message){return message.length+":"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,supportsBinary,function(message){doneCallback(null,setLengthHeader(message))})}return"function"==typeof supportsBinary&&(callback=supportsBinary,supportsBinary=null),supportsBinary?Blob&&!isAndroid?exports.encodePayloadAsBlob(packets,callback):exports.encodePayloadAsArrayBuffer(packets,callback):packets.length?void map(packets,encodeOne,function(err,results){return callback(results.join(""))}):callback("0:")},exports.decodePayload=function(data,binaryType,callback){if("string"!=typeof data)return exports.decodePayloadAsBinary(data,binaryType,callback);"function"==typeof binaryType&&(callback=binaryType,binaryType=null);var packet;if(""==data)return callback(err,0,1);for(var n,msg,length="",i=0,l=data.length;l>i;i++){var chr=data.charAt(i);if(":"!=chr)length+=chr;else{if(""==length||length!=(n=Number(length)))return callback(err,0,1);if(msg=data.substr(i+1,n),length!=msg.length)return callback(err,0,1);if(msg.length){if(packet=exports.decodePacket(msg,binaryType),err.type==packet.type&&err.data==packet.data)return callback(err,0,1);var ret=callback(packet,i+n,l);if(!1===ret)return}i+=n,length=""}}return""!=length?callback(err,0,1):void 0},exports.encodePayloadAsArrayBuffer=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,!0,function(data){return doneCallback(null,data)})}return packets.length?void map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;return len="string"==typeof p?p.length:p.byteLength,acc+len.toString().length+len+2},0),resultArray=new Uint8Array(totalLength),bufferIndex=0;return encodedPackets.forEach(function(p){var isString="string"==typeof p,ab=p;if(isString){for(var view=new Uint8Array(p.length),i=0;i<p.length;i++)view[i]=p.charCodeAt(i);ab=view.buffer}resultArray[bufferIndex++]=isString?0:1;for(var lenStr=ab.byteLength.toString(),i=0;i<lenStr.length;i++)resultArray[bufferIndex++]=parseInt(lenStr[i]);resultArray[bufferIndex++]=255;for(var view=new Uint8Array(ab),i=0;i<view.length;i++)resultArray[bufferIndex++]=view[i]}),callback(resultArray.buffer)}):callback(new ArrayBuffer(0))},exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,!0,function(encoded){var binaryIdentifier=new Uint8Array(1);if(binaryIdentifier[0]=1,"string"==typeof encoded){for(var view=new Uint8Array(encoded.length),i=0;i<encoded.length;i++)view[i]=encoded.charCodeAt(i);encoded=view.buffer,binaryIdentifier[0]=0}for(var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size,lenStr=len.toString(),lengthAry=new Uint8Array(lenStr.length+1),i=0;i<lenStr.length;i++)lengthAry[i]=parseInt(lenStr[i]);if(lengthAry[lenStr.length]=255,Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})},exports.decodePayloadAsBinary=function(data,binaryType,callback){"function"==typeof binaryType&&(callback=binaryType,binaryType=null);for(var bufferTail=data,buffers=[];bufferTail.byteLength>0;){for(var tailArray=new Uint8Array(bufferTail),isString=0===tailArray[0],msgLength="",i=1;255!=tailArray[i];i++)msgLength+=tailArray[i];bufferTail=sliceBuffer(bufferTail,2+msgLength.length),msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString)try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(var i=0;i<typed.length;i++)msg+=String.fromCharCode(typed[i])}buffers.push(msg),bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType),i,total)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":22,after:23,"arraybuffer.slice":24,"base64-arraybuffer":25,blob:19,utf8:26}],22:[function(_dereq_,module){module.exports=Object.keys||function(obj){var arr=[],has=Object.prototype.hasOwnProperty;for(var i in obj)has.call(obj,i)&&arr.push(i);return arr}},{}],23:[function(_dereq_,module){function after(count,callback,err_cb){function proxy(err,result){if(proxy.count<=0)throw new Error("after called too many times");--proxy.count,err?(bail=!0,callback(err),callback=err_cb):0!==proxy.count||bail||callback(null,result)}var bail=!1;return err_cb=err_cb||noop,proxy.count=count,0===count?callback():proxy}function noop(){}module.exports=after},{}],24:[function(_dereq_,module){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;if(start=start||0,end=end||bytes,arraybuffer.slice)return arraybuffer.slice(start,end);if(0>start&&(start+=bytes),0>end&&(end+=bytes),end>bytes&&(end=bytes),start>=bytes||start>=end||0===bytes)return new ArrayBuffer(0);for(var abv=new Uint8Array(arraybuffer),result=new Uint8Array(end-start),i=start,ii=0;end>i;i++,ii++)result[ii]=abv[i];return result.buffer}},{}],25:[function(_dereq_,module,exports){!function(chars){exports.encode=function(arraybuffer){var i,bytes=new Uint8Array(arraybuffer),len=bytes.length,base64="";for(i=0;len>i;i+=3)base64+=chars[bytes[i]>>2],base64+=chars[(3&bytes[i])<<4|bytes[i+1]>>4],base64+=chars[(15&bytes[i+1])<<2|bytes[i+2]>>6],base64+=chars[63&bytes[i+2]];return len%3===2?base64=base64.substring(0,base64.length-1)+"=":len%3===1&&(base64=base64.substring(0,base64.length-2)+"=="),base64},exports.decode=function(base64){var i,encoded1,encoded2,encoded3,encoded4,bufferLength=.75*base64.length,len=base64.length,p=0;"="===base64[base64.length-1]&&(bufferLength--,"="===base64[base64.length-2]&&bufferLength--);var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;len>i;i+=4)encoded1=chars.indexOf(base64[i]),encoded2=chars.indexOf(base64[i+1]),encoded3=chars.indexOf(base64[i+2]),encoded4=chars.indexOf(base64[i+3]),bytes[p++]=encoded1<<2|encoded2>>4,bytes[p++]=(15&encoded2)<<4|encoded3>>2,bytes[p++]=(3&encoded3)<<6|63&encoded4;return arraybuffer}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],26:[function(_dereq_,module,exports){(function(global){!function(root){function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;length>counter;)value=string.charCodeAt(counter++),value>=55296&&56319>=value&&length>counter?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){for(var value,length=array.length,index=-1,output="";++index<length;)value=array[index],value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value);return output}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if(0==(4294967168&codePoint))return stringFromCharCode(codePoint);var symbol="";return 0==(4294965248&codePoint)?symbol=stringFromCharCode(codePoint>>6&31|192):0==(4294901760&codePoint)?(symbol=stringFromCharCode(codePoint>>12&15|224),symbol+=createByte(codePoint,6)):0==(4292870144&codePoint)&&(symbol=stringFromCharCode(codePoint>>18&7|240),symbol+=createByte(codePoint,12),symbol+=createByte(codePoint,6)),symbol+=stringFromCharCode(63&codePoint|128)}function utf8encode(string){for(var codePoint,codePoints=ucs2decode(string),length=codePoints.length,index=-1,byteString="";++index<length;)codePoint=codePoints[index],byteString+=encodeCodePoint(codePoint);return byteString}function readContinuationByte(){if(byteIndex>=byteCount)throw Error("Invalid byte index");var continuationByte=255&byteArray[byteIndex];if(byteIndex++,128==(192&continuationByte))return 63&continuationByte;throw Error("Invalid continuation byte")}function decodeSymbol(){var byte1,byte2,byte3,byte4,codePoint;if(byteIndex>byteCount)throw Error("Invalid byte index");if(byteIndex==byteCount)return!1;if(byte1=255&byteArray[byteIndex],byteIndex++,0==(128&byte1))return byte1;if(192==(224&byte1)){var byte2=readContinuationByte();if(codePoint=(31&byte1)<<6|byte2,codePoint>=128)return codePoint;throw Error("Invalid continuation byte")}if(224==(240&byte1)){if(byte2=readContinuationByte(),byte3=readContinuationByte(),codePoint=(15&byte1)<<12|byte2<<6|byte3,codePoint>=2048)return codePoint;throw Error("Invalid continuation byte")}if(240==(248&byte1)&&(byte2=readContinuationByte(),byte3=readContinuationByte(),byte4=readContinuationByte(),codePoint=(15&byte1)<<18|byte2<<12|byte3<<6|byte4,codePoint>=65536&&1114111>=codePoint))return codePoint;throw Error("Invalid UTF-8 detected")}function utf8decode(byteString){byteArray=ucs2decode(byteString),byteCount=byteArray.length,byteIndex=0;for(var tmp,codePoints=[];(tmp=decodeSymbol())!==!1;)codePoints.push(tmp);return ucs2encode(codePoints)}var freeExports="object"==typeof exports&&exports,freeModule="object"==typeof module&&module&&module.exports==freeExports&&module,freeGlobal="object"==typeof global&&global;(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal)&&(root=freeGlobal);var byteArray,byteCount,byteIndex,stringFromCharCode=String.fromCharCode,utf8={version:"2.0.0",encode:utf8encode,decode:utf8decode};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return utf8});else if(freeExports&&!freeExports.nodeType)if(freeModule)freeModule.exports=utf8;else{var object={},hasOwnProperty=object.hasOwnProperty;for(var key in utf8)hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}else root.utf8=utf8}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],27:[function(_dereq_,module){(function(global){var rvalidchars=/^[\],:{}\s]*$/,rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rtrimLeft=/^\s+/,rtrimRight=/\s+$/;module.exports=function(data){return"string"==typeof data&&data?(data=data.replace(rtrimLeft,"").replace(rtrimRight,""),global.JSON&&JSON.parse?JSON.parse(data):rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))?new Function("return "+data)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],28:[function(_dereq_,module,exports){exports.encode=function(obj){var str="";for(var i in obj)obj.hasOwnProperty(i)&&(str.length&&(str+="&"),str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i]));return str},exports.decode=function(qs){for(var qry={},pairs=qs.split("&"),i=0,l=pairs.length;l>i;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],29:[function(_dereq_,module){function ws(uri,protocols){var instance;return instance=protocols?new WebSocket(uri,protocols):new WebSocket(uri)}var global=function(){return this}(),WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null,WebSocket&&(ws.prototype=WebSocket.prototype)},{}],30:[function(_dereq_,module){(function(global,Buffer){function hasBinary(data){function _hasBinary(obj){if(!obj)return!1;if(global.Buffer&&Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File)return!0;if(isArray(obj)){for(var i=0;i<obj.length;i++)if(_hasBinary(obj[i]))return!0}else if(obj&&"object"==typeof obj){obj.toJSON&&(obj=obj.toJSON());for(var key in obj)if(obj.hasOwnProperty(key)&&_hasBinary(obj[key]))return!0}return!1}return _hasBinary(data)}var isArray=_dereq_("isarray");module.exports=hasBinary}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer)},{buffer:42,isarray:31}],31:[function(_dereq_,module){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],32:[function(_dereq_,module){var global=_dereq_("global");try{module.exports="XMLHttpRequest"in global&&"withCredentials"in new global.XMLHttpRequest}catch(err){module.exports=!1}},{global:33}],33:[function(_dereq_,module){module.exports=function(){return this}()},{}],34:[function(_dereq_,module){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}},{}],35:[function(_dereq_,module,exports){var has=Object.prototype.hasOwnProperty;exports.keys=Object.keys||function(obj){var keys=[];for(var key in obj)has.call(obj,key)&&keys.push(key);return keys},exports.values=function(obj){var vals=[];for(var key in obj)has.call(obj,key)&&vals.push(obj[key]);return vals},exports.merge=function(a,b){for(var key in b)has.call(b,key)&&(a[key]=b[key]);return a},exports.length=function(obj){return exports.keys(obj).length},exports.isEmpty=function(obj){return 0==exports.length(obj)}},{}],36:[function(_dereq_,module){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function(str){for(var m=re.exec(str||""),uri={},i=14;i--;)uri[parts[i]]=m[i]||"";return uri}},{}],37:[function(_dereq_,module,exports){(function(global,Buffer){function isBuf(obj){return global.Buffer&&Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer
}var isArray=_dereq_("isarray");exports.deconstructPacket=function(packet){function _deconstructPacket(data){if(!data)return data;if(global.Buffer&&Buffer.isBuffer(data)||global.ArrayBuffer&&data instanceof ArrayBuffer){var placeholder={_placeholder:!0,num:buffers.length};return buffers.push(data),placeholder}if(isArray(data)){for(var newData=new Array(data.length),i=0;i<data.length;i++)newData[i]=_deconstructPacket(data[i]);return newData}if("object"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data)newData[key]=_deconstructPacket(data[key]);return newData}return data}var buffers=[],packetData=packet.data,pack=packet;return pack.data=_deconstructPacket(packetData),pack.attachments=buffers.length,{packet:pack,buffers:buffers}},exports.reconstructPacket=function(packet,buffers){function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}if(isArray(data)){for(var i=0;i<data.length;i++)data[i]=_reconstructPacket(data[i]);return data}if(data&&"object"==typeof data){for(var key in data)data[key]=_reconstructPacket(data[key]);return data}return data}return packet.data=_reconstructPacket(packet.data),packet.attachments=void 0,packet},exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){containingObject?containingObject[curKey]=this.result:bloblessData=this.result,--pendingBlobs||callback(bloblessData)},fileReader.readAsArrayBuffer(obj)}else if(isArray(obj))for(var i=0;i<obj.length;i++)_removeBlobs(obj[i],i,obj);else if(obj&&"object"==typeof obj&&!isBuf(obj))for(var key in obj)_removeBlobs(obj[key],key,obj)}var pendingBlobs=0,bloblessData=data;_removeBlobs(bloblessData),pendingBlobs||callback(bloblessData)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer)},{buffer:42,isarray:39}],38:[function(_dereq_,module,exports){(function(global,Buffer){function Encoder(){}function encodeAsString(obj){var str="",nsp=!1;return str+=obj.type,(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type)&&(str+=obj.attachments,str+="-"),obj.nsp&&"/"!=obj.nsp&&(nsp=!0,str+=obj.nsp),null!=obj.id&&(nsp&&(str+=",",nsp=!1),str+=obj.id),null!=obj.data&&(nsp&&(str+=","),str+=json.stringify(obj.data)),debug("encoded %j as %s",obj,str),str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData),pack=encodeAsString(deconstruction.packet),buffers=deconstruction.buffers;buffers.unshift(pack),callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}function decodeString(str){var p={},i=0;if(p.type=Number(str.charAt(0)),null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){for(p.attachments="";"-"!=str.charAt(++i);)p.attachments+=str.charAt(i);p.attachments=Number(p.attachments)}if("/"==str.charAt(i+1))for(p.nsp="";++i;){var c=str.charAt(i);if(","==c)break;if(p.nsp+=c,i+1==str.length)break}else p.nsp="/";var next=str.charAt(i+1);if(""!=next&&Number(next)==next){for(p.id="";++i;){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}if(p.id+=str.charAt(i),i+1==str.length)break}p.id=Number(p.id)}if(str.charAt(++i))try{p.data=json.parse(str.substr(i))}catch(e){return error()}return debug("decoded %s as %j",str,p),p}function BinaryReconstructor(packet){this.reconPack=packet,this.buffers=[]}function error(){return{type:exports.ERROR,data:"parser error"}}var debug=_dereq_("debug")("socket.io-parser"),json=_dereq_("json3"),Emitter=(_dereq_("isarray"),_dereq_("component-emitter")),binary=_dereq_("./binary");exports.protocol=4,exports.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],exports.CONNECT=0,exports.DISCONNECT=1,exports.EVENT=2,exports.ACK=3,exports.ERROR=4,exports.BINARY_EVENT=5,exports.BINARY_ACK=6,exports.Encoder=Encoder,Encoder.prototype.encode=function(obj,callback){if(debug("encoding packet %j",obj),exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type)encodeAsBinary(obj,callback);else{var encoding=encodeAsString(obj);callback([encoding])}},exports.Decoder=Decoder,Emitter(Decoder.prototype),Decoder.prototype.add=function(obj){var packet;if("string"==typeof obj)packet=decodeString(obj),exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type?(this.reconstructor=new BinaryReconstructor(packet),0==this.reconstructor.reconPack.attachments&&this.emit("decoded",packet)):this.emit("decoded",packet);else{if(!(global.Buffer&&Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||obj.base64))throw new Error("Unknown type: "+obj);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");packet=this.reconstructor.takeBinaryData(obj),packet&&(this.reconstructor=null,this.emit("decoded",packet))}},Decoder.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},BinaryReconstructor.prototype.takeBinaryData=function(binData){if(this.buffers.push(binData),this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),packet}return null},BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},_dereq_("buffer").Buffer)},{"./binary":37,buffer:42,"component-emitter":7,debug:8,isarray:39,json3:40}],39:[function(_dereq_,module){module.exports=_dereq_(31)},{}],40:[function(_dereq_,module,exports){!function(window){function has(name){if(has[name]!==undef)return has[name];var isSupported;if("bug-string-char-index"==name)isSupported="a"!="a"[0];else if("json"==name)isSupported=has("json-stringify")&&has("json-parse");else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==name){var stringify=JSON3.stringify,stringifySupported="function"==typeof stringify&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported="0"===stringify(0)&&"0"===stringify(new Number)&&'""'==stringify(new String)&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&"1"===stringify(value)&&"[1]"==stringify([value])&&"[null]"==stringify([undef])&&"null"==stringify(null)&&"[null,null,null]"==stringify([undef,getClass,null])&&stringify({a:[value,!0,!1,null,"\x00\b\n\f\r	"]})==serialized&&"1"===stringify(null,value)&&"[\n 1,\n 2\n]"==stringify([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==stringify(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==stringify(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==stringify(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==stringify(new Date(-1))}catch(exception){stringifySupported=!1}}isSupported=stringifySupported}if("json-parse"==name){var parse=JSON3.parse;if("function"==typeof parse)try{if(0===parse("0")&&!parse(!1)){value=parse(serialized);var parseSupported=5==value.a.length&&1===value.a[0];if(parseSupported){try{parseSupported=!parse('"	"')}catch(exception){}if(parseSupported)try{parseSupported=1!==parse("01")}catch(exception){}if(parseSupported)try{parseSupported=1!==parse("1.")}catch(exception){}}}}catch(exception){parseSupported=!1}isSupported=parseSupported}}return has[name]=!!isSupported}var isProperty,forEach,undef,getClass={}.toString,isLoader="function"==typeof define&&define.amd,nativeJSON="object"==typeof JSON&&JSON,JSON3="object"==typeof exports&&exports&&!exports.nodeType&&exports;JSON3&&nativeJSON?(JSON3.stringify=nativeJSON.stringify,JSON3.parse=nativeJSON.parse):JSON3=window.JSON=nativeJSON||{};var isExtended=new Date(-0xc782b5b800cec);try{isExtended=-109252==isExtended.getUTCFullYear()&&0===isExtended.getUTCMonth()&&1===isExtended.getUTCDate()&&10==isExtended.getUTCHours()&&37==isExtended.getUTCMinutes()&&6==isExtended.getUTCSeconds()&&708==isExtended.getUTCMilliseconds()}catch(exception){}if(!has("json")){var functionClass="[object Function]",dateClass="[object Date]",numberClass="[object Number]",stringClass="[object String]",arrayClass="[object Array]",booleanClass="[object Boolean]",charIndexBuggy=has("bug-string-char-index");if(!isExtended)var floor=Math.floor,Months=[0,31,59,90,120,151,181,212,243,273,304,334],getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)};(isProperty={}.hasOwnProperty)||(isProperty=function(property){var constructor,members={};return(members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass?isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);return this.__proto__=original,result}:(constructor=members.constructor,isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}),members=null,isProperty.call(this,property)});var PrimitiveTypes={"boolean":1,number:1,string:1,undefined:1},isHostType=function(object,property){var type=typeof object[property];return"object"==type?!!object[property]:!PrimitiveTypes[type]};if(forEach=function(object,callback){var Properties,members,property,size=0;(Properties=function(){this.valueOf=0}).prototype.valueOf=0,members=new Properties;for(property in members)isProperty.call(members,property)&&size++;return Properties=members=null,size?forEach=2==size?function(object,callback){var property,members={},isFunction=getClass.call(object)==functionClass;for(property in object)isFunction&&"prototype"==property||isProperty.call(members,property)||!(members[property]=1)||!isProperty.call(object,property)||callback(property)}:function(object,callback){var property,isConstructor,isFunction=getClass.call(object)==functionClass;for(property in object)isFunction&&"prototype"==property||!isProperty.call(object,property)||(isConstructor="constructor"===property)||callback(property);(isConstructor||isProperty.call(object,property="constructor"))&&callback(property)}:(members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],forEach=function(object,callback){var property,length,isFunction=getClass.call(object)==functionClass,hasProperty=!isFunction&&"function"!=typeof object.constructor&&isHostType(object,"hasOwnProperty")?object.hasOwnProperty:isProperty;for(property in object)isFunction&&"prototype"==property||!hasProperty.call(object,property)||callback(property);for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}),forEach(object,callback)},!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},leadingZeroes="000000",toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)},unicodePrefix="\\u00",quote=function(value){var symbols,result='"',index=0,length=value.length,isLarge=length>10&&charIndexBuggy;for(isLarge&&(symbols=value.split(""));length>index;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(32>charCode){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=isLarge?symbols[index]:charIndexBuggy?value.charAt(index):value[index]}}return result+'"'},serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if("object"==typeof value&&value)if(className=getClass.call(value),className!=dateClass||isProperty.call(value,"toJSON"))"function"==typeof value.toJSON&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,"toJSON"))&&(value=value.toJSON(property));else if(value>-1/0&&1/0>value){if(getDay){for(date=floor(value/864e5),year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month),time=(value%864e5+864e5)%864e5,hours=floor(time/36e5)%24,minutes=floor(time/6e4)%60,seconds=floor(time/1e3)%60,milliseconds=time%1e3}else year=value.getUTCFullYear(),month=value.getUTCMonth(),date=value.getUTCDate(),hours=value.getUTCHours(),minutes=value.getUTCMinutes(),seconds=value.getUTCSeconds(),milliseconds=value.getUTCMilliseconds();value=(0>=year||year>=1e4?(0>year?"-":"+")+toPaddedString(6,0>year?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else value=null;if(callback&&(value=callback.call(object,property,value)),null===value)return"null";if(className=getClass.call(value),className==booleanClass)return""+value;if(className==numberClass)return value>-1/0&&1/0>value?""+value:"null";if(className==stringClass)return quote(""+value);if("object"==typeof value){for(length=stack.length;length--;)if(stack[length]===value)throw TypeError();if(stack.push(value),results=[],prefix=indentation,indentation+=whitespace,className==arrayClass){for(index=0,length=value.length;length>index;index++)element=serialize(index,value,callback,properties,whitespace,indentation,stack),results.push(element===undef?"null":element);result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);element!==undef&&results.push(quote(property)+":"+(whitespace?" ":"")+element)}),result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}";return stack.pop(),result}};JSON3.stringify=function(source,filter,width){var whitespace,callback,properties,className;if("function"==typeof filter||"object"==typeof filter&&filter)if((className=getClass.call(filter))==functionClass)callback=filter;else if(className==arrayClass){properties={};for(var value,index=0,length=filter.length;length>index;value=filter[index++],className=getClass.call(value),(className==stringClass||className==numberClass)&&(properties[value]=1));}if(width)if((className=getClass.call(width))==numberClass){if((width-=width%1)>0)for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}else className==stringClass&&(whitespace=width.length<=10?width:width.slice(0,10));return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var Index,Source,fromCharCode=String.fromCharCode,Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},abort=function(){throw Index=Source=null,SyntaxError()},lex=function(){for(var value,begin,position,isSigned,charCode,source=Source,length=source.length;length>Index;)switch(charCode=source.charCodeAt(Index)){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:return value=charIndexBuggy?source.charAt(Index):source[Index],Index++,value;case 34:for(value="@",Index++;length>Index;)if(charCode=source.charCodeAt(Index),32>charCode)abort();else if(92==charCode)switch(charCode=source.charCodeAt(++Index)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode],Index++;break;case 117:for(begin=++Index,position=Index+4;position>Index;Index++)charCode=source.charCodeAt(Index),charCode>=48&&57>=charCode||charCode>=97&&102>=charCode||charCode>=65&&70>=charCode||abort();value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}else{if(34==charCode)break;for(charCode=source.charCodeAt(Index),begin=Index;charCode>=32&&92!=charCode&&34!=charCode;)charCode=source.charCodeAt(++Index);value+=source.slice(begin,Index)}if(34==source.charCodeAt(Index))return Index++,value;abort();default:if(begin=Index,45==charCode&&(isSigned=!0,charCode=source.charCodeAt(++Index)),charCode>=48&&57>=charCode){for(48==charCode&&(charCode=source.charCodeAt(Index+1),charCode>=48&&57>=charCode)&&abort(),isSigned=!1;length>Index&&(charCode=source.charCodeAt(Index),charCode>=48&&57>=charCode);Index++);if(46==source.charCodeAt(Index)){for(position=++Index;length>position&&(charCode=source.charCodeAt(position),charCode>=48&&57>=charCode);position++);position==Index&&abort(),Index=position}if(charCode=source.charCodeAt(Index),101==charCode||69==charCode){for(charCode=source.charCodeAt(++Index),(43==charCode||45==charCode)&&Index++,position=Index;length>position&&(charCode=source.charCodeAt(position),charCode>=48&&57>=charCode);position++);position==Index&&abort(),Index=position}return+source.slice(begin,Index)}if(isSigned&&abort(),"true"==source.slice(Index,Index+4))return Index+=4,!0;if("false"==source.slice(Index,Index+5))return Index+=5,!1;if("null"==source.slice(Index,Index+4))return Index+=4,null;abort()}return"$"},get=function(value){var results,hasMembers;if("$"==value&&abort(),"string"==typeof value){if("@"==(charIndexBuggy?value.charAt(0):value[0]))return value.slice(1);if("["==value){for(results=[];value=lex(),"]"!=value;hasMembers||(hasMembers=!0))hasMembers&&(","==value?(value=lex(),"]"==value&&abort()):abort()),","==value&&abort(),results.push(get(value));return results}if("{"==value){for(results={};value=lex(),"}"!=value;hasMembers||(hasMembers=!0))hasMembers&&(","==value?(value=lex(),"}"==value&&abort()):abort()),(","==value||"string"!=typeof value||"@"!=(charIndexBuggy?value.charAt(0):value[0])||":"!=lex())&&abort(),results[value.slice(1)]=get(lex());return results}abort()}return value},update=function(source,property,callback){var element=walk(source,property,callback);element===undef?delete source[property]:source[property]=element},walk=function(source,property,callback){var length,value=source[property];if("object"==typeof value&&value)if(getClass.call(value)==arrayClass)for(length=value.length;length--;)update(value,length,callback);else forEach(value,function(property){update(value,property,callback)});return callback.call(source,property,value)};JSON3.parse=function(source,callback){var result,value;return Index=0,Source=""+source,result=get(lex()),"$"!=lex()&&abort(),Index=Source=null,callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}isLoader&&define(function(){return JSON3})}(this)},{}],41:[function(_dereq_,module){function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++)array[i-index]=list[i];return array}module.exports=toArray},{}],42:[function(_dereq_,module,exports){function Buffer(subject,encoding,noZero){if(!(this instanceof Buffer))return new Buffer(subject,encoding,noZero);var type=typeof subject;"base64"===encoding&&"string"===type&&(subject=base64clean(subject));var length;if("number"===type)length=coerce(subject);else if("string"===type)length=Buffer.byteLength(subject,encoding);else{if("object"!==type)throw new Error("First argument needs to be a number, array or string.");length=coerce(subject.length)}var buf;Buffer._useTypedArrays?buf=Buffer._augment(new Uint8Array(length)):(buf=this,buf.length=length,buf._isBuffer=!0);var i;if(Buffer._useTypedArrays&&"number"==typeof subject.byteLength)buf._set(subject);else if(isArrayish(subject))if(Buffer.isBuffer(subject))for(i=0;length>i;i++)buf[i]=subject.readUInt8(i);else for(i=0;length>i;i++)buf[i]=(subject[i]%256+256)%256;else if("string"===type)buf.write(subject,0,encoding);else if("number"===type&&!Buffer._useTypedArrays&&!noZero)for(i=0;length>i;i++)buf[i]=0;return buf}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining;var strLen=string.length;assert(strLen%2===0,"Invalid hex string"),length>strLen/2&&(length=strLen/2);for(var i=0;length>i;i++){var byte=parseInt(string.substr(2*i,2),16);assert(!isNaN(byte),"Invalid hex string"),buf[offset+i]=byte}return i}function utf8Write(buf,string,offset,length){var charsWritten=blitBuffer(utf8ToBytes(string),buf,offset,length);return charsWritten}function asciiWrite(buf,string,offset,length){var charsWritten=blitBuffer(asciiToBytes(string),buf,offset,length);return charsWritten}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){var charsWritten=blitBuffer(base64ToBytes(string),buf,offset,length);return charsWritten}function utf16leWrite(buf,string,offset,length){var charsWritten=blitBuffer(utf16leToBytes(string),buf,offset,length);return charsWritten}function base64Slice(buf,start,end){return base64.fromByteArray(0===start&&end===buf.length?buf:buf.slice(start,end))}function utf8Slice(buf,start,end){var res="",tmp="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)buf[i]<=127?(res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]),tmp=""):tmp+="%"+buf[i].toString(16);return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;end>i;i++)ret+=String.fromCharCode(buf[i]);return ret}function binarySlice(buf,start,end){return asciiSlice(buf,start,end)}function hexSlice(buf,start,end){var len=buf.length;(!start||0>start)&&(start=0),(!end||0>end||end>len)&&(end=len);for(var out="",i=start;end>i;i++)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function readUInt16(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val;return littleEndian?(val=buf[offset],len>offset+1&&(val|=buf[offset+1]<<8)):(val=buf[offset]<<8,len>offset+1&&(val|=buf[offset+1])),val}}function readUInt32(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val;return littleEndian?(len>offset+2&&(val=buf[offset+2]<<16),len>offset+1&&(val|=buf[offset+1]<<8),val|=buf[offset],len>offset+3&&(val+=buf[offset+3]<<24>>>0)):(len>offset+1&&(val=buf[offset+1]<<16),len>offset+2&&(val|=buf[offset+2]<<8),len>offset+3&&(val|=buf[offset+3]),val+=buf[offset]<<24>>>0),val}}function readInt16(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val=readUInt16(buf,offset,littleEndian,!0),neg=32768&val;return neg?-1*(65535-val+1):val}}function readInt32(buf,offset,littleEndian,noAssert){noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to read beyond buffer length"));var len=buf.length;if(!(offset>=len)){var val=readUInt32(buf,offset,littleEndian,!0),neg=2147483648&val;return neg?-1*(4294967295-val+1):val}}function readFloat(buf,offset,littleEndian,noAssert){return noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(offset+3<buf.length,"Trying to read beyond buffer length")),ieee754.read(buf,offset,littleEndian,23,4)}function readDouble(buf,offset,littleEndian,noAssert){return noAssert||(assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(offset+7<buf.length,"Trying to read beyond buffer length")),ieee754.read(buf,offset,littleEndian,52,8)}function writeUInt16(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"trying to write beyond buffer length"),verifuint(value,65535));var len=buf.length;if(!(offset>=len)){for(var i=0,j=Math.min(len-offset,2);j>i;i++)buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i);return offset+2}}function writeUInt32(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"trying to write beyond buffer length"),verifuint(value,4294967295));var len=buf.length;if(!(offset>=len)){for(var i=0,j=Math.min(len-offset,4);j>i;i++)buf[offset+i]=value>>>8*(littleEndian?i:3-i)&255;return offset+4}}function writeInt16(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+1<buf.length,"Trying to write beyond buffer length"),verifsint(value,32767,-32768));var len=buf.length;if(!(offset>=len))return value>=0?writeUInt16(buf,value,offset,littleEndian,noAssert):writeUInt16(buf,65535+value+1,offset,littleEndian,noAssert),offset+2}function writeInt32(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to write beyond buffer length"),verifsint(value,2147483647,-2147483648));var len=buf.length;if(!(offset>=len))return value>=0?writeUInt32(buf,value,offset,littleEndian,noAssert):writeUInt32(buf,4294967295+value+1,offset,littleEndian,noAssert),offset+4}function writeFloat(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+3<buf.length,"Trying to write beyond buffer length"),verifIEEE754(value,3.4028234663852886e38,-3.4028234663852886e38));var len=buf.length;if(!(offset>=len))return ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert("boolean"==typeof littleEndian,"missing or invalid endian"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset+7<buf.length,"Trying to write beyond buffer length"),verifIEEE754(value,1.7976931348623157e308,-1.7976931348623157e308));var len=buf.length;if(!(offset>=len))return ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}function base64clean(str){for(str=stringtrim(str).replace(INVALID_BASE64_RE,"");str.length%4!==0;)str+="=";return str}function stringtrim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function clamp(index,len,defaultValue){return"number"!=typeof index?defaultValue:(index=~~index,index>=len?len:index>=0?index:(index+=len,index>=0?index:0))}function coerce(length){return length=~~Math.ceil(+length),0>length?0:length}function isArray(subject){return(Array.isArray||function(subject){return"[object Array]"===Object.prototype.toString.call(subject)})(subject)}function isArrayish(subject){return isArray(subject)||Buffer.isBuffer(subject)||subject&&"object"==typeof subject&&"number"==typeof subject.length}function toHex(n){return 16>n?"0"+n.toString(16):n.toString(16)}function utf8ToBytes(str){for(var byteArray=[],i=0;i<str.length;i++){var b=str.charCodeAt(i);if(127>=b)byteArray.push(b);else{var start=i;b>=55296&&57343>=b&&i++;for(var h=encodeURIComponent(str.slice(start,i+1)).substr(1).split("%"),j=0;j<h.length;j++)byteArray.push(parseInt(h[j],16))}}return byteArray}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;i++)byteArray.push(255&str.charCodeAt(i));return byteArray}function utf16leToBytes(str){for(var c,hi,lo,byteArray=[],i=0;i<str.length;i++)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}function base64ToBytes(str){return base64.toByteArray(str)}function blitBuffer(src,dst,offset,length){for(var i=0;length>i&&!(i+offset>=dst.length||i>=src.length);i++)dst[i+offset]=src[i];return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}function verifuint(value,max){assert("number"==typeof value,"cannot write a non-number as a number"),assert(value>=0,"specified a negative value for writing an unsigned value"),assert(max>=value,"value is larger than maximum value for type"),assert(Math.floor(value)===value,"value has a fractional component")}function verifsint(value,max,min){assert("number"==typeof value,"cannot write a non-number as a number"),assert(max>=value,"value larger than maximum allowed value"),assert(value>=min,"value smaller than minimum allowed value"),assert(Math.floor(value)===value,"value has a fractional component")}function verifIEEE754(value,max,min){assert("number"==typeof value,"cannot write a non-number as a number"),assert(max>=value,"value larger than maximum allowed value"),assert(value>=min,"value smaller than minimum allowed value")}function assert(test,message){if(!test)throw new Error(message||"Failed assertion")}var base64=_dereq_("base64-js"),ieee754=_dereq_("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=Buffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192,Buffer._useTypedArrays=function(){try{var buf=new ArrayBuffer(0),arr=new Uint8Array(buf);return arr.foo=function(){return 42},42===arr.foo()&&"function"==typeof arr.subarray}catch(e){return!1}}(),Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.isBuffer=function(b){return!(null===b||void 0===b||!b._isBuffer)},Buffer.byteLength=function(str,encoding){var ret;switch(str=str.toString(),encoding||"utf8"){case"hex":ret=str.length/2;break;case"utf8":case"utf-8":ret=utf8ToBytes(str).length;break;case"ascii":case"binary":case"raw":ret=str.length;break;case"base64":ret=base64ToBytes(str).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=2*str.length;break;default:throw new Error("Unknown encoding")}return ret},Buffer.concat=function(list,totalLength){if(assert(isArray(list),"Usage: Buffer.concat(list[, length])"),0===list.length)return new Buffer(0);if(1===list.length)return list[0];var i;if(void 0===totalLength)for(totalLength=0,i=0;i<list.length;i++)totalLength+=list[i].length;var buf=new Buffer(totalLength),pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos),pos+=item.length}return buf},Buffer.compare=function(a,b){assert(Buffer.isBuffer(a)&&Buffer.isBuffer(b),"Arguments must be Buffers");for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);len>i&&a[i]===b[i];i++);return i!==len&&(x=a[i],y=b[i]),y>x?-1:x>y?1:0},Buffer.prototype.write=function(string,offset,length,encoding){if(isFinite(offset))isFinite(length)||(encoding=length,length=void 0);else{var swap=encoding;encoding=offset,offset=length,length=swap}offset=Number(offset)||0;var remaining=this.length-offset;length?(length=Number(length),length>remaining&&(length=remaining)):length=remaining,encoding=String(encoding||"utf8").toLowerCase();
var ret;switch(encoding){case"hex":ret=hexWrite(this,string,offset,length);break;case"utf8":case"utf-8":ret=utf8Write(this,string,offset,length);break;case"ascii":ret=asciiWrite(this,string,offset,length);break;case"binary":ret=binaryWrite(this,string,offset,length);break;case"base64":ret=base64Write(this,string,offset,length);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leWrite(this,string,offset,length);break;default:throw new Error("Unknown encoding")}return ret},Buffer.prototype.toString=function(encoding,start,end){var self=this;if(encoding=String(encoding||"utf8").toLowerCase(),start=Number(start)||0,end=void 0===end?self.length:Number(end),end===start)return"";var ret;switch(encoding){case"hex":ret=hexSlice(self,start,end);break;case"utf8":case"utf-8":ret=utf8Slice(self,start,end);break;case"ascii":ret=asciiSlice(self,start,end);break;case"binary":ret=binarySlice(self,start,end);break;case"base64":ret=base64Slice(self,start,end);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":ret=utf16leSlice(self,start,end);break;default:throw new Error("Unknown encoding")}return ret},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.equals=function(b){return assert(Buffer.isBuffer(b),"Argument must be a Buffer"),0===Buffer.compare(this,b)},Buffer.prototype.compare=function(b){return assert(Buffer.isBuffer(b),"Argument must be a Buffer"),Buffer.compare(this,b)},Buffer.prototype.copy=function(target,target_start,start,end){var source=this;if(start||(start=0),end||0===end||(end=this.length),target_start||(target_start=0),end!==start&&0!==target.length&&0!==source.length){assert(end>=start,"sourceEnd < sourceStart"),assert(target_start>=0&&target_start<target.length,"targetStart out of bounds"),assert(start>=0&&start<source.length,"sourceStart out of bounds"),assert(end>=0&&end<=source.length,"sourceEnd out of bounds"),end>this.length&&(end=this.length),target.length-target_start<end-start&&(end=target.length-target_start+start);var len=end-start;if(100>len||!Buffer._useTypedArrays)for(var i=0;len>i;i++)target[i+target_start]=this[i+start];else target._set(this.subarray(start,start+len),target_start)}},Buffer.prototype.slice=function(start,end){var len=this.length;if(start=clamp(start,len,0),end=clamp(end,len,len),Buffer._useTypedArrays)return Buffer._augment(this.subarray(start,end));for(var sliceLen=end-start,newBuf=new Buffer(sliceLen,void 0,!0),i=0;sliceLen>i;i++)newBuf[i]=this[i+start];return newBuf},Buffer.prototype.get=function(offset){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(offset)},Buffer.prototype.set=function(v,offset){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(v,offset)},Buffer.prototype.readUInt8=function(offset,noAssert){return noAssert||(assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to read beyond buffer length")),offset>=this.length?void 0:this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return readUInt16(this,offset,!0,noAssert)},Buffer.prototype.readUInt16BE=function(offset,noAssert){return readUInt16(this,offset,!1,noAssert)},Buffer.prototype.readUInt32LE=function(offset,noAssert){return readUInt32(this,offset,!0,noAssert)},Buffer.prototype.readUInt32BE=function(offset,noAssert){return readUInt32(this,offset,!1,noAssert)},Buffer.prototype.readInt8=function(offset,noAssert){if(noAssert||(assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to read beyond buffer length")),!(offset>=this.length)){var neg=128&this[offset];return neg?-1*(255-this[offset]+1):this[offset]}},Buffer.prototype.readInt16LE=function(offset,noAssert){return readInt16(this,offset,!0,noAssert)},Buffer.prototype.readInt16BE=function(offset,noAssert){return readInt16(this,offset,!1,noAssert)},Buffer.prototype.readInt32LE=function(offset,noAssert){return readInt32(this,offset,!0,noAssert)},Buffer.prototype.readInt32BE=function(offset,noAssert){return readInt32(this,offset,!1,noAssert)},Buffer.prototype.readFloatLE=function(offset,noAssert){return readFloat(this,offset,!0,noAssert)},Buffer.prototype.readFloatBE=function(offset,noAssert){return readFloat(this,offset,!1,noAssert)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return readDouble(this,offset,!0,noAssert)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return readDouble(this,offset,!1,noAssert)},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"trying to write beyond buffer length"),verifuint(value,255)),offset>=this.length?void 0:(this[offset]=value,offset+1)},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return writeUInt16(this,value,offset,!0,noAssert)},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return writeUInt16(this,value,offset,!1,noAssert)},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return writeUInt32(this,value,offset,!0,noAssert)},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return writeUInt32(this,value,offset,!1,noAssert)},Buffer.prototype.writeInt8=function(value,offset,noAssert){return noAssert||(assert(void 0!==value&&null!==value,"missing value"),assert(void 0!==offset&&null!==offset,"missing offset"),assert(offset<this.length,"Trying to write beyond buffer length"),verifsint(value,127,-128)),offset>=this.length?void 0:(value>=0?this.writeUInt8(value,offset,noAssert):this.writeUInt8(255+value+1,offset,noAssert),offset+1)},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return writeInt16(this,value,offset,!0,noAssert)},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return writeInt16(this,value,offset,!1,noAssert)},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return writeInt32(this,value,offset,!0,noAssert)},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return writeInt32(this,value,offset,!1,noAssert)},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.fill=function(value,start,end){if(value||(value=0),start||(start=0),end||(end=this.length),assert(end>=start,"end < start"),end!==start&&0!==this.length){assert(start>=0&&start<this.length,"start out of bounds"),assert(end>=0&&end<=this.length,"end out of bounds");var i;if("number"==typeof value)for(i=start;end>i;i++)this[i]=value;else{var bytes=utf8ToBytes(value.toString()),len=bytes.length;for(i=start;end>i;i++)this[i]=bytes[i%len]}return this}},Buffer.prototype.inspect=function(){for(var out=[],len=this.length,i=0;len>i;i++)if(out[i]=toHex(this[i]),i===exports.INSPECT_MAX_BYTES){out[i+1]="...";break}return"<Buffer "+out.join(" ")+">"},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer._useTypedArrays)return new Buffer(this).buffer;for(var buf=new Uint8Array(this.length),i=0,len=buf.length;len>i;i+=1)buf[i]=this[i];return buf.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(arr){return arr._isBuffer=!0,arr._get=arr.get,arr._set=arr.set,arr.get=BP.get,arr.set=BP.set,arr.write=BP.write,arr.toString=BP.toString,arr.toLocaleString=BP.toString,arr.toJSON=BP.toJSON,arr.equals=BP.equals,arr.compare=BP.compare,arr.copy=BP.copy,arr.slice=BP.slice,arr.readUInt8=BP.readUInt8,arr.readUInt16LE=BP.readUInt16LE,arr.readUInt16BE=BP.readUInt16BE,arr.readUInt32LE=BP.readUInt32LE,arr.readUInt32BE=BP.readUInt32BE,arr.readInt8=BP.readInt8,arr.readInt16LE=BP.readInt16LE,arr.readInt16BE=BP.readInt16BE,arr.readInt32LE=BP.readInt32LE,arr.readInt32BE=BP.readInt32BE,arr.readFloatLE=BP.readFloatLE,arr.readFloatBE=BP.readFloatBE,arr.readDoubleLE=BP.readDoubleLE,arr.readDoubleBE=BP.readDoubleBE,arr.writeUInt8=BP.writeUInt8,arr.writeUInt16LE=BP.writeUInt16LE,arr.writeUInt16BE=BP.writeUInt16BE,arr.writeUInt32LE=BP.writeUInt32LE,arr.writeUInt32BE=BP.writeUInt32BE,arr.writeInt8=BP.writeInt8,arr.writeInt16LE=BP.writeInt16LE,arr.writeInt16BE=BP.writeInt16BE,arr.writeInt32LE=BP.writeInt32LE,arr.writeInt32BE=BP.writeInt32BE,arr.writeFloatLE=BP.writeFloatLE,arr.writeFloatBE=BP.writeFloatBE,arr.writeDoubleLE=BP.writeDoubleLE,arr.writeDoubleBE=BP.writeDoubleBE,arr.fill=BP.fill,arr.inspect=BP.inspect,arr.toArrayBuffer=BP.toArrayBuffer,arr};var INVALID_BASE64_RE=/[^+\/0-9A-z]/g},{"base64-js":43,ieee754:44}],43:[function(_dereq_,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(exports){function decode(elt){var code=elt.charCodeAt(0);return code===PLUS?62:code===SLASH?63:NUMBER>code?-1:NUMBER+10>code?code-NUMBER+26+26:UPPER+26>code?code-UPPER:LOWER+26>code?code-LOWER+26:void 0}function b64ToByteArray(b64){function push(v){arr[L++]=v}var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0,arr=new Arr(3*b64.length/4-placeHolders),l=placeHolders>0?b64.length-4:b64.length;var L=0;for(i=0,j=0;l>i;i+=4,j+=3)tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3)),push((16711680&tmp)>>16),push((65280&tmp)>>8),push(255&tmp);return 2===placeHolders?(tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4,push(255&tmp)):1===placeHolders&&(tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2,push(tmp>>8&255),push(255&tmp)),arr}function uint8ToBase64(uint8){function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(63&num)}var i,temp,length,extraBytes=uint8.length%3,output="";for(i=0,length=uint8.length-extraBytes;length>i;i+=3)temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2],output+=tripletToBase64(temp);switch(extraBytes){case 1:temp=uint8[uint8.length-1],output+=encode(temp>>2),output+=encode(temp<<4&63),output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1],output+=encode(temp>>10),output+=encode(temp>>4&63),output+=encode(temp<<2&63),output+="="}return output}var Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,PLUS="+".charCodeAt(0),SLASH="/".charCodeAt(0),NUMBER="0".charCodeAt(0),LOWER="a".charCodeAt(0),UPPER="A".charCodeAt(0);exports.toByteArray=b64ToByteArray,exports.fromByteArray=uint8ToBase64}("undefined"==typeof exports?this.base64js={}:exports)},{}],44:[function(_dereq_,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?0/0:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;for(value=Math.abs(value),isNaN(value)||1/0===value?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias),value*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}]},{},[1])(1)}),function(win){function isLocalStorageNameSupported(){try{return localStorageName in win&&win[localStorageName]}catch(err){return!1}}function withIEStorage(storeFunction){return function(){var args=Array.prototype.slice.call(arguments,0);args.unshift(storage),storageOwner.appendChild(storage),storage.addBehavior("#default#userData"),storage.load(localStorageName);var result=storeFunction.apply(store,args);return storageOwner.removeChild(storage),result}}function ieKeyFix(key){return key.replace(/^d/,"___$&").replace(forbiddenCharsRegex,"___")}var storage,store={},doc=win.document,localStorageName="localStorage",scriptTag="script";if(store.disabled=!1,store.set=function(){},store.get=function(){},store.remove=function(){},store.clear=function(){},store.transact=function(key,defaultVal,transactionFn){var val=store.get(key);null==transactionFn&&(transactionFn=defaultVal,defaultVal=null),"undefined"==typeof val&&(val=defaultVal||{}),transactionFn(val),store.set(key,val)},store.getAll=function(){},store.forEach=function(){},store.serialize=function(value){return JSON.stringify(value)},store.deserialize=function(value){if("string"!=typeof value)return void 0;try{return JSON.parse(value)}catch(e){return value||void 0}},isLocalStorageNameSupported())storage=win[localStorageName],store.set=function(key,val){return void 0===val?store.remove(key):(storage.setItem(key,store.serialize(val)),val)},store.get=function(key){return store.deserialize(storage.getItem(key))},store.remove=function(key){storage.removeItem(key)},store.clear=function(){storage.clear()},store.getAll=function(){var ret={};return store.forEach(function(key,val){ret[key]=val}),ret},store.forEach=function(callback){for(var i=0;i<storage.length;i++){var key=storage.key(i);callback(key,store.get(key))}};else if(doc.documentElement.addBehavior){var storageOwner,storageContainer;try{storageContainer=new ActiveXObject("htmlfile"),storageContainer.open(),storageContainer.write("<"+scriptTag+">document.w=window</"+scriptTag+'><iframe src="/favicon.ico"></iframe>'),storageContainer.close(),storageOwner=storageContainer.w.frames[0].document,storage=storageOwner.createElement("div")}catch(e){storage=doc.createElement("div"),storageOwner=doc.body}var forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");store.set=withIEStorage(function(storage,key,val){return key=ieKeyFix(key),void 0===val?store.remove(key):(storage.setAttribute(key,store.serialize(val)),storage.save(localStorageName),val)}),store.get=withIEStorage(function(storage,key){return key=ieKeyFix(key),store.deserialize(storage.getAttribute(key))}),store.remove=withIEStorage(function(storage,key){key=ieKeyFix(key),storage.removeAttribute(key),storage.save(localStorageName)}),store.clear=withIEStorage(function(storage){var attributes=storage.XMLDocument.documentElement.attributes;storage.load(localStorageName);for(var attr,i=0;attr=attributes[i];i++)storage.removeAttribute(attr.name);storage.save(localStorageName)}),store.getAll=function(){var ret={};return store.forEach(function(key,val){ret[key]=val}),ret},store.forEach=withIEStorage(function(storage,callback){for(var attr,attributes=storage.XMLDocument.documentElement.attributes,i=0;attr=attributes[i];++i)callback(attr.name,store.deserialize(storage.getAttribute(attr.name)))})}try{var testKey="__storejs__";store.set(testKey,testKey),store.get(testKey)!=testKey&&(store.disabled=!0),store.remove(testKey)}catch(e){store.disabled=!0}store.enabled=!store.disabled,"undefined"!=typeof module&&module.exports&&this.module!==module?module.exports=store:"function"==typeof define&&define.amd?define("store",store):win.store=store}(Function("return this")()),define("timedQueue",["store"],function(Store){function TimedQueue(name,callback,options){this.q=name,this.callback=callback,this.options=options||{},this.limit=this.options.limit||2,this.vals=Store.get(this.q),this.vals=this.vals||[],this.nextComsue=(new Date).getTime(),this.tick()}return TimedQueue.prototype.push=function(data){this.vals.push(data),Store.set(this.q,this.vals),this.tick()},TimedQueue.prototype.comsume=function(){var next=this.vals.shift();this.nextComsue=(new Date).getTime()+1e3*this.limit,Store.set(this.q,this.vals),this.callback(next)},TimedQueue.prototype.tick=function(){var that=this,curTime=(new Date).getTime();this.vals.length>0&&(curTime>this.nextComsue&&this.comsume(),this.nexTick&&clearTimeout(this.nexTick),this.nexTick=setTimeout(function(){that.tick()},this.nextComsue-curTime))},TimedQueue}),define("prettyJson",["backbone","underscore"],function(Backbone,_){var PrettyJSON={view:{},tpl:{}};return PrettyJSON.util={isObject:function(v){return"[object Object]"===Object.prototype.toString.call(v)},pad:function(str,length){for(str=String(str);str.length<length;)str="0"+str;return str},dateFormat:function(date,f){return f=f.replace("YYYY",date.getFullYear()),f=f.replace("YY",String(date.getFullYear()).slice(-2)),f=f.replace("MM",PrettyJSON.util.pad(date.getMonth()+1,2)),f=f.replace("DD",PrettyJSON.util.pad(date.getDate(),2)),f=f.replace("HH24",PrettyJSON.util.pad(date.getHours(),2)),f=f.replace("HH",PrettyJSON.util.pad(date.getHours()%12,2)),f=f.replace("MI",PrettyJSON.util.pad(date.getMinutes(),2)),f=f.replace("SS",PrettyJSON.util.pad(date.getSeconds(),2))}},PrettyJSON.tpl.Node='<span class="node-container"><span class="node-top node-bracket" /><span class="node-content-wrapper"><ul class="node-body" /></span><span class="node-down node-bracket" /></span>',PrettyJSON.tpl.Leaf='<span class="leaf-container"><span class="<%= type %>"> <%=data%></span><span><%= coma %></span></span>',PrettyJSON.view.Node=Backbone.View.extend({tagName:"span",className:"pretty-json",data:null,level:1,path:"",type:"",size:0,isLast:!0,rendered:!1,events:{"click .node-bracket":"collapse","mouseover .node-container":"mouseover","mouseout .node-container":"mouseout"},initialize:function(opt){this.options=opt,this.data=this.options.data,this.level=this.options.level||this.level,this.path=this.options.path,this.isLast=_.isUndefined(this.options.isLast)?this.isLast:this.options.isLast,this.dateFormat=this.options.dateFormat;var m=this.getMeta();this.type=m.type,this.size=m.size,this.childs=[],this.render()},getMeta:function(){var val={size:_.size(this.data),type:_.isArray(this.data)?"array":"object"};return val},elements:function(){this.els={container:Backbone.$(this.el).find(".node-container"),contentWrapper:Backbone.$(this.el).find(".node-content-wrapper"),top:Backbone.$(this.el).find(".node-top"),ul:Backbone.$(this.el).find(".node-body"),down:Backbone.$(this.el).find(".node-down")}},render:function(){this.tpl=_.template(PrettyJSON.tpl.Node),Backbone.$(this.el).html(this.tpl),this.elements();var b=this.getBrackets();return this.els.top.html(b.top),this.els.down.html(b.bottom),this.hide(),this},renderChilds:function(){var count=1;_.each(this.data,function(val,key){var isLast=count==this.size;count+=1;var path="array"==this.type?this.path+"["+key+"]":this.path+"."+key,opt={key:key,data:val,parent:this,path:path,level:this.level+1,dateFormat:this.dateFormat,isLast:isLast},child=PrettyJSON.util.isObject(val)||_.isArray(val)?new PrettyJSON.view.Node(opt):new PrettyJSON.view.Leaf(opt);child.on("mouseover",function(e,path){this.trigger("mouseover",e,path)},this),child.on("mouseout",function(e){this.trigger("mouseout",e)},this);var li=Backbone.$("<li/>"),colom="&nbsp;:&nbsp;",left=Backbone.$("<span />"),right=Backbone.$("<span />").append(child.el);left.html("array"==this.type?"":key+colom),left.append(right),li.append(left),this.els.ul.append(li),child.parent=this,this.childs.push(child)},this)},isVisible:function(){return this.els.contentWrapper.is(":visible")},collapse:function(e){e.stopPropagation(),this.isVisible()?this.hide():this.show(),this.trigger("collapse",e)},show:function(){this.rendered||(this.renderChilds(),this.rendered=!0),this.els.top.html(this.getBrackets().top),this.els.contentWrapper.show(),this.els.down.show()},hide:function(){var b=this.getBrackets();this.els.top.html(b.close),this.els.contentWrapper.hide(),this.els.down.hide()},getBrackets:function(){var v={top:"{",bottom:"}",close:"{ ... }"};return"array"==this.type&&(v={top:"[",bottom:"]",close:"[ ... ]"}),v.bottom=this.isLast?v.bottom:v.bottom+",",v.close=this.isLast?v.close:v.close+",",v},mouseover:function(e){e.stopPropagation(),this.trigger("mouseover",e,this.path)},mouseout:function(e){e.stopPropagation(),this.trigger("mouseout",e)},expandAll:function(){_.each(this.childs,function(child){child instanceof PrettyJSON.view.Node&&(child.show(),child.expandAll())},this),this.show()},collapseAll:function(){_.each(this.childs,function(child){child instanceof PrettyJSON.view.Node&&(child.hide(),child.collapseAll())},this),1!=this.level&&this.hide()}}),PrettyJSON.view.Leaf=Backbone.View.extend({tagName:"span",data:null,level:0,path:"",type:"string",isLast:!0,events:{"mouseover .leaf-container":"mouseover","mouseout .leaf-container":"mouseout"},initialize:function(opt){this.options=opt,this.data=this.options.data,this.level=this.options.level,this.path=this.options.path,this.type=this.getType(),this.dateFormat=this.options.dateFormat,this.isLast=_.isUndefined(this.options.isLast)?this.isLast:this.options.isLast,this.render()},getType:function(){var m="string",d=this.data;return _.isNumber(d)?m="number":_.isBoolean(d)?m="boolean":_.isDate(d)&&(m="date"),m},getState:function(){var coma=this.isLast?"":",",state={data:this.data,level:this.level,path:this.path,type:this.type,coma:coma};return state},render:function(){var state=this.getState();return"date"==state.type&&this.dateFormat&&(state.data=PrettyJSON.util.dateFormat(this.data,this.dateFormat)),this.tpl=_.template(PrettyJSON.tpl.Leaf,state),Backbone.$(this.el).html(this.tpl),this},mouseover:function(e){e.stopPropagation();var path=this.path+'&nbsp;:&nbsp;<span class="'+this.type+'"><b>'+this.data+"</b></span>";this.trigger("mouseover",e,path)},mouseout:function(e){e.stopPropagation(),this.trigger("mouseout",e)}}),PrettyJSON}),define("channel",["backbone"],function(Backbone){var Channel=Backbone.Model.extend({publish:function(event){this.set(event,!0)},ensure:function(event,callback){var happened=this.get(event);if(happened)callback&&callback();else{var backbone_event="change:"+event;this.once(backbone_event,callback)}}}),channel=new Channel;return channel}),define("text!templates/mustache/onboard-tutorial.mustache",[],function(){return'<ol class="hide" data-joyride>\n  <li data-button="Take a tour">\n    <h3>Welcome to retain.cc{{#user}}, {{name}}{{/user}}</h3>\n    <p>You are only a few steps away from sending<br><strong>Better Targeted Messages</strong></p>\n    <p class="footer">\n      {{^demo_agent}}\n        <a id="skip-tour-link" class="skip-tour" href="#">Skip the tour?</a><br>\n        <span class="install"><a href="{{install_url}}">Install</a> to see your users here in 5 minutes</span>\n      {{/demo_agent}}\n    </p>\n  </li>\n  <li data-id="onboard-tutorial-step-1"><p class="instruction">Quickly learn who your users are and what they do.</p></li>\n  <li data-id="user-filter" data-options="tip_location: left"><p class="instruction">Filter users so you can send targeted messages.</p></li>\n  <li data-id="onboard-tutorial-step-3" data-options="tip_location: top"><p class="instruction">Send automated messages based on users\' profiles and behavioral events</p></li>\n  <li data-id="onboard-tutorial-step-4"><p class="instruction">Personalize your message, and send emails / in-app notifications / other types of messages</p></li>\n  {{#app_installed}}\n  <li class="app-installed" data-id="onboard-tutorial-step-5" data-button="Get Started!">\n  {{/app_installed}}\n  {{^app_installed}}\n  <li data-id="onboard-tutorial-step-5" data-button="You\'re all set. Install your users here in 5mins!">\n  {{/app_installed}}\n    <p class="instruction">Use data about customer response to send better automated messages in the future.</p>\n    <p class="footer"><a id="replay-tutorial-link" href="#">Replay tutorial</a> | <a href="http://help.retain.cc/">Learn how retain.cc helps you</a></p>\n  </li>\n</ol>\n'}),define("onboardTutorial",["underscore","jquery","mustache","channel","text!templates/mustache/onboard-tutorial.mustache","foundation.joyride","jquery.cookie"],function(_,$,Mustache,Channel,onboardTutorialTemplate){var OnboardTutorial=function(options){options=options||{},this.app_installed=options.app_installed,this.demo_agent=options.demo_agent,this.demo_app=options.demo_app,this.demo_complete_url=options.demo_complete_url,this.demo_step_prefix=options.demo_step_prefix,this.demo_url=options.demo_url,this.home_url=options.home_url,this.install_url=options.install_url,this.new_agent_url=options.new_agent_url,this.tutorial_url=options.tutorial_url,this.urls=options.urls;var currentStep=parseInt($.cookie(this.demo_step_prefix+"-onboard-tutorial-step"),10)||0;this.currentStep=this.demo_app?currentStep:0,this.content=Mustache.render(onboardTutorialTemplate,{app_installed:this.app_installed,demo_agent:this.demo_agent,install_url:this.install_url,user:options.user}),this.stepExposes=[null,"#users-table table tbody tr:first-child,#users-table table thead","#user-filter-container","#auto-message-form .event-match, #auto-message-form .filter-match","#am-preview .cit-head,#am-preview .cit-body,#am-preview .cit-footer",".table.auto-messages>tbody>tr:first-child,.table.auto-messages>thea"]};return _.extend(OnboardTutorial.prototype,{start:function(){if(-1===window.location.href.indexOf(this.install_url)){0!==this.currentStep&&this.current_url()&&-1===window.location.href.indexOf(this.current_url())&&window.location.replace(this.current_url());var $el=$(this.content);$(document.body).on("click","#skip-tour-link",this.end.bind(this)),$(document.body).on("click",'.cit.joyride-tip-guide[data-index="5"] .joyride-next-tip',this.end.bind(this)),$(document.body).on("click","#replay-tutorial-link",this.replay.bind(this)),$(document.body).append($el),2===this.currentStep?(this.hook_target_id(this.currentStep),_.delay(this.show.bind(this),500)):3===this.currentStep?Channel.ensure("AutoMessageFormInited",function(){_.delay(function(){this.hook_target_id(this.currentStep),this.show()}.bind(this),600)}.bind(this)):4===this.currentStep?Channel.ensure("AutoMessagePreviewInited",function(){this.hook_target_id(this.currentStep),this.show()}.bind(this)):(this.hook_target_id(this.currentStep),this.show())}},show:function(){var options={template:{link:"",timer:'<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>',tip:'<div class="joyride-tip-guide cit tutorial"><span class="joyride-nub"></span></div>',wrapper:'<div class="joyride-content-wrapper"></div>',button:'<a href="#" class="btn btn-primary btn-large joyride-next-tip"></a>',modal:"",expose:"",expose_cover:""},start_offset:this.currentStep,pause_after:[2,3,4,5],pre_step_callback:function(step){var exposes=this.get_expose(step);this.expose(exposes)}.bind(this),post_step_callback:function(){var currentStep=this.currentStep,nextStep=currentStep+1;if(this.setCurrentStep(nextStep),this.hook_target_id(nextStep),0!==currentStep||this.demo_app||this.demo_agent)if(nextStep<this.urls.length){var currentUrl=this.urls[currentStep],nextUrl=this.urls[nextStep];nextUrl!=currentUrl&&window.location.replace(nextUrl)}else this.unexpose();else window.location=this.agent_tutorial_url()}.bind(this)};this.demo_agent||this.demo_app||(options.pause_after=[0]),$(document).foundation("joyride","start",options)},end:function(){var do_end=function(){$(document).foundation("joyride","off"),this.unexpose()}.bind(this);this.setCurrentStep(this.currentStep+1),this.demo_agent?do_end():(this.setCurrentStep(0),$.post(this.demo_complete_url).always(function(){this.demo_app&&window.location.replace(this.home_url),do_end()}.bind(this)))},_stepCookieKey:function(){return this.demo_step_prefix+"-onboard-tutorial-step"},setCurrentStep:function(value){this.currentStep=value,$.cookie(this._stepCookieKey(),value,{path:"/"})},replay:function(){this.setCurrentStep(0),window.location.replace(this.agent_tutorial_url())},hook_target_id:function(step){var $el;switch(step){case 1:$el=$("#users-table table tbody tr:first-child"),$el.attr("id","onboard-tutorial-step-1");break;case 2:$("html,body").css("overflow","hidden"),$("#user-filter-container").css("transition","none"),$("#user-filter-container").addClass("active"),$("#users-listing-header>button.filter-edit").addClass("active");break;case 3:$el=$("#auto-message-form .event-match.active"),0===$el.length&&($el=$("#auto-message-form .filter-match.active")),$el.attr("id","onboard-tutorial-step-3");break;case 4:$el=$("#am-preview .cit-body"),$el.attr("id","onboard-tutorial-step-4");break;case 5:$el=$(".table.auto-messages>tbody>tr:first-child>td.message"),$el.attr("id","onboard-tutorial-step-5")}},expose:function($els){var modal=this.modal||(this.modal=this.create_modal()),docWidth=$(document).width(),docHeight=$(document).height();modal.attr("width",docWidth),modal.attr("height",docHeight);var canvas=modal[0];if(canvas.getContext){var ctx=canvas.getContext("2d");ctx.fillStyle="rgba(255,255,255,0.8)",ctx.fillRect(0,0,docWidth,docHeight),$.each($els,function(){var $el=$(this),top=$el.offset().top,left=$el.offset().left,width=$el.outerWidth(),height=$el.outerHeight();ctx.clearRect(left,top,width,height)})}var lazyexpose=_.debounce(function(){this.expose($els)}.bind(this),30);$(window).off("cit-onboard-tutorial").on("resize.cit-onboard-tutorial",lazyexpose).on("scroll.cit-onboard-tutorial",lazyexpose)},unexpose:function(){this.modal&&(this.modal.remove(),this.modal=void 0)},get_expose:function(step){var exposes;return step<this.stepExposes.length&&(exposes=$(this.stepExposes[step])),exposes=exposes||$()},create_modal:function(){var modal=$('<canvas id="onboard-tutorial-modal" />');return modal.css({position:"absolute",top:0,left:0,"z-index":1001}),$(document.body).append(modal),modal},current_url:function(){return this.urls[this.currentStep]},agent_tutorial_url:function(){return this.demo_agent?this.demo_url:this.tutorial_url}}),OnboardTutorial}),define("text!templates/mustache/demo-logout-prompt.mustache",[],function(){return'<ol class="hide" data-joyride>\n  <li class="demo-logout-prompt" data-button="Logout and proceed">\n    <h3>Proceeding to demo...</h3>\n    <p>You will be logged out for using the demo project.</p>\n  </li>\n</ol>\n'}),define("demoLogoutPrompt",["underscore","jquery","text!templates/mustache/demo-logout-prompt.mustache","foundation.joyride"],function(_,$,demoLogoutPromptTemplate){var DemoLogoutPrompt=function(options){options=options||{},this.demo_url_override=options.demo_url_override};return _.extend(DemoLogoutPrompt.prototype,{prompt:function(){var $el=$(demoLogoutPromptTemplate);$(document.body).append($el),$(document.body).on("click",".demo-logout-prompt .joyride-next-tip",function(){window.location=this.demo_url_override}.bind(this)),$(document).foundation("joyride","start",{template:{link:'<a href="#close" class="btn btn-large joyride-close-tip">No, thanks</a>',timer:'<div class="joyride-timer-indicator-wrap"><span class="joyride-timer-indicator"></span></div>',tip:'<div class="joyride-tip-guide cit demo-logout-prompt"><span class="joyride-nub"></span></div>',wrapper:'<div class="joyride-content-wrapper"></div>',button:'<a href="#" class="btn btn-primary btn-large joyride-next-tip"></a>',modal:'<div class="joyride-modal-bg cit"></div>',expose:'<div class="joyride-expose-wrapper"></div>',expose_cover:'<div class="joyride-expose-cover"></div>'}})}}),DemoLogoutPrompt}),define("filter",["underscore","backbone","moment","appConfig"],function(_,Backbone,moment,appConfig){var Filter=function(attributes,options){Backbone.Model.call(this,attributes,options)
};return Filter.typeMap=appConfig.typeMap,Filter.parse=function(value,key){return _.map(value,function(operand,operator){return this.doParse(key,operator,operand)},this)},Filter.doParse=function(key,operator,operand){switch(operator){case"exists":operator="exists-"+operand.toString();break;case"equal":operand===!0?operator="boolean-true":operand===!1&&(operator="boolean-false")}return{field:key,operator:operator,operand:operand}},Filter.getType=function(field){var type;return this.typeMap[field]?type=this.typeMap[field].data_type:(console.log("Rules on archived attributes, will removed on save."),type="string"),type},_.bindAll(Filter,"parse","doParse","getType"),_.extend(Filter.prototype,Backbone.Model.prototype,{defaults:{field:"email",operator:"equal",operand:null,enabled:!0},initialize:function(attributes){this.setOperand(attributes.operand)},getFieldGroup:function(){var match=this._eventMatch();return match?"custom_data._event_"+match[1]:this.get("field")},getEventSuffix:function(){var match=this._eventMatch();return match?match[2]:""},setEventSuffix:function(suffix){var realEvent=this.getFieldGroup()+suffix;return this.set("field",realEvent),realEvent},_eventMatch:function(){return r=new RegExp("^custom_data._event_(.+)((?:_first_ocurred_at|_count|_last_ocurred_at))$"),matched=r.exec(this.get("field"))},_matchEventGroup:function(field){var r=new RegExp("^custom_data._event_(?:.+)$");return matched=r.exec(field)},isEvent:function(){var matched=this._eventMatch();return matched?!0:!1},getDataType:function(){var eventSuffix,eventGroupMatch,type,typeMap=this.constructor.typeMap,field=this.get("field");if(typeMap[field])type=typeMap[field].data_type;else if(eventSuffix=this.getEventSuffix())switch(eventSuffix){case"_first_ocurred_at":case"_last_ocurred_at":type="date";break;case"_count":type="numeric";break;default:console.log("Unknown event suffix encountered, treat as string"),type="string"}else eventGroupMatch=this._matchEventGroup(field),eventGroupMatch?type="event":(console.log("Rules on archived attributes, will removed on save."),type="string");return type},setOperand:function(value){var isValid=!0;return field=this.get("field"),operator=this.get("operator"),rVal=value,type=this.getDataType(),"numeric"==type?(rVal=parseInt(value?value:0,10),""===value&&(isValid=!1)):"date"==type?"day_ago"==operator.substring(0,7)?(rVal=parseInt(value?value:0,10),""===value&&(isValid=!1)):("day_after"===operator||"day_on"===operator||"day_before"===operator)&&(moment(value).isValid()?rVal=value:isValid=!1):"string"==type?rVal=void 0===rVal?"":String(rVal):"user_type"==type&&(rVal=value),this.set("operand",rVal),this._isValid=isValid,isValid},isValid:function(){if(this.get("enabled")){switch(this.get("operator")){case"exists-true":case"exists-false":case"boolean-true":case"boolean-false":return!0}return void 0===this.get("operand")||""===this.get("operand")?!1:this._isValid}return!0}}),Filter}),define("query",["underscore","backbone","filter"],function(_,Backbone,Filter){var Query=function(models,options){Backbone.Collection.call(this,models,options)};return Query.createFromJson=function(filterList){var parsedList=_.map(filterList,Filter.parse);return _.flatten(parsedList)},Query.doSerialize=function(filter){var field=filter.get("field"),operator=filter.get("operator"),operand=filter.get("operand"),enabled=filter.get("enabled");if(enabled){switch(operator){case"exists-true":operator="exists",operand=!0;break;case"exists-false":operator="exists",operand=!1;break;case"boolean-true":operator="equal",operand=!0;break;case"boolean-false":operator="equal",operand=!1}this[field]=this[field]||{},this[field][operator]=operand}},_.extend(Query.prototype,Backbone.Collection.prototype,{model:Filter,initialize:function(){},getFiltersByName:function(name){var result=[];return _.each(this.models,function(filter){filter.get("field")==name&&result.push(filter)},result),result},toFilterObject:function(){var result={};return _.each(this.models,Query.doSerialize,result),result},toFilterString:function(){var result={};return _.each(this.models,Query.doSerialize,result),JSON.stringify(this.toFilterObject())},update:function(field,operator,operand){var _filter=null;return _.each(this.models,function(filter){filter.get("field")===field&&filter.get("operator")===operator&&(filter.setOperand(operand),_filter=filter)}),null!==_filter?_filter:newFilter=this.add({field:field,operator:operator,operand:operand})},deleteFilter:function(field,operator){var exist=!1;return _.each(this.models,function(filter){filter&&filter.get("field")===field&&filter.get("operator")===operator&&(this.remove(filter),exist=!0)},this),exist},isValid:function(){var inValid;return inValid=_.any(this.models,function(filter){return!filter.isValid()}),!inValid}}),Query}),define("message-mode",["underscore","backbone"],function(_,Backbone){var MessageMode=Backbone.Model.extend({defaults:{mode:"attribute"},initialize:function(attributes,options){options=options||{};var availableEvents=options.availableEvents;this.set(availableEvents&&availableEvents.length?{mode:"event"}:{mode:"attribute"})},toggle:function(){"attribute"===this.get("mode")?this.set("mode","event"):this.set("mode","attribute")},event:function(){return"event"===this.get("mode")}});return MessageMode}),define("models/event-recurrence",["backbone"],function(Backbone){var EventRecurrence=Backbone.Model.extend({defaults:{operator:"once",threshold:"1"},initialize:function(attributes,options){options=options||{};var rateLimit=options.rate_limit;rateLimit&&this.set("threshold",Math.floor(rateLimit/86400))},validate:function(attributes){var operator=attributes.operator,threshold=attributes.threshold,thresholdInt=threshold&&+threshold;return operator?"every-period"!==operator||threshold&&thresholdInt&&!(1>thresholdInt)?void 0:"Please specify the recurrence time period correctly!":"Please select a recurrence option!"},getRateLimit:function(){var threshold=parseInt(this.get("threshold"),10);return 86400*threshold}});return EventRecurrence.Factory={fromMessage:function(message){var eventMachine=message.get("eventMachine"),emptyEvent=eventMachine&&eventMachine.empty(),rateLimit=message.get("rate_limit"),attributes={},options={};if(!emptyEvent){var primaryEvent=eventMachine.get("primaryEvent"),operator=primaryEvent.get("operator");switch(operator){case"eq":attributes.operator="once";break;case"every":rateLimit?(attributes.operator="every-period",options.rate_limit=rateLimit):attributes.operator="every"}}return new EventRecurrence(attributes,options)}},EventRecurrence}),define("event-condition",["underscore","backbone"],function(_,Backbone){var EventCondition=function(attrs,options){Backbone.Model.call(this,attrs,options)};return _.extend(EventCondition.prototype,Backbone.Model.prototype,{defaults:{name:null,operator:"happen",count:null,within:"alltime",span:null},initialize:function(attrs,options){var span=null;null===options.span?this.set("within","alltime"):0===options.span?(this.set("within","session"),span=0):(this.set("within","day"),_.isNumber(attrs.span)&&(span=attrs.span)),this.set("span",span)},isValid:function(){return void 0===this.get("name")?!1:!0}}),EventCondition}),define("event-primary-event",["underscore","backbone"],function(_,Backbone){var PrimaryEvent=Backbone.Model.extend({defaults:{name:null,operator:"eq",threshold:1,nil:!0},once:function(){return"eq"===this.get("operator")},repeat:function(){return"every"===this.get("operator")},valid:function(){return this.get("name")}});return PrimaryEvent}),define("event-timed-event",["underscore","backbone"],function(_,Backbone){var TimedEvent=Backbone.Model.extend({defaults:{name:null,operator:"eq",threshold:1,type:"future",span:1,spanType:"day"},past:function(){return"past"===this.get("type")},future:function(){return"future"===this.get("type")},spanSeconds:function(){var spanSize,spanCount=this.get("span");switch(this.get("spanType")){case"day":spanSize=86400;break;case"hour":spanSize=3600;break;default:spanSize=0}return spanCount*spanSize}});return TimedEvent.Collection=Backbone.Collection.extend({model:TimedEvent}),TimedEvent}),define("event-machine",["underscore","backbone","event-primary-event","event-timed-event"],function(_,Backbone,PrimaryEvent,TimedEvent){var EventMachine=function(models,options){Backbone.Model.call(this,models,options)};return _.extend(EventMachine.prototype,Backbone.Model.prototype,{defaults:function(){return{primaryEvent:new PrimaryEvent,timedEvents:new TimedEvent.Collection}},empty:function(){return this.get("primaryEvent").get("nil")}}),EventMachine}),define("event-factory",["underscore","event-condition","event-machine","event-primary-event","event-timed-event"],function(_,EventCondition,EventMachine){function EventFactory(){}return EventFactory.prototype={createMachine:function(jsonDef){return this.machine=new EventMachine,jsonDef?(this.defs=jsonDef,this.parsePrimary(),this.parseTimed("past"),this.parseTimed("future"),this.machine):this.machine},parsePrimary:function(){var prim=this.defs.prim,evt=this.machine.get("primaryEvent");evt.set({name:prim.event,operator:prim.operator,threshold:prim.threshold,nil:!1})},parseTimed:function(when){_.each(this.defs[when],function(def){this._parseTimed(def,when)},this)},_parseTimed:function(definition,when){var span,evts=this.machine.get("timedEvents");"lt"===definition.operator&&1===definition.threshold&&(definition.operator="never"),span=this.secToSpan(definition.span),evts.add({name:definition.event,operator:definition.operator,threshold:definition.threshold,type:when,span:span.val,spanType:span.unit})},secToSpan:function(span){return span%86400===0?{val:Math.round(span/86400),unit:"day"}:{val:Math.round(span/3600),unit:"hour"}}},EventFactory}),define("text!templates/event-timed-event.html",[],function(){return'and\n\n<select class="event-name">\n  <% _.each(availableEvents, function(availableEvent) { %>\n    <option <%= (availableEvent === event.get(\'name\'))? \'selected\': \'\' %>><%= availableEvent %></option>\n  <% }); %>\n</select>\n\n<select class="event-operator">\n  <% _.each(operators, function(op) { %>\n    <option value="<%= op %>" <%= (op === event.get(\'operator\'))? \'selected\': \'\' %>><%= operatorHumanDict[op] %></option>\n  <% }); %>\n</select>\n\n<span class="container-operator-threshold">\n  <input\n    class="event-threshold input-small"\n    type="number"\n    size="4"\n    min="1"\n    step="1"\n    value="<%= event.get(\'threshold\') %>">\n  times\n</span>\n\nin\n\n<input\n  class="event-span input-small"\n  type="number"\n  size="4"\n  min="1"\n  value="<%= event.get(\'span\') %>">\n\n<select class="event-past-span-type">\n  <% _.each(pastSpanTypes, function(type) { %>\n    <option <%= (type === event.get(\'spanType\'))? \'selected\': \'\' %>><%= type %></option>\n  <% }); %>\n</select>\n\n<select class="event-future-span-type">\n  <% _.each(futureSpanTypes, function(type) { %>\n    <option <%= (type === event.get(\'spanType\'))? \'selected\': \'\' %>><%= type %></option>\n  <% }); %>\n</select>\n\n<select class="event-type">\n  <% _.each(eventTypes, function(type) { %>\n    <option value="<%= type %>" <%= (type === event.get(\'type\'))? \'selected\': \'\' %>><%= eventTypeOptionDict[type] %></option>\n  <% }); %>\n</select>\n\n\n<button type="button" class="btn btn-danger btn-delete-event">Delete</button>\n'}),define("views/event-timed-event",["underscore","backbone","event-timed-event","text!templates/event-timed-event.html"],function(_,Backbone,TimedEvent,_TimedEventHTML){var TimedEventView=Backbone.View.extend({tagName:"li",className:"timed-event",template:_.template(_TimedEventHTML),events:{"change .event-name":"updateEvent","change .event-operator":"updateEvent","change .event-threshold":"updateEvent","change .event-type":"updateEvent","change .event-span":"updateEvent","change .event-span-type":"updateEvent","click .btn-delete-event":"clear"},initialize:function(options){this.availableEvents=options.availableEvents,this.listenTo(this.model,"destroy",this.remove)},_operators:["gt","lt","never"],_eventTypes:["future","past"],_pastSpanTypes:["day"],_futureSpanTypes:["day","hour"],render:function(){return this.$el.html(this.template({event:this.model,availableEvents:this.availableEvents,operators:this._operators,operatorHumanDict:TimedEventView.operatorHumanDict,eventTypes:this._eventTypes,eventTypeOptionDict:TimedEventView.eventTypeOptionDict,pastSpanTypes:this._pastSpanTypes,futureSpanTypes:this._futureSpanTypes})),this.nameSelect=this.$(".event-name"),this.operatorSelect=this.$(".event-operator"),this.thresholdInput=this.$(".event-threshold"),this.typeSelect=this.$(".event-type"),this.spanInput=this.$(".event-span"),this.pastSpanTypeSelect=this.$(".event-past-span-type"),this.futureSpanTypeSelect=this.$(".event-future-span-type"),this.updateEvent(),this},getSpanType:function(){var ret;switch(this.model.get("event-type")){case"past":ret=this.pastSpanTypeSelect.val();break;default:ret=this.futureSpanTypeSelect.val()}return ret},updateEvent:function(){var name=this.nameSelect.val(),operator=this.operatorSelect.val(),threshold=this.thresholdInput.val(),type=this.typeSelect.val(),span=this.spanInput.val(),spanType=this.getSpanType();threshold=parseInt(threshold?threshold:0,10),span=parseInt(span?span:0,10),this.model.set({name:name,operator:operator,threshold:threshold,type:type,span:span,spanType:spanType});var classNames=_.chain([this.className]).union(_.values(this.model.attributes)).filter(function(o){return!_.isNumber(o)}).value();this.$el.attr("class",classNames.join(" "))},clear:function(){this.model.destroy()}});return _.extend(TimedEventView,{operatorHumanDict:{eq:"triggered exactly",gt:"triggered more than",lt:"triggered less than",never:"never triggered"},eventTypeOptionDict:{past:"before filter event triggered",future:"after filter event triggered"}}),TimedEventView}),define("event-serializer",["underscore","event-condition","event-machine","views/event-timed-event"],function(_,EventCondition,EventMachine,TimedEventView){function EventSerializer(){}return EventSerializer.prototype={COMPARATOR:["eq","gt","gte","lt","lte"],toReadable:function(machine){var result,prim=machine.get("primaryEvent"),timed=machine.get("timedEvents");return machine.empty()||(result={prim:{name:prim.get("name"),threshold:prim.get("threshold")},timed:[]}),timed.each(function(evt){result.timed.push({name:evt.get("name"),comparator:TimedEventView.operatorHumanDict[evt.get("operator")],threshold:evt.get("threshold"),span:evt.get("span"),spanType:evt.get("spanType"),type:TimedEventView.eventTypeOptionDict[evt.get("type")]})}),result},serializeMachine:function(machine,recurrence){return this.machine=machine,this.primary=this.machine.get("primaryEvent"),this.timed=this.machine.get("timedEvents"),this.recurrence=recurrence,this.result={prim:null,past:[],future:[]},this.serializePrimary(),this.serializeTimedEvents(),this.result},serializePrimary:function(){var operator;switch(this.recurrence.get("operator")){case"every":case"every-period":operator="every";break;case"once":operator="eq";break;default:operator="eq"}this.result.prim={event:this.primary.get("name"),operator:operator,threshold:this.primary.get("threshold")}},serializeTimedEvents:function(){this.timed.each(function(evt){var operator,threshold;"never"===evt.get("operator")?(operator="lt",threshold=1):(operator=evt.get("operator"),threshold=evt.get("threshold")),this.result[evt.get("type")].push({event:evt.get("name"),operator:operator,threshold:threshold,span:evt.spanSeconds()})},this)}},EventSerializer}),define("models/query-recurrence",["underscore","backbone"],function(_,Backbone){var QueryRecurrence=Backbone.Model.extend({defaults:{frequency:"once",threshold:"30"},initialize:function(attributes,options){var recurring=options.recurring,rate_limit=options.rate_limit;recurring&&rate_limit?(rate_limit=Math.round(rate_limit/86400),this.set("frequency","every"),this.set("threshold",rate_limit)):this.set("frequency","once")},validate:function(attributes){var frequency=attributes.frequency,threshold=attributes.threshold,thresholdInt=threshold&&+threshold;return frequency?"every"!==frequency||threshold&&thresholdInt&&!(1>thresholdInt)?void 0:"Please specify the recurrence time period correctly!":"Please select a recurrence option!"},once:function(){return"once"===this.get("frequency")},repeat:function(){return"every"===this.get("frequency")},recurring:function(){return this.repeat()&&this.get("threshold")?!0:!1},rateLimit:function(){if(this.recurring()){var threshold=parseInt(this.get("threshold"),10);return 86400*threshold}return null}});return QueryRecurrence}),define("message-schedule",["underscore","backbone"],function(_,Backbone){var MessageSchedule=function(attributes,options){Backbone.Model.call(this,attributes,options)};return _.extend(MessageSchedule.prototype,Backbone.Model.prototype,{defaults:{type:"now",waitSpan:0,waitUnit:"days"},_unitSecondDict:{minutes:60,days:86400},initialize:function(attributes,options){var schedule={},sendAfter=options.sendAfter;sendAfter||(sendAfter=0),0===sendAfter?schedule.type="now":86400>sendAfter?(schedule.type="wait",schedule.waitUnit="minutes",schedule.waitSpan=Math.round(sendAfter/60)):(schedule.type="wait",schedule.waitUnit="days",schedule.waitSpan=Math.round(sendAfter/86400)),this.set(schedule)},afterSeconds:function(){switch(this.get("type")){case"now":return 0;case"wait":return this.get("waitSpan")*this._unitSecondDict[this.get("waitUnit")];default:return 0}}}),MessageSchedule}),define("message",["underscore","backbone","query","message-mode","models/event-recurrence","event-factory","event-serializer","models/query-recurrence","message-schedule"],function(_,Backbone,Query,MessageMode,EventRecurrence,EventFactory,EventSerializer,QueryRecurrence,MessageSchedule){var Message=function(attributes,options){Backbone.Model.call(this,attributes,options)};return _.extend(Message.prototype,Backbone.Model.prototype,{defaults:function(){return{status:"draft",name:"New message",agent_id:null,agent:"Retain",app:"Retain.cc",delivery:"email",content:'Hi {{name | fallback: "there" }},',filter:{},stop_at:null,query:null,messageMode:new MessageMode,EventRecurrence:new EventRecurrence,eventMachine:null,schedule:null}},initialize:function(attributes,options){var evtFactory=new EventFactory;this.evtSerializer=new EventSerializer,this.update=_.bind(this.update,this),options&&options.form&&(this.form=options.form,this.on("change",this.updateForm,this),this.form.on("submit",this.update)),this.set("query",new Query(Query.createFromJson(this.get("filter")))),this.set("eventMachine",evtFactory.createMachine(this.get("event_machine"))),this.set({messageMode:new MessageMode({},{availableEvents:this.get("available_events")})}),this.set("queryRecurrence",new QueryRecurrence({},{recurring:this.get("recurring"),rate_limit:this.get("rate_limit")})),this.set("eventRecurrence",EventRecurrence.Factory.fromMessage(this)),this.set("schedule",new MessageSchedule({},{sendAfter:this.get("send_after")}))},validate:function(attributes){if(!attributes.query.isValid())return"Please config the filter properly before save!";if(!this.eventOrQuery())return"Plase config user profile or event filer before save!";var recurrence;return recurrence=attributes.eventMachine.empty()?attributes.queryRecurrence:attributes.eventRecurrence,recurrence.isValid()?void 0:recurrence.validationError},updateForm:function(){var form=this.form;_.each(this.changedAttributes(),function(value,attr){var input=form.find("[name="+attr+"]");input&&input.val(value)})},update:function(){var filterString,eventString;filterString=this.get("query").toFilterString(),this.form.find("[name=to_filter]").val(filterString),eventString=this.get("eventMachine").empty()?null:this.evtSerializer.serializeMachine(this.get("eventMachine"),this.get("eventRecurrence")),this.form.find("[name=event_machine]").val(JSON.stringify(eventString)),this.updateRecurrence(),this.form.find("[name=send_after]").val(this.get("schedule").afterSeconds())},updateRecurrence:function(){var recurringInput=this.form.find("[name=recurring]"),rateLimitInput=this.form.find("[name=rate_limit]");if(this.get("eventMachine").empty()){var queryRecurrence=this.get("queryRecurrence");recurringInput.val(queryRecurrence.recurring()),rateLimitInput.val(queryRecurrence.rateLimit())}else{var eventRecurrence=this.get("eventRecurrence");switch(recurringInput.val(!1),eventRecurrence.get("operator")){case"every":rateLimitInput.val(null),recurringInput.val(!0);break;case"every-period":rateLimitInput.val(eventRecurrence.getRateLimit()),recurringInput.val(!0);break;default:rateLimitInput.val(null),recurringInput.val(!1)}}},eventOrQuery:function(){return!this.get("eventMachine").empty()||this.get("query").length>0}}),Message}),define("auto-message-sub-event",["underscore","backbone"],function(_,Backbone){var AutoMessageSubEvent=function(attributes,options){Backbone.Model.call(this,attributes,options)};return _.extend(AutoMessageSubEvent.prototype,Backbone.Model.prototype,{defaults:{evt_name:"",time_frame:"alltime"}}),AutoMessageSubEvent.posEvents=Backbone.Collection.extend({model:AutoMessageSubEvent,toFutures:function(futureSpan){for(var futures=[],i=this.models.length-1;i>=0;i--)"after"==this.models[i].get("time_frame")&&futures.push({operator:"gt",event:this.models[i].get("evt_name"),span:futureSpan,threshold:1});return futures},toAttrs:function(){for(var attrs=[],i=this.models.length-1;i>=0;i--)"alltime"==this.models[i].get("time_frame")&&attrs.push({field:"custom_data._event_"+this.models[i].get("evt_name")+"_count",operator:"gt",operand:0,enable:!0});return attrs}}),AutoMessageSubEvent.negEvents=Backbone.Collection.extend({model:AutoMessageSubEvent,toFutures:function(futureSpan){for(var futures=[],i=this.models.length-1;i>=0;i--)"after"==this.models[i].get("time_frame")&&futures.push({operator:"lt",event:this.models[i].get("evt_name"),span:futureSpan,threshold:1});return futures},toAttrs:function(){for(var attrs=[],i=this.models.length-1;i>=0;i--)"alltime"==this.models[i].get("time_frame")&&attrs.push({field:"custom_data._event_"+this.models[i].get("evt_name")+"_count",operator:"exists",operand:!1,enable:!0});return attrs}}),AutoMessageSubEvent}),define("auto-message-recurrence",["underscore","backbone"],function(_,Backbone){var AutoMessageRecurrence=Backbone.Model.extend({defaults:{frequency:"once",threshold:"30"},initialize:function(attributes){var recurring=attributes.recurring,rate_limit=attributes.rate_limit;recurring&&rate_limit?(rate_limit=Math.round(rate_limit/86400),this.set("frequency","every"),this.set("threshold",rate_limit)):this.set("frequency","once")},validate:function(attributes){var frequency=attributes.frequency,threshold=attributes.threshold,thresholdInt=threshold&&+threshold;return frequency?"every"!==frequency||threshold&&thresholdInt&&!(1>thresholdInt)?void 0:"Please specify the recurrence time period correctly!":"Please select a recurrence option!"},once:function(){return"once"===this.get("frequency")},repeat:function(){return"every"===this.get("frequency")},recurring:function(){return this.repeat()&&this.get("threshold")?!0:!1},rateLimit:function(){if(this.recurring()){var threshold=parseInt(this.get("threshold"),10);return 86400*threshold}return null},isValid:function(){return""===this.get("threshold")?!1:!0}});return AutoMessageRecurrence}),define("auto-message",["underscore","backbone","auto-message-sub-event","query","auto-message-recurrence"],function(_,Backbone,AutoMessageSubEvent,Query,AutoMessageRecurrence){var AutoMessageModel=function(attributes,options){Backbone.Model.call(this,attributes,options)};return _.extend(AutoMessageModel.prototype,Backbone.Model.prototype,{defaults:function(){return{app_uid:null,editor_mode:"event",status:"draft",name:"",delivery:"email",subject:"via Retain.cc",content:'Hi {{ name | fallback: "there" }},',response_content:"Thanks your response",delay:"now",delaySpan:0,primEvent:null,posEvents:new AutoMessageSubEvent.posEvents,negEvents:new AutoMessageSubEvent.negEvents,query:new Query([]),recurrence:new AutoMessageRecurrence({}),previewUser:null}},previewUrl:function(){return"/app/"+this.get("app_uid")+"/message/preview_user"},url:function(){return this.get("id")?"/app/"+this.get("app_uid")+"/message/auto/"+this.get("id"):this.urlRoot()},urlRoot:function(){return"/app/"+this.get("app_uid")+"/messages/auto"},initialize:function(attributes){var editorState=this.get("editor_state");if(editorState)this.set("primEvent",editorState.primEvent),this.set("editor_mode",editorState.editor_mode),this.get("posEvents").add(editorState.pos_events),this.get("negEvents").add(editorState.neg_events),editorState.delaySpan&&editorState.delay&&(this.set("delaySpan",editorState.delaySpan),this.set("delay",editorState.delay)),editorState.filters&&(this.set("query",new Query),this.get("query").add(editorState.filters));else{var editorMode=this.get("editor_mode");"filter"===editorMode&&this.get("query").add([{enabled:!0,field:"email",operator:"exists-true",operand:""}])}this.set("recurrence",new AutoMessageRecurrence(attributes)),"draft"==this.get("status")?this.set("notLive","draft"):this.set("notLive","stop"),this.listenTo(this.get("posEvents"),"add",this.onPosEventAdd),this.listenTo(this.get("negEvents"),"add",this.onNegEventAdd)},toggleStatus:function(){"live"==this.get("status")?this.set("status",this.get("notLive")):this.set("status","live")},getDeliveries:function(){var delivery=this.get("delivery"),deliveries=[{val:"prompt",name:"Conversation"},{val:"growl",name:"Notification"},{val:"email",name:"Email"},{val:"email-lead",name:"Email Lead"}];return _.each(deliveries,function(select){select.val==delivery&&(select.active=!0)}),deliveries},getDeliveryName:function(){var delivery;return delivery=_.find(this.getDeliveries(),function(item){return item.active}),delivery.name},addPosEvent:function(attrs){this.get("posEvents").add(attrs)},addNegEvent:function(attrs){this.get("negEvents").add(attrs)},onPosEventAdd:function(model){this.trigger("add:posEvent",model)},onNegEventAdd:function(model){this.trigger("add:negEvent",model)},validate:function(){return"later"!=this.get("delay")||this.get("delaySpan")?this.get("recurrence").isValid()?this.get("query").isValid()?this.get("name")?!1:"Please give a name to auto message":"Please config the filter properly!":"Please config no. of day properly":"Please config no. of day properly"},toJSON:function(){var attrs=_.clone(this.attributes);if(attrs.editor_state={primEvent:this.get("primEvent"),editor_mode:this.get("editor_mode"),filters:this.get("query").toJSON(),pos_events:this.get("posEvents").toJSON(),neg_events:this.get("negEvents").toJSON(),delaySpan:this.get("delaySpan"),delay:this.get("delay")},attrs.send_after="later"==this.get("delay")?86400*this.get("delaySpan"):0,attrs.recurring=this.get("recurrence").recurring(),attrs.rate_limit=this.get("recurrence").rateLimit(),"event"==attrs.editor_mode){attrs.event_machine=this.buildEvents(attrs.send_after),_.size(attrs.event_machine.future)>0&&(attrs.send_after=0);for(var query=new Query,i=this.get("query").models.length-1;i>=0;i--)query.add(this.get("query").models[i].attributes);query.add(this.buildEvtAttrs()),attrs.to_filter=query.toFilterString()}else attrs.to_filter=this.get("query").toFilterString();return attrs},buildEvents:function(futureSpan){var future=[];return futureSpan>0&&(future=_.union(future,this.get("posEvents").toFutures(futureSpan)),future=_.union(future,this.get("negEvents").toFutures(futureSpan))),{prim:{operator:"eq",event:this.get("primEvent"),threshold:1},past:[],future:future}},buildEvtAttrs:function(){var attrs=[];return attrs=_.union(attrs,this.get("posEvents").toAttrs()),attrs=_.union(attrs,this.get("negEvents").toAttrs())},updatePreviewUser:function(){var param={q:this.get("query").toFilterString()},paramString=Backbone.$.param(param);Backbone.$.ajax({type:"POST",url:this.previewUrl()+"?"+paramString,context:this,success:function(data){this.set("previewUser",data)},error:function(){console.log("Fail connect to server")}})}}),AutoMessageModel}),define("text!templates/auto-message/creator.mustache",[],function(){return'<header>\n  <h1>Create Message</h1>\n</header>\n\n<div class="creator-content">\n<h3>I want to Create...</h3>\n\n<div class="create-segment">\n  <p class="action">\n    <button class="btn btn-submit"\n      data-filter="filter">Create</button>\n  </p>\n  <h4>Segment Triggered Messages</h4>\n  <p class="content">Send a message when user enters a segment.</p>\n  <h6>Examples:</h6>\n  <ul>\n    <li>Send a "Getting Started" series after a user sign up</li>\n    <li>Email a user if he is likely to unsubscribe</li>\n  </ul>\n</div>\n\n<div class="create-event">\n  <p class="action">\n    <button class="btn btn-submit"\n      data-filter="event">Create</button>\n  </p>\n  <h4>Event Triggered Messages</h4>\n  <p class="content">Send a message everytime when an event occurs.</p>\n  <h6>Use Cases:</h6>\n  <ul>\n    <li>Send an email after user looked at a product but didn\'t check out</li>\n    <li>Send a message when user try out a new feature</li>\n    <li>Show a popup when user try out a new feature</li>\n  </ul>\n</div>\n\n</div>'}),define("auto-message-creator",["underscore","backbone","auto-message","text!templates/auto-message/creator.mustache"],function(_,Backbone,AutoMessageModel,Template){var AutoMessageCreator=function(options){Backbone.View.call(this,options)};return _.extend(AutoMessageCreator.prototype,Backbone.View.prototype,{tagName:"section",className:"auto-message-creator",events:{"click button":"clickCreate"},initialize:function(options){this.appID=options.appID,this.currentAgent=options.currentAgent},render:function(parent){parent.append(this.$el),parent.removeClass("loading"),this.$el.html(Template)},clickCreate:function(e){var target=Backbone.$(e.currentTarget),filterType=target.data("filter");this.model=new AutoMessageModel({app_uid:this.appID,editor_mode:filterType,agent:this.currentAgent,agent_id:this.currentAgent.id}),this.trigger("created",this.model)}}),AutoMessageCreator}),define("text!templates/auto-message/editor.mustache",[],function(){return'<header>\n  <h1>Create Event Triggered Message</h1>\n  <input name="name" type="text"class="message-name input-xlarge"\n    placeholder="Name your rules (e.g. New Signup)"\n    value="{{model.name}}">\n  <div class="status-control-wrap">\n    <div class="status-control\n      {{model.status}} {{model.notLive}}\n    ">\n      <span class="not-live">{{model.notLive}}</span>\n      <span class="switch">&nbsp;</span>\n      <span class="live">Live</span>\n    </div>\n    <span class="spining icon-spin">&nbsp;</span>\n  </div>\n</header>\n<section class="event-match">\n  <h4 data-section="event" class="navigate">\n    <span class="first">1</span>Send Message to Users who are...\n  </h4>\n  <div class="widget event-widget">\n    \n  </div>\n</section>\n<section class="filter-match">\n  <h4  data-section="filter" class="navigate">\n    <span class="second">2</span>And Only send to users with these profiles...\n  </h4>\n  <div class="widget filter-widget">\n    \n  </div>\n</section>\n<section class="message-match">\n  <h4 data-section="message" class="navigate">\n    <span class="third">3</span>Compose\n    <span class="delivery-name">{{deliveryName}}</span>\n  </h4>\n  <div class="widget message-widget">\n    \n  </div>\n</section>\n<section class="bottom-match"> \n  <button class="btn btn-submit done">\n    <span class="spining icon-spin">&nbsp;</span>\n    Done</button>\n</section>\n'}),define("text!templates/auto-message/filter-editor.mustache",[],function(){return'<header>\n  <h1>Segment Triggered Messages</h1>\n  <input name="name" type="text"class="message-name input-xlarge"\n    placeholder="Name your rules (e.g. New Signup)"\n    value="{{model.name}}">\n  <div class="status-control-wrap">\n    <div class="status-control\n      {{model.status}} {{model.notLive}}\n    ">\n      <span class="not-live">{{model.notLive}}</span>\n      <span class="switch">&nbsp;</span>\n      <span class="live">Live</span>\n    </div>\n    <span class="spining icon-spin">&nbsp;</span>\n  </div>\n</header>\n<section class="filter-match">\n  <h4 data-section="filter" class="navigate">\n    <span class="first">1</span>Send Message to Users who are...\n  </h4>\n  <div class="widget filter-widget">\n    \n  </div>\n</section>\n<section class="message-match">\n  <h4 data-section="message" class="navigate">\n    <span class="second">2</span>Compose\n    <span class="delivery-name">{{deliveryName}}</span>\n  </h4>\n  <div class="widget message-widget">\n    \n  </div>\n</section>\n<section class="bottom-match"> \n  <button class="btn btn-submit done">\n    <span class="spining icon-spin">&nbsp;</span>\n    Done</button>\n</section>\n'
}),define("flash-view",["underscore","backbone"],function(_,Backbone){var FlashView=function(options){Backbone.View.call(this,options)};return _.extend(FlashView.prototype,Backbone.View.prototype,{initialize:function(){this.hide=_.bind(this.hide,this)},render:function(message){this.setElement("#flash-messages"),message&&this.$el.html('<div class="flash-message">'+message+"</div>"),this.$el.removeClass("fadedown"),_.delay(this.hide,3e3)},delegateEvents:function(){this.$el.on("click",this.hide)},hide:function(){this.$el.addClass("fadedown")}}),new FlashView}),define("text!templates/auto-message/pos-event.mustache",[],function(){return'<select name="event-name" class="event-name">\n  {{#events}}\n    <option value="{{key}}">{{name}}</option>\n  {{/events}}\n</select>\n<select name="time-frame" class="time-frame">\n  <option value="alltime">Anytime</option>\n  {{#delay}}\n    <option value="after" class="after-name">After Last Event</option>\n  {{/delay}}\n</select>\n<button class="remove">-</button>\n'}),define("text!templates/auto-message/neg-event.mustache",[],function(){return'<select name="event-name" class="event-name">\n  {{#events}}\n    <option value="{{key}}">{{name}}</option>\n  {{/events}}\n</select>\n<select name="time-frame" class="time-frame">\n  <option value="alltime">Never</option>\n  {{#delay}}\n    <option value="after" class="after-name">After Last Event</option>\n  {{/delay}}\n</select>\n<button class="remove">-</button>\n'}),define("auto-message-subevent-view",["underscore","backbone","mustache","text!templates/auto-message/pos-event.mustache","text!templates/auto-message/neg-event.mustache"],function(_,Backbone,Mustache,PosEventTemplate,NegEventTemplate){var AutoMessageSubEventView=function(options){Backbone.View.call(this,options)};return _.extend(AutoMessageSubEventView.prototype,Backbone.View.prototype,{tagName:"li",className:"sub-event",events:{"change select.event-name":"changeName","change select.time-frame":"changeTime","click button.remove":"remove"},initialize:function(options){this.sign=options.sign,this.eventNames=options.eventNames,this.autoMessage=options.autoMessage,this.model=options.model,this.listenTo(this.autoMessage,"change:delay",this.onDelayChange),this.listenTo(this.autoMessage,"change:primEvent",this.onPrimEventChange)},render:function(){var delay="later"==this.autoMessage.get("delay"),template={pos:PosEventTemplate,neg:NegEventTemplate}[this.sign];this.$el.html(Mustache.render(template,{events:this.eventNames,delay:delay,model:this.model.attributes})),this.afterName=this.$(".after-name"),this.$(".event-name").val(this.model.get("evt_name")),this.$(".time-frame").val(this.model.get("time_frame")),this.onPrimEventChange(this.autoMessage)},remove:function(){Backbone.View.prototype.remove.call(this),this.model.destroy()},changeName:function(e){this.model.set("evt_name",e.target.value)},changeTime:function(e){this.model.set("time_frame",e.target.value)},onDelayChange:function(model){"now"==model.get("delay")&&this.model.set("time_frame","alltime"),this.render()},onPrimEventChange:function(model){var evt,primEvt=model.get("primEvent");evt=_.find(this.eventNames,function(evt){return primEvt==evt.key}),this.afterName.text("After Last "+evt.name)}}),AutoMessageSubEventView}),define("text!templates/auto-message/event-widget.mustache",[],function(){return'<p class="prim-event">\n  If a user\n  <select name="event-name" class="events-list">\n    {{#events}}\n      <option value="{{key}}">{{name}}</option>\n    {{/events}}\n  </select>\n  send an\n  <select name="delivery" class="delivery">\n    {{#deliveries}}\n      <option value="{{val}}" {{#active}}selected{{/active}}>{{name}}</option>\n    {{/deliveries}}\n  </select>\n  message\n  <span class="schdeule">\n    <input\n      class="delay-span input-small"\n      type="number"\n      size="4"\n      min="1"\n      step="1"\n      value="{{model.delaySpan}}">\n    days\n  </span>\n  <select name="delay" class="delay input-xsmall">\n    <option value="now">immediately</option>\n    <option value="later">later</option>\n  </select>\n</p>\n\n<div class="positive-event">\n  <span class="icon-checkmark">&nbsp;</span>\n  <h5>\n    And only send to users who triggered events:\n  </h5>\n  <ul class="positive-conditions">\n  {{#model.posEvents}}\n    {{> posEvent}}\n  {{/model.posEvents}}\n  </ul>\n  <p>\n    <button class="btn btn-submit btn-small add">Add Event</button>\n  </p>\n</div>\n\n<div class="negative-event">\n  <span class="icon-close">&nbsp;</span>\n  <h5>\n    Don\'t send to users who triggered events:\n  </h5>\n  <ul class="negative-conditions">\n  {{#model.negEvents}}\n    {{> negEvent}}\n  {{/model.negEvents}}\n  </ul>\n    <p>\n    <button class="btn btn-submit btn-small add">Add Event</button>\n  </p>\n</div>'}),define("auto-message-event-widget",["underscore","backbone","mustache","auto-message-subevent-view","text!templates/auto-message/event-widget.mustache"],function(_,Backbone,Mustache,AutoMessageSubEventView,Template){var AutoMessageEventWidget=function(options){Backbone.View.call(this,options)};return _.extend(AutoMessageEventWidget.prototype,Backbone.View.prototype,{tagName:"div",className:"event-widget",events:{"click .positive-event button.add":"addPositive","click .negative-event button.add":"addNegative","change select.events-list":"changeEventName","change select.delivery":"changeDelivery","change select.delay":"changeDelay","change input.delay-span":"changeDelaySpan"},initialize:function(options){this.model=options.model;var primEvent=this.model.get("primEvent"),events=[];null===primEvent&&(primEvent=options.eventNames[0].key,this.model.set("primEvent",primEvent)),_.each(this.model.get("posEvents").models,function(evt){events.push(evt.get("evt_name"))}),_.each(this.model.get("negEvents").models,function(evt){events.push(evt.get("evt_name"))}),this.eventNames=_.filter(options.eventNames,function(name){return check=!name.status||"stop"!=name.status||primEvent==name.key||_.contains(events,name.key)}),this.listenTo(this.model,"change:delay",this.onDelayChange),this.listenTo(this.model,"change:delaySpan",this.onDelaySpanChange),this.listenTo(this.model,"add:posEvent",this.onAddPosEvent),this.listenTo(this.model,"add:negEvent",this.onAddNegEvent)},render:function(){this.$el.html(Mustache.render(Template,{events:this.eventNames,model:this.model.attributes,deliveries:this.model.getDeliveries()})),this.primContainer=this.$(".prim-event"),this.evtName=this.$(".events-list"),this.posContainer=this.$(".positive-conditions"),this.negContainer=this.$(".negative-conditions"),this.delaySpan=this.$(".delay-span"),_.each(this.model.get("posEvents").models,this.onAddPosEvent,this),_.each(this.model.get("negEvents").models,this.onAddNegEvent,this),this.onEventChange(this.model),this.onDelayChange(this.model),this.$(".delay").val(this.model.get("delay"))},addPositive:function(){this.model.addPosEvent({})},addNegative:function(){this.model.addNegEvent({})},changeEventName:function(e){this.model.set("primEvent",e.target.value)},changeDelivery:function(e){this.model.set("delivery",e.target.value)},changeDelay:function(e){this.model.set("delay",e.target.value)},changeDelaySpan:function(e){var val=e.target.value;val=parseInt(val?val:0,10),this.model.set("delaySpan",val)},onEventChange:function(model){this.evtName.val(model.get("primEvent"))},onDelayChange:function(model){this.primContainer.removeClass("now later"),this.primContainer.addClass(model.get("delay"))},onDelaySpanChange:function(model){model.get("delaySpan")?this.delaySpan.removeClass("warning"):this.delaySpan.addClass("warning")},onAddPosEvent:function(model){var view=new AutoMessageSubEventView({sign:"pos",eventNames:this.eventNames,model:model,autoMessage:this.model});view.render(),this.posContainer.append(view.el)},onAddNegEvent:function(model){var view=new AutoMessageSubEventView({sign:"neg",eventNames:this.eventNames,model:model,autoMessage:this.model});view.render(),this.negContainer.append(view.el)}}),AutoMessageEventWidget}),define("text!templates/auto-message/filter-control.mustache",[],function(){return'<select class="filter-field">\n  {{#avaliableFilter}}\n    <option value="{{key}}"\n      data-type="{{data_type}}">{{name}}</option>\n  {{/avaliableFilter}}\n  <hr>\n  {{#companyFilter}}\n    <option value="company.{{key}}"\n      data-type="{{data_type}}">{{name}}</option>\n  {{/companyFilter}}\n</select>\n<div class="string-filter">\n  <select class="filter-operator">\n    <option value="equal">Is</option>\n    <option value="not_equal">Is not</option>\n    <option value="start_with">Starts with</option>\n    <option value="not_start_with">Does not start with</option>\n    <option value="end_with">Ends with</option>\n    <option value="not_end_with">Does not end with</option>\n    <option value="contains">Contains</option>\n    <option value="exists-true" data-input="exists-operator">Has any value</option>\n    <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n  </select>\n  <br>\n  <input class="filter-operand" type="text">\n</div>\n<div class="date-filter">\n  <select class="filter-operator">\n    <optgroup label="Relative">\n      <option value="day_ago_lt" data-input="ago">Less than</option>\n      <option value="day_ago_eq" data-input="ago">Exactly</option>\n      <option value="day_ago_gt" data-input="ago">More than</option>\n    </optgroup>\n    <optgroup label="Absolute">\n      <option value="day_after" data-input="abs">After</option>\n      <option value="day_on" data-input="abs">On</option>\n      <option value="day_before" data-input="abs">Before</option>\n      <option value="exists-true" data-input="exists-operator">Has any value</option>\n      <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n    </optgroup>\n  </select>\n  <br>\n  <span class="ago">\n    <input class="filter-operand" type="number">days ago\n  </span>\n  <span class="abs">\n    <input class="filter-operand abs-date" type="text">\n  </span>\n</div>\n<div class="numeric-filter">\n  <select class="filter-operator">\n    <option value="gt">More than</option>\n    <option value="equal">Exactly</option>\n    <option value="lt">Less than</option>\n    <option value="exists-true" data-input="exists-operator">Has any value</option>\n    <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n  </select>\n  <br>\n  <input class="filter-operand" type="number">\n</div>\n<div class="boolean-filter">\n  <select class="filter-operator">\n    <option value="boolean-true">is True</option>\n    <option value="boolean-false">is False</option>\n    <option value="exists-true" data-input="exists-operator">Has Any Value</option>\n    <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n  </select>\n  <input type="hidden" value="" class="filter-operand" readonly>\n</div>\n<div class="birthday-filter">\n  <input type="hidden" value="same_day_of_year" class="filter-operator">\n  <select class="filter-operand">\n    <option value="_TODAY" selected>Is today</option>\n  </select>\n</div>\n<div class="user_type-filter">\n  <input type="hidden" value="contain_any" class="filter-operator" readonly data-input="user_type">\n  <select class="filter-operand">\n    <option value=\'["anonymous"]\'>Anonymous</option>\n    <option value=\'["email-lead"]\'>Email Lead</option>\n    <option value=\'["registered"]\'>Registered</option>\n  </select>\n</div>\n<div class="event-filter">\n  <select class="event-suffix">\n    <option value="_count">Count</option>\n    <option value="_first_ocurred_at">First Time</option>\n    <option value="_last_ocurred_at">Most Recent</option>\n  </select>\n  <div class="date-filter">\n    <select class="filter-operator">\n      <optgroup label="Relative">\n        <option value="day_ago_lt" data-input="ago">Less than</option>\n        <option value="day_ago_eq" data-input="ago">Exactly</option>\n        <option value="day_ago_gt" data-input="ago">More than</option>\n      </optgroup>\n      <optgroup label="Absolute">\n        <option value="day_after" data-input="abs">After</option>\n        <option value="day_on" data-input="abs">On</option>\n        <option value="day_before" data-input="abs">Before</option>\n        <option value="exists-true" data-input="exists-operator">Has any value</option>\n        <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n      </optgroup>\n    </select>\n    <br>\n    <span class="ago">\n      <input class="filter-operand" type="number">days ago\n    </span>\n    <span class="abs">\n      <input class="filter-operand abs-date" type="text">\n    </span>\n  </div>\n  <div class="numeric-filter">\n    <select class="filter-operator">\n      <option value="gt">More than</option>\n      <option value="equal">Exactly</option>\n      <option value="lt">Less than</option>\n      <option value="exists-true" data-input="exists-operator">Has any value</option>\n      <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n    </select>\n    <br>\n    <input class="filter-operand" type="number">\n  </div>\n\n</div>\n<button class="delete-btn btn btn-red"><span class="icon-close"">&nbsp;</span></button>\n'}),define("text!templates/filter-control-option.html",[],function(){return'<option value="<%= filter.key %>"\n    data-type="<%= filter.data_type %>"><%= filter.name %></option>\n'}),define("text!templates/filter-control-company-option.html",[],function(){return'<option value="company.<%= filter.key %>"\n    data-type="<%= filter.data_type %>"><%= filter.name %></option>\n'}),define("auto-message-filter-view",["underscore","backbone","mustache","filter","pikaday","text!templates/auto-message/filter-control.mustache","text!templates/filter-control-option.html","text!templates/filter-control-company-option.html"],function(_,Backbone,Mustache,Filter,Pikaday,ControlTemplate,filterControlOption,filterControlCompanyOption){var FilterView=(_.template(filterControlOption),_.template(filterControlCompanyOption),function(options){Backbone.View.call(this,options)});return _.extend(FilterView.prototype,Backbone.View.prototype,{tagName:"li",className:"filter-control",events:{"click .delete-btn":"onRemoveClicked","change .filter-field":"onFieldClick","change .event-suffix":"onEeventSuffixChange","change .filter-operator":"onOperatorChange","change .filter-operand":"onOperandChange"},initialize:function(options){this.model=options.model,this.avaliableFilter=options.avaliableFilter,this.companyFilter=options.companyFilter,this.pikadays=[],this.listenTo(this.model,"change:field",this.onFieldChange),this.listenTo(this.model,"change:operator",this.syncOperandType)},render:function(){this.avaliableFilter.length,this.companyFilter.length;return this.$el.append(Mustache.render(ControlTemplate,{avaliableFilter:this.avaliableFilter,companyFilter:this.companyFilter})),this.filterField=this.$(".filter-field"),this.pikadays[0]=new Pikaday({field:this.$("input.abs-date").get(0),format:"YYYY-MM-DD"}),this.pikadays[1]=new Pikaday({field:this.$("input.abs-date").get(1),format:"YYYY-MM-DD"}),this.filterField.val(this.model.getFieldGroup()),this.onFieldChange(this.model,this.model.get("field")),this},onFieldChange:function(model,field){var operator=model.get("operator"),operand=model.get("operand");this.activeType=model.getDataType(field),this.activeFilter&&this.activeFilter.removeClass("active-filter"),this.model.isEvent()||"event"==this.activeType?(this.$(".event-filter").addClass("active-filter"),this.activeFilter=this.$(".event-filter ."+this.activeType+"-filter"),console.log(this.model.getEventSuffix()),this.$(".event-suffix").val(this.model.getEventSuffix()),this.activeFilter&&(this.activeFilter.addClass("active-filter"),this.$(".event-filter .active-filter .filter-operator").val(operator))):(this.$(".event-filter").removeClass("active-filter"),this.activeFilter=this.$("."+this.activeType+"-filter"),this.activeFilter.addClass("active-filter"),this.$(".active-filter .filter-operator").val(operator)),"user_type"===this.activeType&&(operand=JSON.stringify(operand)),this.$(".active-filter .filter-operand").val(operand),this.syncOperandType(model,model.get("operator")),"birthday"===this.activeType&&this.model.set("operator","same_day_of_year"),"user_type"===this.activeType&&this.model.set("operator","contain_any")},syncOperandType:function(model,operator){var newMode,val,mode=this.activeFilter.data("mode")||"";newMode=this.$(".active-filter option[value="+operator+"]").data("input"),newMode=newMode||"",newMode!==mode&&(this.activeFilter.removeClass(mode),this.activeFilter.addClass(newMode),this.activeFilter.data("mode",newMode),newMode&&(val=this.activeFilter.find("."+newMode+" input").val()),isValid=model.setOperand(val),this.syncOperandValid(isValid))},syncOperandValid:function(isValid){isValid?this.$(".active-filter .filter-operand").removeClass("warning"):this.$(".active-filter .filter-operand").addClass("warning")},onRemoveClicked:function(){this.trigger("remove",this.model),this.model.destroy()},onFieldClick:function(e){this.model.set("field",e.target.value)},onEeventSuffixChange:function(e){this.model.setEventSuffix(e.target.value)},onOperatorChange:function(e){this.model.set("operator",e.target.value)},onOperandChange:function(e){var rVal,isValid;rVal="user_type"==this.activeType?JSON.parse(e.target.value):e.target.value,isValid=this.model.setOperand(rVal),this.syncOperandValid(isValid)}}),FilterView}),define("text!templates/auto-message/query-widget.mustache",[],function(){return'<p class="filter-delivery">\n  If a user matches following profile attributes, send an\n  <select name="delivery" class="delivery input-medium">\n    {{#deliveries}}\n      <option value="{{val}}" {{#active}}selected{{/active}}>{{name}}</option>\n    {{/deliveries}}\n  </select>\n  message\n  <span class="schdeule">\n    <input\n      class="delay-span input-small"\n      type="number"\n      size="4"\n      min="1"\n      step="1"\n      value="{{model.delaySpan}}">\n    days\n  </span>\n  <select name="delay" class="delay input-xsmall">\n    <option value="now">immediately</option>\n    <option value="later">later</option>\n  </select>\n</p>\n<div class="query-wrap">\n  <ul class="filters-container">\n    <li class="filter-control add">\n      <button class="btn add-btn"><i class="add-i">+</i></button>\n    </li>\n  </ul>\n</div>\n<hr>\n<p class="segment">\n  <span class="add-btn">\n    <button><i class="add-i">+</i></button> Add Filter\n  </span>\n</p>\n'}),define("auto-message-query-widget",["underscore","backbone","mustache","auto-message-filter-view","text!templates/auto-message/query-widget.mustache"],function(_,Backbone,Mustache,FilterView,Template){var AutoMessageQueryWidget=function(options){Backbone.View.call(this,options)};return _.extend(AutoMessageQueryWidget.prototype,Backbone.View.prototype,{tagName:"div",className:"query-widget",events:{"change select.delivery":"changeDelivery","change select.delay":"changeDelay","change input.delay-span":"changeDelaySpan","click .add-btn":"onAddClicked"},initialize:function(options){this.filterMap={},this.model=options.model,this.autoMessage=options.autoMessage,this.avaliableFilter=options.avaliableFilter,this.companyFilter=options.companyFilter,this.listenTo(this.model,"add",this.addFilter),this.listenTo(this.model,"remove",this.removeFilter),this.listenTo(this.model,"add",this.populateFilterCount),this.listenTo(this.model,"remove",this.populateFilterCount),this.listenTo(this.autoMessage,"change:delay",this.onDelayChange)},render:function(){return this.$el.append(Mustache.render(Template,{model:this.autoMessage.attributes,deliveries:this.autoMessage.getDeliveries()})),this.filterDelivery=this.$(".filter-delivery"),this.filterContainer=this.$(".filters-container"),this.addBtn=this.$(".filter-control.add"),this.model.each(this.addFilter,this),this.onDelayChange(this.autoMessage),this.populateFilterCount(),this},addFilter:function(filter){var filterView=new FilterView({model:filter,avaliableFilter:this.avaliableFilter,companyFilter:this.companyFilter});this.filterMap[filter.cid]=filterView,this.addBtn.before(filterView.render().el)},removeFilter:function(filter){this.filterMap[filter.cid].remove(),delete this.filterMap[filter.cid]},populateFilterCount:function(){var isEmptyQuery=0===this.model.length;this.filterContainer.toggleClass("empty",isEmptyQuery)},onDelayChange:function(model){this.filterDelivery.removeClass("now later"),this.filterDelivery.addClass(model.get("delay"))},onAddClicked:function(){this.model.add({})},changeDelivery:function(e){this.autoMessage.set("delivery",e.target.value)},changeDelay:function(e){this.autoMessage.set("delay",e.target.value)},changeDelaySpan:function(e){var val=e.target.value;val=parseInt(val?val:0,10),this.autoMessage.set("delaySpan",val)}}),AutoMessageQueryWidget}),define("text!templates/auto-message/message-recurrence.mustache",[],function(){return'<p class="message-recurrence {{frequency}} ">\n  Send this message to the same user\n  <select class="frequency">\n    <option value="once"\n      {{#frequency=once}}selected{{/frequency=once}}>only once</option>\n    <option value="every"\n      {{#frequency=every}}selected{{/frequency=every}}>every</option>\n  </select>\n  <span class="threshold-container">\n  <input\n    class="threshold"\n    type="number"\n    size="2"\n    min="1"\n    max="180"\n    step="1"\n    value="{{threshold}}">\n  day<span class="day-plural">s</span>\n  </span>\n</p>\n'}),define("auto-message-recurrence-view",["underscore","backbone","mustache","text!templates/auto-message/message-recurrence.mustache"],function(_,Backbone,Mustache,template){var RecurrenceView=Backbone.View.extend({tagName:"div",className:"recurrence",events:{"change .frequency":"updateAttributes","change .threshold":"updateAttributes"},initialize:function(options){this.model=options.model,this.listenTo(this.model,"change:frequency",this.render),this.listenTo(this.model,"change:threshold",this.onThresholdChange)},render:function(){return this.$el.html(Mustache.render(template,this.model.attributes)),this.frequencySelect=this.$(".frequency"),this.thresholdInput=this.$(".threshold"),this.pluralDaySpan=this.$(".day-plural"),this.populateFrequency(),this},updateAttributes:function(){var frequency=this.frequencySelect.val(),threshold=parseInt(this.thresholdInput.val());this.model.set({frequency:frequency,threshold:threshold});var isDayPlural=1!==threshold;this.pluralDaySpan.toggleClass("active",isDayPlural)},populateFrequency:function(){var frequency=this.model.get("frequency");this.frequencySelect.val(frequency)},onThresholdChange:function(){this.model.isValid()?this.thresholdInput.removeClass("warning"):this.thresholdInput.addClass("warning")}});return RecurrenceView}),define("message-insert-var",["underscore","backbone"],function(_,Backbone){var MessageInsertVarView=function(options){Backbone.View.call(this,options)};return _.extend(MessageInsertVarView.prototype,Backbone.View.prototype,{events:{"click a[data-toggle='insert-var']":"onInsertUserVarClick"},initialize:function(){},render:function(){this.contentTextArea=this.$("textarea.content-textarea")},onInsertUserVarClick:function(e){e.preventDefault();var node,tDOM,val,endIndex,textToInsert;node=$(e.target),tDOM=this.contentTextArea[0],val=this.contentTextArea.val(),textToInsert=node.data("insert-val"),0!==textToInsert.length&&(void 0!==tDOM.selectionStart&&void 0!==tDOM.selectionEnd?(endIndex=tDOM.selectionEnd,this.contentTextArea.val(val.slice(0,tDOM.selectionStart)+textToInsert+val.slice(endIndex)),tDOM.selectionStart=tDOM.selectionEnd=endIndex+textToInsert.length):this.contentTextArea.val(val+" "+textToInsert),this.contentTextArea.trigger("keyup"))}}),MessageInsertVarView}),define("views/message-base",["backbone"],function(Backbone){var MessageBaseView=Backbone.View.extend({className:"cit-msg-content",hide:function(){this.$el.hide()},show:function(){this.$el.show()},isHidden:function(){return this.$el.is(":hidden")}});return MessageBaseView}),define("views/prompt-close",["backbone"],function(Backbone){var PromptCloseView=Backbone.View.extend({tagName:"span",className:"cit-close",events:{click:"onCloseClicked"},initialize:function(options){this.parent=options.parent},render:function(){return this.$el.html("&#215;"),this},onCloseClicked:function(){this.parent.closeMessageWindow()}});return PromptCloseView}),define("text!templates/prompt-head.html",[],function(){return'<p>\n  <img class="agent-avatar" src="<%= agentImg %>">\n  <span class="label">From</span>\n  <span class="agent-detail">\n    <strong class="agent-name"><%= agent %></strong>\n    from <%= appName %>\n  </span>\n</p>\n<p class="subject-container">\n  <span class="label">Subject</span>\n  <span class="subject"><%= subject %></span>\n</p>\n'}),define("views/prompt-head",["underscore","backbone","text!templates/prompt-head.html"],function(_,Backbone,PromptHeadHTML){var PromptHeadView=Backbone.View.extend({className:"cit-head",template:_.template(PromptHeadHTML),events:{"click .cit-close":"closeMessageWindow"},initialize:function(options){this.parent=options.parent},render:function(){var attributes=this.model.attributes;return this.$el.html(this.template({agent:attributes.agent.name,agentImg:attributes.agent.avatar,appName:attributes.app,subject:attributes.subject})),this.agentNameSpan=this.$(".agent-name"),this.agentAvatarImg=this.$("img.agent-avatar"),this.subjectSpan=this.$(".subject"),this},onAgentChange:function(){var agent=this.model.get("agent");this.agentNameSpan.text(agent.name),this.agentAvatarImg.attr("src",agent.avatar)},onSubjectChange:function(){var subject=this.model.get("subject");this.subjectSpan.text(subject)}});return PromptHeadView}),define("AppSetting",[],function(){var baseUrl="http://app.retain.dev:80";return{socketIoUrl:baseUrl+"/",serverUrl:baseUrl+"/api",pingUrl:baseUrl+"/api/users/ping",emailLeadFormUrl:baseUrl+"/api/app/<%=app_uid%>/form/lead.json",evtUrl:baseUrl+"/api/events",configUrl:baseUrl+"/api/app/<%=app_uid%>/config",widgetConfiguredUrl:baseUrl+"/api/app/<%=app_uid%>/widget_configured",baseUrl:baseUrl}}),define("AppClient",["require","exports","module","underscore","jquery","backbone"],function(require,exports,module){var app=(require("underscore"),require("jquery"),require("backbone"),module.exports);app.root="/"}),define("views/prompt-body",["backbone","AppSetting","AppClient"],function(Backbone,AppSetting,app){var PromptBodyView=Backbone.View.extend({className:"cit-body",events:{"click a":"onContentLinkClicked"},initialize:function(options){this.parent=options.parent,this.processed=options.processed||!1},render:function(){return this.onContentChange(),this},onContentChange:function(model,content){content||(content=this.model.get("content"),finalContent=this.processContent(content));var finalContent=this.processContent(content);this.$el.html(finalContent)},processContent:function(content){var finalContent="";return this.processed?content:(content&&(finalContent=content.replace(/\n/g,"<br>")),finalContent)},onContentLinkClicked:function(e){e.preventDefault();var $link,url,data;$link=Backbone.$(e.target),url=$link.attr("href"),data=app.citofono.getUserData(),data.message_id=this.model.get("id"),Backbone.$.ajax({type:"PUT",url:AppSetting.baseUrl+"/api/user/message/clicked",data:JSON.stringify(data),contentType:"application/json; charset=utf-8"}),window.open(url,"_blank")}});return PromptBodyView}),define("text!templates/prompt-footer.html",[],function(){return'<textarea class="cit-reply" placeholder="User Response"></textarea>\n<button class="cit-submit">Submit</button>\n'}),define("views/prompt-footer",["jquery","underscore","backbone","message","text!templates/prompt-footer.html","AppSetting","AppClient"],function($,_,Backbone,Message,PromptFooterHTML,AppSetting,app){var PromptFooterView=Backbone.View.extend({className:"cit-footer",events:{"key .cit-reply":"stopPropagation","keydown .cit-reply":"stopPropagation","keyup .cit-reply":"stopPropagation","click .cit-submit":"submitReply","keydown .cit-submit":"submitReply"},initialize:function(options){this.parent=options.parent;var shouldBindSubmit=options.shouldBindSubmit;void 0===shouldBindSubmit&&(shouldBindSubmit=!0),this.shouldBindSubmit=shouldBindSubmit,this.submittingMessage=null},render:function(){return this.$el.html(PromptFooterHTML),this.replyTextArea=this.$(".cit-reply"),this.submitButton=this.$(".cit-submit"),this},submitReply:function(){if(this.shouldBindSubmit&&null===this.submittingMessage){var button=this.submitButton;this.submittingMessage=this.doSubmitReply(button),this.submittingMessage.always(function(){this.submittingMessage=null})}},doSubmitReply:function(button){var data=app.citofono.getUserData();return data.message_id=this.model.get("id"),data.message=new Message({content:this.replyTextArea.val(),status:"sent",delivery:"app"}),$.ajax({type:"POST",url:AppSetting.baseUrl+"/api/messages",data:JSON.stringify(data),contentType:"application/json; charset=utf-8",context:this,beforeSend:function(){button.html("Loading"),button.attr("disabled",!0)},success:function(data){window.alert(data.message?data.message:"Fail connect to server"),data.success&&this.parent.onSubmitSucceeded()},error:function(){window.alert("Fail connect to server")},complete:function(){button.html("Submit"),button.removeAttr("disabled")}})}});return PromptFooterView}),define("message-content",["underscore","views/message-base","views/prompt-close","views/prompt-head","views/prompt-body","views/prompt-footer"],function(_,MessageBaseView,PromptCloseView,PromptHeadView,PromptBodyView,PromptFooterView){var MessageContentView=MessageBaseView.extend({className:"cit-msg-content",initialize:function(options){var childOptions=_.extend({},options,{parent:this});this.citCloseView=new PromptCloseView(childOptions),this.citHeadView=new PromptHeadView(childOptions),this.citBodyView=new PromptBodyView(childOptions),this.citFooterView=new PromptFooterView(childOptions)},render:function(){var $el=this.$el;return $el.empty(),$el.append(this.citCloseView.render().$el),$el.append(this.citHeadView.render().$el),$el.append(this.citBodyView.render().$el),$el.append(this.citFooterView.render().$el),this},onAgentChange:function(model,agent){this.citHeadView.onAgentChange(model,agent)},onSubjectChange:function(model,subject){this.citHeadView.onSubjectChange(model,subject)},onContentChange:function(model,content){this.citBodyView.onContentChange(model,content)},closeMessageWindow:function(){this.hide()},onSubmitSucceeded:function(){this.closeMessageWindow()}});return MessageContentView}),define("views/message-prompt",["message-content"],function(MessageContentView){var MessagePromptView=MessageContentView.extend({className:"cit-msg-content prompt"});return MessagePromptView}),define("text!templates/message-email.html",[],function(){return'<div class="cit-head">\n  <p>\n    <span class="label">From</span>\n    <span class="agent">Rick Mak</span>\n  </p>\n  <p>\n    <span class="label">Subject</span>\n    <span class="cit-subject">Subject</span>\n  </p>\n</div>\n<div class="cit-body">\n<!-- This body content in a separate file for actual email delivery reuse -->\n</div>\n'}),define("text!templates/email-body.html",[],function(){return'<!-- underscode template for email content rendering -->\n<div style="">\n  <div class="cit-mail-body">\n    <%= content %>\n  </div>\n</div>'}),define("message-email",["underscore","backbone","moment","text!templates/message-email.html","text!templates/email-body.html"],function(_,Backbone,moment,messageEmail,emailBody){var MessageTemplate=_.template(messageEmail),BodyTemplate=_.template(emailBody),MessageEmailView=function(options){Backbone.View.call(this,options)};return _.extend(MessageEmailView.prototype,Backbone.View.prototype,{className:"cit-msg-email",initialize:function(options){this.model=options.model,this.processed=options.processed?!0:!1},render:function(){this.$el.append(MessageTemplate()),this.subjectDiv=this.$(".cit-subject"),this.contentDiv=this.$(".cit-body"),this.agentName=this.$(".agent"),this.onAgentChange(this.model,this.model.get("agent")),this.onSubjectChange(this.model,this.model.get("subject")),this.onContentChange(this.model,this.model.get("content"))
},onAgentChange:function(model,agent){this.agentName.text(agent.name)},onSubjectChange:function(model,subject){var text="Untitled";subject&&(text=subject),this.subjectDiv.text(text)},onContentChange:function(model,content){var finalContent=this.processContent(content);this.contentDiv.html(BodyTemplate({agent:this.model.get("agent").name,agentImg:this.model.get("agent").avatar,app:this.model.get("app"),sentAt:moment().format("ll"),content:finalContent}))},processContent:function(content){var finalContent="";return this.processed?content:(content&&(finalContent=content.replace(/\n/g,"<br>")),finalContent)}}),MessageEmailView}),define("views/message-growl",["message-content"],function(MessageContentView){var MessageGrowlView=MessageContentView.extend({className:"cit-msg-content growl"});return MessageGrowlView}),define("text!templates/email-lead-footer.html",[],function(){return'<input class="cit-reply" type="email" placeholder="your_email@example.com">\n<button class="cit-submit">Submit</button>\n'}),define("views/email-lead-footer",["jquery","underscore","backbone","message","views/prompt-footer","text!templates/email-lead-footer.html","AppSetting","AppClient"],function($,_,Backbone,Message,PromptFooterView,EmailLeadFooterHTML,AppSetting,app){var EmailLeadFooterView=PromptFooterView.extend({events:_.extend({},PromptFooterView.events,{"keydown.submit .cit-reply":"submitOnEnter"}),initialize:function(options){this.parent=options.parent;var shouldBindSubmit=options.shouldBindSubmit;void 0===shouldBindSubmit&&(shouldBindSubmit=!0),this.shouldBindSubmit=shouldBindSubmit,this.submittingMessage=null},render:function(){return this.$el.html(EmailLeadFooterHTML),this.replyInput=this.$(".cit-reply"),this.submitButton=this.$(".cit-submit"),this},doSubmitReply:function(button){var email=this.replyInput.val().trim();button.prop("disabled",!0);var deferred=app.citofono.to_email_lead(email,this);return deferred.always(function(){button.prop("disabled",!1)}),deferred.then(function(){this.parent.onSubmitSucceeded()},function(jqXHR){var data=jqXHR.responseJSON||{};_.isEmpty(data.errors)&&(data.errors=[{message:"Failed to connect to server"}]),_.each(data.errors,function(error){window.alert(error.message)})}),deferred},submitOnEnter:function(e){13===e.keyCode&&this.submitReply()}});return EmailLeadFooterView}),define("views/message-email-lead",["underscore","backbone","views/message-base","message-content","views/prompt-close","views/prompt-head","views/prompt-body","views/email-lead-footer","AppClient"],function(_,Backbone,MessageBaseView,MessageContentView,PromptCloseView,PromptHeadView,PromptBodyView,EmailLeadFooterView,app){var MessageEmailLeadView=MessageContentView.extend({className:"cit-msg-content email-lead",initialize:function(options){var childOptions=_.extend({},options,{parent:this});this.citCloseView=new PromptCloseView(childOptions),this.citHeadView=new PromptHeadView(childOptions),this.citBodyView=new PromptBodyView(childOptions),this.citFooterView=new EmailLeadFooterView(childOptions)},onSubmitSucceeded:function(){var resultMessage,attrs=this.model.attributes;resultMessage={agent:attrs.agent,content:attrs.response_content,delivery:"email-lead-result"},this.hide(),app.citofono.messages.push(resultMessage),app.citofono.showMessage()},closeMessageWindow:function(){this.hide()}});return MessageEmailLeadView}),define("views/message-email-lead-result",["underscore","views/message-base","views/prompt-close","views/prompt-head","views/prompt-body"],function(_,MessageBaseView,PromptCloseView,PromptHeadView,PromptBodyView){var MessageEmailLeadResultView=MessageBaseView.extend({className:"cit-msg-content email-lead cit-result",initialize:function(options){var childOptions=_.extend({},options,{parent:this});this.citCloseView=new PromptCloseView(childOptions),this.citHeadView=new PromptHeadView(childOptions),this.citBodyView=new PromptBodyView(childOptions)},render:function(){var $el=this.$el;return $el.empty(),$el.append(this.citCloseView.render().$el),$el.append(this.citHeadView.render().$el),$el.append(this.citBodyView.render().$el),this},onAgentChange:function(model,agent){this.citHeadView.onAgentChange(model,agent)},onContentChange:function(model,content){this.citBodyView.onContentChange(model,content)},closeMessageWindow:function(){this.hide()}});return MessageEmailLeadResultView}),define("views/message-email-lead-preview",["jquery","underscore","backbone","mustache","views/message-email-lead","views/message-email-lead-result"],function($,_,Backbone,Mustache,MessageEmailLeadView,MessageEmailLeadResultView){var MessageEmailLeadPreview=Backbone.View.extend({stepTemplate:Mustache.render.bind(null,'<p class="email-lead-preview-step">Step {{step}}</p>'),initialize:function(options){var stepTwoOptions,stepTwoModel=options.model.clone();stepTwoModel.set("content",stepTwoModel.get("response_content")),stepTwoOptions=_.extend({},options,{model:stepTwoModel}),this.stepOneView=new MessageEmailLeadView(options),this.stepTwoView=new MessageEmailLeadResultView(stepTwoOptions),this.views=[this.stepOneView,this.stepTwoView]},render:function(){return this.$el.append($(this.stepTemplate({step:1}))),this.$el.append(this.stepOneView.render().$el),this.$el.append($(this.stepTemplate({step:2}))),this.$el.append(this.stepTwoView.render().$el),this},remove:function(){_.each(this.views,function(view){view.remove()}),this.$el.empty()},onAgentChange:function(model,agent){_.each(this.views,function(view){view.onAgentChange(model,agent)})},onSubjectChange:function(){},onContentChange:function(model,content){this.stepOneView.onContentChange(model,content)},onResponseContentChange:function(model,content){this.stepTwoView.onContentChange(model,content)}});return MessageEmailLeadPreview}),define("message-preview",["underscore","backbone","views/message-prompt","message-email","views/message-growl","views/message-email-lead-preview"],function(_,Backbone,MessagePromptView,MessageEmailView,MessageGrowlView,MessageEmailLeadPreview){var MessagePreview=function(options){Backbone.View.call(this,options)};return _.extend(MessagePreview.prototype,Backbone.View.prototype,{initialize:function(options){this.model=options.model,this.model.on("change:agent",this.onAgentChange,this),this.model.on("change:delivery",this.onDeliveryChange,this),this.model.on("change:subject",this.onSubjectChange,this),this.model.on("change:content",this.onContentChange,this),this.model.on("change:response_content",this.onResponseContentChange,this),this.model.on("change:previewUser",this.changePreviewValMap,this),this.shouldBindSubmit=options.shouldBindSubmit,this.previewValMap=options.previewValMap?options.previewValMap:{},this.bottomSize=options.bottomSize?options.bottomSize:null,this.processed=options.processed?!0:!1,null!==this.bottomSize?(this.resize=_.bind(this.resize,this),$(window).on("resize",this.resize)):this.resize=function(){}},remove:function(){Backbone.View.prototype.remove.call(this),this.actualView.remove()},render:function(){this.$(".loading").remove(),this.onDeliveryChange(this.model,this.model.get("delivery")),this.onAgentChange(this.model,this.model.get("agent")),this.onSubjectChange(this.model,this.model.get("subject")),this.onContentChange(this.model,this.model.get("content")),this.onResponseContentChange(this.model,this.model.get("response_content")),this.resize()},resize:function(){this.$el.height(window.innerHeight-this.bottomSize)},viewKlass:function(delivery){return{prompt:MessagePromptView,growl:MessageGrowlView,"email-lead":MessageEmailLeadPreview,email:MessageEmailView}[delivery]},onDeliveryChange:function(model,delivery){var Klass=this.viewKlass(delivery);this.actualView&&this.actualView.remove(),this.actualView=new Klass({model:this.model,shouldBindSubmit:this.shouldBindSubmit,processed:this.processed}),this.actualView.render(),this.$el.append(this.actualView.el),this.onAgentChange(this.model,this.model.get("agent")),this.onSubjectChange(this.model,this.model.get("subject")),this.onContentChange(this.model,this.model.get("content")),this.onResponseContentChange(this.model,this.model.get("response_content"))},onAgentChange:function(model,agent){this.actualView.onAgentChange(model,agent)},onSubjectChange:function(model,subject){"function"==typeof this.actualView.onSubjectChange&&this.actualView.onSubjectChange(model,this.transContent(subject))},onContentChange:function(model,content){this.actualView.onContentChange(model,this.transContent(content))},onResponseContentChange:function(model,content){this.actualView.onResponseContentChange&&this.actualView.onResponseContentChange(model,this.transContent(content))},transContent:function(content){var previewValMap=this.previewValMap;return previewValMap["agent.name"]=this.model.get("agent").name,content?content.replace(/\{\{ *([._A-Za-z0-9\(\)]+|"[._ A-Za-z0-9\(\)]+") *(?:\| *fallback: *"(.*?)")? *\}\}/g,function(match,varName,fallback){var result=previewValMap[varName];return result?result:fallback?fallback:""}):content},changePreviewValMap:function(model,previewValMap){this.previewValMap=previewValMap,this.render()}}),MessagePreview}),define("text!templates/auto-message/message-widget.mustache",[],function(){return'<p>\n  <span class="label">From</span>\n  <select name="agent_id" class="agent">\n    <option\n      value="null"\n      data-name="{{app.name}}"\n      data-avatar="{{app.avatar_url}}"\n    >{{app.name}}</option>\n    {{#agents}}\n    <option value="{{id}}"\n      data-name="{{name}}"\n      data-avatar="{{avatar_url}}"\n      >{{name}}</option>\n    {{/agents}}\n  </select>\n</p>\n<p class="subject-container">\n  <span class="label">Subject</span>\n  <input type="text" name="subject"\n    class="subject input-xxlarge"\n    value="{{model.subject}}">\n</p>\n\n<div class="message-content">\n  <div class="content-editor">\n    <p class="label">Content</p>\n    <div class="context-area content">\n    {{=<% %>=}}\n      <textarea class="content-textarea content"\n        name="content"><%model.content%>\n</textarea>\n    </div>\n    <p class="label response">Response</p>\n    <div class="context-area response">\n      <textarea class="content-textarea response"\n        name="response"><%model.response_content%>\n</textarea>\n<%={{ }}=%>\n    </div>\n  </div>\n  <div class="content-preview">\n    \n  </div>\n</div>\n<div class="recurrence"></div>\n'}),define("auto-message-message-widget",["underscore","backbone","mustache","auto-message-recurrence-view","message-insert-var","message-preview","text!templates/auto-message/message-widget.mustache"],function(_,Backbone,Mustache,RecurrenceView,MessageInsertVarView,MessagePreview,Template){var AutoMessageMessageWidget=function(options){Backbone.View.call(this,options)};return _.extend(AutoMessageMessageWidget.prototype,Backbone.View.prototype,{tagName:"div",className:"message-widget",events:{"change select.agent":"onAgentChange","change input.subject":"onSubjectChange","keyup textarea.content-textarea.content":"onContentChange","keyup textarea.content-textarea.response":"onResponseContentChange"},initialize:function(options){this.model=options.model,this.agents=options.agents,this.app=options.app,this.listenTo(this.model,"change:delivery",this.onDeliveryChange)},render:function(){this.$el.append(Mustache.render(Template,{model:this.model.attributes,app:this.app,agents:this.agents})),this.recurrenceView=new RecurrenceView({el:this.$(".recurrence"),model:this.model.get("recurrence")}),this.recurrenceView.render();var inserVarEl=Backbone.$(".insert-var-dropdown");return this.$(".context-area.content").prepend(inserVarEl.clone()),this.insertVarView=new MessageInsertVarView({el:this.$(".context-area.content")}),this.insertVarView.render(),this.$(".context-area.response").prepend(inserVarEl.clone()),this.insertResponseVarView=new MessageInsertVarView({el:this.$(".context-area.response")}),this.insertResponseVarView.render(),this.messagePreview=new MessagePreview({model:this.model,el:this.$(".content-preview"),shouldBindSubmit:!1,previewValMap:{}}),this.messagePreview.render(),this.agentSelect=this.$("select.agent"),this.agentSelect.val(""+this.model.get("agent_id")),this.onAgentChange(),this.onDeliveryChange(this.model),this},onAgentChange:function(){var option,name,avatar,val=this.agentSelect.val();option=this.agentSelect.find("option[value="+val+"]"),name=option.data("name"),avatar=option.data("avatar"),this.model.set("agent_id",val),this.model.set("agent",{name:name,avatar:avatar})},onSubjectChange:function(e){this.model.set("subject",e.target.value)},onContentChange:function(e){this.model.set("content",e.target.value)},onResponseContentChange:function(e){this.model.set("response_content",e.target.value)},onDeliveryChange:function(){var delivery=this.model.get("delivery");this.$el.removeClass("growl email-lead email prompt"),this.$el.addClass(delivery)}}),AutoMessageMessageWidget}),define("auto-message-editor",["underscore","backbone","mustache","text!templates/auto-message/editor.mustache","text!templates/auto-message/filter-editor.mustache","flash-view","auto-message-event-widget","auto-message-query-widget","auto-message-message-widget"],function(_,Backbone,Mustache,Template,FilterTemplate,flashView,EventWidget,QueryWidget,MessageWidget){var AutoMessageEditor=function(options){Backbone.View.call(this,options)};return _.extend(AutoMessageEditor.prototype,Backbone.View.prototype,{tagName:"section",className:"auto-message-editor",events:{"change .message-name":"changeName","click .status-control":"changeStatus","click .done":"clickDone"},initialize:function(options){this.model=options.model,this.eventNames=options.config.eventNames,this.avaliableFilter=options.config.avaliableFilter,this.companyFilter=options.config.companyFilter,this.agents=options.config.agents,this.app=options.config.app,this.listenTo(this.model,"change:status",this.onStatusChange),this.listenTo(this.model,"change:delivery",this.onDeliveryChange),this.listenTo(this.model,"sync:status",this.onStatusChange)},render:function(parent){parent.append(this.$el),parent.removeClass("loading");var tempalte={event:Template,filter:FilterTemplate}[this.model.get("editor_mode")];this.$el.html(Mustache.render(tempalte,{model:this.model.attributes,deliveryName:this.model.getDeliveryName()})),this.$el.addClass("type-"+this.model.get("editor_mode")),this.statusControl=this.$(".status-control"),this.deliveryName=this.$(".delivery-name"),"event"==this.model.get("editor_mode")&&(this.eventWidget=new EventWidget({model:this.model,el:this.$(".event-match .widget"),eventNames:this.eventNames}),this.eventWidget.render()),this.queryWidget=new QueryWidget({el:this.$(".filter-match .widget"),model:this.model.get("query"),autoMessage:this.model,avaliableFilter:this.avaliableFilter,companyFilter:this.companyFilter}),this.queryWidget.render(),this.messageWidget=new MessageWidget({el:this.$(".message-match .widget"),model:this.model,agents:this.agents,app:this.app}),this.messageWidget.render()},changeName:function(e){this.model.set("name",e.target.value)},saveModel:function(target){this.model.save({},{success:function(){target.removeClass("loading"),flashView.render("Auto-message saved successfully."),console.log("success")},error:function(){target.removeClass("loading"),flashView.render("Failed to save the auto-message!"),console.log("error")}})},changeStatus:function(){var target=Backbone.$(".status-control-wrap"),validate=this.model.validate();if(this.model.toggleStatus(),target.addClass("loading"),"stop"==this.model.get("notLive"))validate?(alert(validate),this.model.toggleStatus(),target.removeClass("loading")):this.saveModel(target);else{var sent_confirm=confirm("Make this auto-message live now?");sent_confirm?validate?(alert(validate),this.model.toggleStatus(),target.removeClass("loading")):this.saveModel(target):(this.model.toggleStatus(),target.removeClass("loading"))}},onStatusChange:function(model){"live"==model.get("status")?this.statusControl.addClass("live"):this.statusControl.removeClass("live")},onDeliveryChange:function(model){this.deliveryName.text(model.getDeliveryName())},section:function(section){this.$el.removeClass("event filter message"),this.$el.addClass(section),this.$("section.active").removeClass("active"),_.delay(_.bind(function(){this.addClass("active")},this.$("."+section+"-match")),300)},changeToStop:function(){this.model.set("notLive","stop"),this.statusControl.removeClass("draft").addClass("stop"),Backbone.$(".not-live",this.statusControl).text("Stop")},clickDone:function(e){var target=Backbone.$(e.target),validate=this.model.validate();if(target.addClass("loading"),validate)alert(validate),target.removeClass("loading");else{if("draft"==this.model.get("status")){var sent_confirm=confirm("Auto-message created.\nDo you want to make it live and start sending to users?");sent_confirm&&(this.model.toggleStatus(),this.changeToStop())}this.saveModel(target)}}}),AutoMessageEditor}),define("auto-message-router",["backbone","channel","auto-message-creator","auto-message-editor"],function(Backbone,Channel,AutoMessageCreator,AutoMessageEditor){var AutoMessageRouter=Backbone.Router.extend({routes:{"app/:appId/message/auto/new":"newMessage","app/:appId/messages/auto/event":"viewEdit","app/:appId/messages/auto/filter":"viewEdit","app/:appId/messages/auto/message":"viewEdit","app/:appId/message/auto/:id/edit":"viewEdit","app/:appId/message/auto/:id/edit/event":"viewEdit","app/:appId/message/auto/:id/edit/filter":"viewEdit","app/:appId/message/auto/:id/edit/message":"viewEdit"},initialize:function(options){this.editView=null,this.model=options.model,this.config=options.config},execute:function(callback,args){console.log(args),this.appID=args[0],callback&&callback.apply(this,args)},renderEditor:function(model){return this.editView||(this.editView=new AutoMessageEditor({model:model,config:this.config}),this.editView.render(Backbone.$("#auto-message-form")),this.listenTo(this.editView,"navigate",this.navigateToEditor)),Channel.publish("AutoMessageFormInited"),this.editView},newMessage:function(){var newView=new AutoMessageCreator({appID:this.appID,currentAgent:this.config.currentAgent});newView.render(Backbone.$("#auto-message-form")),this.listenTo(newView,"created",function(model){newView.remove(),this.navigateToEditor(model)})},navigateToEditor:function(model){this.model=model;var url=model.url(),editorMode=model.get("editor_mode");this.model.isNew()||(url+="/edit"),editorMode&&(url+="/"+editorMode),this.navigate(url,{trigger:!0,replace:!0})},viewEdit:function(){this.renderEditor(this.model)}});return AutoMessageRouter}),define("auto-message-wizard",["underscore","backbone"],function(_,Backbone){var AutoMessageWizard=function(options){Backbone.View.call(this,options)};return _.extend(AutoMessageWizard.prototype,Backbone.View.prototype,{initialize:function(options){this.tabsSelector=options.tabs,this.tabs=this.$(options.tabs),this.switchTarget=_.bind(this.switchTarget,this),this.targetButton=Backbone.$(options.button)},remove:function(){Backbone.View.prototype.remove.call(this),this.targetButton=null,this.switchTarget=null,this.tabs=null},render:function(){this.target=this.tabs.filter(".active").data("target"),this.activeTarget=this.$(this.target),this.activeTarget.addClass("active")},delegateEvents:function(){this.$el.on("click",this.tabsSelector,this.switchTarget)},switchTarget:function(e){var node=$(e.target);this.target=node.data("target"),node.hasClass("active")||this.syncButton()},syncButton:function(){this.targetButton&&(this.targetButton.attr("value",this.target),this.targetButton.click())}}),AutoMessageWizard}),define("text!templates/auto-message/view.mustache",[],function(){return'{{#hasEvents}}\n  <h5 class="rules">Events</h5>\n  <p class="events">When user trigger <strong>{{primEvent}}</strong></p>\n  {{#posEvents}}\n  <p class="events">\n    and <strong>{{evtName}}</strong> happened\n    {{#after}}\n      after last {{primEvent}}\n    {{/after}}\n    {{#alltime}}\n      anytime\n    {{/alltime}}\n  </p>\n  {{/posEvents}}\n  {{#negEvents}}\n  <p class="events">\n    and <strong>{{evtName}}</strong>\n    never happened \n    {{#after}}\n      after last {{primEvent}}\n    {{/after}}\n  </p>\n  {{/negEvents}}\n{{/hasEvents}}\n\n{{#hasFilters}}\n  <h5 class="rules\n    {{#hasEvents}}has-events{{/hasEvents}}\n  ">Rules</h5>\n  {{#filters}}\n  <p class="filters">\n    <strong>{{name}}</strong>\n    {{operator}}\n    <strong>{{value}}</strong>\n    {{suffix}}\n  </p>\n  {{/filters}}\n{{/hasFilters}}\n'}),define("auto-message-view",["underscore","backbone","mustache","auto-message","text!templates/auto-message/view.mustache"],function(_,Backbone,Mustache,AutoMessageModel,Template){var AutoMessageView=function(options){Backbone.View.call(this,options)};return _.extend(AutoMessageView.prototype,Backbone.View.prototype,{tagName:"div",className:"auto-message-viewer",events:{},initialize:function(options){this.eventNames=options.eventNames,this.filterNames=options.filterNames,this.model=options.model},render:function(){var filters,primEvent=null,posEvents=[],negEvents=[];"event"==this.model.get("editor_mode")&&(primEvent=this.eventName(this.model.get("primEvent")),posEvents=_.map(this.model.get("posEvents").models,this.subEvt,this),negEvents=_.map(this.model.get("negEvents").models,this.subEvt,this)),filters=_.map(this.model.get("query").models,this.filter,this),this.$el.html(Mustache.render(Template,{hasEvents:null!==primEvent,primEvent:primEvent,posEvents:posEvents,negEvents:negEvents,hasFilters:0!==_.size(filters),filters:filters}))},eventName:function(key){var result;return result=_.find(this.eventNames,function(evt){return key==evt.key}),result?result.name:key},subEvt:function(subEvt){return{evtName:this.eventName(subEvt.get("evt_name")),after:"after"==subEvt.get("time_frame"),alltime:"alltime"==subEvt.get("time_frame")}},filter:function(filter){var result,mapping_op={user_type:{contain_any:"is"},string:{equal:"is",not_equal:"is not",start_with:"starts with",not_start_with:"does not start with",end_with:"ends with",not_end_with:"does not end with",contains:"contains"},numeric:{gt:"more than",equal:"exactly",lt:"less than"},date:{day_ago_gt:"more than",day_ago_eq:"exactly",day_ago_lt:"less than",day_after:"after",day_on:"on",day_before:"before"},"boolean":{equal:"is"},birthday:{same_day_of_year:"is"}};if(result=_.find(this.filterNames,function(f){var field=filter.get("field");return"event"==f.data_type?field==f.count.key?!0:field==f.first_ocurred_at.key?!0:field==f.last_ocurred_at.key?!0:!1:f.key==field})){var operator,name=result.name,data_type=result.data_type,field=filter.get("field"),operand=filter.get("operand"),suffix="";return"event"==result.data_type&&(field==result.count.key?(data_type="numeric",name=result.name+" Count"):field==result.first_ocurred_at.key?(data_type="date",name=result.name+" First Time"):field==result.last_ocurred_at.key&&(data_type="date",name=result.name+" Last Time")),operator=mapping_op[data_type][filter.get("operator")],_.contains(["day_ago_gt","day_ago_eq","day_ago_lt"],operator)&&(suffix=operand>1?"days ago":"day ago"),"exists-true"==filter.get("operator")&&(operator="has",operand="any value"),"exists-false"==filter.get("operator")&&(operator="is",operand="Unknown"),{name:name,operator:operator,value:operand,suffix:suffix}}}}),AutoMessageView}),define("text!templates/message-form-header.html",[],function(){return'<header class="top-header <%= mode %>">\n  <h3>\n    Send message based on these rules:\n    <a class="how-to-track-events" href="http://help.retain.cc/tracking-events-in-retain-cc/" target="_blank"><span class="label label-default">How to track events?</span></a>\n  </h3>\n</header>\n'}),define("views/message-form-header",["underscore","backbone","text!templates/message-form-header.html"],function(_,Backbone,_MessageFormHeaderHTML){var MessageFormHeader=Backbone.View.extend({tagName:"section",className:"message-header",template:_.template(_MessageFormHeaderHTML),render:function(){return this.$el.html(this.template(this.model.attributes)),this}});return MessageFormHeader}),define("text!templates/filter-control.html",[],function(){return'<li class="filter-control">\n  <select class="filter-field">\n  </select>\n  <div class="string-filter">\n    <select class="filter-operator">\n      <option value="equal">Is</option>\n      <option value="not_equal">Is not</option>\n      <option value="start_with">Starts with</option>\n      <option value="not_start_with">Does not start with</option>\n      <option value="end_with">Ends with</option>\n      <option value="not_end_with">Does not end with</option>\n      <option value="contains">Contains</option>\n      <option value="exists-true" data-input="exists-operator">Has any value</option>\n      <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n    </select>\n    <br>\n    <input class="filter-operand" type="text">\n  </div>\n  <div class="date-filter">\n    <select class="filter-operator">\n      <optgroup label="Relative">\n        <option value="day_ago_lt" data-input="ago">Less than</option>\n        <option value="day_ago_eq" data-input="ago">Exactly</option>\n        <option value="day_ago_gt" data-input="ago">More than</option>\n      </optgroup>\n      <optgroup label="Absolute">\n        <option value="day_after" data-input="abs">After</option>\n        <option value="day_on" data-input="abs">On</option>\n        <option value="day_before" data-input="abs">Before</option>\n        <option value="exists-true" data-input="exists-operator">Has any value</option>\n        <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n      </optgroup>\n    </select>\n    <br>\n    <span class="ago">\n      <input class="filter-operand" type="number">days ago\n    </span>\n    <span class="abs">\n      <input class="filter-operand abs-date" type="text">\n    </span>\n  </div>\n  <div class="numeric-filter">\n    <select class="filter-operator">\n      <option value="gt">More than</option>\n      <option value="equal">Exactly</option>\n      <option value="lt">Less than</option>\n      <option value="exists-true" data-input="exists-operator">Has any value</option>\n      <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n    </select>\n    <br>\n    <input class="filter-operand" type="number">\n  </div>\n  <div class="boolean-filter">\n    <select class="filter-operator">\n      <option value="boolean-true">is True</option>\n      <option value="boolean-false">is False</option>\n      <option value="exists-true" data-input="exists-operator">Has Any Value</option>\n      <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n    </select>\n    <input type="hidden" value="" class="filter-operand" readonly>\n  </div>\n  <div class="birthday-filter">\n    <input type="hidden" value="same_day_of_year" class="filter-operator">\n    <select class="filter-operand">\n      <option value="_TODAY" selected>Is today</option>\n    </select>\n  </div>\n  <div class="user_type-filter">\n    <input type="hidden" value="contain_any" class="filter-operator" readonly data-input="user_type">\n    <select class="filter-operand">\n      <option value=\'["anonymous"]\'>Anonymous</option>\n      <option value=\'["email-lead"]\'>Email Lead</option>\n      <option value=\'["registered"]\'>Registered</option>\n    </select>\n  </div>\n  <div class="event-filter">\n    <select class="event-suffix">\n      <option value="_count">Count</option>\n      <option value="_first_ocurred_at">First Time</option>\n      <option value="_last_ocurred_at">Most Recent</option>\n    </select>\n    <div class="date-filter">\n      <select class="filter-operator">\n        <optgroup label="Relative">\n          <option value="day_ago_lt" data-input="ago">Less than</option>\n          <option value="day_ago_eq" data-input="ago">Exactly</option>\n          <option value="day_ago_gt" data-input="ago">More than</option>\n        </optgroup>\n        <optgroup label="Absolute">\n          <option value="day_after" data-input="abs">After</option>\n          <option value="day_on" data-input="abs">On</option>\n          <option value="day_before" data-input="abs">Before</option>\n          <option value="exists-true" data-input="exists-operator">Has any value</option>\n          <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n        </optgroup>\n      </select>\n      <br>\n      <span class="ago">\n        <input class="filter-operand" type="number">days ago\n      </span>\n      <span class="abs">\n        <input class="filter-operand abs-date" type="text">\n      </span>\n    </div>\n    <div class="numeric-filter">\n      <select class="filter-operator">\n        <option value="gt">More than</option>\n        <option value="equal">Exactly</option>\n        <option value="lt">Less than</option>\n        <option value="exists-true" data-input="exists-operator">Has any value</option>\n        <option value="exists-false" data-input="exists-operator">Is Unknown</option>\n      </select>\n      <br>\n      <input class="filter-operand" type="number">\n    </div>\n\n  </div>\n  <button class="delete-btn btn btn-red">Delete</button>\n</li>\n'}),define("filter-view",["underscore","backbone","filter","pikaday","text!templates/filter-control.html","text!templates/filter-control-option.html","text!templates/filter-control-company-option.html"],function(_,Backbone,Filter,Pikaday,filterControl,filterControlOption,filterControlCompanyOption){var ControlTemplate=_.template(filterControl),OptionTemplate=_.template(filterControlOption),CompanyOptionTemplate=_.template(filterControlCompanyOption),FilterView=function(options){Backbone.View.call(this,options)};return _.extend(FilterView.prototype,Backbone.View.prototype,{initialize:function(options){this.model=options.model,this.avaliableFilter=options.avaliableFilter,this.companyFilter=options.companyFilter,this.pikadays=[],this.model.on("change:field",this.onFieldChange,this),this.model.on("change:operator",this.syncOperandType,this),this.onRemoveClicked=_.bind(this.onRemoveClicked,this),this.onFieldClick=_.bind(this.onFieldClick,this),this.onEeventSuffixChange=_.bind(this.onEeventSuffixChange,this),this.onOperatorChange=_.bind(this.onOperatorChange,this),this.onOperandChange=_.bind(this.onOperandChange,this)},render:function(){var i=0,filterLength=this.avaliableFilter.length,companyLength=this.companyFilter.length;for(this.setElement(ControlTemplate()),this.filterField=this.$(".filter-field"),i=0;filterLength>i;i++)this.filterField.append(OptionTemplate({filter:this.avaliableFilter[i]}));for(this.filterField.append("<hr>"),i=0;companyLength>i;i++)this.filterField.append(CompanyOptionTemplate({filter:this.companyFilter[i]}));return this.pikadays[0]=new Pikaday({field:this.$("input.abs-date").get(0),format:"YYYY-MM-DD"}),this.pikadays[1]=new Pikaday({field:this.$("input.abs-date").get(1),format:"YYYY-MM-DD"}),console.log(this.model.getFieldGroup()),this.filterField.val(this.model.getFieldGroup()),this.onFieldChange(this.model,this.model.get("field")),this},remove:function(){Backbone.View.prototype.remove.call(this),this.model.off(null,null,this),this.pikadays=null,this.onRemoveClicked=null,this.onFieldClick=null,this.onOperatorChange=null,this.onOperandChange=null,this.activeFilter=null},delegateEvents:function(){this.undelegateEvents(),this.$el.on("click",".delete-btn",this.onRemoveClicked),this.$el.on("change",".filter-field",this.onFieldClick),this.$el.on("change",".event-suffix",this.onEeventSuffixChange),this.$el.on("change",".filter-operator",this.onOperatorChange),this.$el.on("change input",".filter-operand",this.onOperandChange)},onFieldChange:function(model,field){var operator=model.get("operator"),operand=model.get("operand");this.activeType=Filter.getType(field),this.activeFilter&&this.activeFilter.removeClass("active-filter"),this.model.isEvent()||"event"==this.activeType?(this.$(".event-filter").addClass("active-filter"),this.activeFilter=this.$(".event-filter ."+this.activeType+"-filter"),console.log(this.model.getEventSuffix()),this.$(".event-suffix").val(this.model.getEventSuffix()),this.activeFilter&&(this.activeFilter.addClass("active-filter"),this.$(".event-filter .active-filter .filter-operator").val(operator))):(this.activeFilter=this.$("."+this.activeType+"-filter"),this.activeFilter.addClass("active-filter"),this.$(".active-filter .filter-operator").val(operator)),"user_type"===this.activeType&&(operand=JSON.stringify(operand)),this.$(".active-filter .filter-operand").val(operand),this.syncOperandType(model,model.get("operator")),"birthday"===this.activeType&&this.model.set("operator","same_day_of_year"),"user_type"===this.activeType&&this.model.set("operator","contain_any")
},syncOperandType:function(model,operator){var newMode,val,mode=this.activeFilter.data("mode")||"";newMode=this.$(".active-filter option[value="+operator+"]").data("input"),newMode=newMode||"",newMode!==mode&&(this.activeFilter.removeClass(mode),this.activeFilter.addClass(newMode),this.activeFilter.data("mode",newMode),newMode&&(val=this.activeFilter.find("."+newMode+" input").val()),model.setOperand(val))},onRemoveClicked:function(){this.trigger("remove",this.model),this.model.destroy()},onFieldClick:function(e){this.model.set("field",e.target.value)},onEeventSuffixChange:function(e){this.model.setEventSuffix(e.target.value)},onOperatorChange:function(e){this.model.set("operator",e.target.value)},onOperandChange:function(e){var rVal;rVal="user_type"==this.activeType?JSON.parse(e.target.value):e.target.value,this.model.setOperand(rVal)}}),FilterView}),define("text!templates/query-container.html",[],function(){return'<header>\n  <h4>\n    <span class="and">And </span>User Profile<br>\n    <small>For matching user properties</small>\n  </h4>\n</header>\n<div class="query-wrap">\n  <ul class="filters-container">\n    <li class="filter-control add">\n      <button class="btn add-btn"><i class="add-i">+</i> Add</button>\n    </li>\n  </ul>\n</div>\n'}),define("query-view",["underscore","backbone","filter-view","text!templates/query-container.html"],function(_,Backbone,FilterView,_QueryContainer){var QueryContainer=_.template(_QueryContainer),QueryView=function(options){Backbone.View.call(this,options)};return _.extend(QueryView.prototype,Backbone.View.prototype,{tagName:"section",className:"query",initialize:function(options){this.filterMap={},this.query=options.query,this.avaliableFilter=options.avaliableFilter,this.companyFilter=options.companyFilter,this.messageMode=options.messageMode,this.query.on("add",this.addFilter,this),this.query.on("remove",this.removeFilter,this),this.onAddClicked=_.bind(this.onAddClicked,this),this.listenTo(this.messageMode,"change:mode",this.updateHeader)},render:function(){return this.$el.append(QueryContainer()),this.filterContainer=this.$(".filters-container"),this.addBtn=this.$(".filter-control.add"),this.query.each(this.addFilter,this),this},remove:function(){Backbone.View.prototype.remove.call(this),this.avaliableFilter=null,this.companyFilter=null,this.query.off(null,null,this),this.query=null,this.onAddClicked=null},delegateEvents:function(){this.undelegateEvents(),this.$el.on("click",".add-btn",this.onAddClicked)},addFilter:function(filter){var filterView=new FilterView({model:filter,avaliableFilter:this.avaliableFilter,companyFilter:this.companyFilter});this.filterMap[filter.cid]=filterView,this.addBtn.before(filterView.render().el)},removeFilter:function(filter){this.filterMap[filter.cid].remove(),delete this.filterMap[filter.cid]},updateHeader:function(){this.messageMode.event()?this.$el.addClass("event-query"):this.$el.removeClass("event-query")},onAddClicked:function(){this.query.add({})}}),QueryView}),define("query-result-view",["underscore","backbone"],function(_,Backbone){var QueryResultView=function(options){Backbone.View.call(this,options)};return _.extend(QueryResultView.prototype,Backbone.View.prototype,{tagName:"div",className:"query-result",events:{"click .count-container":"onClickExpand"},initialize:function(options){this.query=options.query,this.url=options.url,this.expanding=!1,this.update=_.debounce(this.update,300),this.doRender=_.bind(this.doRender,this),this.resize=_.bind(this.resize,this),this.query.on("change",this.update,this),$(window).on("resize",this.resize)},render:function(){return this.update(),this.resize(),this},resize:function(){this.expandHeight=window.innerHeight-550,this.syncSize()},remove:function(){Backbone.View.prototype.remove.call(this)},update:function(){Backbone.ajax(this.url,{data:"q="+encodeURIComponent(this.query.toFilterString())}).done(this.doRender)},doRender:function(data){this.$el.html(data),this.syncSize()},onClickExpand:function(){this.expanding=!this.expanding,this.syncSize()},syncSize:function(){this.expanding?(this.$el.height(this.expandHeight),this.$el.addClass("expanding")):(this.$el.height(0),this.$el.removeClass("expanding"))}}),QueryResultView}),define("text!templates/event-primary-event.html",[],function(){return'<p class="primary-event">\n  When user trigger <select class="event-name">\n    <% for (var i = 0; i < availableEvents.length; ++i) { %>\n      <option><%= availableEvents[i] %></option>\n    <% } %>\n  </select>\n\n  <input\n    class="event-threshold input-small"\n    type="number"\n    size="4"\n    min="1"\n    step="1"\n    value="<%= event.get(\'threshold\') %>">\n\n  times\n\n  <button type="button" class="btn btn-danger btn-delete-prim-event">Delete</button>\n</p>\n\n<button class="btn btn-primary btn-add-prim-event">Turn on event condition</button>\n'}),define("views/event-primary-event",["underscore","backbone","event-primary-event","text!templates/event-primary-event.html"],function(_,Backbone,PrimaryEvent,_PrimaryEventHTML){var PrimaryEventView=Backbone.View.extend({tagName:"div",className:"container-prim-event",template:_.template(_PrimaryEventHTML),events:{"click .btn-add-prim-event":"affirm","click .btn-delete-prim-event":"nullify","change .event-name":"setName","change .event-threshold":"setThreshold"},initialize:function(options){this.model=options.model,this.availableEvents=options.availableEvents,this.availableEvents&&!this.model.get("name")&&this.model.set({name:this.availableEvents[0]}),this.listenTo(this.model,"change:nil",this.populatePrimEvent),this.listenTo(this.model,"change:threshold",this.populateThreshold)},render:function(){return this.$el.html(this.template({event:this.model,availableEvents:this.availableEvents})),this.primEventContainer=this.$(".primary-event"),this.addPrimEventButton=this.$(".btn-add-prim-event"),this.populatePrimEvent(this.model),this.nameSelect=this.$(".event-name"),this.thresholdInput=this.$(".event-threshold"),this.deletePrimEventButton=this.$(".btn-delete-prim-event"),this.populateEventName(),this},affirm:function(){this.model.set("nil",!1)},nullify:function(){this.model.set("nil",!0)},setName:function(){this.model.set({name:this.nameSelect.val()})},setThreshold:function(){var threshold=0/0;threshold=parseInt(this.thresholdInput.val(),10),isNaN(threshold)&&(threshold=1),this.model.set("threshold",threshold)},populatePrimEvent:function(model){var nil=model.get("nil");nil?(this.primEventContainer.addClass("hide"),this.addPrimEventButton.removeClass("hide")):(this.addPrimEventButton.addClass("hide"),this.primEventContainer.removeClass("hide"))},populateEventName:function(){var eventName=this.model.get("name");this.nameSelect.val(eventName)},populateThreshold:function(model,value){this.thresholdInput.val(value)}});return PrimaryEventView}),define("text!templates/event-container.html",[],function(){return'<header class="section">\n  <h4>\n    Event<br>\n    <small>For matching user actions</small>\n    <a href="http://help.retain.cc/creating-event-triggered-auto-messages/" target="_blank"><span class="label label-default">Help needed?</span></a>\n  </h4>\n</header>\n<div class="event-wrap">\n  <div class="primary-event-container"></div>\n  <div class="timed-events-container">\n    <ul class="timed-event-list"></ul>\n    <button class="btn btn-primary btn-add-event">+ Add more condition</button>\n  </div>\n</div>\n'}),define("event-editor",["underscore","backbone","views/event-primary-event","views/event-timed-event","text!templates/event-container.html"],function(_,Backbone,PrimaryEventView,TimedEventView,_EventContainer){var EventEditor=function(options){Backbone.View.call(this,options)};return _.extend(EventEditor.prototype,Backbone.View.prototype,{tagName:"section",className:"event",template:_.template(_EventContainer),events:{"click .btn-add-event":"onAddBtnClicked"},initialize:function(options){this.machine=options.machine,this.availableEvents=options.avaliableEvents,this.messageMode=options.messageMode,this.primaryEvent=this.machine.get("primaryEvent"),this.timedEvents=this.machine.get("timedEvents"),this.primaryEventView=new PrimaryEventView({model:this.primaryEvent,availableEvents:this.availableEvents}),this.syncMessageMode(),this.listenTo(this.primaryEvent,"change:nil",this.presentTimedEvents),this.listenTo(this.primaryEvent,"change:nil",this.syncMessageMode),this.listenTo(this.timedEvents,"add",this.addTimedEvent)},render:function(){return this.$el.html(this.template()),this.$(".primary-event-container").html(this.primaryEventView.render().el),this.timedEventsContainer=this.$(".timed-events-container"),this.presentTimedEvents(),this.timedEventList=this.$(".timed-event-list"),this.addAllTimedEvent(),this},syncMessageMode:function(){var nil=this.primaryEvent.get("nil");this.messageMode.set(nil?{mode:"attribute"}:{mode:"event"})},addTimedEvent:function(timedEvent){var view=new TimedEventView({model:timedEvent,availableEvents:this.availableEvents});this.timedEventList.append(view.render().el)},presentTimedEvents:function(){var nil=this.primaryEvent.get("nil");nil?this.timedEventsContainer.addClass("hide"):this.timedEventsContainer.removeClass("hide")},addAllTimedEvent:function(){this.timedEvents.each(this.addTimedEvent,this)},onAddBtnClicked:function(){this.machine.get("timedEvents").add({})}}),EventEditor}),define("text!templates/query-recurrence.html",[],function(){return'<header class="section">\n  <h4>\n    Recurrence<br>\n    <small>Set the period for the message to send again</small>\n  </h4>\n</header>\n\n<div class="query-wrap">\n<p>Send\n\n<select class="frequency">\n  <% _.each(frequencyOptions, function(opt) { %>\n    <option value="<%= opt %>"><%= opt %></option>\n  <% }); %>\n</select>\n\n<% if (recurrence.repeat()) { %>\n  <input\n    class="threshold input-small"\n    type="number"\n    size="2"\n    min="1"\n    max="180"\n    step="1"\n    value="<%= recurrence.get(\'threshold\') %>">\n\n  day\n<% } %>\n\n</p>\n</div>'}),define("views/query-recurrence",["underscore","backbone","text!templates/query-recurrence.html"],function(_,Backbone,_QueryRecurrenceHTML){var QueryRecurrenceView=Backbone.View.extend({tagName:"section",className:"query-recurrence",template:_.template(_QueryRecurrenceHTML),events:{"change .frequency":"updateAttributes","change .threshold":"updateAttributes"},_frequencyOptions:["once","every"],initialize:function(options){this.messageMode=options.messageMode,this.listenTo(this.model,"change:frequency",this.render),this.listenTo(this.messageMode,"change:mode",this.render)},render:function(){return this.messageMode.event()?this.$el.addClass("hide"):this.$el.removeClass("hide"),this.$el.html(this.template({recurrence:this.model,frequencyOptions:this._frequencyOptions})),this.frequencySelect=this.$(".frequency"),this.thresholdInput=this.$(".threshold"),this.populateFrequency(),this},updateAttributes:function(){var frequency=this.frequencySelect.val(),threshold=this.thresholdInput.val();this.model.set({frequency:frequency,threshold:threshold})},populateFrequency:function(){var frequency=this.model.get("frequency");this.frequencySelect.val(frequency)}});return QueryRecurrenceView}),define("text!templates/event-recurrence.html",[],function(){return'<header class="section">\n  <h4>\n    Recurrence<br>\n    <small>Set the period for the message to send again</small>\n  </h4>\n</header>\n\n\n<div class="query-wrap">\n\n<p>Send\n\n<select class="operator">\n  <option value="once" <%= (event.once())? \'selected\' : \'\' %>>Once</option>\n  <option value="every" <%= (event.repeat())? \'selected\' : \'\' %>>Everytime</option>\n  <option value="every-period" <%= (event.repeat())? \'selected\' : \'\' %>>Every period</option>\n</select>\n\n<span class="repeat-day-line">of <input class="threshold" type="number" min="1" step="1"> day per</span>\n<span class="repeat-event-line"><em class="name"><%= event.get("name") %></em> matches</span>\n\n</p>\n\n</div>'}),define("views/event-recurrence",["underscore","backbone","text!templates/event-recurrence.html"],function(_,Backbone,_EventRecurrenceHTML){var EventRecurrenceView=Backbone.View.extend({tagName:"section",className:"event-recurrence",template:_.template(_EventRecurrenceHTML),events:{"change .operator":"setOperator","change .threshold":"setThreshold"},initialize:function(options){this.messageMode=options.messageMode,this.primaryEvent=options.primaryEvent,this.listenTo(this.messageMode,"change:mode",this.populateMessageMode),this.listenTo(this.primaryEvent,"change:name",this.populateName),this.listenTo(this.model,"change:operator",this.populateOperator),this.listenTo(this.model,"change:threshold",this.populateThreshold)},render:function(){return this.$el.html(this.template({event:this.primaryEvent})),this.queryWrap=this.$(".query-wrap"),this.operatorSelect=this.$(".operator"),this.thresholdInput=this.$(".threshold"),this.nameEm=this.$(".name"),this.populateMessageMode(),this.populateName(),this.populateOperator(),this.populateThreshold(),this},setOperator:function(){this.model.set("operator",this.operatorSelect.val())},setThreshold:function(){var value=this.thresholdInput.val();this.model.set("threshold",value)},populateMessageMode:function(){this.messageMode.event()?this.$el.removeClass("hide"):this.$el.addClass("hide")},populateOperator:function(){var model=this.model,value=model.get("operator"),preValue=model.previous("operator");this.queryWrap.removeClass(preValue).addClass(value),this.operatorSelect.val(value)},populateThreshold:function(){var model=this.model,value=model.get("threshold");value&&this.thresholdInput.val(value)},populateName:function(){this.nameEm.text(this.primaryEvent.get("name"))}});return EventRecurrenceView}),define("text!templates/message-schedule-container.html",[],function(){return'<header>\n  <h4>\n    Scheduling <br>\n    <small>When to send your message after criteria matched</small>\n  </h4>\n</header>\n\n<div class="schedule-wrap <%= type %>">\n  <select class="schedule-type">\n    <option value="now"\n      <% if (type == "now") print(\'selected\'); %>\n      >Send Immediately</option>\n    <option value="wait"\n      <% if (type == "wait") print(\'selected\'); %>\n      data-operator=".wait">Wait for</option>\n  </select>\n  <div class="operator wait">\n    <input type="number" class="wait-span span input-small"\n      data-attr="waitSpan" value="<%= waitSpan %>">\n    <select class="waitUnit input-small">\n      <option value="days"\n        <% if (waitUnit == "days") print(\'selected\'); %>\n        >Days</option>\n      <option value="minutes"\n        <% if (waitUnit == "minutes") print(\'selected\'); %>\n        >Minutes</option>\n    </select>\n  </div>\n</div>\n'}),define("text!templates/event-option.html",[],function(){return'<option value="<%= name %>"><%= name %></option>\n'}),define("message-schedule-view",["underscore","backbone","text!templates/message-schedule-container.html","text!templates/event-option.html"],function(_,Backbone,_scheduleContainer,_optionTemplate){var ScheduleContainer=_.template(_scheduleContainer),OptionTemplate=_.template(_optionTemplate),MessageScheduleView=function(options){Backbone.View.call(this,options)};return _.extend(MessageScheduleView.prototype,Backbone.View.prototype,{tagName:"section",className:"schedule",events:{"change .schedule-type":"onScheduleTypeChange","change .waitUnit":"onWaitUnitChange","change input":"onInputChange"},render:function(){this.typeCls=this.model.get("type"),this.$el.append(ScheduleContainer(this.model.attributes)),this.wrap=this.$(".schedule-wrap")},_appendEvt:function(evtName){this.evtSelect.append(OptionTemplate({name:evtName}))},onScheduleTypeChange:function(e){this.wrap.removeClass(this.typeCls),this.wrap.addClass(e.target.value),this.typeCls=e.target.value,this.model.set("type",this.typeCls)},onWaitUnitChange:function(e){this.model.set("waitUnit",e.target.value)},onInputChange:function(e){var attr=$(e.target).data("attr"),val=e.target.value;val=parseInt(val?val:0,10),this.model.set(attr,val)}}),MessageScheduleView}),define("message-form",["underscore","backbone","message-mode","views/message-form-header","message-preview","query-view","query-result-view","message-insert-var","event-editor","views/query-recurrence","views/event-recurrence","message-schedule-view"],function(_,Backbone,MessageMode,MessageFormHeader,MessagePreview,QueryView,QueryResultView,MessageInsertVarView,EventEditor,QueryRecurrenceView,EventRecurrenceView,MessageScheduleView){var MessageFormView=function(options){Backbone.View.call(this,options)};return _.extend(MessageFormView.prototype,Backbone.View.prototype,{initialize:function(options){this.model=options.model,this.messageFormHeader=new MessageFormHeader({model:this.model.get("messageMode")}),this.messageContent=new MessagePreview({model:this.model,el:this.$(".content-preview"),shouldBindSubmit:options.shouldBindSubmit,previewValMap:options.previewValMap,bottomSize:325}),this.filterView=new QueryView({query:this.model.get("query"),avaliableFilter:options.avaliableFilter,companyFilter:options.avaliableCompanyFilter,messageMode:this.model.get("messageMode")}),this.queryPreview=new QueryResultView({query:this.model.get("query"),url:options.queryPreviewUrl}),this.eventEditor=new EventEditor({machine:this.model.get("eventMachine"),avaliableEvents:this.model.get("available_events"),messageMode:this.model.get("messageMode")}),this.queryRecurrenceView=new QueryRecurrenceView({model:this.model.get("queryRecurrence"),messageMode:this.model.get("messageMode")}),this.eventRecurrenceView=new EventRecurrenceView({model:this.model.get("eventRecurrence"),messageMode:this.model.get("messageMode"),primaryEvent:this.model.get("eventMachine").get("primaryEvent")}),this.messageScheduleView=new MessageScheduleView({model:this.model.get("schedule")}),this.insertVarView=new MessageInsertVarView({el:this.$(".context-area.content")}),this.insertVarViewForResponseContent=new MessageInsertVarView({el:this.$(".context-area.response")}),this.onIsLiveClick=_.bind(this.onIsLiveClick,this),this.onNameChange=_.bind(this.onNameChange,this),this.onAgentChange=_.bind(this.onAgentChange,this),this.onDeliveryChange=_.bind(this.onDeliveryChange,this),this.onSubjectChange=_.bind(this.onSubjectChange,this),this.onContentChange=_.bind(this.onContentChange,this),this.onResponseContentChange=_.bind(this.onResponseContentChange,this),this.onSubmit=_.bind(this.onSubmit,this)},remove:function(){Backbone.View.prototype.remove.call(this),this.filterView.remove(),this.filterView=null,this.eventEditor.remove(),this.eventEditor=null,this.queryRecurrenceView.remove(),this.queryRecurrenceView=null,this.eventRecurrenceView.remove(),this.eventRecurrenceView=null,this.messageScheduleView.remove(),this.messageScheduleView=null,this.queryPreview.remove(),this.queryPreview=null,this.onIsLiveClick=null,this.onNameChange=null,this.onAgentChange=null,this.onDeliveryChange=null,this.onSubjectChange=null,this.onContentChange=null,this.onResponseContentChange=null,this.onSubmit=null,this.agentSelect=null},render:function(){this.ruleEl=this.$(".message-target"),this.messageContent.render(),this.messageFormHeader.render(),this.ruleEl.append(this.messageFormHeader.$el),this.eventEditor.render(),this.ruleEl.append(this.eventEditor.$el),this.filterView.render(),this.ruleEl.append(this.filterView.$el),this.queryPreview.render(),this.ruleEl.append(this.queryPreview.$el),this.queryRecurrenceView.render(),this.ruleEl.append(this.queryRecurrenceView.$el),this.eventRecurrenceView.render(),this.ruleEl.append(this.eventRecurrenceView.$el),this.messageScheduleView.render(),this.ruleEl.append(this.messageScheduleView.$el),this.insertVarView.render(),this.insertVarViewForResponseContent.render(),this.agentSelect=this.$("select.agent"),this.onAgentChange(),this.deliverySelect=this.$("select.delivery"),this.onDeliveryChange(),this.$el.removeClass("loading")},delegateEvents:function(){this.undelegateEvents(),this.$el.on("click","input:radio[name=status]",this.onIsLiveClick),this.$el.on("change","input.name",this.onNameChange),this.$el.on("change","input.subject",this.onSubjectChange),this.$el.on("change","select.agent",this.onAgentChange),this.$el.on("change","select.delivery",this.onDeliveryChange),this.$el.on("keyup","textarea.content-textarea.content",this.onContentChange),this.$el.on("keyup","textarea.content-textarea.response",this.onResponseContentChange),this.$el.on("submit","form",this.onSubmit)},onIsLiveClick:function(e){this.model.set("status",e.target.value)},onNameChange:function(e){this.model.set("name",e.target.value)},onAgentChange:function(){var option,name,avatar,val=this.agentSelect.val();option=this.agentSelect.find("option[value="+val+"]"),name=option.data("name"),avatar=option.data("avatar"),this.model.set("agent_id",val),this.model.set("agent",{name:name,avatar:avatar})},onDeliveryChange:function(){var delivery=this.deliverySelect.val(),oldDelivery=this.model.get("delivery");this.model.set("delivery",delivery),delivery!==oldDelivery&&this.$el.removeClass(oldDelivery),this.$el.addClass(delivery)},onSubjectChange:function(e){this.model.set("subject",e.target.value)},onContentChange:function(e){this.model.set("content",e.target.value)},onResponseContentChange:function(e){this.model.set("response_content",e.target.value)},onSubmit:function(e){var model=this.model;model.isValid()||(e.preventDefault(),window.alert(model.validationError))}}),MessageFormView}),define("text!templates/message-conversation.html",[],function(){return'<div class="cit-head">\n  <span class="cit-close">&#215;</span>\n  <%= message_box_title %>\n</div>\n<div class="cit-footer">\n  <textarea class="cit-reply"\n    placeholder="<%= message_box_placeholder %>"></textarea>\n  <button class="cit-submit">Submit</button>\n</div>\n'}),define("message-conversation",["AppClient","underscore","backbone","message","text!templates/message-conversation.html","AppSetting"],function(app,_,Backbone,Message,conversationPrompt,AppSetting){var ConversationPromptTemplate=_.template(conversationPrompt),MessageConversationView=function(options){Backbone.View.call(this,options)};return _.extend(MessageConversationView.prototype,Backbone.View.prototype,{className:"cit-msg-content prompt new-prompt",events:{"click .cit-submit":"submitMessage","click .cit-close":"hide"},initialize:function(){},render:function(){this.$el.append(ConversationPromptTemplate({message_box_title:app.clientConfig.widgetTitle,message_box_placeholder:app.clientConfig.widgetPlaceholder})),this.subjectDiv=this.$(".cit-subject"),this.replyTextArea=this.$(".cit-reply")},submitMessage:function(e){var data,button;button=Backbone.$(e.target),data=app.citofono.getUserData(),data.message=new Message({content:this.replyTextArea.val(),status:"sent",delivery:"prompt"}),Backbone.ajax({type:"POST",url:AppSetting.baseUrl+"/api/messages",data:JSON.stringify(data),contentType:"application/json; charset=utf-8",context:this,beforeSend:function(){button.html("Loading"),button.attr("disabled",!0)},success:function(data){alert(data.message?data.message:"Fail connect to server"),data.success&&(this.replyTextArea.val(""),this.hide())},error:function(){alert("Fail connect to server")},complete:function(){button.html("Submit"),button.removeAttr("disabled")}})},hide:function(){this.$el.hide()},show:function(){this.$el.show()},isHidden:function(){return this.$el.is(":hidden")}}),MessageConversationView}),define("text!templates/event-condition-control.html",[],function(){return'<li class="condition-control">\n  <p class="input-prepend">\n    <select class="event-name">\n    </select><span class="add-on">happened</span>\n  </p>\n  <div class="condition-filter">\n    <select class="condition-operator">\n      <option value="happen">Once</option>\n      <option value="gt">More than</option>\n      <option value="lt">Less than</option>\n      <option value="never">Never</option>\n    </select><input\n      class="condition-count input-mini"\n      type="number" value="<%= count %>">\n  </div>\n  <p class="input-prepend within-container">\n    <span class="add-on">within</span>\n    <input type="number" name="span"\n      class="input-mini">\n    <select class="within-type input-medium">\n      <option value="alltime">anytime</option>\n      <option value="day">days</option>\n      <option value="session">within browser session</option>\n    </select>\n    <span>?</span>\n  </p>\n  <p>\n    <button class="delete-btn btn btn-red">Delete</button>\n  </p>\n</li>\n'}),define("event-condition-editor",["underscore","backbone","event-condition","text!templates/event-condition-control.html","text!templates/event-option.html"],function(_,Backbone,EventCondition,_eventConditionControl,_optionTemplate){var EventConditionControl=_.template(_eventConditionControl),OptionTemplate=_.template(_optionTemplate),EventConditionView=function(options){Backbone.View.call(this,options)};return _.extend(EventConditionView.prototype,Backbone.View.prototype,{initialize:function(options){this.model=options.model,this.avaliableEvents=options.avaliableEvents,this.model.on("change:name",this.onEventChange,this),this.model.on("change:operator",this.syncOperandType,this),this.onRemoveClicked=_.bind(this.onRemoveClicked,this),this.onEventClick=_.bind(this.onEventClick,this),this.onOperatorChange=_.bind(this.onOperatorChange,this),this.onCountChange=_.bind(this.onCountChange,this),this.onWithinTypeChange=_.bind(this.onWithinTypeChange,this),this.containerCls=null,this.withinCls=null},render:function(){var i;for(this.setElement(EventConditionControl({count:this.model.get("count")})),this.evtNames=this.$(".event-name"),this.container=this.$(".condition-filter"),this.withinContiner=this.$(".within-container"),this.evtOperator=this.$(".condition-operator"),i=0;i<this.avaliableEvents.length;i++)this.evtNames.append(OptionTemplate({name:this.avaliableEvents[i]}));return this.onEventChange(this.model,this.model.get("name")),this.syncOperandType(this.model,this.model.get("operator")),this},remove:function(){Backbone.View.prototype.remove.call(this),this.model.off(null,null,this),this.onRemoveClicked=null,this.onFieldClick=null,this.onOperatorChange=null,this.onOperandChange=null,this.activeFilter=null,this.containerCls=null,this.withinCls=null},delegateEvents:function(){this.undelegateEvents(),this.$el.on("click",".delete-btn",this.onRemoveClicked),this.$el.on("change",".event-name",this.onEventClick),this.$el.on("change",".condition-operator",this.onOperatorChange),this.$el.on("change",".condition-count",this.onCountChange),this.$el.on("change",".within-type",this.onWithinTypeChange)},onEventChange:function(model,name){this.evtNames.val(name)},syncOperandType:function(model,operator){this.evtOperator.val(operator),null!==this.containerCls&&this.container.removeClass(this.containerCls),this.container.addClass(operator),this.containerCls=operator,-1!=_.indexOf(["happen","never"],operator)?this.model.set("count",null):this.model.set("count",model.get("count"))},onRemoveClicked:function(){this.trigger("remove",this.model),this.model.destroy()},onEventClick:function(e){this.model.set("name",e.target.value)},onOperatorChange:function(e){this.model.set("operator",e.target.value)},onCountChange:function(e){var rVal=e.target.value;rVal=parseInt(rVal?rVal:0,10),_.isNaN(rVal)&&(rVal=0),this.model.set("count",rVal)},onWithinTypeChange:function(e){null!==this.withinCls&&this.withinContiner.removeClass(this.withinCls),this.withinCls=e.target.value,this.withinContiner.addClass(this.withinCls)}}),EventConditionView}),define("cit-button",["jquery","underscore","backbone"],function($,_,Backbone){var CitButtonView=Backbone.View.extend({events:{click:"buttonClicked"},initialize:function(options){this.container=options.container,this.messageData=options.messageData,this.hasWidgetActivator=options.hasWidgetActivator,this.evt=options.evt},render:function(){},buttonClicked:function(){this.evt.trigger("click:citButton")}});return CitButtonView}),define("views/message-email-lead-form-result",["underscore","views/message-base","views/prompt-close","views/prompt-body"],function(_,MessageBaseView,PromptCloseView,PromptBodyView){var MessageEmailLeadFormResultView=MessageBaseView.extend({className:"cit-msg-content email-lead cit-form-result",initialize:function(options){var childOptions=_.extend({},options,{parent:this});this.citCloseView=new PromptCloseView(childOptions),this.citBodyView=new PromptBodyView(childOptions)},render:function(){var $el=this.$el;return $el.empty(),$el.append(this.citCloseView.render().$el),$el.append(this.citBodyView.render().$el),this},onContentChange:function(model,content){this.citBodyView.onContentChange(model,content)},closeMessageWindow:function(){this.hide()}});return MessageEmailLeadFormResultView}),define("factories/message-view-factory",["views/message-prompt","views/message-growl","views/message-email-lead","views/message-email-lead-result","views/message-email-lead-form-result"],function(MessagePromptView,MessageGrowlView,MessageEmailLeadView,MessageEmailLeadResultView,MessageEmailLeadFormResultView){return{create:function(options){var Klass;switch(options.model.get("delivery")){case"prompt":Klass=MessagePromptView;break;case"growl":Klass=MessageGrowlView;break;case"email-lead":Klass=MessageEmailLeadView;break;case"email-lead-result":Klass=MessageEmailLeadResultView;break;case"email-lead-form-result":Klass=MessageEmailLeadFormResultView}return new Klass(options)}}}),define("cit-view",["jquery","underscore","backbone","cit-button","factories/message-view-factory","message-conversation","AppSetting"],function($,_,Backbone,CitButton,MessageViewFactory,MessageConversationView,AppSetting){var CitView=Backbone.View.extend({id:"citofono-modal",className:"cit",initialize:function(options){this.citofono=options.citofono,this.evt=options.evt,this.evt.on("show:newConversation",this.showNewMessageConversation,this),this.evt.on("show:message",this.showMessage,this)},render:function(){return $("body").append(this.$el),this.addCitButton(this.$el,this.evt),this},addCitButton:function(container,evt){var button=null;this.citofono.hasWidgetActivator&&(this.citofono.isDefaultWidgetActivator?(button=$("<img/>",{id:"RetainDefaultButton","class":"cit-prompt-button",src:AppSetting.baseUrl+"/static/img/icon.png"}),container.append(button)):button=$(this.citofono.widgetActivatorSelector));new CitButton({el:button,container:container,hasWidgetActivator:this.hasWidgetActivator,evt:evt})},showNewMessageConversation:function(){if(!this.isShowContentView()){if(void 0!==this.messageConversationView)return void this.messageConversationView.show();this.messageConversationView=new MessageConversationView,this.messageConversationView.render(),this.$el.append(this.messageConversationView.el)}},showMessage:function(message){this.messageContentView=MessageViewFactory.create({model:message,shouldBindSubmit:!0,processed:!0}),this.messageContentView.render(),this.$el.append(this.messageContentView.el)},isShowContentView:function(){return void 0!==this.messageContentView&&!this.messageContentView.isHidden()},isShowConversationView:function(){return void 0!==this.messageConversationView&&!this.messageConversationView.isHidden()}});return CitView}),define("column-control-view",["underscore","backbone"],function(_,Backbone){var ColumnControl=function(options){Backbone.View.call(this,options)};return _.extend(ColumnControl.prototype,Backbone.View.prototype,{events:{'click [type="checkbox"]':"onCheckboxClick"},initialize:function(options){this.listView=options.listView,this.onCheckboxClick=_.debounce(_.bind(this.onCheckboxClick,this),300)},remove:function(){Backbone.View.remove(this)},render:function(){return this},onCheckboxClick:function(e){e.preventDefault();var list=[];this.$("input:checked").each(function(){list.push(this.value)}),this.model.onColumnChange(list)}}),ColumnControl}),define("list-filter-base",["underscore","backbone"],function(_,Backbone){var ListFilterBase=function(options){Backbone.View.call(this,options)
};return _.extend(ListFilterBase.prototype,Backbone.View.prototype,{initialize:function(options){this.fieldName=options.field,this.query=options.query,this.listenTo(this.query,"change",this.onQueryChanged),this.listenTo(this.query,"add",this.onQueryAdded),this.listenTo(this.query,"remove",this.onQueryRemoved),this.onAttributeEnabledChanged=_.bind(this.onAttributeEnabledChanged,this),this.onStringComparatorEnabledChange=_.bind(this.onStringComparatorEnabledChange,this),this.onExistComparatorEnabledChange=_.bind(this.onExistComparatorEnabledChange,this),this.onfilterValueChange=_.bind(this.onfilterValueChange,this)},render:function(){return this.filters().length>0&&(this.$("input.attribute-enabled").prop("checked",!0).trigger("change"),_.each(this.filters(),this.renderFilter,this)),this},renderFilter:function(filter){var comparatorNode,enableNode,valueNode,operator=filter.get("operator"),operand=filter.get("operand");"exists"===operator?this.$("input.attribute-exist."+operand).prop("checked",!0):"contain_any"===operator?this.$('input[name="'+this.fieldName+'_type"]').filter(function(){return-1!==operand.indexOf(this.value)}).each(function(){this.checked=!0}):(comparatorNode=this.$(".comparator.key-"+operator),1==comparatorNode.length&&(comparatorNode.addClass("enabled"),enableNode=comparatorNode.find(".comparator-enabled"),valueNode=comparatorNode.find(".filter-value"),valueNode.val(operand),enableNode.prop("checked",!0)))},remove:function(){Backbone.View.prototype.remove.call(this),this.stopListening(this.query),this.onAttributeEnabledChanged=null,this.onStringComparatorEnabledChange=null,this.onExistComparatorEnabledChange=null,this.onfilterValueChange=null},filters:function(){return this.query.getFiltersByName(this.fieldName)},delegateEvents:function(){this.undelegateEvents(),this.$el.on("change","input.attribute-enabled",this.onAttributeEnabledChanged),this.$el.on("change","input.comparator-enabled",this.onStringComparatorEnabledChange),this.$el.on("change","input.attribute-exist",this.onExistComparatorEnabledChange),this.$el.on("change","input.filter-value",this.onfilterValueChange)},onQueryAdded:function(model){var filterName=model.get("field"),operator=model.get("operator");filterName==this.fieldName&&this.$(".comparator.key-"+operator).addClass("enabled")},onQueryRemoved:function(model){var filterName=model.get("field"),operator=model.get("operator");filterName==this.fieldName&&this.$(".comparator.key-"+operator).removeClass("enabled")},onQueryChanged:function(model){var value,filterName=model.get("field"),operator=model.get("operator");filterName==this.fieldName&&"exists"==operator&&(value=model.get("operand"),value=value?"false":"true",this.$(".attribute-exist."+value).removeAttr("checked"))},onAttributeEnabledChanged:function(event){var node,enabled;node=Backbone.$(event.target),enabled=node.is(":checked"),this.$el.toggleClass("enabled",enabled),_.each(this.filters(),function(filter){filter.set("enabled",enabled)},this)},onStringComparatorEnabledChange:function(){return!1},onfilterValueChange:function(){return!1},onExistComparatorEnabledChange:function(){return!1}}),ListFilterBase}),define("list-filter-view",["underscore","backbone","list-filter-base"],function(_,Backbone,ListFilterBase){var UserFilterView=function(options){ListFilterBase.call(this,options)};return _.extend(UserFilterView.prototype,ListFilterBase.prototype,{onStringComparatorEnabledChange:function(event){var filterValue,node=Backbone.$(event.currentTarget),operator=node.data("operator");node.is(":checked")?(filterValue=this.$(".filter-value.key-"+operator).val(),this.query.update(this.fieldName,operator,filterValue)):this.query.deleteFilter(this.fieldName,operator)},onfilterValueChange:function(event){var node=Backbone.$(event.currentTarget);this.query.update(this.fieldName,node.data("operator"),node.val())},onExistComparatorEnabledChange:function(event){var actionNode=Backbone.$(event.currentTarget),operand;actionNode.prop("checked")&&(operand=eval(actionNode.val()),this.query.update(this.fieldName,"exists",operand))}}),UserFilterView}),define("list-filter-date-view",["underscore","backbone","moment","pikaday","list-filter-view"],function(_,Backbone,moment,Pikaday,UserFilterView){var DateFilterView=function(options){UserFilterView.call(this,options)};return _.extend(DateFilterView.prototype,UserFilterView.prototype,{initialize:function(options){UserFilterView.prototype.initialize.call(this,options),this.pikadays=[]},render:function(){var pikadays=this.pikadays;return this.filters().length>0&&(this.$("input.attribute-enabled").prop("checked",!0).trigger("change"),_.each(this.filters(),this.renderFilter,this)),this.$(".abs-time-filter input").each(function(i,el){pikadays.push(new Pikaday({field:el,format:"YYYY-MM-DD"}))}),this},onStringComparatorEnabledChange:function(event){var filterValue,node=Backbone.$(event.currentTarget),operator=node.data("operator"),$comparator=this.$(".comparator.key-"+operator);node.is(":checked")?(filterValue=this.$(".filter-value.key-"+operator).val(),moment(filterValue).isValid()?this.query.update(this.fieldName,operator,filterValue):$comparator.addClass("enabled")):(this.query.deleteFilter(this.fieldName,operator),$comparator.removeClass("enabled"))},onfilterValueChange:function(event){var node=Backbone.$(event.currentTarget),val=node.val();moment(val).isValid()&&this.query.update(this.fieldName,node.data("operator"),node.val())},onExistComparatorEnabledChange:function(event){var actionNode=Backbone.$(event.currentTarget),operand;actionNode.prop("checked")&&(operand=eval(actionNode.val()),this.query.update(this.fieldName,"exists",operand))}}),DateFilterView}),define("list-filter-boolean-view",["underscore","backbone"],function(_,Backbone){var BooleanFilterView=function(options){Backbone.View.call(this,options)};return _.extend(BooleanFilterView.prototype,Backbone.View.prototype,{initialize:function(options){this.fieldName=options.field,this.query=options.query,this.listenTo(this.query,"change",this.onQueryChanged),this.listenTo(this.query,"add",this.onQueryAdded),this.listenTo(this.query,"remove",this.onQueryRemoved),this.onAttributeEnabledChanged=_.bind(this.onAttributeEnabledChanged,this),this.onExistComparatorEnabledChange=_.bind(this.onExistComparatorEnabledChange,this),this.onfilterValueChange=_.bind(this.onfilterValueChange,this)},render:function(){return this.filters().length>0&&(this.$("input.attribute-enabled").prop("checked",!0).trigger("change"),_.each(this.filters(),this.renderFilter,this)),this},renderFilter:function(filter){var operator=filter.get("operator"),operand=filter.get("operand");"exists"===operator?this.$("input.attribute-exist."+operand).prop("checked",!0):operand?this.$(".attribute-value.true").prop("checked",!0):this.$(".attribute-value.false").prop("checked",!0)},remove:function(){Backbone.View.prototype.remove.call(this),this.onAttributeEnabledChanged=null,this.onExistComparatorEnabledChange=null,this.onfilterValueChange=null},filters:function(){return this.query.getFiltersByName(this.fieldName)},delegateEvents:function(){this.undelegateEvents(),this.$el.on("change","input.attribute-enabled",this.onAttributeEnabledChanged),this.$el.on("change","input.attribute-value",this.onfilterValueChange),this.$el.on("change","input.attribute-exist",this.onExistComparatorEnabledChange)},onQueryAdded:function(model){var filterName=model.get("field"),operator=model.get("operator"),operand=model.get("operand");filterName==this.fieldName&&"equal"==operator&&this.$(".attribute-value."+operand).prop("checked",!0)},onQueryRemoved:function(model){var filterName=model.get("field"),operator=model.get("operator");filterName==this.fieldName&&this.$(".comparator.key-"+operator).prop("checked",!0)},onQueryChanged:function(model){var value,filterName=model.get("field"),operator=model.get("operator");filterName==this.fieldName&&("exists"==operator?(value=model.get("operand"),value=value?"false":"true",this.$(".attribute-exist."+value).removeAttr("checked")):"equal"==operator&&(value=model.get("operand"),value=value?"false":"true",this.$(".attribute-value."+value).removeAttr("checked")))},onAttributeEnabledChanged:function(event){var node,enabled;node=$(event.target),enabled=node.is(":checked"),this.$el.toggleClass("enabled",enabled),_.each(this.filters(),function(filter){filter.set("enabled",enabled)},this)},onfilterValueChange:function(event){var node=$(event.currentTarget),operand;node.prop("checked")?(operand=eval(node.val()),this.query.update(this.fieldName,"equal",operand)):this.query.deleteFilter(this.fieldName,"equal")},onExistComparatorEnabledChange:function(event){var actionNode=$(event.currentTarget),operand,isExistSelect;actionNode.prop("checked")?(operand=eval(actionNode.val()),this.query.update(this.fieldName,"exists",operand)):this.query.deleteFilter(this.fieldName,"exists")}}),BooleanFilterView}),define("list-filter-birthday-view",["underscore","backbone","list-filter-base"],function(_,Backbone,ListFilterBase){var UserBirthdayFilterView=function(options){ListFilterBase.call(this,options)};return _.extend(UserBirthdayFilterView.prototype,ListFilterBase.prototype,{onfilterValueChange:function(event){var node=$(event.currentTarget);node.prop("checked")?this.query.update(this.fieldName,"same_day_of_year","_TODAY"):this.query.deleteFilter(this.fieldName,"same_day_of_year")},onExistComparatorEnabledChange:function(event){var actionNode=Backbone.$(event.currentTarget),operand;actionNode.prop("checked")&&(operand=eval(actionNode.val()),this.query.update(this.fieldName,"exists",operand))}}),UserBirthdayFilterView}),define("list-filter-user-type-view",["underscore","backbone","list-filter-base"],function(_,Backbone){var UserTypeFilterView=Backbone.View.extend({events:{"click .btn-user-type":"onUserTypeButtonClicked"},initialize:function(options){this.fieldName=options.field,this.query=options.query,this.listenTo(this.query,"change",this.populateQuery),this.listenTo(this.query,"add",this.populateQuery),this.listenTo(this.query,"remove",this.populateQuery)},render:function(){return this.userTypeButtons=this.$(".btn-user-type"),this.populateQuery(),this},filters:function(){return this.query.getFiltersByName(this.fieldName)},activeButtons:function(){return this.userTypeButtons.filter(".active")},onUserTypeButtonClicked:function(e){var button=Backbone.$(e.currentTarget),value=button.val();this.query.update(this.fieldName,"contain_any",[value])},populateQuery:function(){var filters=this.filters();this.activeButtons().removeClass("active");var activeUserTypes=_.chain(filters).map(function(filter){return filter.get("operand")}).flatten().unique().value();_.each(activeUserTypes,function(type){this.userTypeButtons.filter('[value="'+type+'"]').addClass("active")},this)}});return UserTypeFilterView}),define("list-filter-event-view",["underscore","backbone","list-filter-view","list-filter-date-view"],function(_,Backbone,UserFilterView,DateFilterView){var EventFilterView=Backbone.View.extend({events:{change:"stopPropagation","change >input.attribute-enabled":"populateGroup"},initialize:function(options){this.query=options.query},render:function(){this.checkbox=this.$(">input[type=checkbox]"),this.initSelfChecked();var $subfilters=this.$(">.subfilters>.attribute");return this.viewDict={},_.each($subfilters,function(filter){var Klass,$filter=$(filter),id=$filter.data("id"),type=$filter.data("type");switch(type){case"numeric":Klass=UserFilterView;break;case"date":Klass=DateFilterView;break;default:Klass=UserFilterView}var view=new Klass({el:filter,field:id,query:this.query,filters:this.query.getFiltersByName(id)});view.render(),this.viewDict[id]=view},this),this},remove:function(){_.each(_.values(this.viewDict),function(view){view.remove()})},filters:function(){var ids=this.getSubfilterIds(),subfilters_list=_.map(ids,function(id){return this.query.getFiltersByName(id)},this),flatten_list=_.reduce(subfilters_list,function(sum,filters){return sum.concat(filters)},[]);return flatten_list},initSelfChecked:function(){var ids=this.getSubfilterIds();_.each(ids,function(id){this.query.getFiltersByName(id).length&&this.checkbox.prop("checked",!0)},this),this.populateGroup()},getSubfilterIds:function(){var $items=this.$el.find(">.subfilters>li.attribute"),ids=_.map($items,function(item){return $(item).data("id")});return ids},stopPropagation:function(e){e.stopPropagation()},populateGroup:function(){var enabled=this.checkbox.prop("checked");enabled?this.$el.addClass("enabled"):this.$el.removeClass("enabled"),_.each(this.filters(),function(filter){filter.set("enabled",enabled)},this)}});return EventFilterView}),define("user-manual-message",["underscore","backbone","message-preview","message-insert-var"],function(_,Backbone,MessagePreview,MessageInsertVarView){var UserManualMessageView=function(options){Backbone.View.call(this,options)};return _.extend(UserManualMessageView.prototype,Backbone.View.prototype,{initialize:function(options){this.pos={top:null,left:null},this.userList=options.userList,this.message=options.message,this.$buttonEl=Backbone.$(options.buttonEl),this.onCreateMessageClick=_.bind(this.onCreateMessageClick,this),this.onSelectAllChange=_.bind(this.onSelectAllChange,this),this.onSelectUserChange=_.bind(this.onSelectUserChange,this),this.hideManualMessagePopover=_.bind(this.hideManualMessagePopover,this),this.onAgentChange=_.bind(this.onAgentChange,this),this.onDeliveryChange=_.bind(this.onDeliveryChange,this),this.onSubjectChange=_.bind(this.onSubjectChange,this),this.onContentChange=_.bind(this.onContentChange,this),this.onDocumentKeyUp=_.bind(this.onDocumentKeyUp,this),this.listenTo(this.userList,"change:previewUser",this.onPreviewUser)},render:function(){return this.messageExtraFormNode=$("<div/>"),this.$(".manual-message-form").append(this.messageExtraFormNode),this.resultCount=parseInt(this.$el.data("count"),10),this.popOver=this.$(".manual-message-popover"),this.agentSelect=this.$("select.agent"),this.onAgentChange(),this.messageContent=new MessagePreview({model:this.message,el:this.$(".content-preview"),shouldBindSubmit:!1,bottomSize:70}),this.insertVarView=new MessageInsertVarView({el:this.$(".context-area")}),this.messageContent.render(),this.insertVarView.render(),this._initFormValueFromUserSelected(),this},remove:function(){Backbone.View.prototype.remove.call(this),this.messageContent.remove(),this.messageContent=null,this.popOver=null,this.agentSelect=null,this.onCreateMessageClick=null,this.onSelectAllChange=null,this.onSelectUserChange=null,this.hideManualMessagePopover=null,this.onAgentChange=null,this.onDeliveryChange=null,this.onSubjectChange=null,this.onContentChange=null,this.onDocumentKeyUp=null,$(document).off(".UserManualMessageView")},delegateEvents:function(){this.undelegateEvents(),this.$buttonEl.on("click.userManualMessage",this.onCreateMessageClick),this.$el.on("change",".select-all",this.onSelectAllChange),this.$el.on("change",".select-user",this.onSelectUserChange),this.$el.on("click",".manual-message-popover .close",this.hideManualMessagePopover),this.$el.on("change","input.subject",this.onSubjectChange),this.$el.on("change","select.agent",this.onAgentChange),this.$el.on("change","select.delivery",this.onDeliveryChange),this.$el.on("keyup","textarea.content-textarea",this.onContentChange),$(document).on("keyup.UserManualMessageView",null,this.onDocumentKeyUp)},undelegateEvents:function(){this.$buttonEl.off("click.userManualMessage"),Backbone.View.prototype.undelegateEvents.apply(this)},_initFormValueFromUserSelected:function(){var selectAllNode;selectAllNode=this.$(".select-all"),this.isBulk=selectAllNode.is(":checked"),this.isBulk&&this.$(".select-user:not(:checked)").length>0&&selectAllNode.prop("indeterminate",!0),this._syncFormValueFromUserSelection()},onCreateMessageClick:function(e){e.preventDefault();var uid=[];_.each(this.$(".select-user:checked"),function(dom){uid.push($(dom).val())}),this.popOver.addClass("show"),$(document.body).addClass("manual-message-popover-showing"),this.userList.updatePreviewUser(uid)},onAgentChange:function(){var option,name,avatar,val=this.agentSelect.val();option=this.agentSelect.find("option[value="+val+"]"),name=option.data("name"),avatar=option.data("avatar"),this.message.set("agent_id",val),this.message.set("agent",{name:name,avatar:avatar})},onDeliveryChange:function(e){var delivery=e.target.value;this.message.set("delivery",delivery)},onSubjectChange:function(e){this.message.set("subject",e.target.value)},onContentChange:function(e){this.message.set("content",e.target.value)},onSelectAllChange:function(e){var node=$(e.target);node.is(":checked")?(this.isBulk=!0,node.data("checked",!0),this.$(".select-user").prop("checked",!0)):(this.isBulk=!1,this.$(".select-user").prop("checked",!1)),this._syncFormValueFromUserSelection()},onSelectUserChange:function(e){var node=$(e.target),selectAllNode=this.$(".select-all");this.isBulk&&(node.is(":checked")?0===this.$(".select-user:not(:checked)").length&&(selectAllNode.prop("indeterminate",!1),selectAllNode.prop("checked",!0)):selectAllNode.prop("indeterminate",!0)),this._syncFormValueFromUserSelection()},_syncFormValueFromUserSelection:function(){this.messageExtraFormNode.empty();var count=0;this.isBulk?(this.messageExtraFormNode.append($("<input/>",{type:"hidden",name:"bulk",value:!0})),count=this.resultCount,_.each(this.$(".select-user:not(:checked)"),function(dom){count--,this.messageExtraFormNode.append($("<input/>",{type:"hidden",name:"targeted_users[]",value:$(dom).val()}))},this)):_.each(this.$(".select-user:checked"),function(dom){count++,this.messageExtraFormNode.append($("<input/>",{type:"hidden",name:"targeted_users[]",value:$(dom).val()}))},this),this.userList.set("itemSelectedCount",count)},hideManualMessagePopover:function(){$(document.body).removeClass("manual-message-popover-showing"),this.popOver.removeClass("show")},onDocumentKeyUp:function(e){27==e.keyCode&&this.hideManualMessagePopover()},afterAddedNewUserItems:function(newListNode){this.isBulk&&newListNode.find(".select-user").prop("checked",!0)},populateSelectUserCount:function(){var count=this.userList.get("itemSelectedCount");count||this.hideManualMessagePopover()},onPreviewUser:function(){var previewUser=this.userList.get("previewUser");this.messageContent.changePreviewValMap(this.model,previewUser)}}),UserManualMessageView}),define("item-list-action-bar-view",["underscore","backbone"],function(_,Backbone){var ItemListActionBar=Backbone.View.extend({events:{"click .filter-edit":"onEditFilterButtonClick"},initialize:function(){this.listenTo(this.model,"change:itemCount",this.populateItemCount),this.listenTo(this.model,"change:itemTotalCount",this.populateItemTotalCount),this.listenTo(this.model,"change:itemSelectedCount",this.populateSelectedItemCount),this.listenTo(this.model,"change:filterOpened",this.populateFilterOpened),this.listenTo(this.model,"change:filterObject",this.populateFilterObject)},render:function(){return this.itemCountSpan=this.$(".result-count"),this.itemTotalCountSpan=this.$(".total-count"),this.selectedItemSpan=this.$(".selected-count"),this.sendMessageButton=this.$(".create-manual-message"),this.editFilterButton=this.$(".filter-edit"),this.populateSelectedItemCount(),this},onEditFilterButtonClick:function(){var filterOpened=this.model.get("filterOpened");this.model.set("filterOpened",!filterOpened)},populateItemCount:function(){var count=this.model.get("itemCount");this.itemCountSpan.text(count)},populateItemTotalCount:function(count,totalCount){var totalCount=this.model.get("itemTotalCount");this.itemTotalCountSpan.text(totalCount)},populateSelectedItemCount:function(){var count=this.model.get("itemSelectedCount");count?(this.$el.addClass("item-selected"),this.selectedItemSpan.find(".count").text(count)):this.$el.removeClass("item-selected")},populateFilterOpened:function(){var value=this.model.get("filterOpened");this.editFilterButton.toggleClass("active",value)},populateFilterObject:function(){var attrs=this.model.attributes,initialFilter=attrs.initialFilterObject,currentFilter=attrs.filterObject,isFilterModified=!_.isEqual(initialFilter,currentFilter);this.$el.toggleClass("filter-modified",isFilterModified)}});return ItemListActionBar}),define("users-list-view",["underscore","backbone","query","list-filter-view","list-filter-date-view","list-filter-boolean-view","list-filter-birthday-view","list-filter-user-type-view","list-filter-event-view","user-manual-message","item-list-action-bar-view"],function(_,Backbone,Query,UserFilterView,DateFilterView,BooleanFilterView,BirthdayFilterView,UserTypeFilterView,EventFilterView,UserManualMessageView,ItemListActionBarView){var UsersListView=function(options){Backbone.View.call(this,options)};return _.extend(UsersListView.prototype,Backbone.View.prototype,{initialize:function(options){this.message=options.message,this.resultCountSpan=this.$(".result-count"),this.totalCountSpan=this.$(".total-count"),this.filterViewMap={},this.query=new Query(Query.createFromJson(options.query)),this.url=options.url,this.currentFilterString=this.query.toFilterString(),_.each(Backbone.$("#user-filter>.attribute"),this.addFilter,this),this.segmentCreationFormFilterInput=Backbone.$("#form-create-segment #filter"),this.addUserManualMessageView(),this.initUserTableHeader(),this.actionBar=new ItemListActionBarView({model:this.model,el:this.$("#users-listing-header")}),this.model.setQueryString(this.query.toFilterString()),this.afterQueryChanged=_.debounce(_.bind(this.afterQueryChanged,this),300),this.onNextPageClick=_.bind(this.onNextPageClick,this),this.listenTo(this.model,"change:filterOpened",this.populateFilterOpened),this.listenTo(this.model,"change:userList",this.onColumnChange)},remove:function(){Backbone.View.remove.call(this),_.each(this.filterViewMap,function(view){view.remove()}),this.filterViewMap=null,this.addUserManualMessageView=null,this.initUserTableHeader=null,this.currentFilterString=null,this.afterQueryChanged=null,this.onNextPageClick=null,$(window).off(".UsersListView"),this.actionBar=null},render:function(){return this.filterContainer=this.$("#user-filter-container"),this.actionBar.render(),this.$el.removeClass("loading"),this},delegateEvents:function(){this.undelegateEvents(),this.query.on("change add remove",this.afterQueryChanged),this.$el.on("click",".next-page",this.onNextPageClick)},filterViewClass:function(type){return{numeric:UserFilterView,string:UserFilterView,date:DateFilterView,"boolean":BooleanFilterView,birthday:BirthdayFilterView,type:UserTypeFilterView,event:EventFilterView}[type]},addFilter:function(attribute){var node,attrName,attrType,filterView,Klass;node=Backbone.$(attribute),attrName=node.data("id"),attrType=node.data("type"),Klass=this.filterViewClass(attrType),filterView=new Klass({el:node,field:attrName,query:this.query,filters:this.query.getFiltersByName(attrName)}),filterView.render(),this.filterViewMap[attrName]=filterView},addUserManualMessageView:function(){this.userManualMessageView&&this.userManualMessageView.remove(),this.userManualMessageView=new UserManualMessageView({el:this.$(".users-table-content"),buttonEl:this.$(".create-manual-message"),userList:this.model,message:this.message}),this.userManualMessageView.render()},initUserTableHeader:function(){var table=this.$("#users-table .users-table-content>table"),tableHeaders=table.find("td[data-field]");!function(that){tableHeaders.on("click",function(){var $el=$(this),field=$el.data("field"),desc=!0;$el.hasClass("desc")&&(desc=!1);var map={};map[field]=desc?"desc":"asc",that.model.setOrder(map),that.fetch()})}(this)},afterQueryChanged:function(){var newFilterObject=this.query.toFilterObject(),newFilterString=this.query.toFilterString();this.model.set("filterObject",newFilterObject),this.currentFilterString!==newFilterString&&(this.currentFilterString=newFilterString,this.model.setQueryString(newFilterString),this.fetch()),this.syncSegmentCreationFormFilterInput(),this.model.set("previewUid",0)},syncSegmentCreationFormFilterInput:function(){this.segmentCreationFormFilterInput.val(this.currentFilterString)},fetch:function(){var pageUrl,paramString=Backbone.$.param(this.model.get("param"));history.pushState&&(pageUrl=this.url+"?"+paramString,history.pushState(null,null,pageUrl)),this.requestUrl=this.url+".html?"+paramString,this.$(".users-table-content").addClass("loading"),$.ajax({type:"GET",url:this.requestUrl,context:this,success:function(data){this.requestUrl&&this.onUserListFetched(data)},error:function(){console.log("Fail connect to server")}})},onUserListFetched:function(data){var $el=Backbone.$(data),count=$el.data("count"),totalCount=$el.data("total-count");this.$("#users-table .app-data-contents").remove(),this.$("#users-table").append($el),this.addUserManualMessageView(),this.initUserTableHeader(),this.model.set({itemCount:count,itemTotalCount:totalCount})},onColumnChange:function(){this.onUserListFetched(this.model.get("userList"))},onNextPageClick:function(e){e.preventDefault();var node;node=$(e.target);var requestUrl=node.attr("href");$.ajax({type:"GET",url:requestUrl,context:this,beforeSend:function(){node.data("org-text",node.html()),node.data("loading",!0),this.$(".pagination td").addClass("loading")},success:function(data){var $el=Backbone.$(data),count=$el.data("count"),totalCount=$el.data("total-count"),newList=$(data);this.$(".pagination").remove(),this.$("tbody").append(newList),this.userManualMessageView.afterAddedNewUserItems(newList),this.model.set({itemCount:count,itemTotalCount:totalCount})},error:function(){node.html(node.data("org-text")),node.removeData("org-text"),node.removeData("loading"),alert("Fail connect to server")}})},populateFilterOpened:function(){var value=this.model.get("filterOpened");this.filterContainer.toggleClass("active",value)}}),UsersListView}),define("user-list",["underscore","backbone"],function(_,Backbone){var UserList=Backbone.Model.extend({defaults:{itemCount:0,itemTotalCount:0,itemSelectedCount:0,filterOpened:!1,initialFilterObject:{},filterObject:{},userList:null,param:{},columnControlUrl:"",previewUser:null,previewUid:0},initialize:function(attributes){this.set("initialFilterObject",attributes.filterObject),this.setOrder(attributes.sort)},setQueryString:function(str){this.get("param").q=str},setOrder:function(sort_map){_.each(sort_map,function(v,i){this.get("param").s="desc"==v?"-"+i:i},this)},onColumnChange:function(list){var paramString=Backbone.$.param(this.get("param"));Backbone.$.ajax({type:"POST",url:this.get("columnControlUrl")+"?"+paramString,data:{list:list},context:this,success:function(data){this.set("userList",data)},error:function(){console.log("Fail connect to server")}})},updatePreviewUser:function(uid){var hasUid=_.contains(uid,this.get("previewUid"));if(!hasUid&&uid.length){var id=uid[0];this.set("previewUid",id),Backbone.$.ajax({type:"POST",url:this.get("previewUserUrl"),data:{uid:id},context:this,success:function(data){this.set("previewUser",data)},error:function(){console.log("Fail connect to server")}})}}});return UserList}),define("segment-item-view",["underscore","backbone"],function(_,Backbone){var SegmentItemView=Backbone.View.extend({events:{"click .filter-rename":"onRenameFilterClick"},initialize:function(){this.listenTo(this.model,"change:filterObject",this.populateFilterObject)},render:function(){var id_,$el=this.$el,s_id=$el.data("id"),name=$el.data("name"),updateUrl=$el.data("update-url"),filterObject=$el.data("filter");return s_id&&(id_=parseInt(s_id,10)),this.id=id_,this.name=name,this.updateUrl=updateUrl,this.filterObject=filterObject,this},getUpdateForm:function(){return Backbone.$("#form-update-segment")},onRenameFilterClick:function(){var updateUrl=this.updateUrl,name=this.name,$form=this.getUpdateForm(),$nameInput=$form.find('input[name="name"]');$form.attr("action",updateUrl),$nameInput.val(name)},populateFilterObject:function(){var value=this.model.get("filterObject"),isEqualFilter=_.isEqual(this.filterObject,value);this.$el.toggleClass("active",isEqualFilter)}});return SegmentItemView}),define("segment-list-view",["underscore","backbone","segment-item-view"],function(_,Backbone,SegmentItemView){var SegmentListView=Backbone.View.extend({events:{"click .segment-head-control.left":"scrollLeft","click .segment-head-control.right":"scrollRight"},render:function(){var segmentHead=this.$(".segment-head"),segmentEls=this.$(".segment-item");this.segmentHead=segmentHead,this.itemViews=_.map(segmentEls,function(el){return new SegmentItemView({model:this.model,el:el})},this),_.each(this.itemViews,function(view){view.render()});var lazy_resize=_.debounce(this.onResize.bind(this),400);return Backbone.$(window).on("resize",lazy_resize),this.onResize(),this},onResize:function(){var leftOffset=(this.containerWidth(),this.childrenWidthSum(),this.leftOffset()),leftOverflow=Math.floor(leftOffset)<0,rightOverflow=Math.floor(this.rightOffset())>0;this.$el.toggleClass("left-overflow",leftOverflow),this.$el.toggleClass("right-overflow",rightOverflow)},activateSegment:function(segment_id){var segmentView=_.find(this.itemViews,function(view){return view.id===segment_id}),$segmentEl=segmentView.$el,pos=$segmentEl.position().left+$segmentEl.outerWidth(),containerWidth=this.containerWidth();if(pos>containerWidth){var amount=pos-containerWidth;this.segmentHead.css("left",-amount+"px"),_.delay(this.onResize.bind(this),500)}},scrollLeft:function(){var leftOffset=this.leftOffset(),suggestedAmount=this.scrollAmount(),scrollAmount=Math.min(Math.abs(leftOffset),suggestedAmount);this.segmentHead.css("left",leftOffset+scrollAmount+"px"),_.delay(this.onResize.bind(this),500)},scrollRight:function(){var leftOffset=this.leftOffset(),rightOffset=this.rightOffset(),suggestedAmount=this.scrollAmount(),scrollAmount=Math.min(Math.abs(rightOffset),suggestedAmount);this.segmentHead.css("left",leftOffset-scrollAmount+"px"),_.delay(this.onResize.bind(this),500)},scrollAmount:function(){return.8*this.containerWidth()},leftOffset:function(){return this.segmentHead.position().left},rightOffset:function(){return this.childrenWidthSum()+this.leftOffset()-this.containerWidth()},containerWidth:function(){return this.$el.outerWidth()},childrenWidthSum:function(){return _.chain(this.itemViews).map(function(view){return view.$el.outerWidth()}).reduce(function(sum,width){return sum+width},0).value()}});return SegmentListView}),define("company-filter",["underscore","backbone","filter"],function(_,Backbone,Filter){var CompanyFilter=function(attributes,options){Backbone.Model.call(this,attributes,options)},companyTypeMap=_.chain(Filter.typeMap).pairs().filter(function(pair){var key=pair[0];return 0===key.indexOf("company.")}).map(function(pair){var key=pair[0],value=pair[1];return[key.substring(8),value]}).object().value();return _.extend(CompanyFilter.prototype,Filter.prototype),_.extend(CompanyFilter,Filter,{typeMap:companyTypeMap}),CompanyFilter}),define("company-list-view",["underscore","backbone","query","company-filter","list-filter-view","list-filter-date-view","list-filter-boolean-view","item-list-action-bar-view"],function(_,Backbone,Query,CompanyFilter,ListFilterView,DateFilterView,BooleanFilterView,ItemListActionBarView){var CompanyListView=function(options){Backbone.View.call(this,options)};return _.extend(CompanyListView.prototype,Backbone.View.prototype,{initialize:function(options){this.message=options.message,this.previewValMap=options.previewValMap,this.filterViewMap={},this.query=new Query(Query.createFromJson(options.query),{model:CompanyFilter}),this.url=options.url,this.currentFilterString=this.query.toFilterString(),_.each(Backbone.$("#company-filter>.attribute"),this.addFilter,this),this.segmentCreationFormFilterInput=Backbone.$("#form-create-segment #filter"),this.initCompanyTableHeader(),this.actionBar=new ItemListActionBarView({model:this.model,el:this.$("#companies-listing-header")}),this.model.setQueryString(this.query.toFilterString()),this.afterQueryChanged=_.debounce(_.bind(this.afterQueryChanged,this),300),this.onNextPageClick=_.bind(this.onNextPageClick,this),this.listenTo(this.model,"change:filterOpened",this.populateFilterOpened),this.listenTo(this.model,"change:companyList",this.onColumnChange)
},remove:function(){Backbone.View.remove.call(this),_.each(this.filterViewMap,function(){view.remove()}),this.filterViewMap=null,this.currentFilterString=null,this.initCompanyTableHeader=null,this.afterQueryChanged=null,this.onNextPageClick=null,$(window).off(".CompanyListView")},render:function(){return this.filterContainer=this.$("#company-filter-container"),this.actionBar.render(),this.$el.removeClass("loading"),this},delegateEvents:function(){this.undelegateEvents(),this.query.on("change add remove",this.afterQueryChanged),this.$el.on("click",".next-page",this.onNextPageClick)},filterViewClass:function(type){return{numeric:ListFilterView,string:ListFilterView,date:DateFilterView,"boolean":BooleanFilterView}[type]},addFilter:function(attribute){var node,attrName,attrType,filterView,Klass;node=$(attribute),attrName=$(attribute).data("id"),attrType=$(attribute).data("type"),Klass=this.filterViewClass(attrType),filterView=new Klass({el:node,field:attrName,query:this.query,filters:this.query.getFiltersByName(attrName)}),filterView.render(),this.filterViewMap[attrName]=filterView},initCompanyTableHeader:function(){var table=this.$("#company-table .companies-table-content>table"),tableHeaders=table.find("td[data-field]");!function(that){tableHeaders.on("click",function(){var $el=$(this),field=$el.data("field"),desc=!0;$el.hasClass("desc")&&(desc=!1);var map={};map[field]=desc?"desc":"asc",that.model.setOrder(map),that.fetch()})}(this)},afterQueryChanged:function(){var newFilterObject=this.query.toFilterObject(),newFilterString=this.query.toFilterString();this.model.set("filterObject",newFilterObject),this.currentFilterString!==newFilterString&&(this.currentFilterString=newFilterString,this.model.setQueryString(newFilterString),this.fetch()),this.syncSegmentCreationFormFilterInput()},syncSegmentCreationFormFilterInput:function(){this.segmentCreationFormFilterInput.val(this.currentFilterString)},fetch:function(){var pageUrl,paramString=Backbone.$.param(this.model.get("param")),requestUrl=this.url+".html?"+paramString;history.pushState&&(pageUrl=this.url+"?"+paramString,history.pushState(null,null,pageUrl)),this.$(".companies-table-content").addClass("loading"),$.ajax({type:"GET",url:requestUrl,context:this,success:function(data){this.onCompanyListFetched(data)},error:function(){console.log("Fail connect to server")}})},onCompanyListFetched:function(data){var $el=Backbone.$(data),count=$el.data("count"),totalCount=$el.data("total-count");this.$("#company-table .companies-table-content").remove(),this.$("#company-table").append(data),this.initCompanyTableHeader(),this.model.set({itemCount:count,itemTotalCount:totalCount})},onColumnChange:function(){this.onCompanyListFetched(this.model.get("companyList"))},onNextPageClick:function(e){e.preventDefault();var node;node=$(e.target),requestUrl=node.attr("href"),$.ajax({type:"GET",url:requestUrl,context:this,beforeSend:function(){node.data("org-text",node.html()),node.data("loading",!0),this.$(".pagination td").addClass("loading")},success:function(data){var $el=Backbone.$(data),count=$el.data("count"),totalCount=$el.data("total-count"),newList=$(data);this.$(".pagination").remove(),this.$("tbody").append(newList),this.model.set({itemCount:count,itemTotalCount:totalCount})},error:function(){node.html(node.data("org-text")),node.removeData("org-text"),node.removeData("loading"),alert("Fail connect to server")}})},populateFilterOpened:function(){var value=this.model.get("filterOpened");this.filterContainer.toggleClass("active",value)}}),CompanyListView}),define("conversation-action",["underscore","backbone","smoothScroll"],function(_,Backbone,smoothScroll){var ConversationActionView=function(options){Backbone.View.call(this,options)};return _.extend(ConversationActionView.prototype,Backbone.View.prototype,{initialize:function(options){this.hasSmoothScroll=void 0!==options.hasSmoothScroll?options.hasSmoothScroll:!0,this.submitTarget=options.submitTarget,this.currentTarget=null,this.currentTab=null,this.switchAction=_.bind(this.switchAction,this),this.onSubmit=_.bind(this.onSubmit,this),this.onButtonClick=_.bind(this.onButtonClick,this),this.listenTo(this,"close:conversation reply-close:conversation reopen:conversation",this.onReopenClose)},remove:function(){Backbone.View.prototype.remove.call(this),this.currentTarget=null,this.switchAction=null,this.onSubmit=null,this.onButtonClick=null},render:function(){var target;this.currentTab=this.$(".conversation-action-types .active"),target=this.currentTab.data("target"),this.currentTarget=this.$actionDiv(target),this.$(".conversation-action-types").length&&this.hasSmoothScroll&&smoothScroll.animateScroll(null,".conversation-action-types",{speed:0,easing:"Linear"}),this.$el.on("click","button",this.onButtonClick),this.$("form").on("submit",this.onSubmit)},$actionDiv:function(type){return this.$(".conversation-actions ."+type)},delegateEvents:function(){this.$el.on("click",".conversation-action-types li",this.switchAction)},switchAction:function(e){var targetName;return target=this.$(e.currentTarget),target.hasClass("active")?(target.removeClass("active"),void this.currentTarget.removeClass("active")):(this.currentTab.removeClass("active"),target.addClass("active"),this.currentTab=target,this.currentTarget.removeClass("active"),targetName=target.data("target"),this.currentTarget=this.$actionDiv(targetName),this.currentTarget.addClass("active"),this.hasSmoothScroll&&smoothScroll.animateScroll(null,"#conversation-action-"+targetName,{speed:200}),void 0)},onButtonClick:function(e){this.currentAction=$(e.currentTarget).val()},onSubmit:function(e){e.preventDefault();var theForm=$(e.target),formData={conversation_id:theForm.find("[name=conversation_id]").val(),content:theForm.find("[name=content]").val(),assignee_id:theForm.find("[name=assignee_id]").val(),action:this.currentAction},url=theForm.attr("action");return"reply"===this.currentAction&&""===formData.content?void alert("Please fill in the reply message."):"note"===this.currentAction&&""===formData.content?void alert("Please fill in the notes."):("reply-close"===this.currentAction&&(url+="_close"),Backbone.ajax({type:"POST",url:url+".pajax",data:formData,context:this,success:this.onSubmitOK,error:this.onSubmitError}),this.$(".active").removeClass("active"),void this.$el.addClass("loading"))},onSubmitOK:function(data){this.$("[name=content]").val("");var $targetEl=Backbone.$(data);this.submitTarget.append($targetEl),this.$el.removeClass("loading");var action=$targetEl.data("action");if("assign"===action||"close"===action||"reply-close"===action||"reopen"===action){var conversationId=$targetEl.data("conversation"),assigneeId=$targetEl.data("assignee");this.trigger(action+":conversation",conversationId,assigneeId)}},onSubmitError:function(){alert("Fail connect to server"),this.$el.removeClass("loading")},onReopenClose:function(){this.$("li[data-target=reopen]").toggleClass("hide"),this.$("li[data-target=close-msg]").toggleClass("hide"),this.$("li#conversation-action-reply [value=reply-close]").toggleClass("hide")}}),ConversationActionView}),define("conversation-router",["backbone"],function(Backbone){var ConversationRouter=Backbone.Router.extend({routes:{"app/:appId/conversation/:conversationId":"viewConversation","app/:appId/conversations/agent/:agentId":"viewAgentConversations"},initialize:function(options){this.conversationIndex=options.conversationIndex;var evt=options.evt;this.listenTo(evt,"agent:selected",this.onAgentSelected),this.listenTo(evt,"conversation:selected",this.onConversationSelected),this.evt=evt,this.route(/^app\/(.+)\/conversations\/(anyone|nobody)$/,"viewAgentConversations")},viewConversation:function(appId,conversationId){this.conversationIndex.loadAgentConversation(conversationId)},viewAgentConversations:function(appId,agentId){this.conversationIndex.loadAgentConversationList(agentId)},pathFromUrl:function(url){return url.substring(document.location.origin.length+1)},onAgentSelected:function(url){var path=this.pathFromUrl(url);this.navigate(path,{trigger:!0})},onConversationSelected:function(url){var path=this.pathFromUrl(url);this.navigate(path,{trigger:!0})}});return ConversationRouter}),define("text!templates/mustache/conversation-list-loading.mustache",[],function(){return'<ul><li class="loading">\n  <span class="spining icon-spin">&nbsp;</span>Loading message\n</li></ul>\n'}),define("text!templates/mustache/conversation-loading.mustache",[],function(){return'<h3>\n  <span class="spining icon-spin">&nbsp;</span>Loading message\n</h3>\n'}),define("text!templates/mustache/conversation-init.mustache",[],function(){return"<h3>Please select a message</h3>\n"}),define("conversation-index",["underscore","backbone","conversation-action","text!templates/mustache/conversation-list-loading.mustache","text!templates/mustache/conversation-loading.mustache","text!templates/mustache/conversation-init.mustache"],function(_,Backbone,ConversationActionView,listLoading,msgLoading,initMsg){function scrollIntoViewIfNeeded($container,$descendent){var containerHeight=$container.height(),scrollTop=$container.scrollTop(),scrollBottom=scrollTop+containerHeight,height=$descendent.height(),pos=$descendent.position(),top=pos.top,bottom=pos.top+height;return scrollTop>top?void $descendent.get(0).scrollIntoView():top>scrollTop&&bottom>scrollBottom?void $descendent.get(0).scrollIntoView(!1):void 0}var ConversationIndexView=function(options){Backbone.View.call(this,options)};return _.extend(ConversationIndexView.prototype,Backbone.View.prototype,{events:{"click .agent-head a":"clickAgent","click .conversation-list a":"clickConversation"},initialize:function(options){this.currentAgent=null,this.actionsView=null,this.evt=options.evt},remove:function(){Backbone.View.prototype.remove.call(this),this.actionsView=null,this.currentAgent=null},render:function(){var url;this.$agents=this.$(".agent-head li[data-agent]"),this.currentAgent=this.$(".agent-head .active"),url=this.currentAgent.find("a").attr("href"),this.listContainer=this.$(".conversation-list"),this.$conversations=this.listContainer.find("ul li"),this.activeConversation=this.$conversations.filter(".active"),this.conversationContainer=this.$(".conversation-content"),this.activeConversation.length>0&&scrollIntoViewIfNeeded(this.listContainer.children(".conversation-list-wrap"),this.activeConversation),this.$(".conversation-content .conversation-action-container")&&this._onConversationLoad()},setCurrentAgent:function(agentId){var $agent=this.getAgent(agentId);this.currentAgent&&this.currentAgent.removeClass("active"),$agent.addClass("active"),this.currentAgent=$agent},getAgent:function(agentId){return this.$agents.filter("[data-agent="+agentId+"]")},updateConversationCount:function(fromId,toId){"nobody"!==fromId&&"closed"!==fromId&&this.decrementAgentConversationCount("anyone"),this.decrementAgentConversationCount(fromId),"nobody"!==fromId&&"closed"!==fromId||"nobody"===toId||"closed"===toId||this.incrementAgentConversationCount("anyone"),this.incrementAgentConversationCount(toId)},setConversationAssignee:function(assigneeId){this.conversationContainer.find(".conversations").data("assignee",assigneeId)},getConversationAssignee:function(){return this.conversationContainer.find(".conversations").data("assignee")},incrementAgentConversationCount:function(agentId){var $agent=this.getAgent(agentId),$count=$agent.find(".count"),count=parseInt($count.text(),10);$count.text(count+1)},decrementAgentConversationCount:function(agentId){var $agent=this.getAgent(agentId),$count=$agent.find(".count"),count=parseInt($count.text(),10);$count.text(count-1)},clickAgent:function(e){e.preventDefault();var currentTarget=$(e.currentTarget),li=currentTarget.parent();this.loadAgentConversationList(li.data("agent")),this.evt.trigger("agent:selected",currentTarget.attr("href"))},loadAgentConversationList:function(agentId){this.setCurrentAgent(agentId);var url=this.currentAgent.find(">a:first-child").attr("href");this.loadList(url)},loadList:function(url){this.listContainer.html(listLoading),this.conversationContainer.html(initMsg),this._listUrl=url,Backbone.ajax({type:"GET",url:url+".pajax",context:this,success:function(data,textStatus,jqXHR){this._listUrl==url&&this.onListLoad(data,textStatus,jqXHR)},error:this.onListError})},onListLoad:function(data){this.listContainer.html(Backbone.$(data).children()),this.$conversations=this.listContainer.find("ul li"),this.activeConversation=null},onListError:function(){console.log("Fail connect to server")},removeConversation:function(conversationId){var $conversation=this.$conversations.filter("[data-id="+conversationId+"]");$conversation.remove()},setActiveConversation:function(conversationId){var $conversation=this.$conversations.filter("[data-id="+conversationId+"]");this.activeConversation&&this.activeConversation.removeClass("active"),$conversation.addClass("active"),this.activeConversation=$conversation;var $list=this.listContainer.children(".conversation-list-wrap");$item=$list.find("li.active"),$item.length>0&&scrollIntoViewIfNeeded($list,$item)},clickConversation:function(e){e.preventDefault();var currentTarget=$(e.currentTarget),li=currentTarget.children("li"),conversationId=li.data("id");this.setActiveConversation(conversationId),this.evt.trigger("conversation:selected",currentTarget.attr("href"))},loadAgentConversation:function(conversationId){this.setActiveConversation(conversationId);var url=this.activeConversation.parent().attr("href");this.loadConversation(url)},loadConversation:function(url){this.actionsView&&(this.stopListening(this.actionsView),this.actionsView.remove()),this._convUrl=url,this.conversationContainer.html(msgLoading),Backbone.ajax({type:"GET",url:url+".pajax",context:this,success:function(data,textStatus,jqXHR){this._convUrl==url&&this.onConversationLoad(data,textStatus,jqXHR)},error:this.onConversationError})},onConversationLoad:function(data){this.conversationContainer.html(data),this._onConversationLoad()},_onConversationLoad:function(){this.actionsView=new ConversationActionView({el:this.$(".conversation-content .conversation-action-container"),submitTarget:this.$(".conversation-content .conversations")}),this.actionsView.render(),this.listenTo(this.actionsView,"assign:conversation",this.onConversationAssign),this.listenTo(this.actionsView,"close:conversation",this.onConversationClose),this.listenTo(this.actionsView,"reply-close:conversation",this.onConversationClose),this.listenTo(this.actionsView,"reopen:conversation",this.onConversationReopen);var conversationId=this.conversationContainer.find("ul.conversations").data("id"),assigneeId=this.conversationContainer.find(".conversations").data("assignee");this.setActiveConversation(conversationId),"closed"!==this.currentAgent.data("agent")&&"anyone"!==this.currentAgent.data("agent")&&this.setCurrentAgent(assigneeId)},onConversationError:function(){console.log("Fail connect to server")},onConversationAssign:function(conversationId,assigneeId){var currentAgentId=this.currentAgent.data("agent"),currentAssigneeId=this.getConversationAssignee();"closed"!==currentAgentId&&(this.updateConversationCount(currentAssigneeId,assigneeId),this.removeConversation(conversationId)),this.setConversationAssignee(assigneeId)},onConversationClose:function(conversationId){var currentAssigneeId=(this.currentAgent.data("agent"),this.getConversationAssignee());this.updateConversationCount(currentAssigneeId,"closed"),this.removeConversation(conversationId)},onConversationReopen:function(conversationId){var currentAssigneeId=(this.currentAgent.data("agent"),this.getConversationAssignee());this.updateConversationCount("closed",currentAssigneeId),this.removeConversation(conversationId)}}),ConversationIndexView}),define("cit-session",["jquery","store","jquery.cookie"],function($,Store){var CitSession={SESSION_ID_KEY:"_cit_sessionId",_getFromStore:function(){return Store.get(this.SESSION_ID_KEY)},install:function(settings){settings.session_id=this.getId()},getId:function(){var id=$.cookie(this.SESSION_ID_KEY);return id||(id=this._getFromStore()),id}};return CitSession}),define("citofono-boot",["underscore"],function(_){function cleanup(settings){_.chain(_.keys(settings)).map(function(key){delete settings[key]}).values()}return function(citofono,settings){settings=settings||{};var thatSettings=citofono.settings||(citofono.settings={}),app_uid=thatSettings.app_uid;cleanup(thatSettings),thatSettings.app_uid=app_uid,_.extend(thatSettings,settings),citofono.initialize(thatSettings)}}),define("Citofono",["jquery","underscore","timedQueue","socket-io","cit-session","citofono-boot","AppSetting","message","AppClient","cit-view"],function($,_,TimedQueue,io,CitSession,boot_citofono,AppSetting,Message,app,CitView){function onCitButtonPressed(){this.showMessage()}function Citofono(settings,options){this.options=options||{},this.settings=settings,this.messages=[],this.lastActiveTime=new Date,this.evt=this.options.evt,this.evt&&this.evt.on("click:citButton",onCitButtonPressed,this),this.initialize.apply(this,settings),this.updateLastActiveTime=_.bind(this.updateLastActiveTime,this),this.pingServer=_.bind(this.pingServer,this),this.pushEvt=_.bind(this.pushEvt,this),this.queue=new TimedQueue("evts",this.pushEvt),$("body").mousemove(this.updateLastActiveTime)}return Citofono.prototype={initialize:function(){this.initPromise=$.Deferred(),CitSession.install(this.settings),this.initWidgetSetting(),this.initViews()},initViews:function(){this.citView=new CitView({citofono:this,evt:this.evt}),this.citView.render()},initSocketIO:function(){var user_uid=this.getSettingUserUid();if(user_uid){var socket,joinChannel=function(socket,channel,ping,initPromise){socket.on("message",function(){ping()}),socket.emit("join",channel),initPromise.resolve()},pingServer=this.pingServer.bind(this),channel=["ping",user_uid].join(":");this.socket?(socket=this.socket,socket.off(),joinChannel(socket,channel,pingServer,this.initPromise)):(socket=io(AppSetting.socketIoUrl),socket.on("connect",function(){this.socket=socket,joinChannel(socket,channel,pingServer,this.initPromise)}.bind(this))),window.setTimeout(function(initPromise){initPromise.resolve()}.bind(null,this.initPromise),2e3)}},initWidgetSetting:function(){if(void 0!==this.settings){var widgetSetting=this.settings.widget;this.hasWidgetActivator=!1,this.isDefaultWidgetActivator=!1,void 0!==widgetSetting&&(this.hasWidgetActivator=void 0!==widgetSetting.activator,this.widgetActivatorSelector=widgetSetting.activator,this.hasWidgetActivator&&"#retaindefaultbutton"===this.widgetActivatorSelector.toLowerCase()&&(this.widgetActivatorSelector="#RetainDefaultButton",this.isDefaultWidgetActivator=!0)),this.widgetSetting=widgetSetting}try{this.widgetTitle=this.settings.widget.title}catch(err){}try{this.widgetPlaceholder=this.settings.widget.placeholder}catch(e){}},onClientConfigFetched:function(config){this.widgetSetting&&!config.appFinishedInstallation&&$.ajax({type:"GET",url:_.template(AppSetting.widgetConfiguredUrl,{app_uid:this.getAppUid()})})},validateSettings:function(settings){return Boolean(settings.no_tracking_visitor?settings.app_uid&&!this.isSettingsAnonymous(settings):settings.app_uid)},decorateSettings:function(settings){_.extend(settings,{last_seen_referrer:document.referrer||null})},isSettingsAnonymous:function(settings){return settings=settings||this.settings,!Boolean(settings.user_id||settings.email)},getSettingString:function(){this.settings;delete this.settings.widget;var settings_copy=_.extend({},this.settings);return delete settings_copy.no_tracking_visitor,JSON.stringify(settings_copy)},getUserIdentifier:function(){var settings=this.settings;return settings.user_id||settings.email||settings.session_id},getSettingUserUid:function(){var settings=this.settings||{};if(!this.validateSettings(settings))return null;var app_uid=settings.app_uid,user_id=this.getUserIdentifier();return[app_uid,user_id].join(":")},pingServer:function(callback){var that=this;if(void 0!==this.settings){if(this.validateSettings(this.settings)){this.decorateSettings(this.settings);var pingPromise=$.ajax({type:"POST",url:AppSetting.pingUrl,data:this.getSettingString(),contentType:"application/json; charset=utf-8",xhrFields:{withCredentials:!0},success:function(data){void 0!=data.message&&(that.messages.push(data.message),that.showMessage()),that.scheduleNextPing(),callback&&callback()}});return pingPromise.then(function(data){this.settings.session_id=data.session_id,this.initSocketIO(),this.showEmailLeadResultIfAny(data)}.bind(this)),pingPromise}console.log("retainSettings is not valid, retry in 500ms"),setTimeout(function(){that.pingServer()},500)}else console.log("retainSettings must be specified, retry in 500ms"),setTimeout(function(){that.pingServer()},500)},to_email_lead:function(email,context){var obj={email:email},deferred=$.ajax({type:"POST",url:_.template(AppSetting.emailLeadFormUrl,{app_uid:this.settings.app_uid}),xhrFields:{withCredentials:!0},data:obj,context:context});return deferred.promise()},getUserData:function(){return void 0===this.settings?{}:{user_id:this.settings.user_id,email:this.settings.email,session_id:this.settings.session_id,app_uid:this.settings.app_uid,name:this.settings.name,user_hash:this.settings.user_hash,created_at:this.settings.created_at}},getAppUid:function(){return this.settings.app_uid},sendHaveSeenToServer:function(message){data=this.getUserData(),data.message_id=message.id,$.ajax({type:"PUT",url:AppSetting.baseUrl+"/api/user/message/seen",xhrFields:{withCredentials:!0},data:JSON.stringify(data),contentType:"application/json; charset=utf-8"})},updateLastActiveTime:function(){this.lastActiveTime=new Date},showMessage:function(){var currentMessage=this.messages.pop();if(void 0!==currentMessage){var message=new Message(currentMessage);this.evt.trigger("show:message",message),message.id&&this.sendHaveSeenToServer(message)}else this.evt.trigger("show:newConversation");return!1},showEmailLeadResultIfAny:function(pingResult){var content=pingResult._lead_toast;if(content){var message={delivery:"email-lead-form-result",content:content};this.messages.push(message),this.showMessage()}},scheduleNextPing:function(){var now=new Date;now-this.lastActiveTime<=1e5?setTimeout(this.pingServer,3e5):setTimeout(this.pingServer,6e5)},track:function(evtName,data){this.queue.push({evt:evtName,data:data})},pushEvt:function(raw){var evtName,data,payload;evtName=raw.evt,data=raw.data,payload={event:evtName,custom_data:data},this.settings.company&&this.settings.company.id&&(payload.company_id=this.settings.company.id),$.ajax({type:"POST",url:AppSetting.evtUrl,data:JSON.stringify(payload),headers:{"RETAIN-UID":this.getUserIdentifier(),"RETAIN-HASH":this.settings.user_hash},contentType:"application/json; charset=utf-8"})},boot:function(settings){boot_citofono(this,settings)}},Citofono}),define("PublicRetain",["jquery","underscore","AppSetting"],function($,_,AppSetting){function merge(dst,src){if(!_.isObject(dst))throw new TypeError("merge destination: expected object, got "+dst);_.chain(src).pairs().each(function(pair){var key=pair[0],src_value=pair[1],dst_value=dst[key];_.isObject(src_value)?_.isObject(dst_value)?merge(dst_value,src_value):dst[key]=src_value:dst[key]=src_value}).value()}function popCallback(obj,name){var callback=obj[name]||$.noop;return delete obj[name],callback}function PublicRetain(_citofono,_retaincc){var citofono=_citofono,_retaincc=_retaincc;if(this.push=function(){var calling=arguments[0];citofono.initPromise.always(function(){this[calling.shift()].apply(this,calling)}.bind(this))},this.track=function(evtName,data){citofono.track(evtName,data)},this.attrs=function(key,val){var settingsDelta;_.isObject(key)?settingsDelta=key:(settingsDelta={})[key]=val;var blacklist=[],settings=citofono.settings;settings.user_id?blacklist.push("user_id"):settings.email&&blacklist.push("email");var blacklisted=_.any(blacklist,function(key){return _.has(settingsDelta,key)});if(blacklisted)throw new Error("user identifier cannot be modify in-place");return merge(citofono.settings,settingsDelta),citofono.pingServer()},this.lead=function(obj){var ajaxDeferred,deferred=$.Deferred(),promise=deferred.promise(),successCallback=popCallback(obj,"_onSuccess"),errorCallback=popCallback(obj,"_onError");return promise.then(successCallback,errorCallback),obj.email?(obj._responseText||(obj=_.extend({},obj,{__no_toast:!0})),ajaxDeferred=$.ajax({type:"POST",url:_.template(AppSetting.emailLeadFormUrl,{app_uid:citofono.settings.app_uid}),data:obj,xhrFields:{withCredentials:!0}}),ajaxDeferred.then(function(){obj._responseText&&citofono.pingServer(),deferred.resolve()},function(xhr){var errors=xhr.responseJSON.errors,message=errors[0].message;deferred.reject(message)}),promise):(deferred.reject("email cannot be blank"),promise)},_.isArray(_retaincc))for(var i=0;i<_retaincc.length;i++)this.push(_retaincc[i]);this.boot=function(settings){citofono.boot(settings),citofono.pingServer()}}return PublicRetain}),define("ClientConfig",["jquery","underscore","AppSetting","AppClient"],function($,_,AppSetting,app){function ClientConfig(){this.initialize.apply(this)}return ClientConfig.prototype={initialize:function(){this.widgetTitle=app.citofono.widgetTitle?app.citofono.widgetTitle:"Have a question?",this.widgetPlaceholder=app.citofono.widgetPlaceholder?app.citofono.widgetPlaceholder:"Leave your message here",this.initConfigFromServer()},initConfigFromServer:function(){this.serverConfigFetchable()&&$.ajax({type:"GET",url:_.template(AppSetting.configUrl,{app_uid:app.citofono.getAppUid()}),contentType:"application/json; charset=utf-8",context:this,success:function(data){!app.citofono.widgetTitle&&data.message_box_title&&(this.widgetTitle=data.message_box_title),!app.citofono.widgetPlaceholder&&data.message_box_placeholder&&(this.widgetPlaceholder=data.message_box_placeholder),this.appFinishedInstallation=data.finished_installation,app.citofono.onClientConfigFetched(this)}})},serverConfigFetchable:function(){return Boolean(app.citofono.getAppUid())}},ClientConfig}),define("text!templates/mustache/event-rules.mustache",[],function(){return'{{#prim}}\n<p class="events">\n  When user trigger <strong>{{name}}</strong> {{threshold}} times\n</p>\n{{/prim}}\n{{#timed}}\n<p class="events past-events">\n  and <strong>{{name}}</strong> {{comparator}} {{threshold}}\n  in {{span}} {{spanType}} {{type}}\n</p>\n{{/timed}}\n'}),define("text!templates/mustache/event-rules-emptiable.mustache",[],function(){return"{{#event}}\n  <h5>Event</h5>\n  {{> eventRules}}\n{{/event}}\n"}),define("text!templates/mustache/event.mustache",[],function(){return'{{#user}}\n  {{name}} {{#company}}<small>({{name}})</small>{{/company}}\n{{/user}}\ntriggered <strong><em>{{event}}</em></strong> <span class="at">at</span> <span class="date">{{received_at}}</span>\n{{#custom_data}} with data {{/custom_data}}'}),define("text!templates/mustache/event-list.mustache",[],function(){return'<ul id="event-list">\n</ul>\n{{#has_next_page}}\n<p class="more-event">and more...</p>\n{{/has_next_page}}\n{{^events}}\n<p class="no-event"><em>No events has been recorded for this user yet.</em></p>\n{{/events}}\n'}),require(["domReady","text","jquery","jquery.cookie","foundation","foundation.joyride","underscore","backbone","moment","mustache","pikaday","smoothScroll","socket-io","store","timedQueue","prettyJson","onboardTutorial","demoLogoutPrompt","channel","message","message-schedule","message-mode","filter","query","event-factory","event-serializer","event-machine","event-primary-event","event-timed-event","event-condition","auto-message-router","auto-message-wizard","auto-message-creator","auto-message-editor","auto-message-event-widget","auto-message-subevent-view","auto-message-query-widget","auto-message-filter-view","auto-message-message-widget","auto-message-recurrence-view","auto-message-view","message-form","message-schedule-view","message-preview","message-content","message-email","message-conversation","message-insert-var","event-editor","event-condition-editor","cit-button","cit-view","filter-view","query-view","query-result-view","column-control-view","users-list-view","user-list","segment-list-view","segment-item-view","company-list-view","list-filter-base","list-filter-view","list-filter-date-view","list-filter-boolean-view","list-filter-birthday-view","list-filter-user-type-view","user-manual-message","conversation-action","conversation-router","conversation-index","flash-view","Citofono","PublicRetain","AppSetting","AppClient","ClientConfig","text!templates/mustache/event-rules.mustache","text!templates/mustache/event-rules-emptiable.mustache","text!templates/mustache/event.mustache","text!templates/mustache/event-list.mustache"],function(){}),define("main",function(){});
//# sourceMappingURL=main.js.map